!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";!function(e){var t,n,o,r,i,s,a,c,l,u;function h(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function d(e){return e="string"!=typeof e?String(e):e}function f(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function p(t){this.map={},t instanceof p?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function g(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function m(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function y(e){var t=new FileReader,n=m(t);return t.readAsArrayBuffer(e),n}function v(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e)if("string"==typeof e)this._bodyText=e;else if(o&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(r&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(i&&o&&a(e))this._bodyArrayBuffer=v(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(e)&&!c(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=g(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var e,t,n=g(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=m(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(e,t){var n,r=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new p(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new p(t.headers)),this.method=(n=t.method||this.method||"GET",e=n.toUpperCase(),-1<l.indexOf(e)?e:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function b(e){var n=new FormData;return e.trim().split("&").forEach(function(e){var t;e&&(e=(t=e.split("=")).shift().replace(/\+/g," "),t=t.join("=").replace(/\+/g," "),n.append(decodeURIComponent(e),decodeURIComponent(t)))}),n}function I(e,t){t=t||{},this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new p(t.headers),this.url=t.url||"",this._initBody(e)}e.fetch||(t="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,o="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),r="FormData"in e,(i="ArrayBuffer"in e)&&(s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=function(e){return e&&DataView.prototype.isPrototypeOf(e)},c=ArrayBuffer.isView||function(e){return e&&-1<s.indexOf(Object.prototype.toString.call(e))}),p.prototype.append=function(e,t){e=h(e),t=d(t);var n=this.map[e];this.map[e]=n?n+","+t:t},p.prototype.delete=function(e){delete this.map[h(e)]},p.prototype.get=function(e){return e=h(e),this.has(e)?this.map[e]:null},p.prototype.has=function(e){return this.map.hasOwnProperty(h(e))},p.prototype.set=function(e,t){this.map[h(e)]=d(t)},p.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},p.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),f(n)},p.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),f(t)},p.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),f(n)},n&&(p.prototype[Symbol.iterator]=p.prototype.entries),l=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},_.call(w.prototype),_.call(I.prototype),I.prototype.clone=function(){return new I(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},I.error=function(){var e=new I(null,{status:0,statusText:""});return e.type="error",e},u=[301,302,303,307,308],I.redirect=function(e,t){if(-1===u.indexOf(t))throw new RangeError("Invalid status code");return new I(null,{status:t,headers:{location:e}})},e.Headers=p,e.Request=w,e.Response=I,e.fetch=function(n,s){return new Promise(function(r,e){var t=new w(n,s),i=new XMLHttpRequest;i.onload=function(){var n,e={status:i.status,statusText:i.statusText,headers:(t=i.getAllResponseHeaders()||"",n=new p,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t=e.split(":"),e=t.shift().trim();e&&(t=t.join(":").trim(),n.append(e,t))}),n)};e.url="responseURL"in i?i.responseURL:e.headers.get("X-Request-URL");var t="response"in i?i.response:i.responseText;r(new I(t,e))},i.onerror=function(){e(new TypeError("Network request failed"))},i.ontimeout=function(){e(new TypeError("Network request failed"))},i.open(t.method,t.url,!0),"include"===t.credentials?i.withCredentials=!0:"omit"===t.credentials&&(i.withCredentials=!1),"responseType"in i&&o&&(i.responseType="blob"),t.headers.forEach(function(e,t){i.setRequestHeader(t,e)}),i.send(void 0===t._bodyInit?null:t._bodyInit)})},e.fetch.polyfill=!0)}("undefined"!=typeof self?self:void 0);var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){var t={exports:{}};return e(t,t.exports),t.exports}function m(e){try{return!!e()}catch(e){return!0}}function g(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function r(e){return h.call(e).slice(8,-1)}function o(e){if(null==e)throw TypeError("Can't call method on "+e);return e}function c(e){return b(o(e))}function y(e){return"object"==typeof e?null!==e:"function"==typeof e}function i(e,t){if(!y(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!y(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!y(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!y(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}function w(e){return Object(o(e))}function n(e){return S?E.createElement(e):{}}function v(e){if(!y(e))throw TypeError(String(e)+" is not an object");return e}function l(t,n){try{P(_,t,n)}catch(e){_[t]=n}return n}var s=function(e){return e&&e.Math==Math&&e},_=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof e&&e)||function(){return this}()||Function("return this")(),d=!m(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),a={}.propertyIsEnumerable,u=Object.getOwnPropertyDescriptor,f={f:u&&!a.call({1:2},1)?function(e){e=u(this,e);return!!e&&e.enumerable}:a},h={}.toString,p="".split,b=m(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==r(e)?p.call(e,""):Object(e)}:Object,I={}.hasOwnProperty,T=Object.hasOwn||function(e,t){return I.call(w(e),t)},E=_.document,S=y(E)&&y(E.createElement),k=!d&&!m(function(){return 7!=Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}),C=Object.getOwnPropertyDescriptor,A={f:d?C:function(e,t){if(e=c(e),t=i(t,!0),k)try{return C(e,t)}catch(e){}if(T(e,t))return g(!f.f.call(e,t),e[t])}},R=Object.defineProperty,N={f:d?R:function(e,t,n){if(v(e),t=i(t,!0),v(n),k)try{return R(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},P=d?function(e,t,n){return N.f(e,t,g(1,n))}:function(e,t,n){return e[t]=n,e},O="__core-js_shared__",x=_[O]||l(O,{}),D=Function.toString;"function"!=typeof x.inspectSource&&(x.inspectSource=function(e){return D.call(e)});function M(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++Q+Y).toString(36)}var L,F,U,j,q,V,B,$,z=x.inspectSource,W=_.WeakMap,K="function"==typeof W&&/native code/.test(z(W)),H=!1,G=t(function(e){(e.exports=function(e,t){return x[e]||(x[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.15.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})}),Q=0,Y=Math.random(),J=G("keys"),s=function(e){return J[e]||(J[e]=M(e))},X={},Z="Object already initialized",e=_.WeakMap;B=K||x.state?(L=x.state||(x.state=new e),F=L.get,U=L.has,j=L.set,q=function(e,t){if(U.call(L,e))throw new TypeError(Z);return t.facade=e,j.call(L,e,t),t},V=function(e){return F.call(L,e)||{}},function(e){return U.call(L,e)}):($=s("state"),X[$]=!0,q=function(e,t){if(T(e,$))throw new TypeError(Z);return t.facade=e,P(e,$,t),t},V=function(e){return T(e,$)?e[$]:{}},function(e){return T(e,$)});function ee(e){return"function"==typeof e?e:void 0}function te(e,t){return arguments.length<2?ee(de[e])||ee(_[e]):de[e]&&de[e][t]||_[e]&&_[e][t]}function ne(e){return isNaN(e=+e)?0:(0<e?pe:fe)(e)}function re(e){return 0<e?ge(ne(e),9007199254740991):0}function ie(e,t){var n,r=c(e),i=0,s=[];for(n in r)!T(X,n)&&T(r,n)&&s.push(n);for(;t.length>i;)T(r,n=t[i++])&&(~ve(s,n)||s.push(n));return s}function se(e,t){for(var n=Te(t),r=N.f,i=A.f,s=0;s<n.length;s++){var o=n[s];T(e,o)||r(e,o,i(t,o))}}function oe(e,t){var n,r,i,s=e.target,o=e.global,a=e.stat,c=o?_:a?_[s]||l(s,{}):(_[s]||{}).prototype;if(c)for(n in t){if(r=t[n],i=e.noTargetGet?(i=Ne(c,n))&&i.value:c[n],!Re(o?n:s+(a?".":"#")+n,e.forced)&&void 0!==i){if(typeof r==typeof i)continue;se(r,i)}(e.sham||i&&i.sham)&&P(r,"sham",!0),he(c,n,r,e)}}function ae(){}function ce(e){return"<script>"+e+"</"+je+">"}var le,ue={set:q,get:V,has:B,enforce:function(e){return B(e)?V(e):q(e,{})},getterFor:function(n){return function(e){var t;if(!y(e)||(t=V(e)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return t}}},he=t(function(e){var t=ue.get,a=ue.enforce,c=String(String).split("String");(e.exports=function(e,t,n,r){var i=!!r&&!!r.unsafe,s=!!r&&!!r.enumerable,o=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof t||T(n,"name")||P(n,"name",t),(r=a(n)).source||(r.source=c.join("string"==typeof t?t:""))),e!==_?(i?!o&&e[t]&&(s=!0):delete e[t],s?e[t]=n:P(e,t,n)):s?e[t]=n:l(t,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&t(this).source||z(this)})}),de=_,fe=Math.ceil,pe=Math.floor,ge=Math.min,me=Math.max,ye=Math.min,a=function(a){return function(e,t,n){var r,i=c(e),s=re(i.length),o=function(e,t){e=ne(e);return e<0?me(e+t,0):ye(e,t)}(n,s);if(a&&t!=t){for(;o<s;)if((r=i[o++])!=r)return!0}else for(;o<s;o++)if((a||o in i)&&i[o]===t)return a||o||0;return!a&&-1}},ve={includes:a(!0),indexOf:a(!1)}.indexOf,_e=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],we=_e.concat("length","prototype"),be={f:Object.getOwnPropertyNames||function(e){return ie(e,we)}},Ie={f:Object.getOwnPropertySymbols},Te=te("Reflect","ownKeys")||function(e){var t=be.f(v(e)),n=Ie.f;return n?t.concat(n(e)):t},Ee=/#|\.prototype\./,O=function(e,t){e=ke[Se(e)];return e==Ae||e!=Ce&&("function"==typeof t?m(t):!!t)},Se=O.normalize=function(e){return String(e).replace(Ee,".").toLowerCase()},ke=O.data={},Ce=O.NATIVE="N",Ae=O.POLYFILL="P",Re=O,Ne=A.f,W=!m(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Pe=s("IE_PROTO"),Oe=Object.prototype,xe=W?Object.getPrototypeOf:function(e){return e=w(e),T(e,Pe)?e[Pe]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Oe:null},De=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,e={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(e,[]),r=e instanceof Array}catch(e){}return function(e,t){return v(e),function(e){if(!y(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(t),r?n.call(e,t):e.__proto__=t,e}}():void 0),Me=Object.keys||function(e){return ie(e,_e)},Le=d?Object.defineProperties:function(e,t){v(e);for(var n,r=Me(t),i=r.length,s=0;s<i;)N.f(e,n=r[s++],t[n]);return e},Fe=te("document","documentElement"),Ue="prototype",je="script",qe=s("IE_PROTO"),Ve=function(){try{le=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e;Ve=le?function(e){e.write(ce("")),e.close();var t=e.parentWindow.Object;return e=null,t}(le):((e=n("iframe")).style.display="none",Fe.appendChild(e),e.src=String("javascript:"),(e=e.contentWindow.document).open(),e.write(ce("document.F=Object")),e.close(),e.F);for(var t=_e.length;t--;)delete Ve[Ue][_e[t]];return Ve()};X[qe]=!0;var Be=Object.create||function(e,t){var n;return null!==e?(ae[Ue]=v(e),n=new ae,ae[Ue]=null,n[qe]=e):n=Ve(),void 0===t?n:Le(n,t)},K=te("navigator","userAgent")||"",e=_.process,a=e&&e.versions,O=a&&a.v8;O?Pt=(Nt=O.split("."))[0]<4?1:Nt[0]+Nt[1]:K&&(!(Nt=K.match(/Edge\/(\d+)/))||74<=Nt[1])&&(Nt=K.match(/Chrome\/(\d+)/))&&(Pt=Nt[1]);function $e(e){return T(Qe,e)&&(Ge||"string"==typeof Qe[e])||(Ge&&T(Ye,e)?Qe[e]=Ye[e]:Qe[e]=Je("Symbol."+e)),Qe[e]}function ze(e){return void 0!==e&&(Xe.Array===e||et[Ze]===e)}function We(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}function Ke(r,i,e){if(We(r),void 0===i)return r;switch(e){case 0:return function(){return r.call(i)};case 1:return function(e){return r.call(i,e)};case 2:return function(e,t){return r.call(i,e,t)};case 3:return function(e,t,n){return r.call(i,e,t,n)}}return function(){return r.apply(i,arguments)}}var He=Pt&&+Pt,Ge=!!Object.getOwnPropertySymbols&&!m(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&He&&He<41}),W=Ge&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Qe=G("wks"),Ye=_.Symbol,Je=W?Ye:Ye&&Ye.withoutSetter||M,Xe={},Ze=$e("iterator"),et=Array.prototype,e={};e[$e("toStringTag")]="z";function tt(e){if(null!=e)return e[ct]||e["@@iterator"]||Xe[at(e)]}function nt(e){var t=e.return;return void 0!==t&&v(t.call(e)).value}function rt(e,t){this.stopped=e,this.result=t}function it(e,t,n){function r(e){return s&&nt(s),new rt(!0,e)}function i(e){return d?(v(e),p?g(e[0],e[1],r):g(e[0],e[1])):p?g(e,r):g(e)}var s,o,a,c,l,u,h=n&&n.that,d=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),g=Ke(t,h,1+d+p);if(f)s=e;else{if("function"!=typeof(f=tt(e)))throw TypeError("Target is not iterable");if(ze(f)){for(o=0,a=re(e.length);o<a;o++)if((c=i(e[o]))&&c instanceof rt)return c;return new rt(!1)}s=f.call(e)}for(l=s.next;!(u=l.call(s)).done;){try{c=i(u.value)}catch(e){throw nt(s),e}if("object"==typeof c&&c&&c instanceof rt)return c}return new rt(!1)}var a="[object z]"===String(e),st=$e("toStringTag"),ot="Arguments"==r(function(){return arguments}()),at=a?r:function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(e=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),st))?e:ot?r(t):"Object"==(e=r(t))&&"function"==typeof t.callee?"Arguments":e},ct=$e("iterator"),lt=function(e,t){var n=this;if(!(n instanceof lt))return new lt(e,t);De&&(n=De(new Error(void 0),xe(n))),void 0!==t&&P(n,"message",String(t));t=[];return it(e,t.push,{that:t}),P(n,"errors",t),n};lt.prototype=Be(Error.prototype,{constructor:g(5,lt),message:g(5,""),name:g(5,"AggregateError")}),oe({global:!0},{AggregateError:lt}),a||he(Object.prototype,"toString",a?{}.toString:function(){return"[object "+at(this)+"]"},{unsafe:!0});function ut(e,t,n){for(var r in t)he(e,r,t[r],n);return e}function ht(e,t,n){e&&!T(e=n?e:e.prototype,mt)&&gt(e,mt,{configurable:!0,value:t})}function dt(e){var t=te(e),e=N.f;d&&t&&!t[yt]&&e(t,yt,{configurable:!0,get:function(){return this}})}function ft(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}var pt=_.Promise,gt=N.f,mt=$e("toStringTag"),yt=$e("species"),vt=$e("iterator"),_t=!1;try{var wt=0,bt={next:function(){return{done:!!wt++}},return:function(){_t=!0}};bt[vt]=function(){return this},Array.from(bt,function(){throw 2})}catch(fp){}function It(e,t){if(!t&&!_t)return!1;var n=!1;try{var r={};r[vt]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n}function Tt(e,t){var n;return void 0===(e=v(e).constructor)||null==(n=v(e)[Ct])?t:We(n)}function Et(e){var t;Mt.hasOwnProperty(e)&&(t=Mt[e],delete Mt[e],t())}function St(e){return function(){Et(e)}}var kt,Ct=$e("species"),O=/(?:iphone|ipod|ipad).*applewebkit/i.test(K),At="process"==r(_.process),Rt=_.location,Nt=_.setImmediate,Pt=_.clearImmediate,Ot=_.process,e=_.MessageChannel,xt=_.Dispatch,Dt=0,Mt={},Lt="onreadystatechange",a=function(e){Et(e.data)},bt=function(e){_.postMessage(e+"",Rt.protocol+"//"+Rt.host)};Nt&&Pt||(Nt=function(e){for(var t=[],n=1;n<arguments.length;)t.push(arguments[n++]);return Mt[++Dt]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},kt(Dt),Dt},Pt=function(e){delete Mt[e]},At?kt=function(e){Ot.nextTick(St(e))}:xt&&xt.now?kt=function(e){xt.now(St(e))}:e&&!O?(Wt=(e=new e).port2,e.port1.onmessage=a,kt=Ke(Wt.postMessage,Wt,1)):_.addEventListener&&"function"==typeof postMessage&&!_.importScripts&&Rt&&"file:"!==Rt.protocol&&!m(bt)?(kt=bt,_.addEventListener("message",a,!1)):kt=Lt in n("script")?function(e){Fe.appendChild(n("script"))[Lt]=function(){Fe.removeChild(this),Et(e)}}:function(e){setTimeout(St(e),0)});var Ft,Ut,jt,qt,Vt,Bt,$t,zt,Wt={set:Nt,clear:Pt},bt=/web0s(?!.*chrome)/i.test(K),a=A.f,Kt=Wt.set,Nt=_.MutationObserver||_.WebKitMutationObserver,Pt=_.document,Ht=_.process,K=_.Promise,a=a(_,"queueMicrotask"),a=a&&a.value;a||(Ft=function(){var e,t;for(At&&(e=Ht.domain)&&e.exit();Ut;){t=Ut.fn,Ut=Ut.next;try{t()}catch(e){throw Ut?qt():jt=void 0,e}}jt=void 0,e&&e.enter()},qt=O||At||bt||!Nt||!Pt?K&&K.resolve?(($t=K.resolve(void 0)).constructor=K,zt=$t.then,function(){zt.call($t,Ft)}):At?function(){Ht.nextTick(Ft)}:function(){Kt.call(_,Ft)}:(Vt=!0,Bt=Pt.createTextNode(""),new Nt(Ft).observe(Bt,{characterData:!0}),function(){Bt.data=Vt=!Vt}));function Gt(e){var n,r;this.promise=new e(function(e,t){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=e,r=t}),this.resolve=We(n),this.reject=We(r)}function Qt(e,t){return v(e),y(t)&&t.constructor===e?t:((0,(e=cn.f(e)).resolve)(t),e.promise)}function Yt(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}function Jt(e){var t;return!(!y(e)||"function"!=typeof(t=e.then))&&t}function Xt(h,d){var f;h.notified||(h.notified=!0,f=h.reactions,an(function(){for(var e=h.value,t=1==h.state,n=0;f.length>n;){var r,i,s,o=f[n++],a=t?o.ok:o.fail,c=o.resolve,l=o.reject,u=o.domain;try{a?(t||(2===h.rejection&&An(h),h.rejection=1),!0===a?r=e:(u&&u.enter(),r=a(e),u&&(u.exit(),s=!0)),r===o.promise?l(yn("Promise-chain cycle")):(i=Jt(r))?i.call(r,c,l):c(r)):l(e)}catch(e){u&&!s&&u.exit(),l(e)}}h.reactions=[],h.notified=!1,d&&!h.rejection&&kn(h)}))}function Zt(e,t,n){var r,i;In?((r=vn.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),_.dispatchEvent(r)):r={promise:t,reason:n},!Tn&&(i=_["on"+e])?i(r):e===En&&function(e,t){var n=_.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)}function en(t,n,r){return function(e){t(n,e,r)}}function tn(e,t,n){e.done||(e.done=!0,(e=n?n:e).value=t,e.state=2,Xt(e,!0))}var nn,rn,sn,on,an=a||function(e){e={fn:e,next:void 0};jt&&(jt.next=e),Ut||(Ut=e,qt()),jt=e},cn={f:function(e){return new Gt(e)}},ln="object"==typeof window,un=Wt.set,hn=$e("species"),dn="Promise",fn=ue.get,pn=ue.set,gn=ue.getterFor(dn),Pt=pt&&pt.prototype,mn=pt,Nt=Pt,yn=_.TypeError,vn=_.document,_n=_.process,wn=cn.f,bn=wn,In=!!(vn&&vn.createEvent&&_.dispatchEvent),Tn="function"==typeof PromiseRejectionEvent,En="unhandledrejection",Sn=!1,a=Re(dn,function(){var e=z(mn)!==String(mn);if(!e&&66===He)return!0;if(51<=He&&/native code/.test(mn))return!1;function t(e){e(function(){},function(){})}var n=new mn(function(e){e(1)});return(n.constructor={})[hn]=t,!(Sn=n.then(function(){})instanceof t)||!e&&ln&&!Tn}),Wt=a||!It(function(e){mn.all(e).catch(function(){})}),kn=function(i){un.call(_,function(){var e,t=i.facade,n=i.value,r=Cn(i);if(r&&(e=Yt(function(){At?_n.emit("unhandledRejection",n,t):Zt(En,t,n)}),i.rejection=At||Cn(i)?2:1,e.error))throw e.value})},Cn=function(e){return 1!==e.rejection&&!e.parent},An=function(t){un.call(_,function(){var e=t.facade;At?_n.emit("rejectionHandled",e):Zt("rejectionhandled",e,t.value)})},Rn=function(n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(n.facade===e)throw yn("Promise can't be resolved itself");var r=Jt(e);r?an(function(){var t={done:!1};try{r.call(e,en(Rn,t,n),en(tn,t,n))}catch(e){tn(t,e,n)}}):(n.value=e,n.state=1,Xt(n,!1))}catch(e){tn({done:!1},e,n)}}};if(a&&(Nt=(mn=function(e){ft(this,mn,dn),We(e),nn.call(this);var t=fn(this);try{e(en(Rn,t),en(tn,t))}catch(e){tn(t,e)}}).prototype,(nn=function(e){pn(this,{type:dn,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=ut(Nt,{then:function(e,t){var n=gn(this),r=wn(Tt(this,mn));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=At?_n.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Xt(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),rn=function(){var e=new nn,t=fn(e);this.promise=e,this.resolve=en(Rn,t),this.reject=en(tn,t)},cn.f=wn=function(e){return e===mn||e===sn?new rn:bn(e)},"function"==typeof pt&&Pt!==Object.prototype)){on=Pt.then,Sn||(he(Pt,"then",function(e,t){var n=this;return new mn(function(e,t){on.call(n,e,t)}).then(e,t)},{unsafe:!0}),he(Pt,"catch",Nt.catch,{unsafe:!0}));try{delete Pt.constructor}catch(fp){}De&&De(Pt,Nt)}oe({global:!0,wrap:!0,forced:a},{Promise:mn}),ht(mn,dn,!1),dt(dn),sn=te(dn),oe({target:dn,stat:!0,forced:a},{reject:function(e){var t=wn(this);return t.reject.call(void 0,e),t.promise}}),oe({target:dn,stat:!0,forced:a},{resolve:function(e){return Qt(this,e)}}),oe({target:dn,stat:!0,forced:Wt},{all:function(e){var a=this,t=wn(a),c=t.resolve,l=t.reject,n=Yt(function(){var r=We(a.resolve),i=[],s=0,o=1;it(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(a,e).then(function(e){n||(n=!0,i[t]=e,--o||c(i))},l)}),--o||c(i)});return n.error&&l(n.value),t.promise},race:function(e){var n=this,r=wn(n),i=r.reject,t=Yt(function(){var t=We(n.resolve);it(e,function(e){t.call(n,e).then(r.resolve,i)})});return t.error&&i(t.value),r.promise}}),oe({target:"Promise",stat:!0},{allSettled:function(e){var a=this,t=cn.f(a),c=t.resolve,n=t.reject,r=Yt(function(){var r=We(a.resolve),i=[],s=0,o=1;it(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(a,e).then(function(e){n||(n=!0,i[t]={status:"fulfilled",value:e},--o||c(i))},function(e){n||(n=!0,i[t]={status:"rejected",reason:e},--o||c(i))})}),--o||c(i)});return r.error&&n(r.value),t.promise}});var Nn="No one promise resolved";oe({target:"Promise",stat:!0},{any:function(e){var c=this,t=cn.f(c),l=t.resolve,u=t.reject,n=Yt(function(){var r=We(c.resolve),i=[],s=0,o=1,a=!1;it(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(c,e).then(function(e){n||a||(a=!0,l(e))},function(e){n||a||(n=!0,i[t]=e,--o||u(new(te("AggregateError"))(i,Nn)))})}),--o||u(new(te("AggregateError"))(i,Nn))});return n.error&&u(n.value),t.promise}});Pt=!!pt&&m(function(){pt.prototype.finally.call({then:function(){}},function(){})});oe({target:"Promise",proto:!0,real:!0,forced:Pt},{finally:function(t){var n=Tt(this,te("Promise")),e="function"==typeof t;return this.then(e?function(e){return Qt(n,t()).then(function(){return e})}:t,e?function(e){return Qt(n,t()).then(function(){throw e})}:t)}}),"function"==typeof pt&&(Ln=te("Promise").prototype.finally,pt.prototype.finally!==Ln&&he(pt.prototype,"finally",Ln,{unsafe:!0}));var Pn,Nt=function(s){return function(e,t){var n,r=String(o(e)),i=ne(t),e=r.length;return i<0||e<=i?s?"":void 0:(t=r.charCodeAt(i))<55296||56319<t||i+1===e||(n=r.charCodeAt(i+1))<56320||57343<n?s?r.charAt(i):t:s?r.slice(i,i+2):n-56320+(t-55296<<10)+65536}},a={codeAt:Nt(!1),charAt:Nt(!0)},On=$e("iterator"),Wt=!1;[].keys&&("next"in(hr=[].keys())?(dr=xe(xe(hr)))!==Object.prototype&&(Pn=dr):Wt=!0);Pt=null==Pn||m(function(){var e={};return Pn[On].call(e)!==e});T(Pn=Pt?{}:Pn,On)||P(Pn,On,function(){return this});function xn(){return this}function Dn(){return this}function Mn(e,t,n,r,i,s,o){function a(e){if(e===i&&p)return p;if(!jn&&e in d)return d[e];switch(e){case"keys":case Vn:case Bn:return function(){return new n(this,e)}}return function(){return new n(this)}}!function(e,t,n){t+=" Iterator";e.prototype=Be(Fn,{next:g(1,n)}),ht(e,t,!1),Xe[t]=xn}(n,t,r);var c,l,u=t+" Iterator",h=!1,d=e.prototype,f=d[qn]||d["@@iterator"]||i&&d[i],p=!jn&&f||a(i);if((r="Array"==t&&d.entries||f)&&(e=xe(r.call(new e)),Un!==Object.prototype&&e.next&&(xe(e)!==Un&&(De?De(e,Un):"function"!=typeof e[qn]&&P(e,qn,Dn)),ht(e,u,!0))),i==Vn&&f&&f.name!==Vn&&(h=!0,p=function(){return f.call(this)}),d[qn]!==p&&P(d,qn,p),Xe[t]=p,i)if(c={values:a(Vn),keys:s?p:a("keys"),entries:a(Bn)},o)for(l in c)!jn&&!h&&l in d||he(d,l,c[l]);else oe({target:t,proto:!0,forced:jn||h},c);return c}var Ln={IteratorPrototype:Pn,BUGGY_SAFARI_ITERATORS:Wt},Fn=Ln.IteratorPrototype,Un=Ln.IteratorPrototype,jn=Ln.BUGGY_SAFARI_ITERATORS,qn=$e("iterator"),Vn="values",Bn="entries",$n=a.charAt,zn="String Iterator",Wn=ue.set,Kn=ue.getterFor(zn);Mn(String,"String",function(e){Wn(this,{type:zn,string:String(e),index:0})},function(){var e=Kn(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(n=$n(t,n),e.index+=n.length,{value:n,done:!1})});var Hn={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Gn=$e("unscopables"),Qn=Array.prototype;null==Qn[Gn]&&N.f(Qn,Gn,{configurable:!0,value:Be(null)});var Nt=function(e){Qn[Gn][e]=!0},Yn="Array Iterator",Jn=ue.set,Xn=ue.getterFor(Yn),Zn=Mn(Array,"Array",function(e,t){Jn(this,{type:Yn,target:c(e),index:0,kind:t})},function(){var e=Xn(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values");Xe.Arguments=Xe.Array,Nt("keys"),Nt("values"),Nt("entries");var er,tr=$e("iterator"),nr=$e("toStringTag"),rr=Zn.values;for(er in Hn){var ir=_[er],sr=ir&&ir.prototype;if(sr){if(sr[tr]!==rr)try{P(sr,tr,rr)}catch(fp){sr[tr]=rr}if(sr[nr]||P(sr,nr,er),Hn[er])for(var or in Zn)if(sr[or]!==Zn[or])try{P(sr,or,Zn[or])}catch(fp){sr[or]=Zn[or]}}}de.Promise,oe({target:"Promise",stat:!0},{try:function(e){var t=cn.f(this),e=Yt(e);return(e.error?t.reject:t.resolve)(e.value),t.promise}});function ar(e,t){var n;return new(void 0===(n=cr(e)&&("function"==typeof(n=e.constructor)&&(n===Array||cr(n.prototype))||y(n)&&null===(n=n[lr]))?void 0:n)?Array:n)(0===t?0:t)}var cr=Array.isArray||function(e){return"Array"==r(e)},lr=$e("species"),ur=[].push,hr=function(d){var f=1==d,p=2==d,g=3==d,m=4==d,y=6==d,v=7==d,_=5==d||y;return function(e,t,n,r){for(var i,s,o=w(e),a=b(o),c=Ke(t,n,3),l=re(a.length),u=0,r=r||ar,h=f?r(e,l):p||v?r(e,0):void 0;u<l;u++)if((_||u in a)&&(s=c(i=a[u],u,o),d))if(f)h[u]=s;else if(s)switch(d){case 3:return!0;case 5:return i;case 6:return u;case 2:ur.call(h,i)}else switch(d){case 4:return!1;case 7:ur.call(h,i)}return y?-1:g||m?m:h}},dr={forEach:hr(0),map:hr(1),filter:hr(2),some:hr(3),every:hr(4),find:hr(5),findIndex:hr(6),filterOut:hr(7)},fr=dr.find,Pt="find",pr=!0;Pt in[]&&Array(1)[Pt](function(){pr=!1}),oe({target:"Array",proto:!0,forced:pr},{find:function(e){return fr(this,e,1<arguments.length?arguments[1]:void 0)}}),Nt(Pt);var gr=Function.call,Wt=function(e,t,n){return Ke(gr,_[e].prototype[t],n)};Wt("Array","find");var mr=dr.findIndex,Ln="findIndex",yr=!0;Ln in[]&&Array(1)[Ln](function(){yr=!1}),oe({target:"Array",proto:!0,forced:yr},{findIndex:function(e){return mr(this,e,1<arguments.length?arguments[1]:void 0)}}),Nt(Ln),Wt("Array","findIndex");function vr(e,t,n){(t=i(t))in e?N.f(e,t,g(0,n)):e[t]=n}a=!It(function(e){Array.from(e)});oe({target:"Array",stat:!0,forced:a},{from:function(e){var t,n,r,i,s,o,a=w(e),c="function"==typeof this?this:Array,l=arguments.length,u=1<l?arguments[1]:void 0,h=void 0!==u,e=tt(a),d=0;if(h&&(u=Ke(u,2<l?arguments[2]:void 0,2)),null==e||c==Array&&ze(e))for(n=new c(t=re(a.length));d<t;d++)o=h?u(a[d],d):a[d],vr(n,d,o);else for(s=(i=e.call(a)).next,n=new c;!(r=s.call(i)).done;d++)o=h?function(t,e,n,r){try{return r?e(v(n)[0],n[1]):e(n)}catch(e){throw nt(t),e}}(i,u,[r.value,d],!0):r.value,vr(n,d,o);return n.length=d,n}}),de.Array.from;var _r,wr,br=dr.some,hr=!!(wr=[]["some"])&&m(function(){wr.call(null,_r||function(){throw 1},1)});oe({target:"Array",proto:!0,forced:!hr},{some:function(e){return br(this,e,1<arguments.length?arguments[1]:void 0)}}),Wt("Array","some");function Ir(e){return!!y(e)&&(e=at(e),T(Rr,e)||T(Nr,e))}var Tr,Pt="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Nt=N.f,Ln=_.Int8Array,Er=Ln&&Ln.prototype,a=_.Uint8ClampedArray,hr=a&&a.prototype,Sr=Ln&&xe(Ln),kr=Er&&xe(Er),a=Object.prototype,Ln=(a.isPrototypeOf,$e("toStringTag")),Cr=M("TYPED_ARRAY_TAG"),Ar=Pt&&!!De&&"Opera"!==at(_.opera),Pt=!1,Rr={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Nr={BigInt64Array:8,BigUint64Array:8};for(Tr in Rr)_[Tr]||(Ar=!1);if((!Ar||"function"!=typeof Sr||Sr===Function.prototype)&&(Sr=function(){throw TypeError("Incorrect invocation")},Ar))for(Tr in Rr)_[Tr]&&De(_[Tr],Sr);if((!Ar||!kr||kr===a)&&(kr=Sr.prototype,Ar))for(Tr in Rr)_[Tr]&&De(_[Tr].prototype,kr);if(Ar&&xe(hr)!==kr&&De(hr,kr),d&&!T(kr,Ln))for(Tr in Pt=!0,Nt(kr,Ln,{get:function(){return y(this)?this[Cr]:void 0}}),Rr)_[Tr]&&P(_[Tr],Cr,Tr);var hr=function(e){if(Ir(e))return e;throw TypeError("Target is not a typed array")},Nt=function(e,t,n){if(d){if(n)for(var r in Rr){r=_[r];if(r&&T(r.prototype,e))try{delete r.prototype[e]}catch(e){}}kr[e]&&!n||he(kr,e,!n&&Ar&&Er[e]||t)}},Ln=$e("iterator"),Pt=_.Uint8Array,Pr=Zn.values,Or=Zn.keys,xr=Zn.entries,Dr=hr,hr=Nt,Nt=Pt&&Pt.prototype[Ln],Pt=!!Nt&&("values"==Nt.name||null==Nt.name),Nt=function(){return Pr.call(Dr(this))};hr("entries",function(){return xr.call(Dr(this))}),hr("keys",function(){return Or.call(Dr(this))}),hr("values",Nt,!Pt),hr(Ln,Nt,!Pt);var Mr=Object.assign,Lr=Object.defineProperty,Nt=!Mr||m(function(){if(d&&1!==Mr({b:1},Mr(Lr({},"a",{enumerable:!0,get:function(){Lr(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return 1;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=Mr({},e)[n]||Me(Mr({},t)).join("")!=r})?function(e,t){for(var n=w(e),r=arguments.length,i=1,s=Ie.f,o=f.f;i<r;)for(var a,c=b(arguments[i++]),l=s?Me(c).concat(s(c)):Me(c),u=l.length,h=0;h<u;)a=l[h++],d&&!o.call(c,a)||(n[a]=c[a]);return n}:Mr;oe({target:"Object",stat:!0,forced:Object.assign!==Nt},{assign:Nt}),de.Object.assign;var Fr=f.f,Pt=function(a){return function(e){for(var t,n=c(e),r=Me(n),i=r.length,s=0,o=[];s<i;)t=r[s++],d&&!Fr.call(n,t)||o.push(a?[t,n[t]]:n[t]);return o}},Nt={entries:Pt(!0),values:Pt(!1)},Ur=Nt.entries;oe({target:"Object",stat:!0},{entries:function(e){return Ur(e)}}),de.Object.entries;var jr=Nt.values;oe({target:"Object",stat:!0},{values:function(e){return jr(e)}}),de.Object.values;function qr(e){if(y(t=e)&&(void 0!==(n=t[Vr])?!!n:"RegExp"==r(t)))throw TypeError("The method doesn't accept regular expressions");var t,n;return e}var Vr=$e("match"),Br=$e("match"),Pt=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[Br]=!1,"/./"[t](n)}catch(e){}}return!1};oe({target:"String",proto:!0,forced:!Pt("includes")},{includes:function(e){return!!~String(o(this)).indexOf(qr(e),1<arguments.length?arguments[1]:void 0)}}),Wt("String","includes");var $r,Nt=A.f,zr="".startsWith,Wr=Math.min,Pt=Pt("startsWith"),$r=!(Pt||(!($r=Nt(String.prototype,"startsWith"))||$r.writable));oe({target:"String",proto:!0,forced:!$r&&!Pt},{startsWith:function(e){var t=String(o(this));qr(e);var n=re(Wr(1<arguments.length?arguments[1]:void 0,t.length)),e=String(e);return zr?zr.call(t,e,n):t.slice(n,n+e.length)===e}}),Wt("String","startsWith");oe({target:"String",proto:!0},{repeat:function(e){var t=String(o(this)),n="",r=ne(e);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n}}),Wt("String","repeat");var Kr,Hr=$e("species"),Gr=$e("isConcatSpreadable"),Qr=9007199254740991,Yr="Maximum allowed index exceeded",Pt=51<=He||!m(function(){var e=[];return e[Gr]=!1,e.concat()[0]!==e}),Wt=(Kr="concat",51<=He||!m(function(){var e=[];return(e.constructor={})[Hr]=function(){return{foo:1}},1!==e[Kr](Boolean).foo}));oe({target:"Array",proto:!0,forced:!Pt||!Wt},{concat:function(e){for(var t,n,r,i=w(this),s=ar(i,0),o=0,a=-1,c=arguments.length;a<c;a++)if(function(e){if(!y(e))return!1;var t=e[Gr];return void 0!==t?!!t:cr(e)}(r=-1===a?i:arguments[a])){if(n=re(r.length),Qr<o+n)throw TypeError(Yr);for(t=0;t<n;t++,o++)t in r&&vr(s,o,r[t])}else{if(Qr<=o)throw TypeError(Yr);vr(s,o++,r)}return s.length=o,s}});function Jr(e){var t=de.Symbol||(de.Symbol={});T(t,e)||ii(t,e,{value:ri.f(e)})}function Xr(e,t){var n=vi[e]=Be(di[ci]);return li(n,{type:ai,tag:e,description:t}),d||(n.description=t),n}function Zr(t,e){v(t);var n=c(e),e=Me(n).concat(Ci(n));return si(e,function(e){d&&!ki.call(n,e)||Si(t,e,n[e])}),t}var ei=be.f,ti={}.toString,ni="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Wt={f:function(e){return ni&&"[object Window]"==ti.call(e)?function(e){try{return ei(e)}catch(e){return ni.slice()}}(e):ei(c(e))}},ri={f:$e},ii=N.f,si=dr.forEach,oi=s("hidden"),ai="Symbol",ci="prototype",dr=$e("toPrimitive"),li=ue.set,ui=ue.getterFor(ai),hi=Object[ci],di=_.Symbol,fi=te("JSON","stringify"),pi=A.f,gi=N.f,mi=Wt.f,yi=f.f,vi=G("symbols"),_i=G("op-symbols"),wi=G("string-to-symbol-registry"),bi=G("symbol-to-string-registry"),s=G("wks"),G=_.QObject,Ii=!G||!G[ci]||!G[ci].findChild,Ti=d&&m(function(){return 7!=Be(gi({},"a",{get:function(){return gi(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=pi(hi,t);r&&delete hi[t],gi(e,t,n),r&&e!==hi&&gi(hi,t,r)}:gi,Ei=W?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof di},Si=function(e,t,n){e===hi&&Si(_i,t,n),v(e);t=i(t,!0);return v(n),T(vi,t)?(n.enumerable?(T(e,oi)&&e[oi][t]&&(e[oi][t]=!1),n=Be(n,{enumerable:g(0,!1)})):(T(e,oi)||gi(e,oi,g(1,{})),e[oi][t]=!0),Ti(e,t,n)):gi(e,t,n)},ki=function(e){var t=i(e,!0),e=yi.call(this,t);return!(this===hi&&T(vi,t)&&!T(_i,t))&&(!(e||!T(this,t)||!T(vi,t)||T(this,oi)&&this[oi][t])||e)},G=function(e,t){var n=c(e),e=i(t,!0);if(n!==hi||!T(vi,e)||T(_i,e)){t=pi(n,e);return!t||!T(vi,e)||T(n,oi)&&n[oi][e]||(t.enumerable=!0),t}},W=function(e){var e=mi(c(e)),t=[];return si(e,function(e){T(vi,e)||T(X,e)||t.push(e)}),t},Ci=function(e){var t=e===hi,e=mi(t?_i:c(e)),n=[];return si(e,function(e){!T(vi,e)||t&&!T(hi,e)||n.push(vi[e])}),n};Ge||(he((di=function(){if(this instanceof di)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=M(e),n=function(e){this===hi&&n.call(_i,e),T(this,oi)&&T(this[oi],t)&&(this[oi][t]=!1),Ti(this,t,g(1,e))};return d&&Ii&&Ti(hi,t,{configurable:!0,set:n}),Xr(t,e)})[ci],"toString",function(){return ui(this).tag}),he(di,"withoutSetter",function(e){return Xr(M(e),e)}),f.f=ki,N.f=Si,A.f=G,be.f=Wt.f=W,Ie.f=Ci,ri.f=function(e){return Xr($e(e),e)},d&&(gi(di[ci],"description",{configurable:!0,get:function(){return ui(this).description}}),he(hi,"propertyIsEnumerable",ki,{unsafe:!0}))),oe({global:!0,wrap:!0,forced:!Ge,sham:!Ge},{Symbol:di}),si(Me(s),function(e){Jr(e)}),oe({target:ai,stat:!0,forced:!Ge},{for:function(e){var t=String(e);if(T(wi,t))return wi[t];e=di(t);return wi[t]=e,bi[e]=t,e},keyFor:function(e){if(!Ei(e))throw TypeError(e+" is not a symbol");if(T(bi,e))return bi[e]},useSetter:function(){Ii=!0},useSimple:function(){Ii=!1}}),oe({target:"Object",stat:!0,forced:!Ge,sham:!d},{create:function(e,t){return void 0===t?Be(e):Zr(Be(e),t)},defineProperty:Si,defineProperties:Zr,getOwnPropertyDescriptor:G}),oe({target:"Object",stat:!0,forced:!Ge},{getOwnPropertyNames:W,getOwnPropertySymbols:Ci}),oe({target:"Object",stat:!0,forced:m(function(){Ie.f(1)})},{getOwnPropertySymbols:function(e){return Ie.f(w(e))}}),fi&&(qi=!Ge||m(function(){var e=di();return"[null]"!=fi([e])||"{}"!=fi({a:e})||"{}"!=fi(Object(e))}),oe({target:"JSON",stat:!0,forced:qi},{stringify:function(e,t,n){for(var r,i=[e],s=1;s<arguments.length;)i.push(arguments[s++]);if((y(r=t)||void 0!==e)&&!Ei(e))return cr(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Ei(t))return t}),i[1]=t,fi.apply(null,i)}})),di[ci][dr]||P(di[ci],dr,di[ci].valueOf),ht(di,ai),X[oi]=!0,Jr("asyncIterator");var Ai,Ri,Ni,Pi,Oi,G=N.f,xi=_.Symbol;!d||"function"!=typeof xi||"description"in xi.prototype&&void 0===xi().description||(Ai={},se(Ri=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Ri?new xi(e):void 0===e?xi():xi(e);return""===e&&(Ai[t]=!0),t},xi),($i=Ri.prototype=xi.prototype).constructor=Ri,Ni=$i.toString,Pi="Symbol(test)"==String(xi("test")),Oi=/^Symbol\((.*)\)[^)]+$/,G($i,"description",{configurable:!0,get:function(){var e=y(this)?this.valueOf():this,t=Ni.call(e);if(T(Ai,e))return"";t=Pi?t.slice(7,-1):t.replace(Oi,"$1");return""===t?void 0:t}}),oe({global:!0,forced:!0},{Symbol:Ri})),Jr("hasInstance"),Jr("isConcatSpreadable"),Jr("iterator"),Jr("match"),Jr("matchAll"),Jr("replace"),Jr("search"),Jr("species"),Jr("split"),Jr("toPrimitive"),Jr("toStringTag"),Jr("unscopables"),ht(_.JSON,"JSON",!0),ht(Math,"Math",!0),oe({global:!0},{Reflect:{}}),ht(_.Reflect,"Reflect",!0),de.Symbol,Jr("asyncDispose"),Jr("dispose"),Jr("matcher"),Jr("metadata"),Jr("observable"),Jr("patternMatch"),Jr("replaceAll"),ri.f("iterator");var Di=!m(function(){return Object.isExtensible(Object.preventExtensions({}))}),Mi=t(function(e){function n(e){t(e,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var t=N.f,r=M("meta"),i=0,s=Object.isExtensible||function(){return!0},o=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!y(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!T(e,r)){if(!s(e))return"F";if(!t)return"E";n(e)}return e[r].objectID},getWeakData:function(e,t){if(!T(e,r)){if(!s(e))return!0;if(!t)return!1;n(e)}return e[r].weakData},onFreeze:function(e){return Di&&o.REQUIRED&&s(e)&&!T(e,r)&&n(e),e}};X[r]=!0}),W=function(o,e,t){function n(e){var n=f[e];he(f,e,"add"==e?function(e){return n.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(u&&!y(e))&&n.call(this,0===e?0:e)}:"get"==e?function(e){return u&&!y(e)?void 0:n.call(this,0===e?0:e)}:"has"==e?function(e){return!(u&&!y(e))&&n.call(this,0===e?0:e)}:function(e,t){return n.call(this,0===e?0:e,t),this})}var r,i,s,a,c,l=-1!==o.indexOf("Map"),u=-1!==o.indexOf("Weak"),h=l?"set":"add",d=_[o],f=d&&d.prototype,p=d,g={};return Re(o,"function"!=typeof d||!(u||f.forEach&&!m(function(){(new d).entries().next()})))?(p=t.getConstructor(e,o,l,h),Mi.REQUIRED=!0):Re(o,!0)&&(i=(r=new p)[h](u?{}:-0,1)!=r,s=m(function(){r.has(1)}),a=It(function(e){new d(e)}),c=!u&&m(function(){for(var e=new d,t=5;t--;)e[h](t,t);return!e.has(-0)}),a||(((p=e(function(e,t){ft(e,p,o);var n,r,i,s,n=(n=new d,r=e,e=p,De&&"function"==typeof(i=r.constructor)&&i!==e&&y(s=i.prototype)&&s!==e.prototype&&De(n,s),n);return null!=t&&it(t,n[h],{that:n,AS_ENTRIES:l}),n})).prototype=f).constructor=p),(s||c)&&(n("delete"),n("has"),l&&n("get")),(c||i)&&n(h),u&&f.clear&&delete f.clear),g[o]=p,oe({global:!0,forced:p!=d},g),ht(p,o),u||t.setStrong(p,o,l),p},Li=N.f,Fi=Mi.fastKey,Ui=ue.set,ji=ue.getterFor,qi={getConstructor:function(e,n,r,i){function s(e,t,n){var r,i=a(e),s=c(e,t);return s?s.value=n:(i.last=s={index:r=Fi(t,!0),key:t,value:n,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=s),n&&(n.next=s),d?i.size++:e.size++,"F"!==r&&(i.index[r]=s)),e}var o=e(function(e,t){ft(e,o,n),Ui(e,{type:n,index:Be(null),first:void 0,last:void 0,size:0}),d||(e.size=0),null!=t&&it(t,e[i],{that:e,AS_ENTRIES:r})}),a=ji(n),c=function(e,t){var n,r=a(e),e=Fi(t);if("F"!==e)return r.index[e];for(n=r.first;n;n=n.next)if(n.key==t)return n};return ut(o.prototype,{clear:function(){for(var e=a(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,d?e.size=0:this.size=0},delete:function(e){var t,n=a(this),r=c(this,e);return r&&(t=r.next,e=r.previous,delete n.index[r.index],r.removed=!0,e&&(e.next=t),t&&(t.previous=e),n.first==r&&(n.first=t),n.last==r&&(n.last=e),d?n.size--:this.size--),!!r},forEach:function(e){for(var t,n=a(this),r=Ke(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),ut(o.prototype,r?{get:function(e){e=c(this,e);return e&&e.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),d&&Li(o.prototype,"size",{get:function(){return a(this).size}}),o},setStrong:function(e,t,n){var r=t+" Iterator",i=ji(t),s=ji(r);Mn(e,t,function(e,t){Ui(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:e.target=void 0,done:!0}},n?"entries":"values",!n,!0),dt(t)}};W("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},qi),de.Map;dr=function(e){var t,n,r,i,s=arguments.length,o=1<s?arguments[1]:void 0;return We(this),(t=void 0!==o)&&We(o),null==e?new this:(n=[],t?(r=0,i=Ke(o,2<s?arguments[2]:void 0,2),it(e,function(e){n.push(i(e,r++))})):it(e,n.push,{that:n}),new this(n))};oe({target:"Map",stat:!0},{from:dr});G=function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)};oe({target:"Map",stat:!0},{of:G});function Vi(){for(var e,t=v(this),n=We(t.delete),r=!0,i=0,s=arguments.length;i<s;i++)e=n.call(t,arguments[i]),r=r&&e;return!!r}oe({target:"Map",proto:!0,real:!0,forced:H},{deleteAll:function(){return Vi.apply(this,arguments)}});oe({target:"Map",proto:!0,real:!0,forced:H},{emplace:function(e,t){var n=v(this),t=n.has(e)&&"update"in t?t.update(n.get(e),e,n):t.insert(e,n);return n.set(e,t),t}});function Bi(e){return Map.prototype.entries.call(e)}oe({target:"Map",proto:!0,real:!0,forced:H},{every:function(e){var r=v(this),t=Bi(r),i=Ke(e,1<arguments.length?arguments[1]:void 0,3);return!it(t,function(e,t,n){if(!i(t,e,r))return n()},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),oe({target:"Map",proto:!0,real:!0,forced:H},{filter:function(e){var n=v(this),t=Bi(n),r=Ke(e,1<arguments.length?arguments[1]:void 0,3),i=new(Tt(n,te("Map"))),s=We(i.set);return it(t,function(e,t){r(t,e,n)&&s.call(i,e,t)},{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),oe({target:"Map",proto:!0,real:!0,forced:H},{find:function(e){var r=v(this),t=Bi(r),i=Ke(e,1<arguments.length?arguments[1]:void 0,3);return it(t,function(e,t,n){if(i(t,e,r))return n(t)},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),oe({target:"Map",proto:!0,real:!0,forced:H},{findKey:function(e){var r=v(this),t=Bi(r),i=Ke(e,1<arguments.length?arguments[1]:void 0,3);return it(t,function(e,t,n){if(i(t,e,r))return n(e)},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),oe({target:"Map",stat:!0},{groupBy:function(e,n){var r=new this;We(n);var i=We(r.has),s=We(r.get),o=We(r.set);return it(e,function(e){var t=n(e);i.call(r,t)?s.call(r,t).push(e):o.call(r,t,[e])}),r}});oe({target:"Map",proto:!0,real:!0,forced:H},{includes:function(i){return it(Bi(v(this)),function(e,t,n){if((r=t)===(t=i)||r!=r&&t!=t)return n();var r},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),oe({target:"Map",stat:!0},{keyBy:function(e,t){var n=new this;We(t);var r=We(n.set);return it(e,function(e){r.call(n,t(e),e)}),n}}),oe({target:"Map",proto:!0,real:!0,forced:H},{keyOf:function(r){return it(Bi(v(this)),function(e,t,n){if(t===r)return n(e)},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),oe({target:"Map",proto:!0,real:!0,forced:H},{mapKeys:function(e){var n=v(this),t=Bi(n),r=Ke(e,1<arguments.length?arguments[1]:void 0,3),i=new(Tt(n,te("Map"))),s=We(i.set);return it(t,function(e,t){s.call(i,r(t,e,n),t)},{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),oe({target:"Map",proto:!0,real:!0,forced:H},{mapValues:function(e){var n=v(this),t=Bi(n),r=Ke(e,1<arguments.length?arguments[1]:void 0,3),i=new(Tt(n,te("Map"))),s=We(i.set);return it(t,function(e,t){s.call(i,e,r(t,e,n))},{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),oe({target:"Map",proto:!0,real:!0,forced:H},{merge:function(e){for(var t=v(this),n=We(t.set),r=0;r<arguments.length;)it(arguments[r++],n,{that:t,AS_ENTRIES:!0});return t}}),oe({target:"Map",proto:!0,real:!0,forced:H},{reduce:function(n){var r=v(this),e=Bi(r),i=arguments.length<2,s=i?void 0:arguments[1];if(We(n),it(e,function(e,t){s=i?(i=!1,t):n(s,t,e,r)},{AS_ENTRIES:!0,IS_ITERATOR:!0}),i)throw TypeError("Reduce of empty map with no initial value");return s}}),oe({target:"Map",proto:!0,real:!0,forced:H},{some:function(e){var r=v(this),t=Bi(r),i=Ke(e,1<arguments.length?arguments[1]:void 0,3);return it(t,function(e,t,n){if(i(t,e,r))return n()},{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),oe({target:"Map",proto:!0,real:!0,forced:H},{update:function(e,t){var n=v(this),r=arguments.length;We(t);var i=n.has(e);if(!i&&r<3)throw TypeError("Updating absent value");r=i?n.get(e):We(2<r?arguments[2]:void 0)(e,n);return n.set(e,t(r,e,n)),n}});var $i=function(e,t){var n,r=v(this),i=2<arguments.length?arguments[2]:void 0;if("function"!=typeof t&&"function"!=typeof i)throw TypeError("At least one callback required");return r.has(e)?(n=r.get(e),"function"==typeof t&&(n=t(n),r.set(e,n))):"function"==typeof i&&(n=i(),r.set(e,n)),n};oe({target:"Map",proto:!0,real:!0,forced:H},{upsert:$i}),oe({target:"Map",proto:!0,real:!0,forced:H},{updateOrInsert:$i}),W("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},qi),de.Set,oe({target:"Set",stat:!0},{from:dr}),oe({target:"Set",stat:!0},{of:G});oe({target:"Set",proto:!0,real:!0,forced:H},{addAll:function(){return function(){for(var e=v(this),t=We(e.add),n=0,r=arguments.length;n<r;n++)t.call(e,arguments[n]);return e}.apply(this,arguments)}}),oe({target:"Set",proto:!0,real:!0,forced:H},{deleteAll:function(){return Vi.apply(this,arguments)}});function zi(e){return Set.prototype.values.call(e)}oe({target:"Set",proto:!0,real:!0,forced:H},{every:function(e){var n=v(this),t=zi(n),r=Ke(e,1<arguments.length?arguments[1]:void 0,3);return!it(t,function(e,t){if(!r(e,e,n))return t()},{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),oe({target:"Set",proto:!0,real:!0,forced:H},{difference:function(e){var t=v(this),n=new(Tt(t,te("Set")))(t),r=We(n.delete);return it(e,function(e){r.call(n,e)}),n}}),oe({target:"Set",proto:!0,real:!0,forced:H},{filter:function(e){var t=v(this),n=zi(t),r=Ke(e,1<arguments.length?arguments[1]:void 0,3),i=new(Tt(t,te("Set"))),s=We(i.add);return it(n,function(e){r(e,e,t)&&s.call(i,e)},{IS_ITERATOR:!0}),i}}),oe({target:"Set",proto:!0,real:!0,forced:H},{find:function(e){var n=v(this),t=zi(n),r=Ke(e,1<arguments.length?arguments[1]:void 0,3);return it(t,function(e,t){if(r(e,e,n))return t(e)},{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),oe({target:"Set",proto:!0,real:!0,forced:H},{intersection:function(e){var t=v(this),n=new(Tt(t,te("Set"))),r=We(t.has),i=We(n.add);return it(e,function(e){r.call(t,e)&&i.call(n,e)}),n}}),oe({target:"Set",proto:!0,real:!0,forced:H},{isDisjointFrom:function(e){var n=v(this),r=We(n.has);return!it(e,function(e,t){if(!0===r.call(n,e))return t()},{INTERRUPTED:!0}).stopped}}),oe({target:"Set",proto:!0,real:!0,forced:H},{isSubsetOf:function(e){var t=function(e){var t=tt(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return v(t.call(e))}(this),n=v(e),r=n.has;return"function"!=typeof r&&(n=new(te("Set"))(e),r=We(n.has)),!it(t,function(e,t){if(!1===r.call(n,e))return t()},{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),oe({target:"Set",proto:!0,real:!0,forced:H},{isSupersetOf:function(e){var n=v(this),r=We(n.has);return!it(e,function(e,t){if(!1===r.call(n,e))return t()},{INTERRUPTED:!0}).stopped}}),oe({target:"Set",proto:!0,real:!0,forced:H},{join:function(e){var t=v(this),n=zi(t),t=void 0===e?",":String(e),e=[];return it(n,e.push,{that:e,IS_ITERATOR:!0}),e.join(t)}}),oe({target:"Set",proto:!0,real:!0,forced:H},{map:function(e){var t=v(this),n=zi(t),r=Ke(e,1<arguments.length?arguments[1]:void 0,3),i=new(Tt(t,te("Set"))),s=We(i.add);return it(n,function(e){s.call(i,r(e,e,t))},{IS_ITERATOR:!0}),i}}),oe({target:"Set",proto:!0,real:!0,forced:H},{reduce:function(t){var n=v(this),e=zi(n),r=arguments.length<2,i=r?void 0:arguments[1];if(We(t),it(e,function(e){i=r?(r=!1,e):t(i,e,e,n)},{IS_ITERATOR:!0}),r)throw TypeError("Reduce of empty set with no initial value");return i}}),oe({target:"Set",proto:!0,real:!0,forced:H},{some:function(e){var n=v(this),t=zi(n),r=Ke(e,1<arguments.length?arguments[1]:void 0,3);return it(t,function(e,t){if(r(e,e,n))return t()},{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),oe({target:"Set",proto:!0,real:!0,forced:H},{symmetricDifference:function(e){var t=v(this),n=new(Tt(t,te("Set")))(t),r=We(n.delete),i=We(n.add);return it(e,function(e){r.call(n,e)||i.call(n,e)}),n}}),oe({target:"Set",proto:!0,real:!0,forced:H},{union:function(e){var t=v(this),t=new(Tt(t,te("Set")))(t);return it(e,We(t.add),{that:t}),t}});var Wi=Math.floor;oe({target:"Number",stat:!0},{isInteger:function(e){return!y(e)&&isFinite(e)&&Wi(e)===e}}),de.Number.isInteger,oe({target:"Number",stat:!0},{isNaN:function(e){return e!=e}}),de.Number.isNaN;var Ki=function(e,t){return(Ki=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var Hi=function(){return(Hi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Gi(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function Qi(e,o,a,c){return new(a=a||Promise)(function(n,t){function r(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,i)}s((c=c.apply(e,o||[])).next())})}function Yi(n,r){var i,s,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(o=2&t[0]?s.return:t[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,t[1])).done)return o;switch(s=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],s=0}finally{i=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function Ji(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xi(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function Zi(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}function es(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t}function ts(e){return e=es(e),os.encodeByteArray(e,!0)}var ns=!1,rs="${JSCORE_VERSION}",is=function(e,t){if(!e)throw ss(t)},ss=function(e){return new Error("Firebase Database ("+rs+") INTERNAL ASSERT FAILED: "+e)},os={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var s=e[i],o=i+1<e.length,a=o?e[i+1]:0,c=i+2<e.length,l=c?e[i+2]:0,u=(15&a)<<2|l>>6,l=63&l;c||(l=64,o||(u=64)),r.push(n[s>>2],n[(3&s)<<4|a>>4],n[u],n[l])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(es(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i,s,o,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(s=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&s)):239<a&&a<365?(i=((7&a)<<18|(63&(s=e[n++]))<<12|(63&(o=e[n++]))<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))):(s=e[n++],o=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&s)<<6|63&o))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var s=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,a=++i<e.length?n[e.charAt(i)]:64,c=++i<e.length?n[e.charAt(i)]:64;if(++i,null==s||null==o||null==a||null==c)throw Error();r.push(s<<2|o>>4),64!==a&&(r.push(o<<4&240|a>>2),64!==c&&r.push(a<<6&192|c))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},as=function(e){return ts(e).replace(/\./g,"")},cs=function(e){try{return os.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function ls(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=ls(e[n],t[n]));return e}var us=(hs.prototype.wrapCallback=function(n){var r=this;return function(e,t){e?r.reject(e):r.resolve(t),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(e):n(e,t))}},hs);function hs(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})}function ds(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,t=e.sub||e.user_id;if(!t)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");e=Hi({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:t,user_id:t,firebase:{sign_in_provider:"custom",identities:{}}},e);return[as(JSON.stringify({alg:"none",type:"JWT"})),as(JSON.stringify(e)),""].join(".")}function fs(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function ps(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fs())}function gs(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function ms(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function ys(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function vs(){var e=fs();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function _s(){return!0===ns}function ws(){return"indexedDB"in self&&null!=indexedDB}function bs(){return new Promise(function(e,t){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=function(){i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})}function Is(){return!(!navigator||!navigator.cookieEnabled)}var Ts,Es="FirebaseError",Ss=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Ki(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(ks,Ts=Error),ks);function ks(e,t,n){t=Ts.call(this,t)||this;return t.code=e,t.customData=n,t.name=Es,Object.setPrototypeOf(t,ks.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,Cs.prototype.create),t}var Cs=(As.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i=t[0]||{},s=this.service+"/"+e,e=this.errors[e],e=e?(r=i,e.replace(Rs,function(e,t){var n=r[t];return null!=n?String(n):"<"+t+"?>"})):"Error",e=this.serviceName+": "+e+" ("+s+").";return new Ss(s,e,i)},As);function As(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var Rs=/\{\$([^}]+)}/g;function Ns(e){return JSON.parse(e)}function Ps(e){return JSON.stringify(e)}function Os(e){var t={},n={},r={},i="";try{var s=e.split("."),t=Ns(cs(s[0])||""),n=Ns(cs(s[1])||""),i=s[2],r=n.d||{};delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function xs(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ds(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function Ms(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Ls(e,t,n){var r,i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function Fs(e,t){if(e===t)return 1;for(var n=Object.keys(e),r=Object.keys(t),i=0,s=n;i<s.length;i++){var o=s[i];if(!r.includes(o))return;var a=e[o],c=t[o];if(Us(a)&&Us(c)){if(!Fs(a,c))return}else if(a!==c)return}for(var l=0,u=r;l<u.length;l++){o=u[l];if(!n.includes(o))return}return 1}function Us(e){return null!==e&&"object"==typeof e}function js(e){for(var n=[],t=0,r=Object.entries(e);t<r.length;t++){var i=r[t];!function(t,e){Array.isArray(e)?e.forEach(function(e){n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}):n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}(i[0],i[1])}return n.length?"&"+n.join("&"):""}function qs(e){var n={};return e.replace(/^\?/,"").split("&").forEach(function(e){var t;e&&(e=(t=e.split("="))[0],t=t[1],n[decodeURIComponent(e)]=decodeURIComponent(t))}),n}function Vs(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}var Bs=($s.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},$s.prototype.compress_=function(e,t){t=t||0;var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}for(var s,o=this.chain_[0],a=this.chain_[1],c=this.chain_[2],l=this.chain_[3],u=this.chain_[4],r=0;r<80;r++)var h=r<40?r<20?(s=l^a&(c^l),1518500249):(s=a^c^l,1859775393):r<60?(s=a&c|l&(a|c),2400959708):(s=a^c^l,3395469782),i=(o<<5|o>>>27)+s+u+h+n[r]&4294967295,u=l,l=c,c=4294967295&(a<<30|a>>>2),a=o,o=i;this.chain_[0]=this.chain_[0]+o&4294967295,this.chain_[1]=this.chain_[1]+a&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295},$s.prototype.update=function(e,t){if(null!=e){for(var n=(t=void 0===t?e.length:t)-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++r,++s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++r,++s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}},$s.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);for(var r=0,n=0;n<5;n++)for(var i=24;0<=i;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},$s);function $s(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}function zs(e,t){t=new Ws(e,t);return t.subscribe.bind(t)}var Ws=(Ks.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},Ks.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},Ks.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},Ks.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=Hs),void 0===r.error&&(r.error=Hs),void 0===r.complete&&(r.complete=Hs);n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),n},Ks.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},Ks.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},Ks.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},Ks.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},Ks);function Ks(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}function Hs(){}function Gs(e,t){return e+" failed: "+t+" argument "}function Qs(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:55296<=r&&r<=56319?(t+=4,n++):t+=3}return t}var Ys=1e3,Js=2,Xs=144e5,Zs=.5;function eo(e,t,n){void 0===n&&(n=Js);n=(t=void 0===t?Ys:t)*Math.pow(n,e),e=Math.round(Zs*n*(Math.random()-.5)*2);return Math.min(Xs,n+e)}function to(e){return e&&e._delegate?e._delegate:e}var no=(ro.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},ro.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},ro.prototype.setServiceProps=function(e){return this.serviceProps=e,this},ro.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},ro);function ro(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}var io="[DEFAULT]",so=(oo.prototype.get=function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){e=new us;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise},oo.prototype.getImmediate=function(t){var e=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),t=null!==(t=null==t?void 0:t.optional)&&void 0!==t&&t;if(!this.isInitialized(e)&&!this.shouldAutoInitialize()){if(t)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:e})}catch(e){if(t)return null;throw e}},oo.prototype.getComponent=function(){return this.component},oo.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:io})}catch(e){}try{for(var r=Ji(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var s=Xi(i.value,2),o=s[0],a=s[1],c=this.normalizeInstanceIdentifier(o);try{var l=this.getOrInitializeService({instanceIdentifier:c});a.resolve(l)}catch(e){}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},oo.prototype.clearInstance=function(e){this.instancesDeferred.delete(e=void 0===e?io:e),this.instancesOptions.delete(e),this.instances.delete(e)},oo.prototype.delete=function(){return Qi(this,void 0,void 0,function(){var t;return Yi(this,function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(Zi(Zi([],Xi(t.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()}))),Xi(t.filter(function(e){return"_delete"in e}).map(function(e){return e._delete()}))))];case 1:return e.sent(),[2]}})})},oo.prototype.isComponentSet=function(){return null!=this.component},oo.prototype.isInitialized=function(e){return this.instances.has(e=void 0===e?io:e)},oo.prototype.getOptions=function(e){return this.instancesOptions.get(e=void 0===e?io:e)||{}},oo.prototype.initialize=function(e){var t,n,r=(e=void 0===e?{}:e).options,r=void 0===r?{}:r,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(this.name+"("+i+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var s=this.getOrInitializeService({instanceIdentifier:i,options:r});try{for(var o=Ji(this.instancesDeferred.entries()),a=o.next();!a.done;a=o.next()){var c=Xi(a.value,2),l=c[0],u=c[1];i===this.normalizeInstanceIdentifier(l)&&u.resolve(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return s},oo.prototype.onInit=function(e,t){var n=this.normalizeInstanceIdentifier(t),r=null!==(t=this.onInitCallbacks.get(n))&&void 0!==t?t:new Set;r.add(e),this.onInitCallbacks.set(n,r);t=this.instances.get(n);return t&&e(t,n),function(){r.delete(e)}},oo.prototype.invokeOnInitCallbacks=function(e,t){var n,r,i=this.onInitCallbacks.get(t);if(i)try{for(var s=Ji(i),o=s.next();!o.done;o=s.next()){var a=o.value;try{a(e,t)}catch(e){}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},oo.prototype.getOrInitializeService=function(e){var t=e.instanceIdentifier,n=e.options,r=void 0===n?{}:n,e=this.instances.get(t);if(!e&&this.component&&(e=this.component.instanceFactory(this.container,{instanceIdentifier:(n=t)===io?void 0:n,options:r}),this.instances.set(t,e),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(e,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,e)}catch(e){}return e||null},oo.prototype.normalizeInstanceIdentifier=function(e){return void 0===e&&(e=io),!this.component||this.component.multipleInstances?e:io},oo.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},oo);function oo(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}var ao=(co.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},co.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},co.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new so(e,this);return this.providers.set(e,t),t},co.prototype.getProviders=function(){return Array.from(this.providers.values())},co);function co(e){this.name=e,this.providers=new Map}var lo,uo=[];(qi=lo=lo||{})[qi.DEBUG=0]="DEBUG",qi[qi.VERBOSE=1]="VERBOSE",qi[qi.INFO=2]="INFO",qi[qi.WARN=3]="WARN",qi[qi.ERROR=4]="ERROR",qi[qi.SILENT=5]="SILENT";function ho(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),s=go[t];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[s].apply(console,Zi(["["+i+"]  "+e.name+":"],n))}}var fo={debug:lo.DEBUG,verbose:lo.VERBOSE,info:lo.INFO,warn:lo.WARN,error:lo.ERROR,silent:lo.SILENT},po=lo.INFO,go=((dr={})[lo.DEBUG]="log",dr[lo.VERBOSE]="log",dr[lo.INFO]="info",dr[lo.WARN]="warn",dr[lo.ERROR]="error",dr),mo=(Object.defineProperty(yo.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in lo))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),yo.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?fo[e]:e},Object.defineProperty(yo.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(yo.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),yo.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,lo.DEBUG],e)),this._logHandler.apply(this,Zi([this,lo.DEBUG],e))},yo.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,lo.VERBOSE],e)),this._logHandler.apply(this,Zi([this,lo.VERBOSE],e))},yo.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,lo.INFO],e)),this._logHandler.apply(this,Zi([this,lo.INFO],e))},yo.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,lo.WARN],e)),this._logHandler.apply(this,Zi([this,lo.WARN],e))},yo.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,lo.ERROR],e)),this._logHandler.apply(this,Zi([this,lo.ERROR],e))},yo);function yo(e){this.name=e,this._logLevel=po,this._logHandler=ho,this._userLogHandler=null,uo.push(this)}function vo(o,t){for(var e=0,n=uo;e<n.length;e++)!function(e){var s=null;t&&t.level&&(s=fo[t.level]),e.userLogHandler=null===o?null:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=n.map(function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(function(e){return e}).join(" ");t>=(null!=s?s:e.logLevel)&&o({level:lo[t].toLowerCase(),message:i,args:n,type:e.name})}}(n[e])}class _o{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if(function(e){e=e.getComponent();return"VERSION"===(null==e?void 0:e.type)}(e)){e=e.getImmediate();return`${e.library}/${e.version}`}return null}).filter(e=>e).join(" ")}}const wo="@firebase/app",bo=new mo("@firebase/app");var Io;const To="[DEFAULT]",Eo={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},So=new Map,ko=new Map;function Co(t,n){try{t.container.addComponent(n)}catch(e){bo.debug(`Component ${n.name} failed to register with FirebaseApp ${t.name}`,e)}}function Ao(e,t){e.container.addOrOverwriteComponent(t)}function Ro(e){var t=e.name;if(ko.has(t))return bo.debug(`There were multiple attempts to register component ${t}.`),!1;ko.set(t,e);for(const n of So.values())Co(n,e);return!0}function No(e,t){return e.container.getProvider(t)}const Po=new Cs("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class Oo{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new no("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Po.create("app-deleted",{appName:this._name})}}const xo="9.0.0-2021720181311";function Do(e,t={}){if("object"!=typeof t){const r=t;t={name:r}}var n=Object.assign({name:To,automaticDataCollectionEnabled:!1},t);const r=n.name;if("string"!=typeof r||!r)throw Po.create("bad-app-name",{appName:String(r)});t=So.get(r);if(t){if(Fs(e,t.options)&&Fs(n,t.config))return t;throw Po.create("duplicate-app",{appName:r})}const i=new ao(r);for(const s of ko.values())i.addComponent(s);n=new Oo(e,n,i);return So.set(r,n),n}function Mo(e=To){var t=So.get(e);if(!t)throw Po.create("no-app",{appName:e});return t}async function Lo(e){var t=e.name;So.has(t)&&(So.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function Fo(e,t,n){var r;let i=null!==(r=Eo[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);e=i.match(/\s|\//),n=t.match(/\s|\//);if(e||n){const s=[`Unable to register library "${i}" with version "${t}":`];return e&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),e&&n&&s.push("and"),n&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void bo.warn(s.join(" "))}Ro(new no(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}function Uo(e,t){if(null!==e&&"function"!=typeof e)throw Po.create("invalid-log-argument");vo(e,t)}function jo(e){var t;t=e,uo.forEach(function(e){e.setLogLevel(t)})}Ro(new no("platform-logger",e=>new _o(e),"PRIVATE")),Fo(wo,"0.7.0-2021720181311",Io),Fo("fire-js","");var qo=Object.freeze({__proto__:null,SDK_VERSION:xo,_DEFAULT_ENTRY_NAME:To,_addComponent:Co,_addOrOverwriteComponent:Ao,_apps:So,_clearComponents:function(){ko.clear()},_components:ko,_getProvider:No,_registerComponent:Ro,_removeServiceInstance:function(e,t,n=To){No(e,t).clearInstance(n)},deleteApp:Lo,getApp:Mo,getApps:function(){return Array.from(So.values())},initializeApp:Do,onLog:Uo,registerVersion:Fo,setLogLevel:jo});class Vo{constructor(e,t){this._delegate=e,this.firebase=t,Co(e,new no("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),Lo(this._delegate)))}_getService(e,t=To){this._delegate.checkDestroyed();const n=this._delegate.container.getProvider(e);return n.isInitialized()||"EXPLICIT"!==(null===(e=n.getComponent())||void 0===e?void 0:e.instantiationMode)||n.initialize(),n.getImmediate({identifier:t})}_removeServiceInstance(e,t=To){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Co(this._delegate,e)}_addOrOverwriteComponent(e){Ao(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Bo=new Cs("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});function $o(i){const n={},s={__esModule:!0,initializeApp:function(e,t={}){e=Do(e,t);if(xs(n,e.name))return n[e.name];t=new i(e,s);return n[e.name]=t},app:o,registerVersion:Fo,setLogLevel:jo,onLog:Uo,apps:null,SDK_VERSION:xo,INTERNAL:{registerComponent:function(n){const r=n.name,t=r.replace("-compat","");{var e;Ro(n)&&"PUBLIC"===n.type&&(e=(e=o())=>{if("function"!=typeof e[t])throw Bo.create("invalid-app-argument",{appName:r});return e[t]()},void 0!==n.serviceProps&&ls(e,n.serviceProps),s[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,r);return t.apply(this,n.multipleInstances?e:[])})}return"PUBLIC"===n.type?s[t]:null},removeApp:function(e){delete n[e]},useAsService:function(e,t){if("serverAuth"===t)return null;return t},modularAPIs:qo}};function o(e){if(e=e||To,!xs(n,e))throw Bo.create("no-app",{appName:e});return n[e]}return s.default=s,Object.defineProperty(s,"apps",{get:function(){return Object.keys(n).map(e=>n[e])}}),o.App=i,s}G=function e(){const t=$o(Vo);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){ls(t,e)},createSubscribe:zs,ErrorFactory:Cs,deepExtend:ls}),t}();const zo=new mo("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){zo.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const VF=self.firebase.SDK_VERSION;VF&&0<=VF.indexOf("LITE")&&zo.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const Wo=G;Fo("@firebase/app-compat","0.1.0-2021720181311",void 0);Wo.registerVersion("firebase","9.0.0-2021720181311","app-compat");function Ko(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function Ho(n,r,i){var s,e=new Promise(function(e,t){Ko(s=n[r].apply(n,i)).then(e,t)});return e.request=s,e}function Go(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function Qo(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return Ho(this[n],e,arguments)})})}function Yo(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function Jo(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=Ho(e,n,arguments)).then(function(e){if(e)return new Zo(e,t.request)});var e,t})})}function Xo(e){this._index=e}function Zo(e,t){this._cursor=e,this._request=t}function ea(e){this._store=e}function ta(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function na(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new ta(n)}function ra(e){this._db=e}function ia(e,t,n){var t=Ho(indexedDB,"open",[e,t]),r=t.request;return r&&(r.onupgradeneeded=function(e){n&&n(new na(r.result,e.oldVersion,r.transaction))}),t.then(function(e){return new ra(e)})}function sa(e){return Ho(indexedDB,"deleteDatabase",[e])}Go(Xo,"_index",["name","keyPath","multiEntry","unique"]),Qo(Xo,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),Jo(Xo,"_index",IDBIndex,["openCursor","openKeyCursor"]),Go(Zo,"_cursor",["direction","key","primaryKey","value"]),Qo(Zo,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(Zo.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),Ko(t._request).then(function(e){if(e)return new Zo(e,t._request)})})})}),ea.prototype.createIndex=function(){return new Xo(this._store.createIndex.apply(this._store,arguments))},ea.prototype.index=function(){return new Xo(this._store.index.apply(this._store,arguments))},Go(ea,"_store",["name","keyPath","indexNames","autoIncrement"]),Qo(ea,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),Jo(ea,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),Yo(ea,"_store",IDBObjectStore,["deleteIndex"]),ta.prototype.objectStore=function(){return new ea(this._tx.objectStore.apply(this._tx,arguments))},Go(ta,"_tx",["objectStoreNames","mode"]),Yo(ta,"_tx",IDBTransaction,["abort"]),na.prototype.createObjectStore=function(){return new ea(this._db.createObjectStore.apply(this._db,arguments))},Go(na,"_db",["name","version","objectStoreNames"]),Yo(na,"_db",IDBDatabase,["deleteObjectStore","close"]),ra.prototype.transaction=function(){return new ta(this._db.transaction.apply(this._db,arguments))},Go(ra,"_db",["name","version","objectStoreNames"]),Yo(ra,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[ea,Xo].forEach(function(e){i in e.prototype&&(e.prototype[i.replace("open","iterate")]=function(){var e=(n=arguments,Array.prototype.slice.call(n)),t=e[e.length-1],n=this._store||this._index,r=n[i].apply(n,e.slice(0,-1));r.onsuccess=function(){t(r.result)}})})}),[Xo,ea].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,i=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(i.push(e.value),void 0===n||i.length!=n?e.continue():t(i)):t(i)})})})});H="0.5.0-2021720181311";const oa=1e4,aa=`w:${H}`,ca="FIS_v2",la="https://firebaseinstallations.googleapis.com/v1",ua=36e5;const ha=new Cs("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function da(e){return e instanceof Ss&&e.code.includes("request-failed")}function fa({projectId:e}){return`${la}/projects/${e}/installations`}function pa(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function ga(e,t){t=(await t.json()).error;return ha.create("request-failed",{requestName:e,serverCode:t.code,serverMessage:t.message,serverStatus:t.status})}function ma({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function ya(e,{refreshToken:t}){const n=ma(e);return n.append("Authorization",(t=t,`${ca} ${t}`)),n}async function va(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function _a(t){return new Promise(e=>{setTimeout(e,t)})}const wa=/^[cdef][\w-]{21}$/,ba="";function Ia(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=function(e){const t=function(e){const t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}(e);return t.substr(0,22)}(t);return wa.test(e)?e:ba}catch(e){return ba}}function Ta(e){return`${e.appName}!${e.appId}`}const Ea=new Map;function Sa(e,t){e=Ta(e);ka(e,t),function(e,t){const n=function(){!Ca&&"BroadcastChannel"in self&&(Ca=new BroadcastChannel("[Firebase] FID Change"),Ca.onmessage=e=>{ka(e.data.key,e.data.fid)});return Ca}();n&&n.postMessage({key:e,fid:t});0===Ea.size&&Ca&&(Ca.close(),Ca=null)}(e,t)}function ka(e,t){e=Ea.get(e);if(e)for(const n of e)n(t)}let Ca=null;const Aa="firebase-installations-database",Ra=1,Na="firebase-installations-store";let Pa=null;function Oa(){return Pa=Pa||ia(Aa,Ra,e=>{0===e.oldVersion&&e.createObjectStore(Na)}),Pa}async function xa(e,t){var n=Ta(e);const r=await Oa(),i=r.transaction(Na,"readwrite"),s=i.objectStore(Na);var o=await s.get(n);return await s.put(t,n),await i.complete,o&&o.fid===t.fid||Sa(e,t.fid),t}async function Da(e){e=Ta(e);const t=await Oa(),n=t.transaction(Na,"readwrite");await n.objectStore(Na).delete(e),await n.complete}async function Ma(e,t){var n=Ta(e);const r=await Oa(),i=r.transaction(Na,"readwrite"),s=i.objectStore(Na);var o=await s.get(n),t=t(o);return void 0===t?await s.delete(n):await s.put(t,n),await i.complete,!t||o&&o.fid===t.fid||Sa(e,t.fid),t}async function La(t){let n;var e=await Ma(t,e=>{e=function(e){e=e||{fid:Ia(),registrationStatus:0};return Ua(e)}(e),e=function(e,t){{if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:async function(e){let t=await Fa(e);for(;1===t.registrationStatus;)await _a(100),t=await Fa(e);if(0!==t.registrationStatus)return t;{var{installationEntry:n,registrationPromise:r}=await La(e);return r||n}}(e)}:{installationEntry:t};if(!navigator.onLine){var n=Promise.reject(ha.create("app-offline"));return{installationEntry:t,registrationPromise:n}}t={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},e=async function(t,n){try{var e=await async function(e,{fid:t}){const n=fa(e);var r=ma(e),e={fid:t,authVersion:ca,appId:e.appId,sdkVersion:aa};const i={method:"POST",headers:r,body:JSON.stringify(e)},s=await va(()=>fetch(n,i));if(s.ok){e=await s.json();return{fid:e.fid||t,registrationStatus:2,refreshToken:e.refreshToken,authToken:pa(e.authToken)}}throw await ga("Create Installation",s)}(t,n);return xa(t,e)}catch(e){throw da(e)&&409===e.customData.serverCode?await Da(t):await xa(t,{fid:n.fid,registrationStatus:0}),e}}(e,t);return{installationEntry:t,registrationPromise:e}}}(t,e);return n=e.registrationPromise,e.installationEntry});return e.fid===ba?{installationEntry:await n}:{installationEntry:e,registrationPromise:n}}function Fa(e){return Ma(e,e=>{if(!e)throw ha.create("installation-not-found");return Ua(e)})}function Ua(e){return 1===(t=e).registrationStatus&&t.registrationTime+oa<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function ja({appConfig:e,platformLoggerProvider:t},n){const r=([i,{fid:s}]=[e,n],`${fa(i)}/${s}/authTokens:generate`);var i,s;const o=ya(e,n),a=t.getImmediate({optional:!0});a&&o.append("x-firebase-client",a.getPlatformInfoString());t={installation:{sdkVersion:aa}};const c={method:"POST",headers:o,body:JSON.stringify(t)},l=await va(()=>fetch(r,c));if(l.ok)return pa(await l.json());throw await ga("Generate Auth Token",l)}async function qa(r,i=!1){let s;var e=await Ma(r.appConfig,e=>{if(!Ba(e))throw ha.create("not-registered");var t,n=e.authToken;if(i||2!==(t=n).requestStatus||function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+ua}(t)){if(1===n.requestStatus)return s=async function(e,t){let n=await Va(e.appConfig);for(;1===n.authToken.requestStatus;)await _a(100),n=await Va(e.appConfig);var r=n.authToken;return 0===r.requestStatus?qa(e,t):r}(r,i),e;if(!navigator.onLine)throw ha.create("app-offline");n=(t=e,n={requestStatus:1,requestTime:Date.now()},Object.assign(Object.assign({},t),{authToken:n}));return s=async function(t,n){try{var e=await ja(t,n),r=Object.assign(Object.assign({},n),{authToken:e});return await xa(t.appConfig,r),e}catch(e){throw!da(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(n=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),await xa(t.appConfig,n)):await Da(t.appConfig),e}}(r,n),n}return e});return s?await s:e.authToken}function Va(e){return Ma(e,e=>{if(!Ba(e))throw ha.create("not-registered");var t=e.authToken;return 1===(t=t).requestStatus&&t.requestTime+oa<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function Ba(e){return void 0!==e&&2===e.registrationStatus}async function $a(e,t=!1){return await async function(e){var{registrationPromise:e}=await La(e);e&&await e}(e.appConfig),(await qa(e,t)).token}function za(e){return ha.create("missing-app-config-values",{valueName:e})}const Wa="installations";Ro(new no(Wa,e=>{e=e.getProvider("app").getImmediate();return{app:e,appConfig:function(e){if(!e||!e.options)throw za("App Configuration");if(!e.name)throw za("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw za(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(e),platformLoggerProvider:No(e,"platform-logger"),_delete:()=>Promise.resolve()}},"PUBLIC")),Ro(new no("installations-internal",e=>{const t=No(e.getProvider("app").getImmediate(),Wa).getImmediate();return{getId:()=>async function(e){const{installationEntry:t,registrationPromise:n}=await La(e.appConfig);return(n||qa(e)).catch(console.error),t.fid}(t),getToken:e=>$a(t,e)}},"PRIVATE")),Fo("@firebase/installations",H);const Ka="analytics",Ha="firebase_id",Ga="origin",Qa=6e4,Ya="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Ja="https://www.googletagmanager.com/gtag/js",Xa=new mo("@firebase/analytics");function Za(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function ec(r,i,s,o){return async function(e,t,n){try{"event"===e?await async function(e,n,r,i,s){try{let t=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const c=await Za(r);for(const l of e){var o=c.find(e=>e.measurementId===l),a=o&&n[o.appId];if(!a){t=[];break}t.push(a)}}0===t.length&&(t=Object.values(n)),await Promise.all(t),e("event",i,s||{})}catch(e){Xa.error(e)}}(r,i,s,t,n):"config"===e?await async function(e,t,n,r,i,s){r=r[i];try{if(r)await t[r];else{const a=await Za(n);var o=a.find(e=>e.measurementId===i);o&&await t[o.appId]}}catch(e){Xa.error(e)}e("config",i,s)}(r,i,s,o,t,n):r("set",t)}catch(e){Xa.error(e)}}}const tc=new Cs("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),nc=30;const rc=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function ic(e){var t,{appId:n,apiKey:e}=e,e={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":e})},n=Ya.replace("{app-id}",n);const r=await fetch(n,e);if(200===r.status||304===r.status)return r.json();{let e="";try{var i=await r.json();null!==(t=i.error)&&void 0!==t&&t.message&&(e=i.error.message)}catch(e){}throw tc.create("config-fetch-failed",{httpStatus:r.status,responseMessage:e})}}async function sc(e,t=rc,n){var{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw tc.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw tc.create("no-api-key")}e=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const o=new cc;return setTimeout(async()=>{o.abort()},void 0!==n?n:Qa),async function t(n,{throttleEndTimeMillis:e,backoffCount:r},i,s=rc){const{appId:o,measurementId:a}=n;try{await oc(i,e)}catch(e){if(a)return Xa.warn("Timed out fetching this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${a}`+` provided in the "measurementId" field in the local Firebase config. [${e.message}]`),{appId:o,measurementId:a};throw e}try{const c=await ic(n);return s.deleteThrottleMetadata(o),c}catch(e){if(!ac(e)){if(s.deleteThrottleMetadata(o),a)return Xa.warn("Failed to fetch this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${a}`+` provided in the "measurementId" field in the local Firebase config. [${e.message}]`),{appId:o,measurementId:a};throw e}const l=503===Number(e.customData.httpStatus)?eo(r,s.intervalMillis,nc):eo(r,s.intervalMillis),u={throttleEndTimeMillis:Date.now()+l,backoffCount:r+1};return s.setThrottleMetadata(o,u),Xa.debug(`Calling attemptFetch again in ${l} millis`),t(n,u,i,s)}}({appId:r,apiKey:i,measurementId:s},e,o,t)}function oc(i,s){return new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(tc.create("fetch-throttle",{throttleEndTimeMillis:s}))})})}function ac(e){if(e instanceof Ss&&e.customData){e=Number(e.customData.httpStatus);return 429===e||500===e||503===e||504===e}}class cc{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function lc(t,e,n,r,i,s,o){const a=sc(t);a.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Xa.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>Xa.error(e)),e.push(a);var c=async function(){if(!ws())return Xa.warn(tc.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await bs()}catch(e){return Xa.warn(tc.create("indexeddb-unavailable",{errorInfo:e}).message),!1}return!0}().then(e=>{if(e)return r.getId()}),[e,c]=await Promise.all([a,c]);!function(){var e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Ja))return t}()&&function(e,t){const n=document.createElement("script");n.src=`${Ja}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(s,e.measurementId),i("js",new Date);const l=null!==(o=null==o?void 0:o.config)&&void 0!==o?o:{};return l[Ga]="firebase",l.update=!0,null!=c&&(l[Ha]=c),i("config",e.measurementId,l),e.measurementId}class uc{constructor(e){this.app=e}_delete(){return delete hc[this.app.options.appId],Promise.resolve()}}let hc={},dc=[];const fc={};let pc="dataLayer",gc="gtag",mc,yc,vc=!1;function _c(e){if(vc)throw tc.create("already-initialized");e.dataLayerName&&(pc=e.dataLayerName),e.gtagName&&(gc=e.gtagName)}function wc(e,t,n){!function(){const e=[];var t;ms()&&e.push("This is a browser extension environment."),Is()||e.push("Cookies are not available."),0<e.length&&(t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=tc.create("invalid-analytics-context",{errorInfo:t}),Xa.warn(t.message))}();var r,i,s=e.options.appId;if(!s)throw tc.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw tc.create("no-api-key");Xa.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+` measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId}`+' provided in the "measurementId" field in the local Firebase config.')}if(null!=hc[s])throw tc.create("already-exists",{id:s});return vc||(function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t,t}(pc),{wrappedGtag:r,gtagCore:i}=function(e,t,n,r,i){let s=function(){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=ec(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(hc,dc,fc,pc,gc),yc=r,mc=i,vc=!0),hc[s]=lc(e,dc,fc,t,mc,pc,n),new uc(e)}async function bc(){if(ms())return!1;if(!Is())return!1;if(!ws())return!1;try{return await bs()}catch(e){return!1}}function Ic(e,t,n){e=to(e),async function(e,t,n,r){if(r&&r.global)return e("set",{screen_name:n}),Promise.resolve();e("config",await t,{update:!0,screen_name:n})}(yc,hc[e.app.options.appId],t,n).catch(e=>Xa.error(e))}function Tc(e,t,n){e=to(e),async function(e,t,n,r){if(r&&r.global)return e("set",{user_id:n}),Promise.resolve();e("config",await t,{update:!0,user_id:n})}(yc,hc[e.app.options.appId],t,n).catch(e=>Xa.error(e))}function Ec(e,t,n){e=to(e),async function(e,t,n,r){if(r&&r.global){const i={};for(const s of Object.keys(n))i[`user_properties.${s}`]=n[s];return e("set",i),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(yc,hc[e.app.options.appId],t,n).catch(e=>Xa.error(e))}function Sc(e,t){e=to(e),async function(e,t){e=await e,window[`ga-disable-${e}`]=!t}(hc[e.app.options.appId],t).catch(e=>Xa.error(e))}function kc(e,t,n,r){e=to(e),async function(e,t,n,r,i){i&&i.global?e("event",n,r):(t=await t,e("event",n,Object.assign(Object.assign({},r),{send_to:t})))}(yc,hc[e.app.options.appId],t,n,r).catch(e=>Xa.error(e))}Ro(new no(Ka,(e,{options:t})=>{return wc(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)},"PUBLIC")),Ro(new no("analytics-internal",function(e){try{const r=e.getProvider(Ka).getImmediate();return{logEvent:(e,t,n)=>kc(r,e,t,n)}}catch(e){throw tc.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),Fo("@firebase/analytics","0.7.0-2021720181311");var Cc,Ac;class Rc{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){kc(this._delegate,e,t,n)}setCurrentScreen(e,t){Ic(this._delegate,e,t)}setUserId(e,t){Tc(this._delegate,e,t)}setUserProperties(e,t){Ec(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){Sc(this._delegate,e)}}(qi=Cc=Cc||{}).ADD_SHIPPING_INFO="add_shipping_info",qi.ADD_PAYMENT_INFO="add_payment_info",qi.ADD_TO_CART="add_to_cart",qi.ADD_TO_WISHLIST="add_to_wishlist",qi.BEGIN_CHECKOUT="begin_checkout",qi.CHECKOUT_PROGRESS="checkout_progress",qi.EXCEPTION="exception",qi.GENERATE_LEAD="generate_lead",qi.LOGIN="login",qi.PAGE_VIEW="page_view",qi.PURCHASE="purchase",qi.REFUND="refund",qi.REMOVE_FROM_CART="remove_from_cart",qi.SCREEN_VIEW="screen_view",qi.SEARCH="search",qi.SELECT_CONTENT="select_content",qi.SELECT_ITEM="select_item",qi.SELECT_PROMOTION="select_promotion",qi.SET_CHECKOUT_OPTION="set_checkout_option",qi.SHARE="share",qi.SIGN_UP="sign_up",qi.TIMING_COMPLETE="timing_complete",qi.VIEW_CART="view_cart",qi.VIEW_ITEM="view_item",qi.VIEW_ITEM_LIST="view_item_list",qi.VIEW_PROMOTION="view_promotion",qi.VIEW_SEARCH_RESULTS="view_search_results";const Nc=e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("analytics").getImmediate();return new Rc(t,e)};Ac={Analytics:Rc,settings:_c,isSupported:bc,EventName:Cc},Wo.INTERNAL.registerComponent(new no("analytics-compat",Nc,"PUBLIC").setServiceProps(Ac).setMultipleInstances(!0)),Wo.registerVersion("@firebase/analytics-compat","0.1.0-2021720181311");const Pc=new Map,Oc={activated:!1,tokenObservers:[]},xc={enabled:!1};function Dc(e){return Pc.get(e)||Oc}function Mc(e,t){Pc.set(e,t)}const Lc="https://content-firebaseappcheck.googleapis.com/v1beta",Fc="exchangeDebugToken",Uc={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class jc{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=r))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new us,t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new us,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}const qc=new Cs("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error."});function Vc(){return self.grecaptcha}function Bc(e){if(!Dc(e).activated)throw qc.create("use-before-activation",{appName:e.name})}async function $c({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(r["X-Firebase-Client"]=i.getPlatformInfoString());t={method:"POST",body:JSON.stringify(t),headers:r};let s;try{s=await fetch(e,t)}catch(e){throw qc.create("fetch-network-error",{originalErrorMessage:e.message})}if(200!==s.status)throw qc.create("fetch-status-error",{httpStatus:s.status});let o;try{o=await s.json()}catch(e){throw qc.create("fetch-parse-error",{originalErrorMessage:e.message})}e=o.ttl.match(/^([\d.]+)(s)$/);if(!e||!e[2]||isNaN(Number(e[1])))throw qc.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration "+`format: ${o.ttl}`});t=1e3*Number(e[1]),e=Date.now();return{token:o.attestationToken,expireTimeMillis:e+t,issuedAtTimeMillis:e}}const zc="firebase-app-check-database",Wc=1,Kc="firebase-app-check-store",Hc="debug-token";let Gc=null;function Qc(){return Gc||(Gc=new Promise((t,n)=>{try{const e=indexedDB.open(zc,Wc);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(qc.create("storage-open",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(Kc,{keyPath:"compositeKey"})}}catch(e){n(qc.create("storage-open",{originalErrorMessage:e.message}))}}),Gc)}async function Yc(e,t){const n=await Qc(),r=n.transaction(Kc,"readwrite"),i=r.objectStore(Kc),s=i.put({compositeKey:e,value:t});return new Promise((t,n)=>{s.onsuccess=e=>{t()},r.onerror=e=>{n(qc.create("storage-set",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))}})}async function Jc(e){const t=await Qc(),r=t.transaction(Kc,"readonly"),n=r.objectStore(Kc),i=n.get(e);return new Promise((t,n)=>{i.onsuccess=e=>{e=e.target.result;t(e?e.value:void 0)},r.onerror=e=>{n(qc.create("storage-get",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))}})}function Xc(e){return`${e.options.appId}-${e.name}`}const Zc=new mo("@firebase/app-check");async function el(t){if(ws()){let e=void 0;try{e=await Jc(Xc(t))}catch(e){Zc.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return e}}function tl(e,t){return ws()?Yc(Xc(e),t).catch(e=>{Zc.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}async function nl(){let e=void 0;try{e=await Jc(Hc)}catch(e){}if(e)return e;var t,n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)});return t=n,Yc(Hc,t).catch(e=>Zc.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`)),console.log(`App Check debug token: ${n}. You will need to add it to your app's App Check settings in the Firebase console for it to work`),n}const rl={error:"UNKNOWN_ERROR"};async function il(e,t=!1){var n,r=e.app;Bc(r);const i=Dc(r);let s=i.token,o=void 0;if(s||(n=await i.cachedTokenPromise)&&cl(n)&&(s=n,Mc(r,Object.assign(Object.assign({},i),{token:s})),al(r,{token:s.token})),!t&&s&&cl(s))return{token:s.token};if(xc.enabled){var a=await $c(function(e,t){var{projectId:n,appId:r,apiKey:e}=e.options;return{url:`${Lc}/projects/${n}/apps/${r}:${Fc}?key=${e}`,body:{debug_token:t}}}(r,await async function(){var e=xc;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}()),e.platformLoggerProvider);return await tl(r,a),Mc(r,Object.assign(Object.assign({},i),{token:a})),{token:a.token}}try{s=await i.provider.getToken()}catch(e){Zc.error(e),o=e}let c;return s?(c={token:s.token},Mc(r,Object.assign(Object.assign({},i),{token:s})),await tl(r,s)):c=(a=o,{token:function(e){return os.encodeString(JSON.stringify(e),!1)}(rl),error:a}),al(r,c),c}function sl(e,t,n,r){var{app:i}=e;const s=Dc(i);t={next:n,error:r,type:t};const o=Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,t]});if(o.tokenRefresher||(e=function(n){const{app:r}=n;return new jc(async()=>{var e=Dc(r);let t;if(t=e.token?await il(n,!0):await il(n),t.error)throw t.error},()=>!0,()=>{var e=Dc(r);if(e.token){var t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5,e=e.token.expireTimeMillis-3e5,t=Math.min(t,e);return Math.max(0,t-Date.now())}return 0},Uc.RETRIAL_MIN_WAIT,Uc.RETRIAL_MAX_WAIT)}(e),o.tokenRefresher=e),!o.tokenRefresher.isRunning()&&s.isTokenAutoRefreshEnabled&&o.tokenRefresher.start(),s.token&&cl(s.token)){const a=s.token;Promise.resolve().then(()=>n({token:a.token})).catch(()=>{})}else null==s.token&&s.cachedTokenPromise.then(e=>{e&&cl(e)&&n({token:e.token})}).catch(()=>{});Mc(i,o)}function ol(e,t){const n=Dc(e);var r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),Mc(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function al(e,t){for(const n of Dc(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function cl(e){return 0<e.expireTimeMillis-Date.now()}class ll{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){var{tokenObservers:e}=Dc(this.app);for(const t of e)ol(this.app,t.next);return Promise.resolve()}}const ul="https://www.google.com/recaptcha/api.js";function hl(t,n){var e=Dc(t);const r=new us;Mc(t,Object.assign(Object.assign({},e),{reCAPTCHAState:{initialized:r}}));const i=`fire_app_check_${t.name}`,s=document.createElement("div");s.id=i,s.style.display="none",document.body.appendChild(s);const o=Vc();return o?o.ready(()=>{dl(t,n,o,i),r.resolve(o)}):function(e){const t=document.createElement("script");t.src=`${ul}`,t.onload=e,document.head.appendChild(t)}(()=>{const e=Vc();if(!e)throw new Error("no recaptcha");e.ready(()=>{dl(t,n,e,i),r.resolve(e)})}),r.promise}function dl(e,t,n,r){r=n.render(r,{sitekey:t,size:"invisible"}),t=Dc(e);Mc(e,Object.assign(Object.assign({},t),{reCAPTCHAState:Object.assign(Object.assign({},t.reCAPTCHAState),{widgetId:r})}))}class fl{constructor(e){this._siteKey=e}async getToken(){if(!this._app||!this._platformLoggerProvider)throw qc.create("use-before-activation",{appName:""});var e=await async function(r){Bc(r);const i=await Dc(r).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const n=Dc(r).reCAPTCHAState;i.ready(()=>{e(i.execute(n.widgetId,{action:"fire_app_check"}))})})}(this._app).catch(e=>{throw qc.create("recaptcha-error")});return $c(function(e,t){var{projectId:n,appId:r,apiKey:e}=e.options;return{url:`${Lc}/projects/${n}/apps/${r}:exchangeRecaptchaToken?key=${e}`,body:{recaptcha_token:t}}}(this._app,e),this._platformLoggerProvider)}initialize(e){this._app=e,this._platformLoggerProvider=No(e,"platform-logger"),hl(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof fl&&this._siteKey===e._siteKey}}class pl{constructor(e){this._customProviderOptions=e}async getToken(){if(!this._app)throw qc.create("use-before-activation",{appName:""});var e=await this._customProviderOptions.getToken(),t=function(e){e=Os(e).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null}(e.token),t=null!==t&&t<Date.now()&&0<t?1e3*t:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:t})}initialize(e){this._app=e}isEqual(e){return e instanceof pl&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function gl(e=Mo(),t){const n=No(e=to(e),"app-check");if(n.isInitialized()){var r=n.getImmediate();const i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw qc.create("already-initialized",{appName:e.name})}r=n.initialize({options:t});return function(t,e,n){const r=Dc(t),i=Object.assign(Object.assign({},r),{activated:!0});i.provider=e,i.cachedTokenPromise=el(t).then(e=>(e&&cl(e)&&Mc(t,Object.assign(Object.assign({},Dc(t)),{token:e})),e)),i.isTokenAutoRefreshEnabled=void 0===n?t.automaticDataCollectionEnabled:n,Mc(t,i),i.provider.initialize(t)}(e,t.provider,t.isTokenAutoRefreshEnabled),r}const ml="app-check-internal";Ro(new no("app-check",e=>{var t=e.getProvider("app").getImmediate(),e=e.getProvider("platform-logger");return t=t,e=e,new ll(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(ml).initialize()})),Ro(new no(ml,e=>{var t,e=e.getProvider("app-check").getImmediate();return t=e,{getToken:e=>il(t,e),addTokenListener:e=>sl(t,"INTERNAL",e),removeTokenListener:e=>ol(t.app,e)}},"PUBLIC").setInstantiationMode("EXPLICIT")),Fo("@firebase/app-check","0.4.0-2021720181311"),function(){var e=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}();if("string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){const t=xc;t.enabled=!0;const n=new us;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(nl())}}();const yl=new Cs("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."});class vl{constructor(e){this.app=e}activate(e,t){let n;n="string"==typeof e?new fl(e):new pl({getToken:e.getToken}),this._delegate=gl(this.app,{provider:n,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw yl.create("use-before-activation",{appName:this.app.name});!function(e,t){const n=Dc(e=e.app);n.tokenRefresher&&(!0===t?n.tokenRefresher.start():n.tokenRefresher.stop()),Mc(e,Object.assign(Object.assign({},n),{isTokenAutoRefreshEnabled:t}))}(this._delegate,e)}getToken(e){if(!this._delegate)throw yl.create("use-before-activation",{appName:this.app.name});return async function(e,t){if((t=await il(e,t)).error)throw t.error;return{token:t.token}}(this._delegate,e)}onTokenChanged(e,t,n){if(!this._delegate)throw yl.create("use-before-activation",{appName:this.app.name});return function(e,t,n){let r=()=>{},i=()=>{};return r=null!=t.next?t.next.bind(t):t,null!=t.error?i=t.error.bind(t):n&&(i=n),sl(e,"EXTERNAL",r,i),()=>ol(e.app,r)}(this._delegate,e,t)}}Wo.INTERNAL.registerComponent(new no("appCheck-compat",e=>{e=e.getProvider("app-compat").getImmediate();return new vl(e)},"PUBLIC")),Wo.registerVersion("@firebase/app-check-compat","0.1.0-2021720181311");const _l={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},wl={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};const bl=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},Il=new Cs("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Tl=new mo("@firebase/auth");function El(e,...t){Tl.logLevel<=lo.ERROR&&Tl.error(`Auth (${xo}): ${e}`,...t)}function Sl(e,...t){throw Cl(e,...t)}function kl(e,...t){return Cl(e,...t)}function Cl(e,...t){if("string"==typeof e)return Il.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function Al(e,t,...n){if(!e)throw Cl(t,...n)}function Rl(e){e="INTERNAL ASSERTION FAILED: "+e;throw El(e),new Error(e)}function Nl(e,t){e||Rl(t)}const Pl=new Map;function Ol(e){Nl(e instanceof Function,"Expected a class definition");let t=Pl.get(e);return t?Nl(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,Pl.set(e,t)),t}function xl(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Dl(){return"http:"===Ml()||"https:"===Ml()}function Ml(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Ll{constructor(e,t){Nl((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=ps()||ys()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Dl()||ms()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Fl(e,t){Nl(e.emulator,"Emulator should always be set here");var{url:e}=e.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}class Ul{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:void Rl("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:void Rl("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:void Rl("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const jl={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded"},ql=new Ll(3e4,6e4);function Vl(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Bl(i,s,o,a,e={}){return $l(i,e,()=>{let e={},t={};a&&("GET"===s?t=a:e={body:JSON.stringify(a)});var n=js(Object.assign({key:i.config.apiKey},t)).slice(1);const r=new(Ul.headers());return r.set("Content-Type","application/json"),r.set("X-Client-Version",i._getSdkClientVersion()),i.languageCode&&r.set("X-Firebase-Locale",i.languageCode),Ul.fetch()(Wl(i,i.config.apiHost,o,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function $l(t,e,n){t._canInitEmulator=!1;e=Object.assign(Object.assign({},jl),e);try{const i=new Kl(t),s=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();var r=await s.json();if("needConfirmation"in r)throw Hl(t,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const o=s.ok?r.errorMessage:r.error.message,a=o.split(" : ")[0];if("FEDERATED_USER_ID_ALREADY_LINKED"===a)throw Hl(t,"credential-already-in-use",r);if("EMAIL_EXISTS"===a)throw Hl(t,"email-already-in-use",r);Sl(t,e[a]||a.toLowerCase().replace(/[_\s]+/g,"-"))}}catch(e){if(e instanceof Ss)throw e;Sl(t,"network-request-failed")}}async function zl(e,t,n,r,i={}){i=await Bl(e,t,n,r,i);return"mfaPendingCredential"in i&&Sl(e,"multi-factor-auth-required",{serverResponse:i}),i}function Wl(e,t,n,r){r=`${t}${n}?${r}`;return e.config.emulator?Fl(e.config,r):`${e.config.apiScheme}://${r}`}class Kl{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(kl(this.auth,"timeout")),ql.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Hl(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=kl(e,t,r);return i.customData._tokenResponse=n,i}function Gl(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Ql(e){return 1e3*Number(e)}function Yl(e){var[t,n,e]=e.split(".");if(void 0===t||void 0===n||void 0===e)return El("JWT malformed, contained fewer than 3 sections"),null;try{var r=cs(n);return r?JSON.parse(r):(El("Failed to decode base64 JWT payload"),null)}catch(e){return El("Caught error parsing JWT payload as JSON",e),null}}async function Jl(t,n,e=!1){if(e)return n;try{return await n}catch(e){throw e instanceof Ss&&([{code:n}]=[e],"auth/user-disabled"===n||"auth/user-token-expired"===n)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class Xl{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){var t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}this.errorBackoff=3e4;t=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,t)}schedule(e=!1){this.isRunning&&(e=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},e))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class Zl{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Gl(this.lastLoginAt),this.creationTime=Gl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function eu(e){var t=e.auth,n=await e.getIdToken(),r=await Jl(e,async function(e,t){return Bl(e,"POST","/v1/accounts:lookup",t)}(t,{idToken:n}));Al(null==r?void 0:r.users.length,t,"internal-error");var i=r.users[0];e._notifyReloadListener(i);t=null!==(n=i.providerUserInfo)&&void 0!==n&&n.length?i.providerUserInfo.map(e=>{var{providerId:t}=e,e=Gi(e,["providerId"]);return{providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}}):[],r=function(e,n){e=e.filter(t=>!n.some(e=>e.providerId===t.providerId));return[...e,...n]}(e.providerData,t),n=e.isAnonymous,t=!(e.email&&i.passwordHash||null!=r&&r.length),t=!!n&&t,t={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new Zl(i.createdAt,i.lastLoginAt),isAnonymous:t};Object.assign(e,t)}class tu{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Al(e.idToken,"internal-error"),Al(void 0!==e.idToken,"internal-error"),Al(void 0!==e.refreshToken,"internal-error");var t,t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(Al(t=Yl(t=e.idToken),"internal-error"),Al(void 0!==t.exp,"internal-error"),Al(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Al(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){var r,i,{accessToken:t,refreshToken:e,expiresIn:n}=(i=t,await{accessToken:(n=await $l(r=e,{},()=>{var e=js({grant_type:"refresh_token",refresh_token:i}).slice(1),{tokenApiHost:t,apiKey:n}=r.config,n=Wl(r,t,"/v1/token",`key=${n}`);return Ul.fetch()(n,{method:"POST",headers:{"X-Client-Version":r._getSdkClientVersion(),"Content-Type":"application/x-www-form-urlencoded"},body:e})})).access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token});this.updateTokensAndExpiration(t,e,Number(n))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:n,accessToken:r,expirationTime:t}=t;const i=new tu;return n&&(Al("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(Al("string"==typeof r,"internal-error",{appName:e}),i.accessToken=r),t&&(Al("number"==typeof t,"internal-error",{appName:e}),i.expirationTime=t),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new tu,this.toJSON())}_performRefresh(){return Rl("not implemented")}}function nu(e,t){Al("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ru{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,e=Gi(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new Xl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=e.displayName||null,this.email=e.email||null,this.phoneNumber=e.phoneNumber||null,this.photoURL=e.photoURL||null,this.isAnonymous=e.isAnonymous||!1,this.metadata=new Zl(e.createdAt||void 0,e.lastLoginAt||void 0)}async getIdToken(e){e=await Jl(this,this.stsTokenManager.getToken(this.auth,e));return Al(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(e){return async function(e,t=!1){const n=to(e);var r=await n.getIdToken(t),i=Yl(r);return Al(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error"),e="object"==typeof i.firebase?i.firebase:void 0,t=null==e?void 0:e.sign_in_provider,{claims:i,token:r,authTime:Gl(Ql(i.auth_time)),issuedAtTime:Gl(Ql(i.iat)),expirationTime:Gl(Ql(i.exp)),signInProvider:t||null,signInSecondFactor:(null==e?void 0:e.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=to(e);await eu(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Al(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new ru(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){Al(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await eu(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var e=await this.getIdToken();return await Jl(this,async function(e,t){return Bl(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!==(l=t.displayName)&&void 0!==l?l:void 0,r=null!==(o=t.email)&&void 0!==o?o:void 0,i=null!==(c=t.phoneNumber)&&void 0!==c?c:void 0,s=null!==(a=t.photoURL)&&void 0!==a?a:void 0,o=null!==(l=t.tenantId)&&void 0!==l?l:void 0,a=null!==(c=t._redirectEventId)&&void 0!==c?c:void 0,c=null!==(l=t.createdAt)&&void 0!==l?l:void 0,l=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0;const{uid:u,emailVerified:h,isAnonymous:d,providerData:f,stsTokenManager:p}=t;Al(u&&p,e,"internal-error");t=tu.fromJSON(this.name,p);Al("string"==typeof u,e,"internal-error"),nu(n,e.name),nu(r,e.name),Al("boolean"==typeof h,e,"internal-error"),Al("boolean"==typeof d,e,"internal-error"),nu(i,e.name),nu(s,e.name),nu(o,e.name),nu(a,e.name),nu(c,e.name),nu(l,e.name);const g=new ru({uid:u,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:o,stsTokenManager:t,createdAt:c,lastLoginAt:l});return f&&Array.isArray(f)&&(g.providerData=f.map(e=>Object.assign({},e))),a&&(g._redirectEventId=a),g}static async _fromIdTokenResponse(e,t,n=!1){const r=new tu;r.updateFromServerResponse(t);n=new ru({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await eu(n),n}}class iu{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){e=this.storage[e];return void 0===e?null:e}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}iu.type="NONE";const su=iu;function ou(e,t,n){return`firebase:${e}:${t}:${n}`}class au{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:e,name:n}=this.auth;this.fullUserKey=ou(this.userKey,e.apiKey,n),this.fullPersistenceKey=ou("persistence",e.apiKey,n),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?ru._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence!==e){var t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new au(Ol(su),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||Ol(su);const s=ou(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{var a=await u._get(s);if(a){var c=ru._fromJSON(e,a);u!==i&&(o=c),i=u;break}}catch(e){}var l=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&l.length&&(i=l[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new au(i,e,n)}}function cu(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(du(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(lu(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(pu(t))return"Blackberry";if(gu(t))return"Webos";if(uu(t))return"Safari";if((t.includes("chrome/")||hu(t))&&!t.includes("edge/"))return"Chrome";if(fu(t))return"Android";e=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==e?void 0:e.length)?e[1]:"Other"}function lu(e=fs()){return/firefox\//i.test(e)}function uu(e=fs()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function hu(e=fs()){return/crios\//i.test(e)}function du(e=fs()){return/iemobile/i.test(e)}function fu(e=fs()){return/android/i.test(e)}function pu(e=fs()){return/blackberry/i.test(e)}function gu(e=fs()){return/webos/i.test(e)}function mu(e=fs()){return/iphone|ipad|ipod/i.test(e)}function yu(e=fs()){return mu(e)||fu(e)||gu(e)||pu(e)||/windows phone/i.test(e)||du(e)}function vu(e,t=[]){let n;switch(e){case"Browser":n=cu(fs());break;case"Worker":n=`${cu(fs())}-${e}`;break;default:n=e}t=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${xo}/${t}`}class _u{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new bu(this),this.idTokenSubscription=new bu(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Il,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=Ol(n)),this._initializationPromise=this.queue(async()=>{var e;this._deleted||(this.persistenceManager=await au.create(this,t),this._deleted||(null!==(e=this._popupRedirectResolver)&&void 0!==e&&e._shouldInitProactively&&await this._popupRedirectResolver._initialize(this),await this.initializeCurrentUser(n),this._deleted||(this._isInitialized=!0)))}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e)}}async initializeCurrentUser(e){var t,n;let r=await this.assertedPersistence.getCurrentUser();return e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId,n=null===r||void 0===r?void 0:r._redirectEventId,e=await this.tryRedirectSignIn(e),t&&t!==n||null==e||!e.user||(r=e.user)),r?r._redirectEventId?(Al(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)):this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await eu(e)}catch(e){if("auth/network-request-failed"!==e.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?to(e):null;return t&&Al(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&Al(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Ol(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Cs("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){return this.redirectPersistenceManager||(Al(e=e&&Ol(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await au.create(this,[Ol(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!==(e=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==e?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return Al(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Al(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=vu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getSdkClientVersion(){return this.clientVersion}}function wu(e){return to(e)}class bu{constructor(e){this.auth=e,this.observer=null,this.addObserver=zs(e=>this.observer=e)}get next(){return Al(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Iu(e,t,n){const r=wu(e);Al(r._canInitEmulator,r,"emulator-config-failed"),Al(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");e=!(null==n||!n.disableWarnings);const i=Tu(t);var{host:n,port:t}=function(e){const t=Tu(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);{if(i){var s=i[1];return{host:s,port:Eu(r.substr(s.length+1))}}var[e,s]=r.split(":");return{host:e,port:Eu(s)}}}(t);r.config.emulator={url:`${i}//${n}${null===t?"":`:${t}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:n,port:t,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:e})}),function(e){function t(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"==typeof window||"undefined"==typeof document||e||("loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t())}(e)}function Tu(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Eu(e){if(!e)return null;e=Number(e);return isNaN(e)?null:e}class Su{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Rl("not implemented")}_getIdTokenResponse(e){return Rl("not implemented")}_linkToIdToken(e,t){return Rl("not implemented")}_getReauthenticationResolver(e){return Rl("not implemented")}}async function ku(e,t){return Bl(e,"POST","/v1/accounts:resetPassword",Vl(e,t))}async function Cu(e,t){return Bl(e,"POST","/v1/accounts:update",t)}async function Au(e,t){return Bl(e,"POST","/v1/accounts:sendOobCode",Vl(e,t))}class Ru extends Su{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Ru(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Ru(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){e="string"==typeof e?JSON.parse(e):e;if(null!=e&&e.email&&null!=e&&e.password){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return zl(e,"POST","/v1/accounts:signInWithPassword",Vl(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return zl(e,"POST","/v1/accounts:signInWithEmailLink",Vl(e,t))}(e,{email:this._email,oobCode:this._password});default:Sl(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Cu(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return zl(e,"POST","/v1/accounts:signInWithEmailLink",Vl(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Sl(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Nu(e,t){return zl(e,"POST","/v1/accounts:signInWithIdp",Vl(e,t))}class Pu extends Su{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Pu(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Sl("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:e}=t,t=Gi(t,["providerId","signInMethod"]);if(!n||!e)return null;e=new Pu(n,e);return Object.assign(e,t),e}_getIdTokenResponse(e){return Nu(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Nu(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Nu(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=js(t)}return e}}const Ou={USER_NOT_FOUND:"user-not-found"};class xu extends Su{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new xu({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new xu({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return zl(e,"POST","/v1/accounts:signInWithPhoneNumber",Vl(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){if((t=await zl(e,"POST","/v1/accounts:signInWithPhoneNumber",Vl(e,t))).temporaryProof)throw Hl(e,"account-exists-with-different-credential",t);return t}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return zl(e,"POST","/v1/accounts:signInWithPhoneNumber",Vl(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Ou)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:e}=e="string"==typeof e?JSON.parse(e):e;return n||t||r||e?new xu({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:e}):null}}class Du{constructor(e){var t=qs(Vs(e)),n=null!==(r=t.apiKey)&&void 0!==r?r:null,r=null!==(e=t.oobCode)&&void 0!==e?e:null,e=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(e=t.mode)&&void 0!==e?e:null);Al(n&&r&&e,"argument-error"),this.apiKey=n,this.operation=e,this.code=r,this.continueUrl=null!==(r=t.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(r=t.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(t=t.tenantId)&&void 0!==t?t:null}static parseLink(e){var t,n,r,t=(n=qs(Vs(t=e)).link,r=n?qs(Vs(n)).deep_link_id:null,((e=qs(Vs(t)).deep_link_id)?qs(Vs(e)).link:null)||e||r||n||t);try{return new Du(t)}catch(e){return null}}}class Mu{constructor(){this.providerId=Mu.PROVIDER_ID}static credential(e,t){return Ru._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){t=Du.parseLink(t);return Al(t,"argument-error"),Ru._fromEmailAndCode(e,t.code,t.tenantId)}}Mu.PROVIDER_ID="password",Mu.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Mu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Lu{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Fu extends Lu{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Uu extends Fu{static credentialFromJSON(e){e="string"==typeof e?JSON.parse(e):e;return Al("providerId"in e&&"signInMethod"in e,"argument-error"),Pu._fromParams(e)}credential(e){return this._credential(e)}_credential(e){return Al(e.idToken||e.accessToken,"argument-error"),Pu._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Uu.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Uu.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:e}=e;if(!(n||r||t||i))return null;if(!e)return null;try{return new Uu(e)._credential({idToken:t,accessToken:n,rawNonce:s,pendingToken:i})}catch(e){return null}}}class ju extends Fu{constructor(){super("facebook.com")}static credential(e){return Pu._fromParams({providerId:ju.PROVIDER_ID,signInMethod:ju.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ju.credentialFromTaggedObject(e)}static credentialFromError(e){return ju.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ju.credential(e.oauthAccessToken)}catch(e){return null}}}ju.FACEBOOK_SIGN_IN_METHOD="facebook.com",ju.PROVIDER_ID="facebook.com";class qu extends Fu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Pu._fromParams({providerId:qu.PROVIDER_ID,signInMethod:qu.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return qu.credentialFromTaggedObject(e)}static credentialFromError(e){return qu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:e}=e;if(!t&&!e)return null;try{return qu.credential(t,e)}catch(e){return null}}}qu.GOOGLE_SIGN_IN_METHOD="google.com",qu.PROVIDER_ID="google.com";class Vu extends Fu{constructor(){super("github.com")}static credential(e){return Pu._fromParams({providerId:Vu.PROVIDER_ID,signInMethod:Vu.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vu.credentialFromTaggedObject(e)}static credentialFromError(e){return Vu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Vu.credential(e.oauthAccessToken)}catch(e){return null}}}Vu.GITHUB_SIGN_IN_METHOD="github.com",Vu.PROVIDER_ID="github.com";class Bu extends Su{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Nu(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Nu(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Nu(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:n,pendingToken:e}="string"==typeof e?JSON.parse(e):e;return t&&n&&e&&t===n?new Bu(t,e):null}static _create(e,t){return new Bu(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class $u extends Fu{constructor(){super("twitter.com")}static credential(e,t){return Pu._fromParams({providerId:$u.PROVIDER_ID,signInMethod:$u.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return $u.credentialFromTaggedObject(e)}static credentialFromError(e){return $u.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:e}=e;if(!t||!e)return null;try{return $u.credential(t,e)}catch(e){return null}}}$u.TWITTER_SIGN_IN_METHOD="twitter.com",$u.PROVIDER_ID="twitter.com";async function zu(e,t){return zl(e,"POST","/v1/accounts:signUp",Vl(e,t))}class Wu{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){e=await ru._fromIdTokenResponse(e,n,r),r=Ku(n);return new Wu({user:e,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=Ku(n);return new Wu({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Ku(e){return e.providerId||("phoneNumber"in e?"phone":null)}class Hu extends Ss{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,this.name="FirebaseError",Object.setPrototypeOf(this,Hu.prototype),this.appName=e.name,this.code=t.code,this.tenantId=null!==(e=e.tenantId)&&void 0!==e?e:void 0,this.serverResponse=t.customData.serverResponse}static _fromErrorAndOperation(e,t,n,r){return new Hu(e,t,n,r)}}function Gu(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw Hu._fromErrorAndOperation(t,e,n,r);throw e})}function Qu(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Yu(e,t){const n=to(e);await Xu(!0,n,t);var{providerUserInfo:t}=(e=n.auth,t={idToken:await n.getIdToken(),deleteProvider:[t]},await Bl(e,"POST","/v1/accounts:update",t));const r=Qu(t||[]);return n.providerData=n.providerData.filter(e=>r.has(e.providerId)),r.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function Ju(e,t,n=!1){n=await Jl(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Wu._forOperation(e,"link",n)}async function Xu(e,t,n){await eu(t);const r=Qu(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";Al(r.has(n)===e,t.auth,i)}async function Zu(e,t,n=!1){var{auth:r}=e,i="reauthenticate";try{var s=await Jl(e,Gu(r,i,t,e),n);Al(s.idToken,r,"internal-error");var o=Yl(s.idToken);Al(o,r,"internal-error");var{sub:a}=o;return Al(e.uid===a,r,"user-mismatch"),Wu._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Sl(r,"user-mismatch"),e}}async function eh(e,t,n=!1){t=await Gu(e,"signIn",t),t=await Wu._fromIdTokenResponse(e,"signIn",t);return n||await e._updateCurrentUser(t.user),t}async function th(e,t){return eh(wu(e),t)}async function nh(e,t){e=to(e);return await Xu(!1,e,t.providerId),Ju(e,t)}async function rh(e,t){return Zu(to(e),t)}async function ih(e,t){const n=wu(e);t=await zl(n,"POST","/v1/accounts:signInWithCustomToken",Vl(n,{token:t,returnSecureToken:!0})),t=await Wu._fromIdTokenResponse(n,"signIn",t);return await n._updateCurrentUser(t.user),t}class sh{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?oh._fromServerResponse(e,t):Sl(e,"internal-error")}}class oh extends sh{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new oh(t)}}function ah(e,t,n){var r;Al(0<(null===(r=n.url)||void 0===r?void 0:r.length),e,"invalid-continue-uri"),Al(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(Al(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iosBundleId=n.iOS.bundleId),n.android&&(Al(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function ch(e,t,n){e=to(e),t={requestType:"PASSWORD_RESET",email:t};n&&ah(e,t,n),await Au(e,t)}async function lh(e,t){await Bl(e=to(e),"POST","/v1/accounts:update",Vl(e,{oobCode:t}))}async function uh(e,t){var n=to(e),r=await ku(n,{oobCode:t}),t=r.requestType;switch(Al(t,n,"internal-error"),t){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Al(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Al(r.mfaInfo,n,"internal-error");default:Al(r.email,n,"internal-error")}let i=null;return r.mfaInfo&&(i=sh._fromServerResponse(wu(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:i},operation:t}}async function hh(e,t,n){e=to(e),t={requestType:"EMAIL_SIGNIN",email:t};Al(n.handleCodeInApp,e,"argument-error"),n&&ah(e,t,n),await Au(e,t)}async function dh(e,t){var n=Dl()?xl():"http://localhost",{signinMethods:n}=await Bl(e=to(e),"POST","/v1/accounts:createAuthUri",Vl(e,{identifier:t,continueUri:n}));return n||[]}async function fh(e,t){var n=to(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&ah(n.auth,r,t);var{email:r}=await Au(n.auth,r);r!==e.email&&await e.reload()}async function ph(e,t,n){var r=to(e),t={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&ah(r.auth,t,n);var{email:t}=await Au(r.auth,t);t!==e.email&&await e.reload()}async function gh(e,{displayName:t,photoURL:n}){if(void 0!==t||void 0!==n){const r=to(e);e=await r.getIdToken(),n=await Jl(r,async function(e,t){return Bl(e,"POST","/v1/accounts:update",t)}(r.auth,{idToken:e,displayName:t,photoUrl:n,returnSecureToken:!0}));r.displayName=n.displayName||null,r.photoURL=n.photoUrl||null;const i=r.providerData.find(({providerId:e})=>"password"===e);i&&(i.displayName=r.displayName,i.photoURL=r.photoURL),await r._updateTokensIfNecessary(n)}}async function mh(e,t,n){var{auth:r}=e;const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);r=await Jl(e,Cu(r,i));await e._updateTokensIfNecessary(r,!0)}class yh{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class vh extends yh{constructor(e,t,n,r){super(e,t,n),this.username=r}}class _h extends yh{constructor(e,t){super(e,"facebook.com",t)}}class wh extends vh{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class bh extends yh{constructor(e,t){super(e,"google.com",t)}}class Ih extends vh{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Th(e){var{user:t,_tokenResponse:e}=e;return t.isAnonymous&&!e?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;var{providerId:t}=e,n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&null!=e&&e.idToken){var i=null===(i=null===(i=Yl(e.idToken))||void 0===i?void 0:i.firebase)||void 0===i?void 0:i.sign_in_provider;if(i){i="anonymous"!==i&&"custom"!==i?i:null;return new yh(r,i)}}if(!t)return null;switch(t){case"facebook.com":return new _h(r,n);case"github.com":return new wh(r,n);case"google.com":return new bh(r,n);case"twitter.com":return new Ih(r,n,e.screenName||null);case"custom":case"anonymous":return new yh(r,null);default:return new yh(r,t,n)}}(e)}class Eh{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new Eh("enroll",e)}static _fromMfaPendingCredential(e){return new Eh("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return Eh._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.idToken)return Eh._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Sh{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,r){const i=wu(e);e=(r.serverResponse.mfaInfo||[]).map(e=>sh._fromServerResponse(i,e));Al(r.serverResponse.mfaPendingCredential,i,"internal-error");const s=Eh._fromMfaPendingCredential(r.serverResponse.mfaPendingCredential);return new Sh(s,e,async e=>{e=await e._process(i,s);delete r.serverResponse.mfaInfo,delete r.serverResponse.mfaPendingCredential;var t=Object.assign(Object.assign({},r.serverResponse),{idToken:e.idToken,refreshToken:e.refreshToken});switch(r.operationType){case"signIn":var n=await Wu._fromIdTokenResponse(i,r.operationType,t);return await i._updateCurrentUser(n.user),n;case"reauthenticate":return Al(r.user,i,"internal-error"),Wu._forOperation(r.user,r.operationType,t);default:Sl(i,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class kh{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>sh._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new kh(e)}async getSession(){return Eh._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e;e=await this.getSession(),t=await Jl(this.user,n._process(this.user.auth,e,t));return await this.user._updateTokensIfNecessary(t),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n=await this.user.getIdToken(),n=await Jl(this.user,(e=this.user.auth,n={idToken:n,mfaEnrollmentId:t},Bl(e,"POST","/v2/accounts/mfaEnrollment:withdraw",Object.assign({tenantId:e.tenantId},n))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(n);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==e.code)throw e}}}const Ch=new WeakMap;const Ah="__sak";class Rh{constructor(e,t){this.storage=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ah,"1"),this.storage.removeItem(Ah),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){e=this.storage.getItem(e);return Promise.resolve(e?JSON.parse(e):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}}class Nh extends Rh{constructor(){var e;super(window.localStorage,"LOCAL"),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=(uu(e=fs())||mu(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=yu(),this._shouldAllowMigration=!0,this.boundEventHandler=this.onStorageEvent.bind(this)}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}var n=()=>{var e=this.storage.getItem(r);!t&&this.localCache[r]===e||this.notifyListeners(r,e)};const i=this.storage.getItem(r);vs()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){this.localCache[e]=t;e=this.listeners[e];if(e)for(const n of Array.from(e))n(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Nh.type="LOCAL";const Ph=Nh;class Oh extends Rh{constructor(){super(window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Oh.type="SESSION";const xh=Oh;class Dh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));if(e)return e;e=new Dh(t);return this.receivers.push(e),e}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;e=this.handlersMap[r];null!=e&&e.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),e=Array.from(e).map(async e=>e(t.origin,i)),e=await Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:e}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Mh(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Dh.receivers=[];class Lh{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,o=50){const a="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let c,l;return new Promise((n,r)=>{const i=Mh("",20);a.port1.start();const s=setTimeout(()=>{r(new Error("unsupported_event"))},o);l={messageChannel:a,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),c=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),n(t.data.response);break;default:clearTimeout(s),clearTimeout(c),r(new Error("invalid_response"))}}},this.handlers.add(l),a.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[a.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Fh(){return window}function Uh(){return void 0!==Fh().WorkerGlobalScope&&"function"==typeof Fh().importScripts}const jh="firebaseLocalStorageDb",qh=1,Vh="firebaseLocalStorage",Bh="fbase_key";class $h{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function zh(e,t){return e.transaction([Vh],t?"readwrite":"readonly").objectStore(Vh)}function Wh(){const r=indexedDB.open(jh,qh);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(Vh,{keyPath:Bh})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(Vh)?n(e):(e.close(),t=indexedDB.deleteDatabase(jh),await new $h(t).toPromise(),n(await Wh()))})})}async function Kh(e,t,n){n=zh(e,!0).put({[Bh]:t,value:n});return new $h(n).toPromise()}function Hh(e,t){t=zh(e,!0).delete(t);return new $h(t).toPromise()}class Gh{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Wh(),this.db)}async _withRetries(e){let t=0;for(;;)try{return await e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Uh()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Dh._getInstance(Uh()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t,n;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new Lh(this.activeServiceWorker),(n=await this.sender._send("ping",{},800))&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await Wh();return await Kh(e,Ah,"1"),await Hh(e,Ah),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>Kh(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(t){var e=await this._withRetries(e=>async function(e,t){return t=zh(e,!1).get(t),void 0===(t=await new $h(t).toPromise())?null:t.value}(e,t));return this.localCache[t]=e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>Hh(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e,t,n=await this._withRetries(e=>{e=zh(e,!1).getAll();return new $h(e).toPromise()});if(!n)return[];if(0!==this.pendingWrites)return[];const r=[],i=new Set;for({fbase_key:e,value:t}of n)i.add(e),JSON.stringify(this.localCache[e])!==JSON.stringify(t)&&(this.notifyListeners(e,t),r.push(e));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r}notifyListeners(e,t){this.localCache[e]=t;e=this.listeners[e];if(e)for(const n of Array.from(e))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Gh.type="LOCAL";const Qh=Gh;function Yh(r){return new Promise((e,n)=>{const t=document.createElement("script");t.setAttribute("src",r),t.onload=e,t.onerror=e=>{const t=kl("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!==(e=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==e?e:document).appendChild(t)})}function Jh(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Xh{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new Zh(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t=e||1e12;null===(e=this._widgets.get(t))||void 0===e||e.delete(),this._widgets.delete(t)}getResponse(e){return(null===(e=this._widgets.get(e||1e12))||void 0===e?void 0:e.getResponse())||""}async execute(e){return null===(e=this._widgets.get(e||1e12))||void 0===e||e.execute(),""}}class Zh{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};e="string"==typeof e?document.getElementById(e):e;Al(e,"argument-error",{appName:t}),this.container=e,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(t){const n=[],r="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<t;e++)n.push(r.charAt(Math.floor(Math.random()*r.length)));return n.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const ed=Jh("rcb"),td=new Ll(3e4,6e4);class nd{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!Fh().grecaptcha}load(s,o=""){var e;return Al((e=o).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e),s,"argument-error"),this.shouldResolveImmediately(o)?Promise.resolve(Fh().grecaptcha):new Promise((t,r)=>{const i=Fh().setTimeout(()=>{r(kl(s,"network-request-failed"))},td.get());Fh()[ed]=()=>{Fh().clearTimeout(i),delete Fh()[ed];const e=Fh().grecaptcha;if(e){const n=e.render;e.render=(e,t)=>{t=n(e,t);return this.counter++,t},this.hostLanguage=o,t(e)}else r(kl(s,"internal-error"))},Yh(`https://www.google.com/recaptcha/api.js??${js({onload:ed,render:"explicit",hl:o})}`).catch(()=>{clearTimeout(i),r(kl(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!Fh().grecaptcha&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class rd{async load(e){return new Xh(e)}clearedOneInstance(){}}const id="recaptcha",sd={theme:"light",type:"image"};class od{constructor(e,t=Object.assign({},sd),n){this.parameters=t,this.type=id,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=wu(n),this.isInvisible="invisible"===this.parameters.size,Al("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");e="string"==typeof e?document.getElementById(e):e;Al(e,this.auth,"argument-error"),this.container=e,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?rd:nd),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();var t=r.getResponse(e);return t||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Al(!this.parameters.sitekey,this.auth,"argument-error"),Al(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Al("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=Fh()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){Al(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Al(Dl()&&!Uh(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await Bl(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");Al(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Al(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class ad{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){e=xu._fromVerification(this.verificationId,e);return this.onConfirmation(e)}}async function cd(t,n,r){var i,s,o,a,c,l,u=await r.verify();try{Al("string"==typeof u,t,"argument-error"),Al(r.type===id,t,"argument-error");let e;if(e="string"==typeof n?{phoneNumber:n}:n,"session"in e){var h=e.session;if("phoneNumber"in e)return Al("enroll"===h.type,t,"internal-error"),(c=t,l={idToken:h.credential,phoneEnrollmentInfo:{phoneNumber:e.phoneNumber,recaptchaToken:u}},await Bl(c,"POST","/v2/accounts/mfaEnrollment:start",Object.assign({tenantId:c.tenantId},l))).phoneSessionInfo.sessionInfo;Al("signin"===h.type,t,"internal-error");var d=(null===(i=e.multiFactorHint)||void 0===i?void 0:i.uid)||e.multiFactorUid;return Al(d,t,"missing-multi-factor-info"),(a={mfaPendingCredential:h.credential,mfaEnrollmentId:d,phoneSignInInfo:{recaptchaToken:u}},await Bl(t,"POST","/v2/accounts/mfaSignIn:start",Object.assign({tenantId:t.tenantId},a))).phoneResponseInfo.sessionInfo}var{sessionInfo:f}=(s=t,o={phoneNumber:e.phoneNumber,recaptchaToken:u},await Bl(s,"POST","/v1/accounts:sendVerificationCode",Vl(s,o)));return f}finally{r._reset()}}class ld{constructor(e){this.providerId=ld.PROVIDER_ID,this.auth=wu(e)}verifyPhoneNumber(e,t){return cd(this.auth,e,to(t))}static credential(e,t){return xu._fromVerification(e,t)}static credentialFromResult(e){return ld.credentialFromTaggedObject(e)}static credentialFromError(e){return ld.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:t,temporaryProof:e}=e;return t&&e?xu._fromTokenResponse(t,e):null}}function ud(e,t){return t?Ol(t):(Al(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}ld.PROVIDER_ID="phone",ld.PHONE_SIGN_IN_METHOD="phone";class hd extends Su{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Nu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Nu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Nu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function dd(e){return eh(e.auth,new hd(e),e.bypassAuthState)}function fd(e){var{auth:t,user:n}=e;return Al(n,t,"internal-error"),Zu(n,new hd(e),e.bypassAuthState)}async function pd(e){var{auth:t,user:n}=e;return Al(n,t,"internal-error"),Ju(n,new hd(e),e.bypassAuthState)}class gd{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:e}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(e)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return dd;case"linkViaPopup":case"linkViaRedirect":return pd;case"reauthViaPopup":case"reauthViaRedirect":return fd;default:Sl(this.auth,"internal-error")}}resolve(e){Nl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Nl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const md=new Ll(2e3,1e4);class yd extends gd{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,yd.currentPopupAction&&yd.currentPopupAction.cancel(),yd.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return Al(e,this.auth,"internal-error"),e}async onExecution(){Nl(1===this.filter.length,"Popup operations only handle one event");var e=Mh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(kl(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(kl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,yd.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!==(e=null===(e=this.authWindow)||void 0===e?void 0:e.window)&&void 0!==e&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(kl(this.auth,"popup-closed-by-user"))},2e3):this.pollId=window.setTimeout(t,md.get())};t()}}yd.currentPopupAction=null;const vd="pendingRedirect",_d=new Map;class wd extends gd{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let t=_d.get(this.auth._key());if(!t){try{const i=(e=this.resolver,n=this.auth,r=Td(n),n="true"===await Id(e)._get(r),await Id(e)._remove(r),await n)?await super.execute():null;t=()=>Promise.resolve(i)}catch(e){t=()=>Promise.reject(e)}_d.set(this.auth._key(),t)}var e,n,r;return t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function bd(e,t){return Id(e)._set(Td(t),"true")}function Id(e){return Ol(e._redirectPersistence)}function Td(e){return ou(vd,e.config.apiKey,e.name)}function Ed(e,t,n){return async function(e,t,n){var r=wu(e);Al(t instanceof Lu,e,"argument-error");const i=ud(r,n);return await bd(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function Sd(e,t,n){return async function(e,t,n){e=to(e);Al(t instanceof Lu,e.auth,"argument-error");const r=ud(e.auth,n);await bd(r,e.auth);n=await Ad(e);return r._openRedirect(e.auth,t,"reauthViaRedirect",n)}(e,t,n)}function kd(e,t,n){return async function(e,t,n){e=to(e);Al(t instanceof Lu,e.auth,"argument-error");const r=ud(e.auth,n);await Xu(!1,e,t.providerId),await bd(r,e.auth);n=await Ad(e);return r._openRedirect(e.auth,t,"linkViaRedirect",n)}(e,t,n)}async function Cd(e,t,n=!1){const r=wu(e);e=ud(r,t);const i=new wd(r,e,n),s=await i.execute();return s&&!n&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,t)),s}async function Ad(e){var t=Mh(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Rd{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Pd(e);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!Pd(e)?(n=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error",t.onError(kl(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(Nd(e))}saveEventToCache(e){this.cachedEventUids.add(Nd(e)),this.lastProcessedEventTime=Date.now()}}function Nd(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Pd({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function Od(e,t={}){return Bl(e,"GET","/v1/projects",t)}const xd=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Dd=/^https?/;async function Md(e){if(!e.config.emulator){var{authorizedDomains:t}=await Od(e);for(const n of t)try{if(function(e){const t=xl(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){var i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Dd.test(n))return!1;if(xd.test(e))return r===e;const s=e.replace(/\./g,"\\."),o=new RegExp("^(.+\\."+s+"|"+s+")$","i");return o.test(r)}(n))return}catch(e){}Sl(e,"unauthorized-domain")}}const Ld=new Ll(3e4,6e4);function Fd(){const t=Fh().___jsl;if(null!==t&&void 0!==t&&t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let Ud=null;function jd(e){var i;return Ud=Ud||(i=e,new Promise((e,t)=>{function n(){Fd(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Fd(),t(kl(i,"network-request-failed"))},timeout:Ld.get()})}if(null!==(r=null===(r=Fh().gapi)||void 0===r?void 0:r.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(r=Fh().gapi)||void 0===r||!r.load){var r=Jh("iframefcb");return Fh()[r]=()=>{gapi.load?n():t(kl(i,"network-request-failed"))},Yh(`https://apis.google.com/js/api.js?onload=${r}`)}n()}}).catch(e=>{throw Ud=null,e})),Ud}const qd=new Ll(5e3,15e3),Vd="__/auth/iframe",Bd="emulator/auth/iframe",$d={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},zd=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function Wd(o){const e=await jd(o);var t=Fh().gapi;return Al(t,o,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config;Al(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?Fl(t,Bd):`https://${e.config.authDomain}/${Vd}`;const r={apiKey:t.apiKey,appName:e.name,v:xo};(t=zd.get(e.config.apiHost))&&(r.eid=t);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${js(r).slice(1)}`}(o),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:$d,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=kl(o,"network-request-failed"),r=Fh().setTimeout(()=>{t(n)},qd.get());function i(){Fh().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const Kd={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Hd{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Gd(e,t,n,r=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Kd),{width:r.toString(),height:i.toString(),top:s,left:o});o=fs().toLowerCase();n&&(a=hu(o)?"_blank":n),lu(o)&&(t=t||"http://localhost",c.scrollbars="yes");var l,n=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if([o=fs()]=[o],mu(o)&&null!==(l=window.navigator)&&void 0!==l&&l.standalone&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new Hd(null);const u=window.open(t||"",a,n);Al(u,e,"popup-blocked");try{u.focus()}catch(e){}return new Hd(u)}const Qd="__/auth/handler",Yd="emulator/auth/handler";function Jd(e,t,n,r,i,s){Al(e.config.authDomain,e,"auth-domain-config-required"),Al(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:xo,eventId:i};if(t instanceof Lu){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",Ms(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(var[a,c]of Object.entries(s||{}))o[a]=c}if(t instanceof Fu){const u=t.getScopes().filter(e=>""!==e);0<u.length&&(o.scopes=u.join(","))}e.tenantId&&(o.tid=e.tenantId);const l=o;for(const h of Object.keys(l))void 0===l[h]&&delete l[h];return`${[{config:e}]=[e],e.emulator?Fl(e,Yd):`https://${e.authDomain}/${Qd}`}?${js(l).slice(1)}`}const Xd="webStorageSupport";const Zd=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=xh,this._completeRedirectFn=Cd}async _openPopup(e,t,n,r){var i;return Nl(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),Gd(e,Jd(e,t,n,xl(),r),Mh())}async _openRedirect(e,t,n,r){return await this._originValidation(e),r=Jd(e,t,n,xl(),r),Fh().location.href=r,new Promise(()=>{})}_initialize(e){var t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(Nl(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n}async initAndGetManager(t){const e=await Wd(t),n=new Rd(t);return e.register("authEvent",e=>{return Al(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,n){const e=this.iframes[t._key()];e.send(Xd,{type:Xd},e=>{e=null===(e=null==e?void 0:e[0])||void 0===e?void 0:e[Xd];void 0!==e&&n(!!e),Sl(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Md(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return yu()||uu()||mu()}};class ef extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return Rl("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new ef(e)}_finalizeEnroll(e,t,n){return e=e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()},Bl(e,"POST","/v2/accounts/mfaEnrollment:finalize",Object.assign({tenantId:e.tenantId},n))}_finalizeSignIn(e,t){return e=e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()},Bl(e,"POST","/v2/accounts/mfaSignIn:finalize",Object.assign({tenantId:e.tenantId},t))}}class tf{constructor(){}static assertion(e){return ef._fromCredential(e)}}var nf;class rf{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null===e||void 0===e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Al(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function sf(){return window}nf="Browser",Ro(new no("auth",(e,{options:n})=>{e=e.getProvider("app").getImmediate();const{apiKey:r,authDomain:i}=e.options;return(e=>{Al(r&&!r.includes(":"),"invalid-api-key",{appName:e.name}),Al(!(null!==i&&void 0!==i&&i.includes(":")),"argument-error",{appName:e.name});var t={apiKey:r,authDomain:i,clientPlatform:nf,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:vu(nf)},t=new _u(e,t);return function(e,t){const n=(null==t?void 0:t.persistence)||[];var r=(Array.isArray(n)?n:[n]).map(Ol);null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(t,n),t})(e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),Ro(new no("auth-internal",e=>{e=wu(e.getProvider("auth").getImmediate());return e=e,new rf(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),Fo("@firebase/auth","0.17.0-2021720181311",function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(nf));async function of(e,t,n){var{BuildInfo:r}=sf();Nl(t.sessionId,"AuthEvent did not contain a session ID");var i=await async function(e){const t=function(t){if(Nl(/[0-9a-zA-Z]+/.test(t),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(t);const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId);const s={};return mu()?s.ibi=r.packageName:fu()?s.apn=r.packageName:Sl(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,Jd(e,n,t.type,void 0,null!==(t=t.eventId)&&void 0!==t?t:void 0,s)}function af(r){const{cordova:i}=sf();return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=fs(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}const cf=20;class lf extends Rd{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}function uf(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:function(){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<cf;e++){var r=Math.floor(Math.random()*n.length);t.push(n.charAt(r))}return t.join("")}(),postBody:null,tenantId:e.tenantId,error:kl(e,"no-auth-event")}}async function hf(e){var t=await ff()._get(pf(e));return t&&await ff()._remove(pf(e)),t}function df(e,t){var n,r,i;const s=(n=gf(o=t),r=n.link?decodeURIComponent(n.link):void 0,i=gf(r).link,t=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0,(n=gf(t).link)||t||i||r||o);if(s.includes("/__/auth/callback")){var o=gf(s),o=o.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(o.firebaseError)):null,o=null===(o=null===(o=null==o?void 0:o.code)||void 0===o?void 0:o.split("auth/"))||void 0===o?void 0:o[1],o=o?kl(o):null;return o?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:o,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}function ff(){return Ol(Ph)}function pf(e){return ou("authEvent",e.config.apiKey,e.name)}function gf(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return qs(t.join("?"))}const mf=class{constructor(){this._redirectPersistence=xh,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Cd}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new lf(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){Sl(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i,s;a=e,s=sf(),Al("function"==typeof(null===(i=null==s?void 0:s.universalLinks)||void 0===i?void 0:i.subscribe),a,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),Al(void 0!==(null===(i=null==s?void 0:s.BuildInfo)||void 0===i?void 0:i.packageName),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),Al("function"==typeof(null===(i=null===(i=null===(i=null==s?void 0:s.cordova)||void 0===i?void 0:i.plugins)||void 0===i?void 0:i.browsertab)||void 0===i?void 0:i.openUrl),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Al("function"==typeof(null===(i=null===(i=null===(i=null==s?void 0:s.cordova)||void 0===i?void 0:i.plugins)||void 0===i?void 0:i.browsertab)||void 0===i?void 0:i.isAvailable),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Al("function"==typeof(null===(s=null===(s=null==s?void 0:s.cordova)||void 0===s?void 0:s.InAppBrowser)||void 0===s?void 0:s.open),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const o=await this._initialize(e);await o.initialized(),o.resetRedirect(),_d.clear(),await this._originValidation(e);var a=uf(e,n,r);n=e,r=a,await ff()._set(pf(n),r);t=await af(await of(e,a,t));return async function(o,a,c){const{cordova:l}=sf();let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null===(e=l.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==c?void 0:c.close)&&c.close()}function i(){t=t||window.setTimeout(()=>{e(kl(o,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}a.addPassiveListener(r),document.addEventListener("resume",i,!1),fu()&&document.addEventListener("visibilitychange",s,!1),u=()=>{a.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,o,t)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var{BuildInfo:t}=sf();const n={};mu()?n.iosBundleId=t.packageName:fu()?n.androidPackageName=t.packageName:Sl(e,"operation-not-supported-in-this-environment"),await Od(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=sf(),s=setTimeout(async()=>{await hf(r),i.onEvent(yf())},500),o=async e=>{clearTimeout(s);var t=await hf(r);let n=null;t&&null!=e&&e.url&&(n=df(t,e.url)),i.onEvent(n||yf())};void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,o);const a=t,c=`${n.packageName.toLowerCase()}://`;sf().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function yf(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:kl("no-auth-event")}}var vf;function _f(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function wf(e=fs()){return!("file:"!==_f()&&"ionic:"!==_f()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function bf(e=fs()){return vs()&&11===(null===document||void 0===document?void 0:document.documentMode)||([e=fs()]=[e],/Edge\/\d+/.test(e))}function If(){try{const t=self.localStorage;var e=Mh();if(t)return t.setItem(e,"1"),t.removeItem(e),!bf()||ws()}catch(e){return Tf()&&ws()}return!1}function Tf(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function Ef(){return("http:"===_f()||"https:"===_f()||ms()||wf())&&!(ys()||gs())&&If()&&!Tf()}function Sf(){return wf()&&"undefined"!=typeof document}const kf={LOCAL:"local",NONE:"none",SESSION:"session"},Cf=Al,Af="persistence";async function Rf(e){await e._initializationPromise;const t=Nf();var n=ou(Af,e.config.apiKey,e.name);null!==t&&void 0!==t&&t.sessionStorage&&t.sessionStorage.setItem(n,e._getPersistence())}function Nf(){return"undefined"!=typeof window?window:null}const Pf=Al;class Of{constructor(){this.browserResolver=Ol(Zd),this.cordovaResolver=Ol(mf),this.underlyingResolver=null,this._redirectPersistence=xh,this._completeRedirectFn=Cd}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Sf()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Pf(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!Sf()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function xf(e){return e.unwrap()}function Df(e,t){var n,r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===t.code){const s=t;s.resolver=new Uf(e,(n=t,e=to(i=e),Al((i=n).operationType,e,"argument-error"),Al(null===(n=i.serverResponse)||void 0===n?void 0:n.mfaPendingCredential,e,"argument-error"),Sh._fromError(e,i)))}else if(r){var i=Mf(t);const o=t;i&&(o.credential=i,o.tenantId=r.tenantId||void 0,o.email=r.email||void 0,o.phoneNumber=r.phoneNumber||void 0)}}function Mf(e){var{_tokenResponse:t}=e instanceof Ss?e.customData:e;if(!t)return null;if(!(e instanceof Ss)&&"temporaryProof"in t&&"phoneNumber"in t)return ld.credentialFromResult(e);const n=t.providerId;if(!n||n===_l.PASSWORD)return null;let r;switch(n){case _l.GOOGLE:r=qu;break;case _l.FACEBOOK:r=ju;break;case _l.GITHUB:r=Vu;break;case _l.TWITTER:r=$u;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:a,nonce:c}=t;return s||o||i||a?a?n.startsWith("saml.")?Bu._create(n,a):Pu._fromParams({providerId:n,signInMethod:n,pendingToken:a,idToken:i,accessToken:s}):new Uu(n).credential({idToken:i,accessToken:s,rawNonce:c}):null}return e instanceof Ss?r.credentialFromError(e):r.credentialFromResult(e)}async function Lf(t,e){let n;try{n=await e}catch(e){throw e instanceof Ss&&Df(t,e),e}var{operationType:e,user:t}=n;return{operationType:e,credential:Mf(n),additionalUserInfo:Th(n),user:jf.getOrCreate(t)}}async function Ff(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>Lf(t,n.confirm(e))}}class Uf{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Lf(xf(this.auth),this.resolver.resolveSignIn(e))}}class jf{constructor(e){this._delegate=e,this.multiFactor=(e=to(e=e),Ch.has(e)||Ch.set(e,kh._fromUser(e)),Ch.get(e))}static getOrCreate(e){return jf.USER_MAP.has(e)||jf.USER_MAP.set(e,new jf(e)),jf.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Lf(this.auth,nh(this._delegate,e))}async linkWithPhoneNumber(e,t){return Ff(this.auth,async function(e,t,n){const r=to(e);return await Xu(!1,r,"phone"),n=await cd(r.auth,t,to(n)),new ad(n,e=>nh(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return Lf(this.auth,async function(e,t,n){e=to(e),Al(t instanceof Lu,e.auth,"argument-error"),n=ud(e.auth,n);const r=new yd(e.auth,"linkViaPopup",t,n,e);return r.executeNotNull()}(this._delegate,e,Of))}async linkWithRedirect(e){return await Rf(wu(this.auth)),kd(this._delegate,e,Of)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Lf(this.auth,rh(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Ff(this.auth,async function(e,t,n){const r=to(e);return n=await cd(r.auth,t,to(n)),new ad(n,e=>rh(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Lf(this.auth,async function(e,t,n){e=to(e),Al(t instanceof Lu,e.auth,"argument-error"),n=ud(e.auth,n);const r=new yd(e.auth,"reauthViaPopup",t,n,e);return r.executeNotNull()}(this._delegate,e,Of))}async reauthenticateWithRedirect(e){return await Rf(wu(this.auth)),Sd(this._delegate,e,Of)}sendEmailVerification(e){return fh(this._delegate,e)}async unlink(e){return await Yu(this._delegate,e),this}updateEmail(e){return mh(to(this._delegate),e,null)}updatePassword(e){return mh(to(this._delegate),null,e)}updatePhoneNumber(e){return async function(e,t){await Ju(to(e),t)}(this._delegate,e)}updateProfile(e){return gh(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return ph(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}jf.USER_MAP=new WeakMap;const qf=Al;class Vf{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();var{apiKey:n}=e.options;qf(n,"invalid-api-key",{appName:e.name});let r=[su];if("undefined"!=typeof window){r=function(e,t){const n=Nf();if(null===n||void 0===n||!n.sessionStorage)return[];switch(t=ou(Af,e,t),n.sessionStorage.getItem(t)){case kf.NONE:return[su];case kf.LOCAL:return[Qh,xh];case kf.SESSION:return[xh];default:return[]}}(n,e.name);for(const i of[Qh,Ph,xh])r.includes(i)||r.push(i)}qf(n,"invalid-api-key",{appName:e.name});e="undefined"!=typeof window?Of:void 0;this._delegate=t.initialize({options:{persistence:r,popupRedirectResolver:e}}),this._delegate._updateErrorMap(bl),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?jf.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){Iu(this._delegate,e,t)}applyActionCode(e){return lh(this._delegate,e)}checkActionCode(e){return uh(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await ku(to(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Lf(this._delegate,async function(e,t,n){const r=wu(e);return n=await zu(r,{returnSecureToken:!0,email:t,password:n}),n=await Wu._fromIdTokenResponse(r,"signIn",n),await r._updateCurrentUser(n.user),n}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return dh(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,e=e,"EMAIL_SIGNIN"===(null==(e=Du.parseLink(e))?void 0:e.operation)}async getRedirectResult(){qf(Ef(),this._delegate,"operation-not-supported-in-this-environment");var e,t,t=(e=this._delegate,t=Of,await wu(e)._initializationPromise,await Cd(e,t,!1));return t?Lf(this._delegate,Promise.resolve(t)):{credential:null,user:null}}addFrameworkForLogging(e){wu(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:e,error:t,complete:n}=Bf(e,t,n);return this._delegate.onAuthStateChanged(e,t,n)}onIdTokenChanged(e,t,n){var{next:e,error:t,complete:n}=Bf(e,t,n);return this._delegate.onIdTokenChanged(e,t,n)}sendSignInLinkToEmail(e,t){return hh(this._delegate,e,t)}sendPasswordResetEmail(e,t){return ch(this._delegate,e,t||void 0)}async setPersistence(e){var t,n;t=this._delegate,n=e,Cf(Object.values(kf).includes(n),t,"invalid-persistence-type"),ys()?Cf(n!==kf.SESSION,t,"unsupported-persistence-type"):gs()?Cf(n===kf.NONE,t,"unsupported-persistence-type"):Tf()?Cf(n===kf.NONE||n===kf.LOCAL&&ws(),t,"unsupported-persistence-type"):Cf(n===kf.NONE||If(),t,"unsupported-persistence-type");let r;switch(e){case kf.SESSION:r=xh;break;case kf.LOCAL:var i=await Ol(Qh)._isAvailable();r=i?Qh:Ph;break;case kf.NONE:r=su;break;default:return Sl("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Lf(this._delegate,async function(e){const t=wu(e);return await t._initializationPromise,null!==(e=t.currentUser)&&void 0!==e&&e.isAnonymous?new Wu({user:t.currentUser,providerId:null,operationType:"signIn"}):(e=await zu(t,{returnSecureToken:!0}),e=await Wu._fromIdTokenResponse(t,"signIn",e,!0),await t._updateCurrentUser(e.user),e)}(this._delegate))}signInWithCredential(e){return Lf(this._delegate,th(this._delegate,e))}signInWithCustomToken(e){return Lf(this._delegate,ih(this._delegate,e))}signInWithEmailAndPassword(e,t){return Lf(this._delegate,(n=this._delegate,e=e,t=t,th(to(n),Mu.credential(e,t))));var n}signInWithEmailLink(e,t){return Lf(this._delegate,async function(e,t,n){return e=to(e),Al((n=Mu.credentialWithLink(t,n||xl()))._tenantId===(e.tenantId||null),e,"tenant-id-mismatch"),th(e,n)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Ff(this._delegate,async function(e,t,n){const r=wu(e);return n=await cd(r,t,to(n)),new ad(n,e=>th(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return qf(Ef(),this._delegate,"operation-not-supported-in-this-environment"),Lf(this._delegate,async function(e,t,n){var r=wu(e);Al(t instanceof Lu,e,"argument-error"),n=ud(r,n);const i=new yd(r,"signInViaPopup",t,n);return i.executeNotNull()}(this._delegate,e,Of))}async signInWithRedirect(e){return qf(Ef(),this._delegate,"operation-not-supported-in-this-environment"),await Rf(this._delegate),Ed(this._delegate,e,Of)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){var{data:t}=await uh(to(e),t);return t.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Bf(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&jf.getOrCreate(e)),error:t,complete:n}}class $f{constructor(){this.providerId="phone",this._delegate=new ld(xf(Wo.auth()))}static credential(e,t){return ld.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}$f.PHONE_SIGN_IN_METHOD=ld.PHONE_SIGN_IN_METHOD,$f.PROVIDER_ID=ld.PROVIDER_ID;const zf=Al;class Wf{constructor(e,t,n=Wo.app()){var r;zf(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new od(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}(vf=Wo).INTERNAL.registerComponent(new no("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("auth");return new Vf(t,e)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:wl.EMAIL_SIGNIN,PASSWORD_RESET:wl.PASSWORD_RESET,RECOVER_EMAIL:wl.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:wl.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:wl.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:wl.VERIFY_EMAIL}},EmailAuthProvider:Mu,FacebookAuthProvider:ju,GithubAuthProvider:Vu,GoogleAuthProvider:qu,OAuthProvider:Uu,PhoneAuthProvider:$f,PhoneMultiFactorGenerator:tf,RecaptchaVerifier:Wf,TwitterAuthProvider:$u,Auth:{Persistence:kf},AuthCredential:Su}).setInstantiationMode("LAZY").setMultipleInstances(!1)),vf.registerVersion("@firebase/auth-compat","0.1.0-2021720181311");let Kf="";function Hf(e){Kf=e}class Gf{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ps(t))}get(e){e=this.domStorage_.getItem(this.prefixedName_(e));return null==e?null:Ns(e)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Qf{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return xs(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}var Yf,Jf,Xf,Zf,ep,tp,dr=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Gf(t)}}catch(e){}return new Qf};const np=dr("localStorage"),rp=dr("sessionStorage"),ip=new mo("@firebase/database"),sp=function(){let e=1;return function(){return e++}}(),op=function(e){e=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i,s=e.charCodeAt(r);55296<=s&&s<=56319&&(i=s-55296,is(++r<e.length,"Surrogate pair missing trail surrogate."),s=65536+(i<<10)+(e.charCodeAt(r)-56320)),s<128?t[n++]=s:(s<2048?t[n++]=s>>6|192:(s<65536?t[n++]=s>>12|224:(t[n++]=s>>18|240,t[n++]=s>>12&63|128),t[n++]=s>>6&63|128),t[n++]=63&s|128)}return t}(e);const t=new Bs;t.update(e);e=t.digest();return os.encodeByteArray(e)},ap=function(...t){let n="";for(let e=0;e<t.length;e++){var r=t[e];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?n+=ap.apply(null,r):n+="object"==typeof r?Ps(r):r,n+=" "}return n};let cp=null,lp=!0;const up=function(e,t){is(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(ip.logLevel=lo.VERBOSE,cp=ip.log.bind(ip),t&&rp.set("logging_enabled",!0)):"function"==typeof e?cp=e:(cp=null,rp.remove("logging_enabled"))},hp=function(...e){!0===lp&&(lp=!1,null===cp&&!0===rp.get("logging_enabled")&&up(!0)),cp&&(e=ap.apply(null,e),cp(e))},dp=function(t){return function(...e){hp(t,...e)}},fp=function(...e){e="FIREBASE INTERNAL ERROR: "+ap(...e);ip.error(e)},pp=function(...e){e=`FIREBASE FATAL ERROR: ${ap(...e)}`;throw ip.error(e),new Error(e)},gp=function(...e){e="FIREBASE WARNING: "+ap(...e);ip.warn(e)},mp=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},yp="[MIN_NAME]",vp="[MAX_NAME]",_p=function(e,t){if(e===t)return 0;if(e===yp||t===vp)return-1;if(t===yp||e===vp)return 1;var n=Rp(e),r=Rp(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1},wp=function(e,t){return e===t?0:e<t?-1:1},bp=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Ps(t))},Ip=function(t){if("object"!=typeof t||null===t)return Ps(t);const n=[];for(const e in t)n.push(e);n.sort();let r="{";for(let e=0;e<n.length;e++)0!==e&&(r+=","),r+=Ps(n[e]),r+=":",r+=Ip(t[n[e]]);return r+="}",r},Tp=function(t,n){var r=t.length;if(r<=n)return[t];const i=[];for(let e=0;e<r;e+=n)e+n>r?i.push(t.substring(e,r)):i.push(t.substring(e,e+n));return i};function Ep(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const Sp=function(e){is(!mp(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const o=[];for(s=52;s;--s)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();const a=o.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()};const kp=new RegExp("^-?(0*)\\d{1,10}$"),Cp=-2147483648,Ap=2147483647,Rp=function(e){if(kp.test(e)){e=Number(e);if(e>=Cp&&e<=Ap)return e}return null},Np=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw gp("Exception was thrown by user callback.",e),t},Math.floor(0))}},Pp=function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)},Op=function(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n};class xp{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!==(e=this.appCheckProvider)&&void 0!==e&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){gp(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class Dp{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(hp("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',gp(e)}}class Mp{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Mp.OWNER="owner";const Lp=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Fp="websocket",Up="long_polling";class jp{constructor(e,t,n,r,i=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=np.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&np.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function qp(e,t,n){is("string"==typeof t,"typeof type must == string"),is("object"==typeof n,"typeof params must == object");let r;if(t===Fp)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Up)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return Ep(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Vp{constructor(){this.counters_={}}incrementCounter(e,t=1){xs(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return ls(void 0,this.counters_)}}const Bp={},$p={};function zp(e){e=e.toString();return Bp[e]||(Bp[e]=new Vp),Bp[e]}class Wp{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&Np(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Kp{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=dp(e),this.stats_=zp(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),qp(t,Up,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Wp(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(!this.isClosed_){this.scriptTagHolder=new Hp((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Lp.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Kp.forceAllow_=!0}static forceDisallow(){Kp.forceDisallow_=!0}static isAvailable(){return!!Kp.forceAllow_||!(Kp.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){e=Ps(e);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var e=ts(e),t=Tp(e,1840);for(let e=0;e<t.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,t.length,t[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){e=Ps(e).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Hp{constructor(t,n,e,r){this.onDisconnect=e,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=sp(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=Hp.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){hp("frame writing exception"),e.stack&&hp(e.stack),hp(e)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||hp("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+e.length<=1870))break;var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{hp("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let Gp=null;"undefined"!=typeof MozWebSocket?Gp=MozWebSocket:"undefined"!=typeof WebSocket&&(Gp=WebSocket);class Qp{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=dp(this.connId),this.stats_=zp(t),this.connURL=Qp.connectionURL_(t,s,o,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r){const i={v:"5"};return"undefined"!=typeof location&&location.hostname&&Lp.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),qp(e,Fp,i)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,np.set("previous_websocket_failure",!0);try{_s()||(n={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}},this.mySock=new Gp(this.connURL,[],n))}catch(e){this.log_("Error instantiating WebSocket.");var n=e.message||e.data;return n&&this.log_(n),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");e=e.message||e.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){Qp.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return"undefined"==typeof navigator||!navigator.userAgent||(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4&&(e=!0),!e&&null!==Gp&&!Qp.forceDisallow_}static previouslyFailed(){return np.isInMemoryStorage||!0===np.get("previous_websocket_failure")}markConnectionHealthy(){np.remove("previous_websocket_failure")}appendFrame_(e){this.frames.push(e),this.frames.length===this.totalFrames&&(e=this.frames.join(""),this.frames=null,e=Ns(e),this.onMessage(e))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(is(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){null!==this.mySock&&(e=e.data,this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(e):null!==(e=this.extractFrameCount_(e))&&this.appendFrame_(e))}send(e){this.resetKeepAlive();e=Ps(e);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var t=Tp(e,16384);1<t.length&&this.sendString_(String(t.length));for(let e=0;e<t.length;e++)this.sendString_(t[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Qp.responsesRequiredToBeHealthy=2,Qp.healthyTimeout=3e4;class Yp{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Kp,Qp]}initTransports_(e){var t=Qp&&Qp.isAvailable();let n=t&&!Qp.previouslyFailed();if(e.webSocketOnly&&(t||gp("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Qp];else{const r=this.transports_=[];for(const i of Yp.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i)}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}class Jp{constructor(e,t,n,r,i,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=dp("c:"+this.id+":"),this.transportManager_=new Yp(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=Op(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){"t"in e&&("a"===(e=e.t)?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=bp("t",e),e=bp("d",e);if("c"===t)this.onSecondaryControl_(e);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(e)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=bp("t",e),e=bp("d",e);"c"===t?this.onControl_(e):"d"===t&&this.onDataMessage_(e)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=bp("t",e);if("d"in e){e=e.d;if("h"===t)this.onHandshake_(e);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(e):"r"===t?this.onReset_(e):"e"===t?fp("Server Error: "+e):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):fp("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&gp("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),e=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,e),Op(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Op(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(np.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Xp{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Zp{constructor(e){this.allowedEvents_=e,this.listeners_={},is(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});e=this.getInitialEvent(e);e&&t.apply(n,e)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(t){is(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class eg extends Zp{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||ps()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new eg}getInitialEvent(e){return is("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const tg=32,ng=768;class rg{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)0<this.pieces_[e].length&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function ig(){return new rg("")}function sg(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function og(e){return e.pieces_.length-e.pieceNum_}function ag(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new rg(e.pieces_,t)}function cg(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function lg(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function ug(t){if(t.pieceNum_>=t.pieces_.length)return null;const n=[];for(let e=t.pieceNum_;e<t.pieces_.length-1;e++)n.push(t.pieces_[e]);return new rg(n,0)}function hg(t,n){const r=[];for(let e=t.pieceNum_;e<t.pieces_.length;e++)r.push(t.pieces_[e]);if(n instanceof rg)for(let e=n.pieceNum_;e<n.pieces_.length;e++)r.push(n.pieces_[e]);else{var i=n.split("/");for(let e=0;e<i.length;e++)0<i[e].length&&r.push(i[e])}return new rg(r,0)}function dg(e){return e.pieceNum_>=e.pieces_.length}function fg(e,t){var n=sg(e),r=sg(t);if(null===n)return t;if(n===r)return fg(ag(e),ag(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function pg(e,t){var n=lg(e,0),r=lg(t,0);for(let e=0;e<n.length&&e<r.length;e++){var i=_p(n[e],r[e]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function gg(n,r){if(og(n)!==og(r))return!1;for(let e=n.pieceNum_,t=r.pieceNum_;e<=n.pieces_.length;e++,t++)if(n.pieces_[e]!==r.pieces_[t])return!1;return!0}function mg(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(og(e)>og(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class yg{constructor(e,t){this.errorPrefix_=t,this.parts_=lg(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=Qs(this.parts_[e]);vg(this)}}function vg(e){if(e.byteLength_>ng)throw new Error(e.errorPrefix_+"has a key path longer than "+ng+" bytes ("+e.byteLength_+").");if(e.parts_.length>tg)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+tg+") or object contains a cycle "+_g(e))}function _g(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class wg extends Zp{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new wg}getInitialEvent(e){return is("visible"===e,"Unknown event type: "+e),[this.visible_]}}class bg extends Xp{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=bg.nextPersistentConnectionId_++,this.log_=dp("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!_s())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");wg.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&eg.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,t={r:r,a:e,b:t};this.log_(Ps(t)),is(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(t),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new us,r={p:e._path.toString(),q:e._queryObject},t={action:"g",request:r,onComplete:e=>{var t=e.d;"ok"===e.s?(this.onDataUpdate_(r.p,t,!1,null),n.resolve(t)):n.reject(t)}};this.outstandingGets_.push(t),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{var e=this.outstandingGets_[i];void 0!==e&&t===e&&(delete this.outstandingGets_[i],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+i+" timed out on connection"),n.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(i),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),is(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),is(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");n={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,n),this.connected_&&this.sendListen_(n)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),o=i._queryIdentifier;this.log_("Listen on "+s+" for "+o);const e={p:s};r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;bg.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(o))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,o),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&xs(e,"w")){const n=Ds(e,"w");Array.isArray(n)&&~n.indexOf("no_index")&&(e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',t=t._path.toString(),gp("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${e} at `+`${t} to your security rules for better performance.`))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){e=Os(e).claims;return"object"==typeof e&&!0===e.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const n=this.authToken_;var e=function(e){e=Os(e).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(n)?"auth":"gauth";const t={cred:n};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,e=e.d||"error";this.authToken_===n&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,e))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,e=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,e)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),is(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){n={p:t,d:n};this.log_("onDisconnect "+e,n),this.sendRequest(e,n,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;r=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(r):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){this.connected_&&(this.log_("reportStats",e={c:e}),this.sendRequest("s",e,e=>{"ok"!==e.s&&(e=e.d,this.log_("reportStats","Error sending stats: "+e))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ps(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):fp("Unrecognized action received from server: "+Ps(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){is(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const u=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+bg.nextConnectionId_++,s=this.lastSessionId;let t=!1,n=null;var o=function(){n?n.close():(t=!0,u())};this.realtime_={close:o,sendRequest:function(e){is(n,"sendRequest call when we're not connected not allowed."),n.sendRequest(e)}};var a=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{var[c,l]=await Promise.all([this.authTokenProvider_.getToken(a),this.appCheckTokenProvider_.getToken(a)]);t?hp("getToken() completed but was canceled"):(hp("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=l&&l.token,n=new Jp(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,u,e=>{gp(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),t||(this.repoInfo_.nodeAdmin&&gp(e),o())}}}interrupt(e){hp("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){hp("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ms(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){e-=(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>Ip(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){e=new rg(e).toString();let n;if(this.listens.has(e)){const r=this.listens.get(e);n=r.get(t),r.delete(t),0===r.size&&this.listens.delete(e)}else n=void 0;return n}onAuthRevoked_(e,t){hp("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){hp("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+Kf.replace(/\./g,"-")]=1,ps()?e["framework.cordova"]=1:ys()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=eg.getInstance().currentlyOnline();return Ms(this.interruptReasons_)&&e}}bg.nextPersistentConnectionId_=0,bg.nextConnectionId_=0;class Ig{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ig(e,t)}}class Tg{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){e=new Ig(yp,e),t=new Ig(yp,t);return 0!==this.compare(e,t)}minPost(){return Ig.MIN}}let Eg;class Sg extends Tg{static get __EMPTY_NODE(){return Eg}static set __EMPTY_NODE(e){Eg=e}compare(e,t){return _p(e.name,t.name)}isDefinedOn(e){throw ss("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ig.MIN}maxPost(){return new Ig(vp,Eg)}makePost(e,t){return is("string"==typeof e,"KeyIndex indexValue must always be a string."),new Ig(e,Eg)}toString(){return".key"}}const kg=new Sg;class Cg{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Ag{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Ag.RED,this.left=null!=r?r:Rg.EMPTY_NODE,this.right=null!=i?i:Rg.EMPTY_NODE}copy(e,t,n,r,i){return new Ag(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Rg.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Rg.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){var e=this.copy(null,null,Ag.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,Ag.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Ag.RED=!0,Ag.BLACK=!1;class Rg{constructor(e,t=Rg.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Rg(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ag.BLACK,null,null))}remove(e){return new Rg(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ag.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Cg(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Cg(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Cg(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Cg(this.root_,null,this.comparator_,!0,e)}}function Ng(e,t){return _p(e.name,t.name)}function Pg(e,t){return _p(e,t)}Rg.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new Ag(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let Og;const xg=function(e){return"number"==typeof e?"number:"+Sp(e):"string:"+e},Dg=function(e){var t;e.isLeafNode()?(t=e.val(),is("string"==typeof t||"number"==typeof t||"object"==typeof t&&xs(t,".sv"),"Priority must be a string or number.")):is(e===Og||e.isEmpty(),"priority of unexpected type."),is(e===Og||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Mg;class Lg{constructor(e,t=Lg.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,is(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Dg(this.priorityNode_)}static set __childrenNodeConstructor(e){Mg=e}static get __childrenNodeConstructor(){return Mg}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Lg(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Lg.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return dg(e)?this:".priority"===sg(e)?this.priorityNode_:Lg.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Lg.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=sg(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(is(".priority"!==n||1===og(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Lg.__childrenNodeConstructor.EMPTY_NODE.updateChild(ag(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+xg(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"==t?Sp(this.value_):this.value_,this.lazyHash_=op(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Lg.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Lg.__childrenNodeConstructor?-1:(is(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=Lg.VALUE_TYPE_ORDER.indexOf(t),i=Lg.VALUE_TYPE_ORDER.indexOf(n);return is(0<=r,"Unknown leaf type: "+t),is(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}Lg.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Fg,Ug;const jg=new class extends Tg{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority(),r=n.compareTo(r);return 0===r?_p(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ig.MIN}maxPost(){return new Ig(vp,new Lg("[PRIORITY-POST]",Ug))}makePost(e,t){e=Fg(e);return new Ig(t,new Lg("[PRIORITY-POST]",e))}toString(){return".priority"}},qg=Math.log(2);class Vg{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/qg,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Bg=function(l,e,u,t){l.sort(e);const h=function(e,t){var n=t-e;let r,i;if(0==n)return null;if(1==n)return r=l[e],i=u?u(r):r,new Ag(i,r.node,Ag.BLACK,null,null);n=parseInt(n/2,10)+e,e=h(e,n),t=h(n+1,t);return r=l[n],i=u?u(r):r,new Ag(i,r.node,Ag.BLACK,e,t)};var n=function(t){let n=null,r=null,i=l.length;function s(e,t){var n=i-e,r=i;i-=e,e=h(1+n,r),r=l[n],n=u?u(r):r,o(new Ag(n,r.node,t,null,e))}const o=function(e){n=(n?n.left=e:r=e,e)};for(let e=0;e<t.count;++e){var a=t.nextBitIsOne(),c=Math.pow(2,t.count-(e+1));a?s(c,Ag.BLACK):(s(c,Ag.BLACK),s(c,Ag.RED))}return r}(new Vg(l.length));return new Rg(t||e,n)};let $g;const zg={};class Wg{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return is((zg,jg),"ChildrenNode.ts has not been loaded"),$g=$g||new Wg({".priority":zg},{".priority":jg}),$g}get(e){var t=Ds(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Rg?t:null}hasIndex(e){return xs(this.indexSet_,e.toString())}addIndex(e,t){is(e!==kg,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(Ig.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();let o;o=r?Bg(n,e.getCompare()):zg;t=e.toString();const a=Object.assign({},this.indexSet_);a[t]=e;const c=Object.assign({},this.indexes_);return c[t]=o,new Wg(c,a)}addToIndexes(o,a){var e=Ls(this.indexes_,(t,n)=>{const r=Ds(this.indexSet_,n);if(is(r,"Missing index implementation for "+n),t===zg){if(r.isDefinedOn(o.node)){const i=[],s=a.getIterator(Ig.Wrap);let e=s.getNext();for(;e;)e.name!==o.name&&i.push(e),e=s.getNext();return i.push(o),Bg(i,r.getCompare())}return zg}{n=a.get(o.name);let e=t;return n&&(e=e.remove(new Ig(o.name,n))),e.insert(o,o.node)}});return new Wg(e,this.indexSet_)}removeFromIndexes(n,r){var e=Ls(this.indexes_,e=>{if(e===zg)return e;var t=r.get(n.name);return t?e.remove(new Ig(n.name,t)):e});return new Wg(e,this.indexSet_)}}let Kg;class Hg{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Dg(this.priorityNode_),this.children_.isEmpty()&&is(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Kg=Kg||new Hg(new Rg(Pg),null,Wg.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Kg}updatePriority(e){return this.children_.isEmpty()?this:new Hg(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();e=this.children_.get(e);return null===e?Kg:e}getChild(e){var t=sg(e);return null===t?this:this.getImmediateChild(t).getChild(ag(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(is(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new Ig(n,r);let e,t;t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_));i=e.isEmpty()?Kg:this.priorityNode_;return new Hg(e,i,t)}}updateChild(e,t){var n=sg(e);if(null===n)return t;is(".priority"!==sg(e)||1===og(e),".priority must be the last token in a path");t=this.getImmediateChild(n).updateChild(ag(e),t);return this.updateImmediateChild(n,t)}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,o=!0;if(this.forEachChild(jg,(e,t)=>{r[e]=t.val(n),i++,o&&Hg.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):o=!1}),!n&&o&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let n="";this.getPriority().isEmpty()||(n+="priority:"+xg(this.getPriority().val())+":"),this.forEachChild(jg,(e,t)=>{t=t.hash();""!==t&&(n+=":"+e+":"+t)}),this.lazyHash_=""===n?"":op(n)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){t=r.getPredecessorKey(new Ig(e,t));return t?t.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){e=this.getFirstChildName(e);return e?new Ig(e,this.children_.get(e)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){e=this.getLastChildName(e);return e?new Ig(e,this.children_.get(e)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,Ig.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,Ig.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Qg?-1:0}withIndex(e){if(e===kg||this.indexMap_.hasIndex(e))return this;e=this.indexMap_.addIndex(e,this.children_);return new Hg(this.children_,this.priorityNode_,e)}isIndexed(e){return e===kg||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator(jg),i=n.getIterator(jg);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===kg?null:this.indexMap_.get(e.toString())}}Hg.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Gg extends Hg{constructor(){super(new Rg(Pg),Hg.EMPTY_NODE,Wg.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Hg.EMPTY_NODE}isEmpty(){return!1}}const Qg=new Gg;Object.defineProperties(Ig,{MIN:{value:new Ig(yp,Hg.EMPTY_NODE)},MAX:{value:new Ig(vp,Qg)}}),Sg.__EMPTY_NODE=Hg.EMPTY_NODE,Lg.__childrenNodeConstructor=Hg,Yf=Qg,Og=Yf,Jf=Qg,Ug=Jf;const Yg=!0;function Jg(i,e=null){if(null===i)return Hg.EMPTY_NODE;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),is(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i){var t=i;return new Lg(t,Jg(e))}if(i instanceof Array||!Yg){let r=Hg.EMPTY_NODE;return Ep(i,(e,t)=>{if(xs(i,e)&&"."!==e.substring(0,1)){const n=Jg(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority(Jg(e))}{const s=[];let r=!1;if(Ep(i,(e,t)=>{if("."!==e.substring(0,1)){const n=Jg(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new Ig(e,n)))}}),0===s.length)return Hg.EMPTY_NODE;var n=Bg(s,Ng,e=>e.name,Pg);if(r){t=Bg(s,jg.getCompare());return new Hg(n,Jg(e),new Wg({".priority":t},{".priority":jg}))}return new Hg(n,Jg(e),Wg.Default)}}Fg=Jg;class Xg extends Tg{constructor(e){super(),this.indexPath_=e,is(!dg(e)&&".priority"!==sg(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node),r=n.compareTo(r);return 0===r?_p(e.name,t.name):r}makePost(e,t){e=Jg(e),e=Hg.EMPTY_NODE.updateChild(this.indexPath_,e);return new Ig(t,e)}maxPost(){var e=Hg.EMPTY_NODE.updateChild(this.indexPath_,Qg);return new Ig(vp,e)}toString(){return lg(this.indexPath_,0).join("/")}}const Zg=new class extends Tg{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?_p(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ig.MIN}maxPost(){return Ig.MAX}makePost(e,t){e=Jg(e);return new Ig(t,e)}toString(){return".value"}},em="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",tm=function(){let s=0;const o=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=em.charAt(e%64),e=Math.floor(e/64);is(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===o[n];n--)o[n]=0;o[n]++}else for(n=0;n<12;n++)o[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=em.charAt(o[n]);return is(20===i.length,"nextPushId: Length should be 20."),i}}(),nm=function(t){if(t===""+Ap)return"-";var e=Rp(t);if(null!=e)return""+(e+1);const n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t.charAt(e);if(n.length<786)return n.push("-"),n.join("");let r=n.length-1;for(;0<=r&&"z"===n[r];)r--;if(-1===r)return vp;e=n[r],e=em.charAt(em.indexOf(e)+1);return n[r]=e,n.slice(0,r+1).join("")},rm=function(t){if(t===""+Cp)return yp;var e=Rp(t);if(null!=e)return""+(e-1);const n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t.charAt(e);return"-"===n[n.length-1]?1===n.length?""+Ap:(delete n[n.length-1],n.join("")):(n[n.length-1]=em.charAt(em.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))};function im(e){return{type:"value",snapshotNode:e}}function sm(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function om(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function am(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class cm{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){is(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(om(t,o)):is(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(sm(t,n)):s.trackChildChange(am(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(jg,(e,t)=>{n.hasChild(e)||i.trackChildChange(om(e,t))}),n.isLeafNode()||n.forEachChild(jg,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange(am(e,t,n))}else i.trackChildChange(sm(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Hg.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class lm{constructor(e){this.indexedFilter_=new cm(e.getIndex()),this.index_=e.getIndex(),this.startPost_=lm.getStartPost_(e),this.endPost_=lm.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,n,r,i,s){return this.matches(new Ig(t,n))||(n=Hg.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?Hg.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(Hg.EMPTY_NODE);const i=this;return t.forEachChild(jg,(e,t)=>{i.matches(new Ig(e,t))||(r=r.updateImmediateChild(e,Hg.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class um{constructor(e){this.rangedFilter_=new lm(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new Ig(t,n))||(n=Hg.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,o,t){let a;if(o.isLeafNode()||o.isEmpty())a=Hg.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<o.numChildren()&&o.isIndexed(this.index_)){a=Hg.EMPTY_NODE.withIndex(this.index_);let t;t=this.reverse_?o.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;t.hasNext()&&n<this.limit_;){var r=t.getNext();let e;if(e=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),r)<=0:this.index_.compare(r,this.rangedFilter_.getEndPost())<=0,!e)break;a=a.updateImmediateChild(r.name,r.node),n++}}else{a=o.withIndex(this.index_),a=a.updatePriority(Hg.EMPTY_NODE);let e,t,n,r;if(this.reverse_){r=a.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),t=this.rangedFilter_.getStartPost();const l=this.index_.getCompare();n=(e,t)=>l(t,e)}else r=a.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),t=this.rangedFilter_.getEndPost(),n=this.index_.getCompare();let i=0,s=!1;for(;r.hasNext();){var c=r.getNext();!s&&n(e,c)<=0&&(s=!0),s&&i<this.limit_&&n(c,t)<=0?i++:a=a.updateImmediateChild(c.name,Hg.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,a,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const o=e;is(o.numChildren()===this.limit_,"");var a=new Ig(t,n),c=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),l=this.rangedFilter_.matches(a);if(o.hasChild(t)){var u=o.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=e&&(e.name===t||o.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var h=null==e?1:s(e,a);if(l&&!n.isEmpty()&&0<=h)return null!=i&&i.trackChildChange(am(t,n,u)),o.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(om(t,u));const f=o.updateImmediateChild(t,Hg.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(sm(e.name,e.node)),f.updateImmediateChild(e.name,e.node)):f}}return!n.isEmpty()&&l&&0<=s(c,a)?(null!=i&&(i.trackChildChange(om(c.name,c.node)),i.trackChildChange(sm(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(c.name,Hg.EMPTY_NODE)):e}}class hm{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=jg}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return is(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return is(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:yp}hasEnd(){return this.endSet_}getIndexEndValue(){return is(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return is(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:vp}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return is(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===jg}copy(){const e=new hm;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function dm(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function fm(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function pm(e,t){const n=e.copy();return n.index_=t,n}function gm(e){const t={};if(e.isDefault())return t;let n;return n=e.index_===jg?"$priority":e.index_===Zg?"$value":e.index_===kg?"$key":(is(e.index_ instanceof Xg,"Unrecognized index type!"),e.index_.toString()),t.orderBy=Ps(n),e.startSet_&&(t.startAt=Ps(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+Ps(e.indexStartName_))),e.endSet_&&(t.endAt=Ps(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+Ps(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function mm(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_)),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_)),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==jg&&(n.i=t.index_.toString()),n}class ym extends Xp{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=dp("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(is(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=ym.getListenId_(e,r),a={};this.listens_[o]=a;e=gm(e._queryParams);this.restRequest_(s+".json",e,(t,e)=>{let n=e;if(null===(t=404===t?n=null:t)&&this.onDataUpdate_(s,n,!1,r),Ds(this.listens_,o)===a){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(e,t){t=ym.getListenId_(e,t);delete this.listens_[t]}get(e){var t=gm(e._queryParams);const r=e._path.toString(),i=new us;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},o){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+js(s);this.log_("Sending REST request for "+n);const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(o&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=Ns(r.responseText)}catch(e){gp("Failed to parse JSON response for "+n+": "+r.responseText)}o(null,e)}else 401!==r.status&&404!==r.status&&gp("Got unsuccessful REST response for "+n+" Status: "+r.status),o(r.status);o=null}},r.open("GET",n,!0),r.send()})}}class vm{constructor(){this.rootNode_=Hg.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function _m(){return{value:null,children:new Map}}function wm(e,t,n){var r;dg(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=sg(t),e.children.has(r)||e.children.set(r,_m()),wm(e.children.get(r),t=ag(t),n))}function bm(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{bm(t,new rg(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class Im{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&Ep(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class Tm{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Im(e);e=1e4+2e4*Math.random();Op(this.reportStats_.bind(this),Math.floor(e))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;Ep(e,(e,t)=>{0<t&&xs(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),Op(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function Em(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Sm(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function km(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(G=Xf=Xf||{})[G.OVERWRITE=0]="OVERWRITE",G[G.MERGE=1]="MERGE",G[G.ACK_USER_WRITE=2]="ACK_USER_WRITE",G[G.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class Cm{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Xf.ACK_USER_WRITE,this.source=Em()}operationForChild(e){if(dg(this.path)){if(null!=this.affectedTree.value)return is(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new rg(e));return new Cm(ig(),t,this.revert)}return is(sg(this.path)===e,"operationForChild called for unrelated child."),new Cm(ag(this.path),this.affectedTree,this.revert)}}class Am{constructor(e,t){this.source=e,this.path=t,this.type=Xf.LISTEN_COMPLETE}operationForChild(e){return dg(this.path)?new Am(this.source,ig()):new Am(this.source,ag(this.path))}}class Rm{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Xf.OVERWRITE}operationForChild(e){return dg(this.path)?new Rm(this.source,ig(),this.snap.getImmediateChild(e)):new Rm(this.source,ag(this.path),this.snap)}}class Nm{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Xf.MERGE}operationForChild(e){if(dg(this.path)){const t=this.children.subtree(new rg(e));return t.isEmpty()?null:t.value?new Rm(this.source,ig(),t.value):new Nm(this.source,ig(),t)}return is(sg(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Nm(this.source,ag(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Pm{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(dg(e))return this.isFullyInitialized()&&!this.filtered_;e=sg(e);return this.isCompleteForChild(e)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Om{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function xm(n,e,t,r){var i=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),Dm(n,i,"child_removed",e,r,t),Dm(n,i,"child_added",e,r,t),Dm(n,i,"child_moved",s,r,t),Dm(n,i,"child_changed",e,r,t),Dm(n,i,"value",e,r,t),i}function Dm(s,o,t,e,a,c){const n=e.filter(e=>e.type===t);n.sort((e,t)=>function(e,t,n){if(null==t.childName||null==n.childName)throw ss("Should only compare child_ events.");t=new Ig(t.childName,t.snapshotNode),n=new Ig(n.childName,n.snapshotNode);return e.index_.compare(t,n)}(s,e,t)),n.forEach(t=>{const n=(e=s,i=c,"value"===(r=t).type||"child_removed"===r.type||(r.prevName=i.getPredecessorChildName(r.childName,r.snapshotNode,e.index_)),r);var e,r,i;a.forEach(e=>{e.respondsTo(t.type)&&o.push(e.createEvent(n,s.query_))})})}function Mm(e,t){return{eventCache:e,serverCache:t}}function Lm(e,t,n,r){return Mm(new Pm(t,n,r),e.serverCache)}function Fm(e,t,n,r){return Mm(e.eventCache,new Pm(t,n,r))}function Um(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function jm(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let qm;class Vm{constructor(e,t=(qm=qm||new Rg(wp),qm)){this.value=e,this.children=t}static fromObject(e){let n=new Vm(null);return Ep(e,(e,t)=>{n=n.set(new rg(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:ig(),value:this.value};if(dg(e))return null;{var n=sg(e);const r=this.children.get(n);if(null===r)return null;t=r.findRootMostMatchingPathAndValue(ag(e),t);return null==t?null:{path:hg(new rg(n),t.path),value:t.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(dg(e))return this;{var t=sg(e);const n=this.children.get(t);return null!==n?n.subtree(ag(e)):new Vm(null)}}set(e,t){if(dg(e))return new Vm(t,this.children);{var n=sg(e);const r=this.children.get(n)||new Vm(null);t=r.set(ag(e),t),t=this.children.insert(n,t);return new Vm(this.value,t)}}remove(t){if(dg(t))return this.children.isEmpty()?new Vm(null):new Vm(null,this.children);{var n=sg(t);const r=this.children.get(n);if(r){const i=r.remove(ag(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new Vm(null):new Vm(this.value,e)}return this}}get(e){if(dg(e))return this.value;{var t=sg(e);const n=this.children.get(t);return n?n.get(ag(e)):null}}setTree(t,n){if(dg(t))return n;{var r=sg(t);const i=this.children.get(r)||new Vm(null),s=i.setTree(ag(t),n);let e;return e=s.isEmpty()?this.children.remove(r):this.children.insert(r,s),new Vm(this.value,e)}}fold(e){return this.fold_(ig(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(hg(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,ig(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(dg(e))return null;{r=sg(e);const i=this.children.get(r);return i?i.findOnPath_(ag(e),hg(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ig(),t)}foreachOnPath_(e,t,n){if(dg(e))return this;{this.value&&n(t,this.value);var r=sg(e);const i=this.children.get(r);return i?i.foreachOnPath_(ag(e),hg(t,r),n):new Vm(null)}}foreach(e){this.foreach_(ig(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(hg(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class Bm{constructor(e){this.writeTree_=e}static empty(){return new Bm(new Vm(null))}}function $m(t,n,r){if(dg(n))return new Bm(new Vm(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null!=i){var s=i.path;let e=i.value;i=fg(s,n);return e=e.updateChild(i,r),new Bm(t.writeTree_.set(s,e))}r=new Vm(r),r=t.writeTree_.setTree(n,r);return new Bm(r)}function zm(e,n,t){let r=e;return Ep(t,(e,t)=>{r=$m(r,hg(n,e),t)}),r}function Wm(e,t){if(dg(t))return Bm.empty();t=e.writeTree_.setTree(t,new Vm(null));return new Bm(t)}function Km(e,t){return null!=Hm(e,t)}function Hm(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(fg(n.path,t)):null}function Gm(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(jg,(e,t)=>{n.push(new Ig(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new Ig(e,t.value))}),n}function Qm(e,t){if(dg(t))return e;var n=Hm(e,t);return null!=n?new Bm(new Vm(n)):new Bm(e.writeTree_.subtree(t))}function Ym(e){return e.writeTree_.isEmpty()}function Jm(e,t){return function r(i,e,s){{if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(is(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(hg(i,e),t,s)}),s=!s.getChild(i).isEmpty()&&null!==n?s.updateChild(hg(i,".priority"),n):s}}}(ig(),e.writeTree_,t)}function Xm(e,t){return uy(t,e)}function Zm(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);is(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,o=!1,a=t.allWrites.length-1;for(;s&&0<=a;){var c=t.allWrites[a];c.visible&&(a>=r&&function(e,t){{if(e.snap)return mg(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&mg(hg(e.path,n),t))return!0;return!1}}(c,i.path)?s=!1:mg(i.path,c.path)&&(o=!0)),a--}return!!s&&(o?((e=t).visibleWrites=ty(e.allWrites,ey,ig()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=Wm(t.visibleWrites,i.path):Ep(i.children,e=>{t.visibleWrites=Wm(t.visibleWrites,hg(i.path,e))}),!0)}function ey(e){return e.visible}function ty(t,n,r){let i=Bm.empty();for(let e=0;e<t.length;++e){const o=t[e];if(n(o)){var s=o.path;let e;if(o.snap)mg(r,s)?(e=fg(r,s),i=$m(i,e,o.snap)):mg(s,r)&&(e=fg(s,r),i=$m(i,ig(),o.snap.getChild(e)));else{if(!o.children)throw ss("WriteRecord should have .snap or .children");if(mg(r,s))e=fg(r,s),i=zm(i,e,o.children);else if(mg(s,r))if(e=fg(s,r),dg(e))i=zm(i,ig(),o.children);else{const a=Ds(o.children,sg(e));a&&(s=a.getChild(ag(e)),i=$m(i,ig(),s))}}}}return i}function ny(e,t,n,r,i){if(r||i){var s=Qm(e.visibleWrites,t);if(!i&&Ym(s))return n;if(i||null!=n||Km(s,ig()))return Jm(ty(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(mg(e.path,t)||mg(t,e.path))},t),n||Hg.EMPTY_NODE);return null}s=Hm(e.visibleWrites,t);if(null!=s)return s;e=Qm(e.visibleWrites,t);return Ym(e)?n:null!=n||Km(e,ig())?Jm(e,n||Hg.EMPTY_NODE):null}function ry(e,t,n,r){return ny(e.writeTree,e.treePath,t,n,r)}function iy(e,t){return function(e,t,n){let r=Hg.EMPTY_NODE;const i=Hm(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(jg,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const s=Qm(e.visibleWrites,t);return n.forEachChild(jg,(e,t)=>{t=Jm(Qm(s,new rg(e)),t);r=r.updateImmediateChild(e,t)}),Gm(s).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return Gm(Qm(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function sy(e,t,n,r){return i=e.writeTree,e=e.treePath,t=t,r=r,is(n||r,"Either existingEventSnap or existingServerSnap must exist"),e=hg(e,t),Km(i.visibleWrites,e)?null:Ym(e=Qm(i.visibleWrites,e))?r.getChild(t):Jm(e,r.getChild(t));var i}function oy(e,t){return n=e.writeTree,t=hg(e.treePath,t),Hm(n.visibleWrites,t);var n}function ay(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;if(e=Qm(e.visibleWrites,t),null!=(t=Hm(e,ig())))a=t;else{if(null==n)return[];a=Jm(e,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const c=[],l=o.getCompare(),u=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let e=u.getNext();for(;e&&c.length<i;)0!==l(e,r)&&c.push(e),e=u.getNext();return c}}(e.writeTree,e.treePath,t,n,r,i,s)}function cy(e,t,n){return r=e.writeTree,i=e.treePath,e=n,t=hg(i,n=t),null!=(i=Hm(r.visibleWrites,t))?i:e.isCompleteForChild(n)?Jm(Qm(r.visibleWrites,t),e.getNode().getImmediateChild(n)):null;var r,i}function ly(e,t){return uy(hg(e.treePath,t),e.writeTree)}function uy(e,t){return{treePath:e,writeTree:t}}class hy{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName;is("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),is(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,am(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,om(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,sm(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw ss("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,am(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const dy=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class fy{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new Pm(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return cy(this.writes_,e,n)}getChildAfterChild(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:jm(this.viewCache_),e=ay(this.writes_,r,t,1,n,e);return 0===e.length?null:e[0]}}function py(e,t,n,r,i){const s=new hy;let o,a;if(n.type===Xf.OVERWRITE){var c=n;o=c.source.fromUser?yy(e,t,c.path,c.snap,r,i,s):(is(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!dg(c.path),my(e,t,c.path,c.snap,r,i,a,s))}else if(n.type===Xf.MERGE){var l=n;o=l.source.fromUser?function(n,r,i,e,s,o,a){let c=r;return e.foreach((e,t)=>{e=hg(i,e);vy(r,sg(e))&&(c=yy(n,c,e,t,s,o,a))}),e.foreach((e,t)=>{e=hg(i,e);vy(r,sg(e))||(c=yy(n,c,e,t,s,o,a))}),c}(e,t,l.path,l.children,r,i,s):(is(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),wy(e,t,l.path,l.children,r,i,a,s))}else if(n.type===Xf.ACK_USER_WRITE){l=n;o=l.revert?function(n,r,i,s,o,a){let c;{if(null!=oy(s,i))return r;{o=new fy(s,r,o);const u=r.eventCache.getNode();let t;if(dg(i)||".priority"===sg(i)){let e;e=r.serverCache.isFullyInitialized()?ry(s,jm(r)):(l=r.serverCache.getNode(),is(l instanceof Hg,"serverChildren would be complete if leaf node"),iy(s,l)),e,t=n.filter.updateFullNode(u,e,a)}else{var l=sg(i);let e=cy(s,l,r.serverCache);null==e&&r.serverCache.isCompleteForChild(l)&&(e=u.getImmediateChild(l)),t=null!=e?n.filter.updateChild(u,l,e,ag(i),o,a):r.eventCache.getNode().hasChild(l)?n.filter.updateChild(u,l,Hg.EMPTY_NODE,ag(i),o,a):u,t.isEmpty()&&r.serverCache.isFullyInitialized()&&(c=ry(s,jm(r)),c.isLeafNode()&&(t=n.filter.updateFullNode(t,c,a)))}return c=r.serverCache.isFullyInitialized()||null!=oy(s,ig()),Lm(r,t,c,n.filter.filtersNodes())}}}(e,t,l.path,r,i,s):function(e,t,i,n,s,o,a){if(null!=oy(s,i))return t;const c=t.serverCache.isFiltered(),l=t.serverCache;{if(null!=n.value){if(dg(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return my(e,t,i,l.getNode().getChild(i),s,o,c,a);if(dg(i)){let n=new Vm(null);return l.getNode().forEachChild(kg,(e,t)=>{n=n.set(new rg(e),t)}),wy(e,t,i,n,s,o,c,a)}return t}{let r=new Vm(null);return n.foreach((e,t)=>{var n=hg(i,e);l.isCompleteForPath(n)&&(r=r.set(e,l.getNode().getChild(n)))}),wy(e,t,i,r,s,o,c,a)}}}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==Xf.LISTEN_COMPLETE)throw ss("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache,o=Fm(t,s.getNode(),s.isFullyInitialized()||dg(n),s.isFiltered());return gy(e,o,n,r,dy,i)}(e,t,n.path,r,s)}r=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty();const s=Um(e);(0<n.length||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(im(Um(t)))}}(t,o,r),{viewCache:o,changes:r}}function gy(r,i,s,o,a,c){const l=i.eventCache;if(null!=oy(o,s))return i;{let t,n;if(dg(s)){var e;is(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t=i.serverCache.isFiltered()?(e=iy(o,(e=jm(i))instanceof Hg?e:Hg.EMPTY_NODE),r.filter.updateFullNode(i.eventCache.getNode(),e,c)):(u=ry(o,jm(i)),r.filter.updateFullNode(i.eventCache.getNode(),u,c))}else{var u=sg(s);if(".priority"===u){is(1===og(s),"Can't have a priority with additional path components");var h=l.getNode();n=i.serverCache.getNode();var d=sy(o,s,h,n);t=null!=d?r.filter.updatePriority(h,d):l.getNode()}else{h=ag(s);let e;e=l.isCompleteForChild(u)?(n=i.serverCache.getNode(),null!=(d=sy(o,s,l.getNode(),n))?l.getNode().getImmediateChild(u).updateChild(h,d):l.getNode().getImmediateChild(u)):cy(o,u,i.serverCache),t=null!=e?r.filter.updateChild(l.getNode(),u,e,h,a,c):l.getNode()}}return Lm(i,t,l.isFullyInitialized()||dg(s),r.filter.filtersNodes())}}function my(e,t,n,r,i,s,o,a){const c=t.serverCache;let l;const u=o?e.filter:e.filter.getIndexedFilter();if(dg(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),h,null)}else{o=sg(n);if(!c.isCompleteForPath(n)&&1<og(n))return t;h=ag(n);const d=c.getNode().getImmediateChild(o);r=d.updateChild(h,r);l=".priority"===o?u.updatePriority(c.getNode(),r):u.updateChild(c.getNode(),o,r,h,dy,null)}t=Fm(t,l,c.isFullyInitialized()||dg(n),u.filtersNodes());return gy(e,t,n,i,new fy(i,t,s),a)}function yy(t,n,r,i,e,s,o){const a=n.eventCache;let c,l;const u=new fy(e,n,s);if(dg(r))l=t.filter.updateFullNode(n.eventCache.getNode(),i,o),c=Lm(n,l,!0,t.filter.filtersNodes());else{s=sg(r);if(".priority"===s)l=t.filter.updatePriority(n.eventCache.getNode(),i),c=Lm(n,l,a.isFullyInitialized(),a.isFiltered());else{r=ag(r);const h=a.getNode().getImmediateChild(s);let e;if(dg(r))e=i;else{const d=u.getCompleteChild(s);e=null!=d?".priority"===cg(r)&&d.getChild(ug(r)).isEmpty()?d:d.updateChild(r,i):Hg.EMPTY_NODE}c=h.equals(e)?n:Lm(n,t.filter.updateChild(a.getNode(),s,e,r,u,o),a.isFullyInitialized(),t.filter.filtersNodes())}}return c}function vy(e,t){return e.eventCache.isCompleteForChild(t)}function _y(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function wy(r,i,e,t,s,o,a,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let l=i,n;n=dg(e)?t:new Vm(null).setTree(e,t);const u=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{u.hasChild(e)&&(t=_y(0,i.serverCache.getNode().getImmediateChild(e),t),l=my(r,l,new rg(e),t,s,o,a,c))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&void 0===t.value;u.hasChild(e)||n||(t=_y(0,i.serverCache.getNode().getImmediateChild(e),t),l=my(r,l,new rg(e),t,s,o,a,c))}),l}class by{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new cm(n.getIndex()),i=(e=n).loadsAllData()?new cm(e.getIndex()):new(e.hasLimit()?um:lm)(e);this.processor_={filter:i};const s=t.serverCache,o=t.eventCache;e=r.updateFullNode(Hg.EMPTY_NODE,s.getNode(),null),t=i.updateFullNode(Hg.EMPTY_NODE,o.getNode(),null),e=new Pm(e,s.isFullyInitialized(),r.filtersNodes()),t=new Pm(t,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=Mm(t,e),this.eventGenerator_=new Om(this.query_)}get query(){return this.query_}}function Iy(e){return 0===e.eventRegistrations_.length}function Ty(n,r,t){const i=[];if(t){is(null==r,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(e=>{e=e.createCancelEvent(t,s);e&&i.push(e)})}if(r){let t=[];for(let e=0;e<n.eventRegistrations_.length;++e){const o=n.eventRegistrations_[e];if(o.matches(r)){if(r.hasAnyCallback()){t=t.concat(n.eventRegistrations_.slice(e+1));break}}else t.push(o)}n.eventRegistrations_=t}else n.eventRegistrations_=[];return i}function Ey(e,t,n,r){t.type===Xf.MERGE&&null!==t.source.queryId&&(is(jm(e.viewCache_),"We should always have a full cache before handling merges"),is(Um(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=py(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,is(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),is(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),is(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,Sy(e,s.changes,s.viewCache.eventCache.getNode(),null)}function Sy(e,t,n,r){r=r?[r]:e.eventRegistrations_;return xm(e.eventGenerator_,t,n,r)}let ky;class Cy{constructor(){this.views=new Map}}function Ay(t,n,r,i){var e=n.source.queryId;if(null!==e){e=t.views.get(e);return is(null!=e,"SyncTree gave us an op for an invalid query."),Ey(e,n,r,i)}{let e=[];for(const s of t.views.values())e=e.concat(Ey(s,n,r,i));return e}}function Ry(e,n,r,i,s){var t=n._queryIdentifier,t=e.views.get(t);if(t)return t;{let e=ry(r,s?i:null),t=!1;t=!!e||(e=i instanceof Hg?iy(r,i):Hg.EMPTY_NODE,!1);s=Mm(new Pm(e,t,!1),new Pm(i,s,!1));return new by(n,s)}}function Ny(e,t,n,r,i,s){s=Ry(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,s),s.eventRegistrations_.push(n),function(e,t){const n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){const i=n.getNode();i.forEachChild(jg,(e,t)=>{r.push(sm(e,t))})}return n.isFullyInitialized()&&r.push(im(n.getNode())),Sy(e,r,n.getNode(),t)}(s,n)}function Py(e,t,n,r){var i=t._queryIdentifier;const s=[];let o=[];var a=Ly(e);if("default"===i)for(var[c,l]of e.views.entries())o=o.concat(Ty(l,n,r)),Iy(l)&&(e.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const u=e.views.get(i);u&&(o=o.concat(Ty(u,n,r)),Iy(u)&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return a&&!Ly(e)&&s.push((is(ky,"Reference.ts has not been loaded"),new ky(t._repo,t._path))),{removed:s,events:o}}function Oy(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function xy(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=jm(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!dg(t)&&!n.getImmediateChild(sg(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function Dy(e,t){const n=t._queryParams;if(n.loadsAllData())return Fy(e);t=t._queryIdentifier;return e.views.get(t)}function My(e,t){return null!=Dy(e,t)}function Ly(e){return null!=Fy(e)}function Fy(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Uy;let jy=1;class qy{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Vm(null),this.pendingWriteTree_={visibleWrites:Bm.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Vy(e,t,n,r,i){var s,o,a,c;return s=e.pendingWriteTree_,o=t,a=n,c=i,is((r=r)>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:o,snap:a,writeId:r,visible:c=void 0===c?!0:c}),c&&(s.visibleWrites=$m(s.visibleWrites,o,a)),s.lastWriteId=r,i?Qy(e,new Rm(Em(),t,n)):[]}function By(e,t,n,r){var i,s,o;i=e.pendingWriteTree_,s=t,o=n,is((r=r)>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:s,children:o,writeId:r,visible:!0}),i.visibleWrites=zm(i.visibleWrites,s,o),i.lastWriteId=r;n=Vm.fromObject(n);return Qy(e,new Nm(Em(),t,n))}function $y(e,t,n=!1){var r=function(t,n){for(let e=0;e<t.allWrites.length;e++){var r=t.allWrites[e];if(r.writeId===n)return r}return null}(e.pendingWriteTree_,t);if(Zm(e.pendingWriteTree_,t)){let t=new Vm(null);return null!=r.snap?t=t.set(ig(),!0):Ep(r.children,e=>{t=t.set(new rg(e),!0)}),Qy(e,new Cm(r.path,t,n))}return[]}function zy(e,t,n){return Qy(e,new Rm(Sm(),t,n))}function Wy(n,e,t,r){var i=e._path,s=n.syncPointTree_.get(i);let o=[];if(s&&("default"===e._queryIdentifier||My(s,e))){t=Py(s,e,t,r);0===s.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=t.removed;o=t.events;s=-1!==u.findIndex(e=>e._queryParams.loadsAllData()),t=n.syncPointTree_.findOnPath(i,(e,t)=>Ly(t));if(s&&!t){const h=n.syncPointTree_.subtree(i);if(!h.isEmpty()){var a=h.fold((e,t,r)=>{if(t&&Ly(t))return[Fy(t)];{let n=[];return t&&(n=Oy(t)),Ep(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<a.length;++e){var c=a[e],l=c.query,c=Jy(n,c);n.listenProvider_.startListening(rv(l),Xy(n,l),c.hashFn,c.onComplete)}}}!t&&0<u.length&&!r&&(s?(s=null,n.listenProvider_.stopListening(rv(e),s)):u.forEach(e=>{var t=n.queryToTagMap.get(Zy(e));n.listenProvider_.stopListening(rv(e),t)})),function(t,n){for(let e=0;e<n.length;++e){const s=n[e];var r,i;s._queryParams.loadsAllData()||(r=Zy(s),i=t.queryToTagMap.get(r),t.queryToTagMap.delete(r),t.tagToQueryMap.delete(i))}}(n,u)}return o}function Ky(e,t,n){const r=t._path;let i=null,s=!1;e.syncPointTree_.foreachOnPath(r,(e,t)=>{e=fg(e,r);i=i||xy(t,e),s=s||Ly(t)});let o=e.syncPointTree_.get(r);o?(s=s||Ly(o),i=i||xy(o,ig())):(o=new Cy,e.syncPointTree_=e.syncPointTree_.set(r,o));let a;if(null!=i)a=!0;else{a=!1,i=Hg.EMPTY_NODE;const d=e.syncPointTree_.subtree(r);d.foreachChild((e,t)=>{t=xy(t,ig());t&&(i=i.updateImmediateChild(e,t))})}var c,l=My(o,t);l||t._queryParams.loadsAllData()||(u=Zy(t),is(!e.queryToTagMap.has(u),"View does not exist, but we have a tag"),c=jy++,e.queryToTagMap.set(u,c),e.tagToQueryMap.set(c,u));var u=Xm(e.pendingWriteTree_,r);let h=Ny(o,t,n,u,i,a);return l||s||(l=Dy(o,t),h=h.concat(function(t,e,n){const r=e._path,i=Xy(t,e),s=Jy(t,n),o=t.listenProvider_.startListening(rv(e),i,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(r);if(i)is(!Ly(a.value),"If we're adding a query, it shouldn't be shadowed");else{var c=a.fold((e,t,r)=>{if(!dg(e)&&t&&Ly(t))return[Fy(t).query];{let n=[];return t&&(n=n.concat(Oy(t).map(e=>e.query))),Ep(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e];t.listenProvider_.stopListening(rv(l),Xy(t,l))}}return o}(e,t,l))),h}function Hy(e,n,t){var r=e.pendingWriteTree_,e=e.syncPointTree_.findOnPath(n,(e,t)=>{e=xy(t,fg(e,n));if(e)return e});return ny(r,n,e,t,!0)}function Gy(e,t){const n=t._path;let r=null;e.syncPointTree_.foreachOnPath(n,(e,t)=>{e=fg(e,n);r=r||xy(t,e)});let i=e.syncPointTree_.get(n);i?r=r||xy(i,ig()):(i=new Cy,e.syncPointTree_=e.syncPointTree_.set(n,i));var s=null!=r;const o=s?new Pm(r,!0,!1):null;e=Xm(e.pendingWriteTree_,t._path);return Um(Ry(i,t,e,s?o.getNode():Hg.EMPTY_NODE,s).viewCache_)}function Qy(e,t){return function t(n,r,i,s){{if(dg(n.path))return Yy(n,r,i,s);{const o=r.get(ig());null==i&&null!=o&&(i=xy(o,ig()));let e=[];const a=sg(n.path),c=n.operationForChild(a),l=r.children.get(a);if(l&&c){const u=i?i.getImmediateChild(a):null,h=ly(s,a);e=e.concat(t(c,l,u,h))}return o&&(e=e.concat(Ay(o,n,s,i))),e}}}(t,e.syncPointTree_,null,Xm(e.pendingWriteTree_,ig()))}function Yy(i,e,s,o){var t=e.get(ig());null==s&&null!=t&&(s=xy(t,ig()));let a=[];return e.children.inorderTraversal((e,t)=>{var n=s?s.getImmediateChild(e):null,r=ly(o,e),e=i.operationForChild(e);e&&(a=a.concat(Yy(e,t,n,r)))}),t&&(a=a.concat(Ay(t,i,o,s))),a}function Jy(r,t){const i=t.query,s=Xy(r,i);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||Hg.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return s?function(e,t,n){var r=ev(e,n);if(r){n=tv(r),r=n.path,n=n.queryId,t=fg(r,t);return nv(e,r,new Am(km(n),t))}return[]}(r,i._path,s):(t=r,n=i._path,Qy(t,new Am(Sm(),n)));var t,n,e=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,i);return Wy(r,i,null,e)}}}function Xy(e,t){t=Zy(t);return e.queryToTagMap.get(t)}function Zy(e){return e._path.toString()+"$"+e._queryIdentifier}function ev(e,t){return e.tagToQueryMap.get(t)}function tv(e){var t=e.indexOf("$");return is(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new rg(e.substr(0,t))}}function nv(e,t,n){var r=e.syncPointTree_.get(t);return is(r,"Missing sync point for query tag that we're tracking"),Ay(r,n,Xm(e.pendingWriteTree_,t),null)}function rv(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(is(Uy,"Reference.ts has not been loaded"),new Uy(e._repo,e._path)):e}class iv{constructor(e){this.node_=e}getImmediateChild(e){e=this.node_.getImmediateChild(e);return new iv(e)}node(){return this.node_}}class sv{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){e=hg(this.path_,e);return new sv(this.syncTree_,e)}node(){return Hy(this.syncTree_,this.path_)}}const ov=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},av=function(e,t,n){return e&&"object"==typeof e?(is(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?cv(e[".sv"],t,n):"object"==typeof e[".sv"]?lv(e[".sv"],t):void is(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},cv=function(e,t,n){if("timestamp"===e)return n.timestamp;is(!1,"Unexpected server value: "+e)},lv=function(e,t,n){e.hasOwnProperty("increment")||is(!1,"Unexpected server value: "+JSON.stringify(e,null,2));e=e.increment;"number"!=typeof e&&is(!1,"Unexpected increment value: "+e);const r=t.node();if(is(null!==r&&void 0!==r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return e;const i=r;t=i.getValue();return"number"!=typeof t?e:t+e},uv=function(e,t,n,r){return dv(t,new sv(n,e),r)},hv=function(e,t,n){return dv(e,new iv(t),n)};function dv(e,r,i){var t=e.getPriority().val(),n=av(t,r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const o=e;t=av(o.getValue(),r,i);return t!==o.getValue()||n!==o.getPriority().val()?new Lg(t,Jg(n)):e}{const a=e;return s=a,n!==a.getPriority().val()&&(s=s.updatePriority(new Lg(n))),a.forEachChild(jg,(e,t)=>{var n=dv(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class fv{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function pv(e,t){let n=t instanceof rg?t:new rg(t),r=e,i=sg(n);for(;null!==i;){var s=Ds(r.node.children,i)||{children:{},childCount:0};r=new fv(i,r,s),n=ag(n),i=sg(n)}return r}function gv(e){return e.node.value}function mv(e,t){e.node.value=t,wv(e)}function yv(e){return 0<e.node.childCount}function vv(n,r){Ep(n.node.children,(e,t)=>{r(new fv(e,n,t))})}function _v(e){return new rg(null===e.parent?e.name:_v(e.parent)+"/"+e.name)}function wv(e){var t,n,r,i;null!==e.parent&&(t=e.parent,n=e.name,i=function(e){return void 0===gv(e)&&!yv(e)}(r=e),e=xs(t.node.children,n),i&&e?(delete t.node.children[n],t.node.childCount--,wv(t)):i||e||(t.node.children[n]=r.node,t.node.childCount++,wv(t)))}const bv=/[\[\].#$\/\u0000-\u001F\u007F]/,Iv=/[\[\].#$\u0000-\u001F\u007F]/,Tv=10485760,Ev=function(e){return"string"==typeof e&&0!==e.length&&!bv.test(e)},Sv=function(e){return"string"==typeof e&&0!==e.length&&!Iv.test(e)},kv=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!mp(e)||e&&"object"==typeof e&&xs(e,".sv")},Cv=function(e,t,n,r){r&&void 0===t||Av(Gs(e,"value"),t,n)},Av=function(s,e,t){const o=t instanceof rg?new yg(t,s):t;if(void 0===e)throw new Error(s+"contains undefined "+_g(o));if("function"==typeof e)throw new Error(s+"contains a function "+_g(o)+" with contents = "+e.toString());if(mp(e))throw new Error(s+"contains "+e.toString()+" "+_g(o));if("string"==typeof e&&e.length>Tv/3&&Qs(e)>Tv)throw new Error(s+"contains a string greater than "+Tv+" utf8 bytes "+_g(o)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let r=!1,i=!1;if(Ep(e,(e,t)=>{if(".value"===e)r=!0;else if(".priority"!==e&&".sv"!==e&&(i=!0,!Ev(e)))throw new Error(s+" contains an invalid key ("+e+") "+_g(o)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n;n=o,e=e,0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Qs(e),vg(n),Av(s,t,o),n=o,t=n.parts_.pop(),n.byteLength_-=Qs(t),0<n.parts_.length&&--n.byteLength_}),r&&i)throw new Error(s+' contains ".value" child '+_g(o)+" in addition to actual children.")}},Rv=function(e,t,r,n){if(!n||void 0!==t){const i=Gs(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];Ep(t,(e,t)=>{const n=new rg(e);if(Av(i,t,hg(r,n)),".priority"===cg(n)&&!kv(t))throw new Error(i+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];var i=lg(r);for(let e=0;e<i.length;e++)if((".priority"!==i[e]||e!==i.length-1)&&!Ev(i[e]))throw new Error(t+"contains an invalid key ("+i[e]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}e.sort(pg);let s=null;for(n=0;n<e.length;n++){if(r=e[n],null!==s&&mg(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(i,s)}},Nv=function(e,t,n){if(!n||void 0!==t){if(mp(t))throw new Error(Gs(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!kv(t))throw new Error(Gs(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Pv=function(e,t,n,r){if(!(r&&void 0===n||Ev(n)))throw new Error(Gs(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Ov=function(e,t,n,r){if(!(r&&void 0===n||Sv(n)))throw new Error(Gs(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},xv=function(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),Ov(e,t,n,r)},Dv=function(e,t){if(".info"===sg(t))throw new Error(e+" failed = Can't modify data under /.info/")},Mv=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Ev(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&(n=(n=n)&&n.replace(/^\/*\.info(\/|$)/,"/"),!Sv(n)))throw new Error(Gs(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Lv{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Fv(t,n){let r=null;for(let e=0;e<n.length;e++){const s=n[e];var i=s.getPath();null===r||gg(i,r.path)||(t.eventLists_.push(r),r=null),null===r&&(r={events:[],path:i}),r.events.push(s)}r&&t.eventLists_.push(r)}function Uv(e,t,n){Fv(e,n),qv(e,e=>gg(e,t))}function jv(e,t,n){Fv(e,n),qv(e,e=>mg(e,t)||mg(t,e))}function qv(t,n){t.recursionDepth_++;let r=!0;for(let e=0;e<t.eventLists_.length;e++){var i=t.eventLists_[e];i&&(n(i.path)?(function(t){for(let e=0;e<t.events.length;e++){const r=t.events[e];var n;null!==r&&(t.events[e]=null,n=r.getEventRunner(),cp&&hp("event: "+r.toString()),Np(n))}}(t.eventLists_[e]),t.eventLists_[e]=null):r=!1)}r&&(t.eventLists_=[]),t.recursionDepth_--}const Vv="repo_interrupt",Bv=25;class $v{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Lv,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=_m(),this.transactionQueueTree_=new fv,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function zv(o,e,t){if(o.stats_=zp(o.repoInfo_),o.forceRestClient_||Pp())o.server_=new ym(o.repoInfo_,(e,t,n,r)=>{Hv(o,e,t,n,r)},o.authTokenProvider_,o.appCheckProvider_),setTimeout(()=>Gv(o,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ps(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}o.persistentConnection_=new bg(o.repoInfo_,e,(e,t,n,r)=>{Hv(o,e,t,n,r)},e=>{Gv(o,e)},e=>{var n;n=o,Ep(e,(e,t)=>{Qv(n,e,t)})},o.authTokenProvider_,o.appCheckProvider_,t),o.server_=o.persistentConnection_}o.authTokenProvider_.addTokenChangeListener(e=>{o.server_.refreshAuthToken(e)}),o.appCheckProvider_.addTokenChangeListener(e=>{o.server_.refreshAppCheckToken(e.token)}),o.statsReporter_=(e=o.repoInfo_,t=()=>new Tm(o.stats_,o.server_),e=e.toString(),$p[e]||($p[e]=t()),$p[e]),o.infoData_=new vm,o.infoSyncTree_=new qy({startListening:(e,t,n,r)=>{let i=[];const s=o.infoData_.getNode(e._path);return s.isEmpty()||(i=zy(o.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),Qv(o,"connected",!1),o.serverSyncTree_=new qy({startListening:(n,e,t,r)=>(o.server_.listen(n,t,e,(e,t)=>{t=r(e,t);jv(o.eventQueue_,n._path,t)}),[]),stopListening:(e,t)=>{o.server_.unlisten(e,t)}})}function Wv(e){const t=e.infoData_.getNode(new rg(".info/serverTimeOffset"));e=t.val()||0;return(new Date).getTime()+e}function Kv(e){return ov({timestamp:Wv(e)})}function Hv(e,t,n,r,i){e.dataUpdateCount++;var s,o,a,c=new rg(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let l=[];l=i?r?(s=Ls(n,e=>Jg(e)),function(e,t,n,r){var i=ev(e,r);if(i){r=tv(i),i=r.path,r=r.queryId,t=fg(i,t),n=Vm.fromObject(n);return nv(e,i,new Nm(km(r),t,n))}return[]}(e.serverSyncTree_,c,s,i)):(t=Jg(n),s=e.serverSyncTree_,o=c,a=t,null==(i=ev(s,t=i))?[]:(t=tv(i),i=t.path,t=t.queryId,o=fg(i,o),nv(s,i,new Rm(km(t),o,a)))):r?(o=Ls(n,e=>Jg(e)),a=e.serverSyncTree_,r=c,o=o,o=Vm.fromObject(o),Qy(a,new Nm(Sm(),r,o))):(n=Jg(n),zy(e.serverSyncTree_,c,n));let u=c;0<l.length&&(u=o_(e,c)),jv(e.eventQueue_,u,l)}function Gv(e,t){Qv(e,"connected",t),!1===t&&function(n){n_(n,"onDisconnectEvents");const r=Kv(n),i=_m();bm(n.onDisconnect_,ig(),(e,t)=>{t=uv(e,t,n.serverSyncTree_,r);wm(i,e,t)});let s=[];bm(i,ig(),(e,t)=>{s=s.concat(zy(n.serverSyncTree_,e,t));e=u_(n,e);o_(n,e)}),n.onDisconnect_=_m(),jv(n.eventQueue_,ig(),s)}(e)}function Qv(e,t,n){t=new rg("/.info/"+t),n=Jg(n);e.infoData_.updateSnapshot(t,n);n=zy(e.infoSyncTree_,t,n);jv(e.eventQueue_,t,n)}function Yv(e){return e.nextWriteId_++}function Jv(r,i,e,t,s){n_(r,"set",{path:i.toString(),value:e,priority:t});var n=Kv(r);const o=Jg(e,t);t=Hy(r.serverSyncTree_,i),n=hv(o,t,n);const a=Yv(r);n=Vy(r.serverSyncTree_,i,n,a,!0);Fv(r.eventQueue_,n),r.server_.put(i.toString(),o.val(!0),(e,t)=>{var n="ok"===e;n||gp("set at "+i+" failed: "+e);n=$y(r.serverSyncTree_,a,!n);jv(r.eventQueue_,i,n),r_(0,s,e,t)});n=u_(r,i);o_(r,n),jv(r.eventQueue_,n,[])}function Xv(n,r,i){n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(dg(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild(jg,(e,t)=>{wm(n,new rg(e),t)}),e(n,t)}}if(0<n.children.size){var r=sg(t);return t=ag(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size}return!0}(n.onDisconnect_,r),r_(0,i,e,t)})}function Zv(n,r,e,i){const s=Jg(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&wm(n.onDisconnect_,r,s),r_(0,i,e,t)})}function e_(e,t,n){let r;r=".info"===sg(t._path)?Wy(e.infoSyncTree_,t,n):Wy(e.serverSyncTree_,t,n),Uv(e.eventQueue_,t._path,r)}function t_(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Vv)}function n_(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),hp(n,...t)}function r_(e,r,i,s){r&&Np(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function i_(e,t,n){return Hy(e.serverSyncTree_,t,n)||Hg.EMPTY_NODE}function s_(t,e=t.transactionQueueTree_){if(e||l_(t,e),gv(e)){const n=c_(t,e);is(0<n.length,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(i,s,o){const e=o.map(e=>e.currentWriteId),t=i_(i,s,e);let n=t;var r=t.hash();for(let e=0;e<o.length;e++){const u=o[e];is(0===u.status,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;var a=fg(s,u.path);n=n.updateChild(a,u.currentOutputSnapshotRaw)}const c=n.val(!0),l=s;i.server_.put(l.toString(),c,t=>{n_(i,"transaction put response",{path:l.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<o.length;e++)o[e].status=2,n=n.concat($y(i.serverSyncTree_,o[e].currentWriteId)),o[e].onComplete&&r.push(()=>o[e].onComplete(null,!0,o[e].currentOutputSnapshotResolved)),o[e].unwatcher();l_(i,pv(i.transactionQueueTree_,s)),s_(i,i.transactionQueueTree_),jv(i.eventQueue_,s,n);for(let e=0;e<r.length;e++)Np(r[e])}else{if("datastale"===t)for(let e=0;e<o.length;e++)3===o[e].status?o[e].status=4:o[e].status=0;else{gp("transaction at "+l.toString()+" failed: "+t);for(let e=0;e<o.length;e++)o[e].status=4,o[e].abortReason=t}o_(i,s)}},r)}(t,_v(e),n)}else yv(e)&&vv(e,e=>{s_(t,e)})}function o_(e,t){var n=a_(e,t),t=_v(n);return function(i,s,o){if(0!==s.length){const l=[];let r=[];const e=s.filter(e=>0===e.status),u=e.map(e=>e.currentWriteId);for(let n=0;n<s.length;n++){const h=s[n];var a=fg(o,h.path);let e=!1,t;if(is(null!==a,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)e=!0,t=h.abortReason,r=r.concat($y(i.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=Bv)e=!0,t="maxretry",r=r.concat($y(i.serverSyncTree_,h.currentWriteId,!0));else{const d=i_(i,h.path,u);h.currentInputSnapshot=d;var c=s[n].update(d.val());if(void 0!==c){Av("transaction failed: Data returned ",c,h.path);let e=Jg(c);"object"==typeof c&&null!=c&&xs(c,".priority")||(e=e.updatePriority(d.getPriority()));a=h.currentWriteId,c=Kv(i),c=hv(e,d,c);h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=c,h.currentWriteId=Yv(i),u.splice(u.indexOf(a),1),r=r.concat(Vy(i.serverSyncTree_,h.path,c,h.currentWriteId,h.applyLocally)),r=r.concat($y(i.serverSyncTree_,a,!0))}else e=!0,t="nodata",r=r.concat($y(i.serverSyncTree_,h.currentWriteId,!0))}jv(i.eventQueue_,o,r),r=[],e&&(s[n].status=2,function(e){setTimeout(e,Math.floor(0))}(s[n].unwatcher),s[n].onComplete&&("nodata"===t?l.push(()=>s[n].onComplete(null,!1,s[n].currentInputSnapshot)):l.push(()=>s[n].onComplete(new Error(t),!1,null))))}l_(i,i.transactionQueueTree_);for(let e=0;e<l.length;e++)Np(l[e]);s_(i,i.transactionQueueTree_)}}(e,c_(e,n),t),t}function a_(e,t){let n,r=e.transactionQueueTree_;for(n=sg(t);null!==n&&void 0===gv(r);)r=pv(r,n),t=ag(t),n=sg(t);return r}function c_(e,t){const n=[];return function t(n,e,r){const i=gv(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);vv(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function l_(t,e){const n=gv(e);if(n){let t=0;for(let e=0;e<n.length;e++)2!==n[e].status&&(n[t]=n[e],t++);n.length=t,mv(e,0<n.length?n:void 0)}vv(e,e=>{l_(t,e)})}function u_(t,e){var n=_v(a_(t,e)),e=pv(t.transactionQueueTree_,e);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return;r=r.parent}}(e,e=>{h_(t,e)}),h_(t,e),function t(e,n,r,i){r&&!i&&n(e),vv(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(e,e=>{h_(t,e)}),n}function h_(r,e){const i=gv(e);if(i){const s=[];let t=[],n=-1;for(let e=0;e<i.length;e++)3===i[e].status||(1===i[e].status?(is(n===e-1,"All SENT items should be at beginning of queue."),n=e,i[e].status=3,i[e].abortReason="set"):(is(0===i[e].status,"Unexpected transaction status in abort"),i[e].unwatcher(),t=t.concat($y(r.serverSyncTree_,i[e].currentWriteId,!0)),i[e].onComplete&&s.push(i[e].onComplete.bind(null,new Error("set"),!1,null))));-1===n?mv(e,void 0):i.length=n+1,jv(r.eventQueue_,_v(e),t);for(let e=0;e<s.length;e++)Np(s[e])}}const d_=function(e,t){var n=f_(e),r=n.namespace;"firebase.com"===n.domain&&pp(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||pp("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&gp("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");e="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new jp(n.host,n.secure,r,t,e,"",r!==n.subdomain),path:new rg(n.pathString)}},f_=function(r){let i="",s="",o="",a="",c="",l=!0,u="https",h=443;if("string"==typeof r){let e=r.indexOf("//");0<=e&&(u=r.substring(0,e-1),r=r.substring(e+2));let t=r.indexOf("/");-1===t&&(t=r.length);let n=r.indexOf("?");-1===n&&(n=r.length),i=r.substring(0,Math.min(t,n)),t<n&&(a=function(e){let n="";var r=e.split("/");for(let t=0;t<r.length;t++)if(0<r[t].length){let e=r[t];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}n+="/"+e}return n}(r.substring(t,n)));var d=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):gp(`Invalid query segment '${r}' in query '${e}'`))}return t}(r.substring(Math.min(r.length,n)));e=i.indexOf(":"),0<=e?(l="https"===u||"wss"===u,h=parseInt(i.substring(e+1),10)):e=i.length;const f=i.slice(0,e);"localhost"===f.toLowerCase()?s="localhost":f.split(".").length<=2?s=f:(r=i.indexOf("."),o=i.substring(0,r).toLowerCase(),s=i.substring(r+1),c=o),"ns"in d&&(c=d.ns)}return{host:i,port:h,domain:s,subdomain:o,secure:l,scheme:u,pathString:a,namespace:c}};class p_{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ps(this.snapshot.exportVal())}}class g_{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class m_{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return is(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class y_{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new us;return Xv(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Dv("OnDisconnect.remove",this._path);const e=new us;return Zv(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Dv("OnDisconnect.set",this._path),Cv("OnDisconnect.set",e,this._path,!1);const t=new us;return Zv(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Dv("OnDisconnect.setWithPriority",this._path),Cv("OnDisconnect.setWithPriority",e,this._path,!1),Nv("OnDisconnect.setWithPriority",t,!1);const n=new us;return function(n,r,e,t,i){const s=Jg(e,t);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&wm(n.onDisconnect_,r,s),r_(0,i,e,t)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){Dv("OnDisconnect.update",this._path),Rv("OnDisconnect.update",e,this._path,!1);const t=new us;return function(n,r,i,s){if(Ms(i))return hp("onDisconnect().update() called with empty data.  Don't do anything."),r_(0,s,"ok",void 0);n.server_.onDisconnectMerge(r.toString(),i,(e,t)=>{"ok"===e&&Ep(i,(e,t)=>{t=Jg(t);wm(n.onDisconnect_,hg(r,e),t)}),r_(0,s,e,t)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class v_{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return dg(this._path)?null:cg(this._path)}get ref(){return new I_(this._repo,this._path)}get _queryIdentifier(){var e=mm(this._queryParams),e=Ip(e);return"{}"===e?"default":e}get _queryObject(){return mm(this._queryParams)}isEqual(e){if(!((e=to(e))instanceof v_))return!1;var t=this._repo===e._repo,n=gg(this._path,e._path),e=this._queryIdentifier===e._queryIdentifier;return t&&n&&e}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(t){let n="";for(let e=t.pieceNum_;e<t.pieces_.length;e++)""!==t.pieces_[e]&&(n+="/"+encodeURIComponent(String(t.pieces_[e])));return n||"/"}(this._path)}}function __(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function w_(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===kg){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==yp)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==vp)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===jg){if(null!=t&&!kv(t)||null!=n&&!kv(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(is(e.getIndex()instanceof Xg||e.getIndex()===Zg,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function b_(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class I_ extends v_{constructor(e,t){super(e,t,new hm,!1)}get parent(){var e=ug(this._path);return null===e?null:new I_(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class T_{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new rg(e),e=k_(this.ref,e);return new T_(this._node.getChild(t),e,jg)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new T_(t,k_(this.ref,e),jg)))}hasChild(e){e=new rg(e);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function E_(e,t){return(e=to(e))._checkNotDeleted("ref"),void 0!==t?k_(e._root,t):e._root}function S_(e,t){(e=to(e))._checkNotDeleted("refFromURL");const n=d_(t,e._repo.repoInfo_.nodeAdmin);Mv("refFromURL",n);t=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||t.host===e._repo.repoInfo_.host||pp("refFromURL: Host name does not match the current database: (found "+t.host+" but expected "+e._repo.repoInfo_.host+")"),E_(e,n.path.toString())}function k_(e,t){return(null===sg((e=to(e))._path)?xv:Ov)("child","path",t,!1),new I_(e._repo,hg(e._path,t))}function C_(e,t){e=to(e),Dv("set",e._path),Cv("set",t,e._path,!1);const n=new us;return Jv(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function A_(e,t){Rv("update",t,e._path,!1);const n=new us;return function(i,s,e,o){n_(i,"update",{path:s.toString(),value:e});let n=!0;const r=Kv(i),a={};if(Ep(e,(e,t)=>{n=!1,a[e]=uv(hg(s,e),Jg(t),i.serverSyncTree_,r)}),n)hp("update() called with empty data.  Don't do anything."),r_(0,o,"ok",void 0);else{const c=Yv(i);var t=By(i.serverSyncTree_,s,a,c);Fv(i.eventQueue_,t),i.server_.merge(s.toString(),e,(e,t)=>{var n="ok"===e;n||gp("update at "+s+" failed: "+e);var r=$y(i.serverSyncTree_,c,!n),n=0<r.length?o_(i,s):s;jv(i.eventQueue_,n,r),r_(0,o,e,t)}),Ep(e,e=>{e=u_(i,hg(s,e));o_(i,e)}),jv(i.eventQueue_,s,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function R_(t){return t=to(t),n=t._repo,r=t,(null!=(e=Gy(n.serverSyncTree_,r))?Promise.resolve(e):n.server_.get(r).then(e=>{var t=Jg(e).withIndex(r._queryParams.getIndex()),e=zy(n.serverSyncTree_,r._path,t);return Uv(n.eventQueue_,r._path,e),Promise.resolve(t)},e=>(n_(n,"get for query "+Ps(r)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new T_(e,new I_(t._repo,t._path),t._queryParams.getIndex()));var n,r,e}class N_{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new p_("value",this,new T_(e.snapshotNode,new I_(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new g_(this,e,t):null}matches(e){return e instanceof N_&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class P_{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new g_(this,e,t):null}createEvent(e,t){is(null!=e.childName,"Child events should have a childName.");var n=k_(new I_(t._repo,t._path),e.childName),t=t._queryParams.getIndex();return new p_(e.type,this,new T_(e.snapshotNode,n,t),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof P_&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function O_(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const a=t;i=(e,t)=>{e_(n._repo,n,o),a(e,t)};i.userCallback=t.userCallback,i.context=t.context,t=i}t=new m_(t,s||void 0);const o="value"===e?new N_(t):new P_(e,t);return function(e,t,n){let r;r=".info"===sg(t._path)?Ky(e.infoSyncTree_,t,n):Ky(e.serverSyncTree_,t,n),Uv(e.eventQueue_,t._path,r)}(n._repo,n,o),()=>e_(n._repo,n,o)}function x_(e,t,n,r){return O_(e,"value",t,n,r)}function D_(e,t,n,r){return O_(e,"child_added",t,n,r)}function M_(e,t,n,r){return O_(e,"child_changed",t,n,r)}function L_(e,t,n,r){return O_(e,"child_moved",t,n,r)}function F_(e,t,n,r){return O_(e,"child_removed",t,n,r)}function U_(e,t,n){let r=null;n=n?new m_(n):null;"value"===t?r=new N_(n):t&&(r=new P_(t,n)),e_(e._repo,e,r)}class j_{}class q_ extends j_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Cv("endAt",this._value,e._path,!0);var t=fm(e._queryParams,this._value,this._key);if(b_(t),w_(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new v_(e._repo,e._path,t,e._orderByCalled)}}class V_ extends j_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Cv("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r,i;return i=e.index_===kg?fm(e,t="string"==typeof t?rm(t):t,n):(r=null==n?yp:rm(n),fm(e,t,r)),i.endBeforeSet_=!0,i}(e._queryParams,this._value,this._key);if(b_(t),w_(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new v_(e._repo,e._path,t,e._orderByCalled)}}class B_ extends j_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Cv("startAt",this._value,e._path,!0);var t=dm(e._queryParams,this._value,this._key);if(b_(t),w_(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new v_(e._repo,e._path,t,e._orderByCalled)}}class $_ extends j_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Cv("startAfter",this._value,e._path,!1);var t=function(t,n,r){let i;if(t.index_===kg)"string"==typeof n&&(n=nm(n)),i=dm(t,n,r);else{let e;e=null==r?vp:nm(r),i=dm(t,n,e)}return i.startAfterSet_=!0,i}(e._queryParams,this._value,this._key);if(b_(t),w_(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new v_(e._repo,e._path,t,e._orderByCalled)}}class z_ extends j_{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new v_(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class W_ extends j_{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new v_(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class K_ extends j_{constructor(e){super(),this._path=e}_apply(e){__(e,"orderByChild");var t=new rg(this._path);if(dg(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");t=new Xg(t),t=pm(e._queryParams,t);return w_(t),new v_(e._repo,e._path,t,!0)}}class H_ extends j_{_apply(e){__(e,"orderByKey");var t=pm(e._queryParams,kg);return w_(t),new v_(e._repo,e._path,t,!0)}}class G_ extends j_{_apply(e){__(e,"orderByPriority");var t=pm(e._queryParams,jg);return w_(t),new v_(e._repo,e._path,t,!0)}}class Q_ extends j_{_apply(e){__(e,"orderByValue");var t=pm(e._queryParams,Zg);return w_(t),new v_(e._repo,e._path,t,!0)}}class Y_ extends j_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(Cv("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new q_(this._value,this._key)._apply(new B_(this._value,this._key)._apply(e))}}function J_(e,...t){let n=to(e);for(const r of t)n=r._apply(n);return n}Zf=I_,is(!ky,"__referenceConstructor has already been defined"),ky=Zf,ep=I_,is(!Uy,"__referenceConstructor has already been defined"),Uy=ep;const X_="FIREBASE_DATABASE_EMULATOR_HOST",Z_={};let ew=!1;function tw(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||pp("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),hp("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o=d_(s,i),a=o.repoInfo,c,l=void 0;"undefined"!=typeof process&&(l=process.env[X_]),l?(c=!0,s=`http://${l}?ns=${a.namespace}`,o=d_(s,i),a=o.repoInfo):c=!o.repoInfo.secure;t=i&&c?new Mp(Mp.OWNER):new Dp(e.name,e.options,t);Mv("Invalid Firebase Database URL",o),dg(o.path)||pp("Database URL must point to the root of a Firebase Database (not including a child path).");n=function(e,t,n,r){let i=Z_[t.name];i||(i={},Z_[t.name]=i);t=i[e.toURLString()];t&&pp("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return t=new $v(e,ew,n,r),i[e.toURLString()]=t}(a,e,t,new xp(e.name,n));return new nw(n,e)}class nw{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(zv(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new I_(this._repo,ig())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=Z_[t];n&&n[e.key]===e||pp(`Database ${t}(${e.repoInfo_}) has already been deleted.`),t_(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&pp("Cannot call "+e+" on a deleted database.")}}function rw(e,t,n,r={}){(e=to(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&pp("Cannot call useEmulator() after instance has already been initialized.");var i,s=e._repoInternal;let o=void 0;s.repoInfo_.nodeAdmin?(r.mockUserToken&&pp('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Mp(Mp.OWNER)):r.mockUserToken&&(i="string"==typeof r.mockUserToken?r.mockUserToken:ds(r.mockUserToken,e.app.options.projectId),o=new Mp(i)),i=s,s=t,t=n,n=o,i.repoInfo_=new jp(`${s}:${t}`,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams),n&&(i.authTokenProvider_=n)}function iw(e){(e=to(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(Vv)}function sw(e,t){up(e,t)}const ow={".sv":"timestamp"};class aw{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function cw(i,e,t){if(i=to(i),Dv("Reference.transaction",i._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";t=null===(n=null==t?void 0:t.applyLocally)||void 0===n||n;const s=new us;var n=x_(i,()=>{});return function(t,n,e,r,i,s){n_(t,"transaction on "+n);const o={path:n,update:e,onComplete:r,status:null,order:sp(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=i_(t,n,void 0);if(o.currentInputSnapshot=a,void 0===(s=o.update(a.val())))o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Av("transaction failed: Data returned ",s,o.path),o.status=0;i=pv(t.transactionQueueTree_,n);const c=gv(i)||[];c.push(o),mv(i,c);let e;if("object"==typeof s&&null!==s&&xs(s,".priority"))e=Ds(s,".priority"),is(kv(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const l=Hy(t.serverSyncTree_,n)||Hg.EMPTY_NODE;e=l.getPriority().val()}i=Kv(t),s=Jg(s,e),i=hv(s,a,i);o.currentOutputSnapshotRaw=s,o.currentOutputSnapshotResolved=i,o.currentWriteId=Yv(t);i=Vy(t.serverSyncTree_,n,i,o.currentWriteId,o.applyLocally);jv(t.eventQueue_,n,i),s_(t,t.transactionQueueTree_)}}(i._repo,i._path,e,(e,t,n)=>{var r;e?s.reject(e):(r=new T_(n,new I_(i._repo,i._path),jg),s.resolve(new aw(t,r)))},n,t),s.promise}bg.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},bg.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Hf(xo),Ro(new no("database",(e,{instanceIdentifier:t})=>{return tw(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),Fo("@firebase/database","0.11.0-2021720181311",tp);var lw=function(e,t){return(lw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function uw(e,o,a,c){return new(a=a||Promise)(function(n,t){function r(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,i)}s((c=c.apply(e,o||[])).next())})}function hw(n,r){var i,s,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(o=2&t[0]?s.return:t[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,t[1])).done)return o;switch(s=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],s=0}finally{i=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function dw(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function fw(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function pw(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}var gw=(mw.prototype.wrapCallback=function(n){var r=this;return function(e,t){e?r.reject(e):r.resolve(t),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(e):n(e,t))}},mw);function mw(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})}var yw,vw="FirebaseError",_w=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}lw(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(ww,yw=Error),ww);function ww(e,t,n){t=yw.call(this,t)||this;return t.code=e,t.customData=n,t.name=vw,Object.setPrototypeOf(t,ww.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,bw.prototype.create),t}var bw=(Iw.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i=t[0]||{},s=this.service+"/"+e,e=this.errors[e],e=e?(r=i,e.replace(Ew,function(e,t){var n=r[t];return null!=n?String(n):"<"+t+"?>"})):"Error",e=this.serviceName+": "+e+" ("+s+").";return new _w(s,e,i)},Iw);function Iw(e,t,n){this.service=e,this.serviceName=t,this.errors=n}function Tw(e,t,n,r){var i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}var Ew=/\{\$([^}]+)}/g;function Sw(e,t){return e+" failed: "+t+" argument "}function kw(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Sw(e,t)+"must be a valid function.")}function Cw(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Sw(e,t)+"must be a valid context object.")}var Aw=(Rw.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},Rw.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},Rw.prototype.setServiceProps=function(e){return this.serviceProps=e,this},Rw.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},Rw);function Rw(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}var Nw="[DEFAULT]",Pw=(Ow.prototype.get=function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){e=new gw;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise},Ow.prototype.getImmediate=function(t){var e=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),t=null!==(t=null==t?void 0:t.optional)&&void 0!==t&&t;if(!this.isInitialized(e)&&!this.shouldAutoInitialize()){if(t)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:e})}catch(e){if(t)return null;throw e}},Ow.prototype.getComponent=function(){return this.component},Ow.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:Nw})}catch(e){}try{for(var r=dw(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var s=fw(i.value,2),o=s[0],a=s[1],c=this.normalizeInstanceIdentifier(o);try{var l=this.getOrInitializeService({instanceIdentifier:c});a.resolve(l)}catch(e){}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},Ow.prototype.clearInstance=function(e){this.instancesDeferred.delete(e=void 0===e?Nw:e),this.instancesOptions.delete(e),this.instances.delete(e)},Ow.prototype.delete=function(){return uw(this,void 0,void 0,function(){var t;return hw(this,function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(pw(pw([],fw(t.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()}))),fw(t.filter(function(e){return"_delete"in e}).map(function(e){return e._delete()}))))];case 1:return e.sent(),[2]}})})},Ow.prototype.isComponentSet=function(){return null!=this.component},Ow.prototype.isInitialized=function(e){return this.instances.has(e=void 0===e?Nw:e)},Ow.prototype.getOptions=function(e){return this.instancesOptions.get(e=void 0===e?Nw:e)||{}},Ow.prototype.initialize=function(e){var t,n,r=(e=void 0===e?{}:e).options,r=void 0===r?{}:r,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(this.name+"("+i+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var s=this.getOrInitializeService({instanceIdentifier:i,options:r});try{for(var o=dw(this.instancesDeferred.entries()),a=o.next();!a.done;a=o.next()){var c=fw(a.value,2),l=c[0],u=c[1];i===this.normalizeInstanceIdentifier(l)&&u.resolve(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return s},Ow.prototype.onInit=function(e,t){var n=this.normalizeInstanceIdentifier(t),r=null!==(t=this.onInitCallbacks.get(n))&&void 0!==t?t:new Set;r.add(e),this.onInitCallbacks.set(n,r);t=this.instances.get(n);return t&&e(t,n),function(){r.delete(e)}},Ow.prototype.invokeOnInitCallbacks=function(e,t){var n,r,i=this.onInitCallbacks.get(t);if(i)try{for(var s=dw(i),o=s.next();!o.done;o=s.next()){var a=o.value;try{a(e,t)}catch(e){}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},Ow.prototype.getOrInitializeService=function(e){var t=e.instanceIdentifier,n=e.options,r=void 0===n?{}:n,e=this.instances.get(t);if(!e&&this.component&&(e=this.component.instanceFactory(this.container,{instanceIdentifier:(n=t)===Nw?void 0:n,options:r}),this.instances.set(t,e),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(e,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,e)}catch(e){}return e||null},Ow.prototype.normalizeInstanceIdentifier=function(e){return void 0===e&&(e=Nw),!this.component||this.component.multipleInstances?e:Nw},Ow.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},Ow);function Ow(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}var xw,Dw=(Mw.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},Mw.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},Mw.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new Pw(e,this);return this.providers.set(e,t),t},Mw.prototype.getProviders=function(){return Array.from(this.providers.values())},Mw);function Mw(e){this.name=e,this.providers=new Map}(H=xw=xw||{})[H.DEBUG=0]="DEBUG",H[H.VERBOSE=1]="VERBOSE",H[H.INFO=2]="INFO",H[H.WARN=3]="WARN",H[H.ERROR=4]="ERROR",H[H.SILENT=5]="SILENT";function Lw(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),s=jw[t];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[s].apply(console,pw(["["+i+"]  "+e.name+":"],n))}}var Fw={debug:xw.DEBUG,verbose:xw.VERBOSE,info:xw.INFO,warn:xw.WARN,error:xw.ERROR,silent:xw.SILENT},Uw=xw.INFO,jw=((qi={})[xw.DEBUG]="log",qi[xw.VERBOSE]="log",qi[xw.INFO]="info",qi[xw.WARN]="warn",qi[xw.ERROR]="error",qi),dr=(Object.defineProperty(qw.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in xw))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),qw.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?Fw[e]:e},Object.defineProperty(qw.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(qw.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),qw.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,pw([this,xw.DEBUG],e)),this._logHandler.apply(this,pw([this,xw.DEBUG],e))},qw.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,pw([this,xw.VERBOSE],e)),this._logHandler.apply(this,pw([this,xw.VERBOSE],e))},qw.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,pw([this,xw.INFO],e)),this._logHandler.apply(this,pw([this,xw.INFO],e))},qw.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,pw([this,xw.WARN],e)),this._logHandler.apply(this,pw([this,xw.WARN],e))},qw.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,pw([this,xw.ERROR],e)),this._logHandler.apply(this,pw([this,xw.ERROR],e))},qw);function qw(e){this.name=e,this._logLevel=Uw,this._logHandler=Lw,this._userLogHandler=null}const Vw=new dr("@firebase/database-compat"),Bw=function(e){e="FIREBASE WARNING: "+e;Vw.warn(e)};class $w{constructor(e){this._delegate=e}cancel(t){Tw("OnDisconnect.cancel",0,1,arguments.length),kw("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){Tw("OnDisconnect.remove",0,1,arguments.length),kw("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){Tw("OnDisconnect.set",1,2,arguments.length),kw("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){Tw("OnDisconnect.setWithPriority",2,3,arguments.length),kw("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(Tw("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,Bw("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}kw("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class zw{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Tw("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class Ww{constructor(e,t){this._database=e,this._delegate=t}val(){return Tw("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Tw("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Tw("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Tw("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Tw("DataSnapshot.child",0,1,arguments.length),e=String(e),Ov("DataSnapshot.child","path",e,!1),new Ww(this._database,this._delegate.child(e))}hasChild(e){return Tw("DataSnapshot.hasChild",1,1,arguments.length),Ov("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Tw("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return Tw("DataSnapshot.forEach",1,1,arguments.length),kw("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new Ww(this._database,e)))}hasChildren(){return Tw("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Tw("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Tw("DataSnapshot.ref",0,0,arguments.length),new Hw(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class Kw{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){Tw("Query.on",2,4,arguments.length),kw("Query.on","callback",n,!1);const i=Kw.getCancelAndContextArgs_("Query.on",t,r);var s=(e,t)=>{n.call(i.context,new Ww(this.database,e),t)};s.userCallback=n,s.context=i.context;var o=null===(r=i.cancel)||void 0===r?void 0:r.bind(i.context);switch(e){case"value":return x_(this._delegate,s,o),n;case"child_added":return D_(this._delegate,s,o),n;case"child_removed":return F_(this._delegate,s,o),n;case"child_changed":return M_(this._delegate,s,o),n;case"child_moved":return L_(this._delegate,s,o),n;default:throw new Error(Sw("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;Tw("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Sw(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),kw("Query.off","callback",t,!0),Cw("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,U_(this._delegate,e,r)):U_(this._delegate,e)}get(){return R_(this._delegate).then(e=>new Ww(this.database,e))}once(e,n,t,r){Tw("Query.once",1,4,arguments.length),kw("Query.once","callback",n,!0);const i=Kw.getCancelAndContextArgs_("Query.once",t,r),s=new gw;var o=(e,t)=>{e=new Ww(this.database,e);n&&n.call(i.context,e,t),s.resolve(e)};o.userCallback=n,o.context=i.context;var a=e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)};switch(e){case"value":x_(this._delegate,o,a,{onlyOnce:!0});break;case"child_added":D_(this._delegate,o,a,{onlyOnce:!0});break;case"child_removed":F_(this._delegate,o,a,{onlyOnce:!0});break;case"child_changed":M_(this._delegate,o,a,{onlyOnce:!0});break;case"child_moved":L_(this._delegate,o,a,{onlyOnce:!0});break;default:throw new Error(Sw("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return Tw("Query.limitToFirst",1,1,arguments.length),new Kw(this.database,J_(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new z_(e)}(e)))}limitToLast(e){return Tw("Query.limitToLast",1,1,arguments.length),new Kw(this.database,J_(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new W_(e)}(e)))}orderByChild(e){return Tw("Query.orderByChild",1,1,arguments.length),new Kw(this.database,J_(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ov("orderByChild","path",e,!1),new K_(e)}(e)))}orderByKey(){return Tw("Query.orderByKey",0,0,arguments.length),new Kw(this.database,J_(this._delegate,new H_))}orderByPriority(){return Tw("Query.orderByPriority",0,0,arguments.length),new Kw(this.database,J_(this._delegate,new G_))}orderByValue(){return Tw("Query.orderByValue",0,0,arguments.length),new Kw(this.database,J_(this._delegate,new Q_))}startAt(e=null,t){return Tw("Query.startAt",0,2,arguments.length),new Kw(this.database,J_(this._delegate,([e=null,t]=[e,t],Pv("startAt","key",t,!0),new B_(e,t))))}startAfter(e=null,t){return Tw("Query.startAfter",0,2,arguments.length),new Kw(this.database,J_(this._delegate,(e=e,t=t,Pv("startAfter","key",t,!0),new $_(e,t))))}endAt(e=null,t){return Tw("Query.endAt",0,2,arguments.length),new Kw(this.database,J_(this._delegate,(e=e,t=t,Pv("endAt","key",t,!0),new q_(e,t))))}endBefore(e=null,t){return Tw("Query.endBefore",0,2,arguments.length),new Kw(this.database,J_(this._delegate,(e=e,t=t,Pv("endBefore","key",t,!0),new V_(e,t))))}equalTo(e,t){return Tw("Query.equalTo",1,2,arguments.length),new Kw(this.database,J_(this._delegate,(e=e,t=t,Pv("equalTo","key",t,!0),new Y_(e,t))))}toString(){return Tw("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Tw("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Tw("Query.isEqual",1,1,arguments.length),e instanceof Kw)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,kw(e,"cancel",r.cancel,!0),r.context=n,Cw(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Sw(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new Hw(this.database,new I_(this._delegate._repo,this._delegate._path))}}class Hw extends Kw{constructor(e,t){super(e,new v_(t._repo,t._path,new hm,!1)),this.database=e,this._delegate=t}getKey(){return Tw("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Tw("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new Hw(this.database,k_(this._delegate,e))}getParent(){Tw("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new Hw(this.database,e):null}getRoot(){return Tw("Reference.root",0,0,arguments.length),new Hw(this.database,this._delegate.root)}set(e,t){Tw("Reference.set",1,2,arguments.length),kw("Reference.set","onComplete",t,!0);const n=C_(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(Tw("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,Bw("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Dv("Reference.update",this._delegate._path),kw("Reference.update","onComplete",n,!0);const e=A_(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){Tw("Reference.setWithPriority",2,3,arguments.length),kw("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(Dv("setWithPriority",e._path),Cv("setWithPriority",t,e._path,!1),Nv("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new us;return Jv(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){Tw("Reference.remove",0,1,arguments.length),kw("Reference.remove","onComplete",t,!0);const e=(n=this._delegate,Dv("remove",n._path),C_(n,null));var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){Tw("Reference.transaction",1,3,arguments.length),kw("Reference.transaction","transactionUpdate",e,!1),kw("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Sw(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=cw(this._delegate,e,{applyLocally:n}).then(e=>new zw(e.committed,new Ww(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){Tw("Reference.setPriority",1,2,arguments.length),kw("Reference.setPriority","onComplete",t,!0);const n=function(e,t){e=to(e),Dv("setPriority",e._path),Nv("setPriority",t,!1);const n=new us;return Jv(e._repo,hg(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){Tw("Reference.push",0,2,arguments.length),kw("Reference.push","onComplete",t,!0);const n=function(e,t){e=to(e),Dv("push",e._path),Cv("push",t,e._path,!0);var n=Wv(e._repo),n=tm(n);const r=k_(e,n),i=k_(e,n);let s;return s=null!=t?C_(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new Hw(this.database,e));t&&r.then(()=>t(null),e=>t(e));const i=new Hw(this.database,n);return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return Dv("Reference.onDisconnect",this._delegate._path),new $w(new y_(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class Gw{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete()}}useEmulator(e,t,n={}){rw(this._delegate,e,t,n)}ref(e){if(Tw("database.ref",0,1,arguments.length),e instanceof Hw){var t=S_(this._delegate,e.toString());return new Hw(this,t)}e=E_(this._delegate,e);return new Hw(this,e)}refFromURL(e){Tw("database.refFromURL",1,1,arguments.length);e=S_(this._delegate,e);return new Hw(this,e)}goOffline(){var e;Tw("database.goOffline",0,0,arguments.length),(e=to(e=this._delegate))._checkNotDeleted("goOffline"),t_(e._repo)}goOnline(){return Tw("database.goOnline",0,0,arguments.length),iw(this._delegate)}}Gw.ServerValue={TIMESTAMP:ow,increment:e=>({".sv":{increment:e}})};var Qw,Yw=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){Hf(n);const o=new Pw("auth-internal",new Dw("database-standalone"));return o.setComponent(new Aw("auth-internal",()=>r,"PRIVATE")),{instance:new Gw(tw(e,o,void 0,t,s),e),namespace:i}}});const Jw=Gw.ServerValue;(Qw=Wo).INTERNAL.registerComponent(new Aw("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("database").getImmediate({identifier:t});return new Gw(t,n)},"PUBLIC").setServiceProps({Reference:Hw,Query:Kw,Database:Gw,DataSnapshot:Ww,enableLogging:sw,INTERNAL:Yw,ServerValue:Jw}).setMultipleInstances(!0)),Qw.registerVersion("@firebase/database-compat","0.1.0-2021720181311");var Xw=function(e,t){return(Xw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function Zw(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var G="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},eb={},tb=G||self;function nb(){}function rb(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function ib(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var sb="closure_uid_"+(1e9*Math.random()>>>0),ob=0;function ab(e,t,n){return e.call.apply(e.bind,arguments)}function cb(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function lb(e,t,n){return(lb=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ab:cb).apply(null,arguments)}function ub(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function hb(e,s){function t(){}t.prototype=s.prototype,e.Z=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Vb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function db(){this.s=this.s,this.o=this.o}var fb={};db.prototype.s=!1,db.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,e=Object.prototype.hasOwnProperty.call(e,sb)&&e[sb]||(e[sb]=++ob),delete fb[e])},db.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var pb=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},gb=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"==typeof e?e.split(""):e,s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function mb(){return Array.prototype.concat.apply([],arguments)}function yb(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function vb(e){return/^[\s\xa0]*$/.test(e)}var _b,wb=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function bb(e,t){return-1!=e.indexOf(t)}function Ib(e,t){return e<t?-1:t<e?1:0}e:{var Tb=tb.navigator;if(Tb){Tb=Tb.userAgent;if(Tb){_b=Tb;break e}}_b=""}function Eb(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function Sb(e){var t,n={};for(t in e)n[t]=e[t];return n}var kb="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Cb(e){for(var t,n,r=1;r<arguments.length;r++){for(t in n=arguments[r])e[t]=n[t];for(var i=0;i<kb.length;i++)t=kb[i],Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}}function Ab(e){return Ab[" "](e),e}Ab[" "]=nb;var Rb,Nb=bb(_b,"Opera"),Pb=bb(_b,"Trident")||bb(_b,"MSIE"),Ob=bb(_b,"Edge"),xb=Ob||Pb,Db=bb(_b,"Gecko")&&!(bb(_b.toLowerCase(),"webkit")&&!bb(_b,"Edge"))&&!(bb(_b,"Trident")||bb(_b,"MSIE"))&&!bb(_b,"Edge"),Mb=bb(_b.toLowerCase(),"webkit")&&!bb(_b,"Edge");function Lb(){var e=tb.document;return e?e.documentMode:void 0}e:{var Fb="",Ub=(Ub=_b,Db?/rv:([^\);]+)(\)|;)/.exec(Ub):Ob?/Edge\/([\d\.]+)/.exec(Ub):Pb?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Ub):Mb?/WebKit\/(\S+)/.exec(Ub):Nb?/(?:Version)[ \/]?(\S+)/.exec(Ub):void 0);if(Ub&&(Fb=Ub?Ub[1]:""),Pb){Ub=Lb();if(null!=Ub&&Ub>parseFloat(Fb)){Rb=String(Ub);break e}}Rb=Fb}var jb={};function qb(){return e=function(){for(var e=0,t=wb(String(Rb)).split("."),n=wb("9").split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++)for(var s=t[i]||"",o=n[i]||"";s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],(0!=s[0].length||0!=o[0].length)&&(e=Ib(0==s[1].length?0:parseInt(s[1],10),0==o[1].length?0:parseInt(o[1],10))||Ib(0==s[2].length,0==o[2].length)||Ib(s[2],o[2]),s=s[3],o=o[3],0==e););return 0<=e},t=jb,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9);var e,t}var Vb=tb.document&&Pb&&(Lb()||parseInt(Rb,10))||void 0,Bb=function(){if(!tb.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{tb.addEventListener("test",nb,t),tb.removeEventListener("test",nb,t)}catch(e){}return e}();function $b(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function zb(e,t){if($b.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Db){e:{try{Ab(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Wb[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&zb.Z.h.call(this)}}$b.prototype.h=function(){this.defaultPrevented=!0},hb(zb,$b);var Wb={2:"touch",3:"pen",4:"mouse"};zb.prototype.h=function(){zb.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Kb="closure_listenable_"+(1e6*Math.random()|0),Hb=0;function Gb(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++Hb,this.ca=this.fa=!1}function Qb(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function Yb(e){this.src=e,this.g={},this.h=0}function Jb(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=pb(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(Qb(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function Xb(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}Yb.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Xb(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new Gb(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var Zb="closure_lm_"+(1e6*Math.random()|0),eI={};function tI(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}r=cI(r);return t&&t[Kb]?t.O(n,r,ib(i)?!!i.capture:!!i,s):nI(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)tI(e,t[s],n,r,i);return null}return n=cI(n),e&&e[Kb]?e.N(t,n,ib(r)?!!r.capture:!!r,i):nI(e,t,n,!1,r,i)}function nI(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o,a=ib(i)?!!i.capture:!!i,c=oI(e);if(c||(e[Zb]=c=new Yb(e)),(n=c.add(t,n,r,a,s)).proxy)return n;if(o=sI,(n.proxy=r=function e(t){return o.call(e.src,e.listener,t)}).src=e,r.listener=n,e.addEventListener)void 0===(i=!Bb?a:i)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(iI(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function rI(e){var t,n,r;"number"!=typeof e&&e&&!e.ca&&((t=e.src)&&t[Kb]?Jb(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(iI(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=oI(t))?(Jb(n,e),0==n.h&&(n.src=null,t[Zb]=null)):Qb(e)))}function iI(e){return e in eI?eI[e]:eI[e]="on"+e}function sI(e,t){var n,r;return e=!!e.ca||(t=new zb(t,this),n=e.listener,r=e.ia||e.src,e.fa&&rI(e),n.call(r,t))}function oI(e){return(e=e[Zb])instanceof Yb?e:null}var aI="__closure_events_fn_"+(1e9*Math.random()>>>0);function cI(t){return"function"==typeof t?t:(t[aI]||(t[aI]=function(e){return t.handleEvent(e)}),t[aI])}function lI(){db.call(this),this.i=new Yb(this),(this.P=this).I=null}function uI(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new $b(t,e):t instanceof $b?t.target=t.target||e:(o=t,Cb(t=new $b(r,e),o)),o=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],o=hI(s,r,!0,t)&&o;if(o=hI(s=t.g=e,r,!0,t)&&o,o=hI(s,r,!1,t)&&o,n)for(i=0;i<n.length;i++)o=hI(s=t.g=n[i],r,!1,t)&&o}function hI(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o,a,c=t[s];c&&!c.ca&&c.capture==n&&(o=c.listener,a=c.ia||c.src,c.fa&&Jb(e.i,c),i=!1!==o.call(a,r)&&i)}return i&&!r.defaultPrevented}hb(lI,db),lI.prototype[Kb]=!0,lI.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else i=ib(i)?!!i.capture:!!i,r=cI(r),t&&t[Kb]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=Xb(o=t.g[n],r,i,s))&&(Qb(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete t.g[n],t.h--))):(t=t&&oI(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?Xb(n,r,i,s):t)?n[t]:null)&&rI(r))}(this,e,t,n,r)},lI.prototype.M=function(){if(lI.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Qb(n[r]);delete t.g[e],t.h--}}this.I=null},lI.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},lI.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var dI=tb.JSON.stringify;fI.prototype.add=function(e,t){var n=pI.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n},H=fI;function fI(){this.h=this.g=null}var pI=(gI.prototype.get=function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e},new gI(function(){return new yI},function(e){return e.reset()}));function gI(e,t){this.i=e,this.j=t,this.h=0,this.g=null}var mI,yI=(vI.prototype.set=function(e,t){this.h=e,this.g=t,this.next=null},vI.prototype.reset=function(){this.next=this.g=this.h=null},vI);function vI(){this.next=this.g=this.h=null}function _I(e,t){var n;mI||(n=tb.Promise.resolve(void 0),mI=function(){n.then(II)}),wI||(mI(),wI=!0),bI.add(e,t)}var wI=!1,bI=new H;function II(){for(var e;t=e=void 0,t=null,(e=bI).g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),e=t;){try{e.h.call(e.g)}catch(e){!function(e){tb.setTimeout(function(){throw e},0)}(e)}var t=pI;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}wI=!1}function TI(e,t){lI.call(this),this.h=e||1,this.g=t||tb,this.j=lb(this.kb,this),this.l=Date.now()}function EI(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function SI(e,t,n){if("function"==typeof e)n&&(e=lb(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=lb(e.handleEvent,e)}return 2147483647<Number(t)?-1:tb.setTimeout(e,t||0)}hb(TI,lI),(qi=TI.prototype).da=!1,qi.S=null,qi.kb=function(){var e;this.da&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),uI(this,"tick"),this.da&&(EI(this),this.start())))},qi.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},qi.M=function(){TI.Z.M.call(this),EI(this),delete this.g};var kI,CI=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Xw(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(AI,kI=db),AI.prototype.l=function(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=SI(function(){t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)},AI.prototype.M=function(){kI.prototype.M.call(this),this.g&&(tb.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},AI);function AI(e,t){var n=kI.call(this)||this;return n.m=e,n.j=t,n.h=null,n.i=!1,n.g=null,n}function RI(e){db.call(this),this.h=e,this.g={}}hb(RI,db);var NI=[];function PI(e,t,n,r){Array.isArray(n)||(n&&(NI[0]=n.toString()),n=NI);for(var i=0;i<n.length;i++){var s=tI(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function OI(e){Eb(e.g,function(e,t){this.g.hasOwnProperty(t)&&rI(e)},e),e.g={}}function xI(){this.g=!0}function DI(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return dI(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}RI.prototype.M=function(){RI.Z.M.call(this),OI(this)},RI.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},xI.prototype.Aa=function(){this.g=!1},xI.prototype.info=function(){};var MI={},LI=null;function FI(){return LI=LI||new lI}function UI(e){$b.call(this,MI.Ma,e)}function jI(){var e=FI();uI(e,new UI(e))}function qI(e,t){$b.call(this,MI.STAT_EVENT,e),this.stat=t}function VI(e){var t=FI();uI(t,new qI(t,e))}function BI(e,t){$b.call(this,MI.Na,e),this.size=t}function $I(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return tb.setTimeout(function(){e()},t)}MI.Ma="serverreachability",hb(UI,$b),MI.STAT_EVENT="statevent",hb(qI,$b),MI.Na="timingevent",hb(BI,$b);dr={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},G={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function zI(){}function WI(e){return e.h||(e.h=e.i())}function KI(){}zI.prototype.h=null;H={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function HI(){$b.call(this,"d")}function GI(){$b.call(this,"c")}function QI(){}function YI(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new RI(this),this.P=ZI,this.W=new TI(e=xb?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new JI}function JI(){this.i=null,this.g="",this.h=!1}hb(HI,$b),hb(GI,$b),hb(QI,zI),QI.prototype.g=function(){return new XMLHttpRequest},QI.prototype.i=function(){return{}};var XI=new QI,ZI=45e3,e0={},t0={};function n0(e,t,n){e.K=1,e.v=E0(v0(t)),e.s=n,e.U=!0,r0(e,null)}function r0(e,t){e.F=Date.now(),o0(e),e.A=v0(e.v);var o,a,c,l,u,h,n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),F0(n.h,"t",r),e.C=0,n=e.l.H,e.h=new JI,e.g=UT(e.l,n?t:null,!e.s),0<e.O&&(e.L=new CI(lb(e.Ia,e,e.g),e.O)),PI(e.V,e.g,"readystatechange",e.gb),t=e.H?Sb(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),jI(),o=e.j,a=e.u,c=e.A,l=e.m,u=e.X,h=e.s,o.info(function(){if(o.g)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+l+") [attempt "+u+"]: "+a+"\n"+c+"\n"+e})}function i0(e){return e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function s0(e,t,n){for(var r,i,s,o,a,c=!0;!e.I&&e.C<n.length;){if(s=n,a=o=void 0,o=(i=e).C,(r=-1==(a=s.indexOf("\n",o))?t0:(o=Number(s.substring(o,a)),isNaN(o)?e0:(a+=1)+o>s.length?t0:(s=s.substr(a,o),i.C=a+o,s)))==t0){4==t&&(e.o=4,VI(14),c=!1),DI(e.j,e.m,null,"[Incomplete Response]");break}if(r==e0){e.o=4,VI(15),DI(e.j,e.m,n,"[Invalid Chunk]"),c=!1;break}DI(e.j,e.m,r,null),h0(e,r)}i0(e)&&r!=t0&&r!=e0&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,VI(16),c=!1),e.i=e.i&&c,c?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),NT(t),t.L=!0,VI(11))):(DI(e.j,e.m,n,"[Invalid Chunked Response]"),u0(e),l0(e))}function o0(e){e.Y=Date.now()+e.P,a0(e,e.P)}function a0(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=$I(lb(e.eb,e),t)}function c0(e){e.B&&(tb.clearTimeout(e.B),e.B=null)}function l0(e){0==e.l.G||e.I||xT(e.l,e)}function u0(e){c0(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,EI(e.W),OI(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function h0(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||W0(n.i,e)))if(n.I=e.N,!e.J&&W0(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(g){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;OT(n),bT(n)}RT(n),VI(18)}}else n.ta=i[1],0<n.ta-n.U&&i[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=$I(lb(n.ab,n),6e3));if(z0(n.i)<=1&&n.ka){try{n.ka()}catch(g){}n.ka=void 0}}else MT(n,11)}else if(!e.J&&n.g!=e||OT(n),!vb(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var s,o,a,c,l,u,h,d,f,p,g=i[t];n.U=g[0],g=g[1],2==n.G?"c"==g[0]?(n.J=g[1],n.la=g[2],null!=(s=g[3])&&(n.ma=s,n.h.info("VER="+n.ma)),null!=(o=g[4])&&(n.za=o,n.h.info("SVER="+n.za)),null!=(a=g[5])&&"number"==typeof a&&0<a&&(r=1.5*a,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n,(c=e.g)&&(!(l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(u=r.i).g&&(bb(l,"spdy")||bb(l,"quic")||bb(l,"h2"))&&(u.j=u.l,u.g=new Set,u.h&&(K0(u,u.h),u.h=null)),!r.D||(h=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=h,T0(r.F,r.D,h))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms")),d=e,(r=n).oa=FT(r,r.H?r.la:null,r.W),d.J?(H0(r.i,d),f=d,(p=r.K)&&f.setTimeout(p),f.B&&(c0(f),o0(f)),r.g=d):AT(r),0<n.l.length&&ET(n)):"stop"!=g[0]&&"close"!=g[0]||MT(n,7):3==n.G&&("stop"==g[0]||"close"==g[0]?"stop"==g[0]?MT(n,7):wT(n):"noop"!=g[0]&&n.j&&n.j.wa(g),n.A=0)}jI()}catch(g){}}function d0(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(rb(e)||"string"==typeof e)gb(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(rb(e)||"string"==typeof e)for(var n=[],r=e.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,e)n[r++]=i;for(var i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(rb(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function f0(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof f0)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function p0(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];g0(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){for(var i={},n=t=0;t<e.g.length;)g0(i,r=e.g[t])||(i[e.g[n++]=r]=1),t++;e.g.length=n}}function g0(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(qi=YI.prototype).setTimeout=function(e){this.P=e},qi.gb=function(e){e=e.target;var t=this.L;t&&3==gT(e)?t.l():this.Ia(e)},qi.Ia=function(e){try{if(e==this.g)e:{var t=gT(this.g),n=this.g.Da();this.g.ba();if(!(t<3)&&(3!=t||xb||this.g&&(this.h.h||this.g.ga()||mT(this.g)))){this.I||4!=t||7==n||jI(),c0(this);var r=this.g.ba();this.N=r;t:if(i0(this)){var i=mT(this.g);e="";var s=i.length,o=4==gT(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){u0(this),l0(this);var a="";break t}this.h.i=new tb.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:o&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,h=this.j,d=this.u,f=this.A,p=this.m,g=this.X,m=t,y=r,h.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+g+"]: "+d+"\n"+f+"\n"+m+" "+y}),this.i){if(this.$&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!vb(c)){var u=c;break t}}u=null}if(!(r=u)){this.i=!1,this.o=3,VI(12),u0(this),l0(this);break e}DI(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,h0(this,r)}this.U?(s0(this,t,a),xb&&this.i&&3==t&&(PI(this.V,this.W,"tick",this.fb),this.W.start())):(DI(this.j,this.m,a,null),h0(this,a)),4==t&&u0(this),this.i&&!this.I&&(4==t?xT(this.l,this):(this.i=!1,o0(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,VI(12)):(this.o=0,VI(13)),u0(this),l0(this)}}}catch(t){}var h,d,f,p,g,m,y},qi.fb=function(){var e,t;this.g&&(e=gT(this.g),t=this.g.ga(),this.C<t.length&&(c0(this),s0(this,e,t),this.i&&4!=e&&o0(this)))},qi.cancel=function(){this.I=!0,u0(this)},qi.eb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(jI(),VI(17)),u0(this),this.o=2,l0(this)):a0(this,this.Y-n)},(qi=f0.prototype).R=function(){p0(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},qi.T=function(){return p0(this),this.g.concat()},qi.get=function(e,t){return g0(this.h,e)?this.h[e]:t},qi.set=function(e,t){g0(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},qi.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var m0=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function y0(e,t){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof y0?(this.g=void 0!==t?t:e.g,_0(this,e.j),this.s=e.s,w0(this,e.i),b0(this,e.m),this.l=e.l,t=e.h,(n=new x0).i=t.i,t.g&&(n.g=new f0(t.g),n.h=t.h),I0(this,n),this.o=e.o):e&&(n=String(e).match(m0))?(this.g=!!t,_0(this,n[1]||"",!0),this.s=S0(n[2]||""),w0(this,n[3]||"",!0),b0(this,n[4]),this.l=S0(n[5]||"",!0),I0(this,n[6]||"",!0),this.o=S0(n[7]||"")):(this.g=!!t,this.h=new x0(null,this.g))}function v0(e){return new y0(e)}function _0(e,t,n){e.j=n?S0(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function w0(e,t,n){e.i=n?S0(t,!0):t}function b0(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function I0(e,t,n){var r,i;t instanceof x0?(e.h=t,r=e.h,(i=e.g)&&!r.j&&(D0(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(M0(this,t),F0(this,n,e))},r)),r.j=i):(n||(t=k0(t,P0)),e.h=new x0(t,e.g))}function T0(e,t,n){e.h.set(t,n)}function E0(e){return T0(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function S0(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function k0(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,C0),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function C0(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}y0.prototype.toString=function(){var e=[],t=this.j;t&&e.push(k0(t,A0,!0),":");var n=this.i;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(k0(t,A0,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(k0(n,"/"==n.charAt(0)?N0:R0,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",k0(n,O0)),e.join("")};var A0=/[#\/\?@]/g,R0=/[#\?:]/g,N0=/[#\?]/g,P0=/[#\?@]/g,O0=/#/g;function x0(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function D0(n){n.g||(n.g=new f0,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),s=null;0<=i?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function M0(e,t){D0(e),t=U0(e,t),g0(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,g0((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&p0(e)))}function L0(e,t){return D0(e),t=U0(e,t),g0(e.g.h,t)}function F0(e,t,n){M0(e,t),0<n.length&&(e.i=null,e.g.set(U0(e,t),yb(n)),e.h+=n.length)}function U0(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(qi=x0.prototype).add=function(e,t){D0(this),this.i=null,e=U0(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},qi.forEach=function(n,r){D0(this),this.g.forEach(function(e,t){gb(e,function(e){n.call(r,e,t,this)},this)},this)},qi.T=function(){D0(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},qi.R=function(e){D0(this);var t=[];if("string"==typeof e)L0(this,e)&&(t=mb(t,this.g.get(U0(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=mb(t,e[n])}return t},qi.set=function(e,t){return D0(this),this.i=null,L0(this,e=U0(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},qi.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},qi.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),r=this.R(r),s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}return this.i=e.join("&")};var j0=function(e,t){this.h=e,this.g=t};function q0(e){this.l=e||B0,e=tb.PerformanceNavigationTiming?0<(e=tb.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(tb.g&&tb.g.Ea&&tb.g.Ea()&&tb.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var V0,B0=10;function $0(e){return e.h||e.g&&e.g.size>=e.j}function z0(e){return e.h?1:e.g?e.g.size:0}function W0(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function K0(e,t){e.g?e.g.add(t):e.h=t}function H0(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function G0(e){var t,n;if(null!=e.h)return e.i.concat(e.h.D);if(null==e.g||0===e.g.size)return yb(e.i);var r=e.i;try{for(var i=Zw(e.g.values()),s=i.next();!s.done;s=i.next())var o=s.value,r=r.concat(o.D)}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function Q0(){}function Y0(){this.g=new Q0}function J0(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function X0(e){this.l=e.$b||null,this.j=e.ib||!1}function Z0(e,t){lI.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=eT,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}q0.prototype.cancel=function(){var t,e;if(this.i=G0(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=Zw(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},Q0.prototype.stringify=function(e){return tb.JSON.stringify(e,void 0)},Q0.prototype.parse=function(e){return tb.JSON.parse(e,void 0)},hb(X0,zI),X0.prototype.g=function(){return new Z0(this.l,this.j)},X0.prototype.i=(V0={},function(){return V0}),hb(Z0,lI);var eT=0;function tT(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function nT(e){e.readyState=4,e.l=null,e.j=null,e.A=null,rT(e)}function rT(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(qi=Z0.prototype).open=function(e,t){if(this.readyState!=eT)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,rT(this)},qi.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||tb).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},qi.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,nT(this)),this.readyState=eT},qi.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,rT(this)),this.g&&(this.readyState=3,rT(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==tb.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;tT(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},qi.Sa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?nT:rT)(this),3==this.readyState&&tT(this))},qi.Ua=function(e){this.g&&(this.response=this.responseText=e,nT(this))},qi.Ta=function(e){this.g&&(this.response=e,nT(this))},qi.ha=function(){this.g&&nT(this)},qi.setRequestHeader=function(e,t){this.v.append(e,t)},qi.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},qi.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Z0.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var iT=tb.JSON.parse;function sT(e){lI.call(this),this.headers=new f0,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=oT,this.K=this.L=!1}hb(sT,lI);var oT="",aT=/^https?$/i,cT=["POST","PUT"];function lT(e){return"content-type"==e.toLowerCase()}function uT(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,hT(e),fT(e)}function hT(e){e.D||(e.D=!0,uI(e,"complete"),uI(e,"error"))}function dT(e){if(e.h&&void 0!==eb&&(!e.C[1]||4!=gT(e)||2!=e.ba()))if(e.v&&4==gT(e))SI(e.Fa,0,e);else if(uI(e,"readystatechange"),4==gT(e)){e.h=!1;try{var t,n,r,i,s=e.ba();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break e;default:o=!1}if((t=o)||((n=0===s)&&(!(i=String(e.H).match(m0)[1]||null)&&tb.self&&tb.self.location&&(i=(r=tb.self.location.protocol).substr(0,r.length-1)),n=!aT.test(i?i.toLowerCase():"")),t=n),t)uI(e,"complete"),uI(e,"success");else{e.m=6;try{var a=2<gT(e)?e.g.statusText:""}catch(e){a=""}e.j=a+" ["+e.ba()+"]",hT(e)}}finally{fT(e)}}}function fT(e,t){if(e.g){pT(e);var n=e.g,r=e.C[0]?nb:null;e.g=null,e.C=null,t||uI(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function pT(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(tb.clearTimeout(e.A),e.A=null)}function gT(e){return e.g?e.g.readyState:0}function mT(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case oT:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function yT(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}var i;r||(i="",Eb(n,function(e,t){i+=t,i+=":",i+=e,i+="\r\n"}),n=i,"string"==typeof e?null!=n&&encodeURIComponent(String(n)):T0(e,t,n))}function vT(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function _T(e){this.za=0,this.l=[],this.h=new xI,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=vT("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=vT("baseRetryDelayMs",5e3,e),this.$a=vT("retryDelaySeedMs",1e4,e),this.Ya=vT("forwardChannelMaxRetries",2,e),this.ra=vT("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new q0(e&&e.concurrentRequestLimit),this.Ca=new Y0,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function wT(e){var t,n;IT(e),3==e.G&&(t=e.V++,T0(n=v0(e.F),"SID",e.J),T0(n,"RID",t),T0(n,"TYPE","terminate"),kT(e,n),(t=new YI(e,e.h,t,void 0)).K=2,t.v=E0(v0(n)),n=!1,!(n=tb.navigator&&tb.navigator.sendBeacon?tb.navigator.sendBeacon(t.v.toString(),""):n)&&tb.Image&&((new Image).src=t.v,n=!0),n||(t.g=UT(t.l,null),t.g.ea(t.v)),t.F=Date.now(),o0(t)),LT(e)}function bT(e){e.g&&(NT(e),e.g.cancel(),e.g=null)}function IT(e){bT(e),e.u&&(tb.clearTimeout(e.u),e.u=null),OT(e),e.i.cancel(),e.m&&("number"==typeof e.m&&tb.clearTimeout(e.m),e.m=null)}function TT(e,t){e.l.push(new j0(e.Za++,t)),3==e.G&&ET(e)}function ET(e){$0(e.i)||e.m||(e.m=!0,_I(e.Ha,e),e.C=0)}function ST(e,t){var n=t?t.m:e.V++,r=v0(e.F);T0(r,"SID",e.J),T0(r,"RID",n),T0(r,"AID",e.U),kT(e,r),e.o&&e.s&&yT(r,e.o,e.s),n=new YI(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=CT(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),K0(e.i,n),n0(n,r,t)}function kT(e,n){e.j&&d0({},function(e,t){T0(n,t,e)})}function CT(e,t,n){n=Math.min(e.l.length,n);var r=e.j?lb(e.j.Oa,e.j,e):null;e:for(var i=e.l,s=-1;;){var o=["count="+n];-1==s?0<n?(s=i[0].h,o.push("ofs="+s)):s=0:o.push("ofs="+s);for(var a=!0,c=0;c<n;c++){var l=i[c].h,u=i[c].g;if((l-=s)<0)s=Math.max(0,i[c].h-100),a=!1;else try{!function(e,r,t){var i=t||"";try{d0(e,function(e,t){var n=e;ib(e)&&(n=dI(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(u,o,"req"+l+"_")}catch(e){r&&r(u)}}if(a){r=o.join("&");break e}}return e=e.l.splice(0,n),t.D=e,r}function AT(e){e.g||e.u||(e.Y=1,_I(e.Ga,e),e.A=0)}function RT(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=$I(lb(e.Ga,e),DT(e,e.A)),e.A++,1)}function NT(e){null!=e.B&&(tb.clearTimeout(e.B),e.B=null)}function PT(e){e.g=new YI(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=v0(e.oa);T0(t,"RID","rpc"),T0(t,"SID",e.J),T0(t,"CI",e.N?"0":"1"),T0(t,"AID",e.U),kT(e,t),T0(t,"TYPE","xmlhttp"),e.o&&e.s&&yT(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=E0(v0(t)),n.s=null,n.U=!0,r0(n,e)}function OT(e){null!=e.v&&(tb.clearTimeout(e.v),e.v=null)}function xT(e,t){var n,r,i,s=null;if(e.g==t){OT(e),NT(e),e.g=null;var o=2}else{if(!W0(e.i,t))return;s=t.D,H0(e.i,t),o=1}if(e.I=t.N,0!=e.G)if(t.i)1==o?(s=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,uI(o=FI(),new BI(o,s)),ET(e)):AT(e);else if(3==(n=t.o)||0==n&&0<e.I||(1!=o||(i=t,z0((r=e).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=i.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=$I(lb(r.Ha,r,i),DT(r,r.C)),r.C++,0))))&&(2!=o||!RT(e)))switch(s&&0<s.length&&(t=e.i,t.i=t.i.concat(s)),n){case 1:MT(e,5);break;case 4:MT(e,10);break;case 3:MT(e,6);break;default:MT(e,2)}}function DT(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function MT(e,t){var n,r,i,s;e.h.info("Error code "+t),2==t?(r=null,e.j&&(r=null),s=lb(e.jb,e),r||(r=new y0("//www.google.com/images/cleardot.gif"),tb.location&&"http"==tb.location.protocol||_0(r,"https"),E0(r)),n=r.toString(),r=s,s=new xI,tb.Image?((i=new Image).onload=ub(J0,s,i,"TestLoadImage: loaded",!0,r),i.onerror=ub(J0,s,i,"TestLoadImage: error",!1,r),i.onabort=ub(J0,s,i,"TestLoadImage: abort",!1,r),i.ontimeout=ub(J0,s,i,"TestLoadImage: timeout",!1,r),tb.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):VI(2),e.G=0,e.j&&e.j.va(t),LT(e),IT(e)}function LT(e){e.G=0,e.I=-1,e.j&&(0==G0(e.i).length&&0==e.l.length||(e.i.i.length=0,yb(e.l),e.l.length=0),e.j.ua())}function FT(e,t,n){var r,i,s,o,a,c=(o=n)instanceof y0?v0(o):new y0(o,void 0);return""!=c.i?(t&&w0(c,t+"."+c.i),b0(c,c.m)):(a=tb.location,r=a.protocol,i=t?t+"."+a.hostname:a.hostname,s=+a.port,o=n,a=new y0(null,void 0),r&&_0(a,r),i&&w0(a,i),s&&b0(a,s),o&&(a.l=o),c=a),e.aa&&Eb(e.aa,function(e,t){T0(c,t,e)}),t=e.D,n=e.sa,t&&n&&T0(c,t,n),T0(c,"VER",e.ma),kT(e,c),c}function UT(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new sT(new X0({ib:!0})):new sT(e.qa)).L=e.H,t}function jT(){}function qT(){if(Pb&&!(10<=Number(Vb)))throw Error("Environmental error: no available transport.")}function VT(e,t){lI.call(this),this.g=new _T(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!vb(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!vb(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new zT(this)}function BT(e){HI.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function $T(){GI.call(this),this.status=1}function zT(e){this.g=e}(qi=sT.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||XI).g(),this.C=this.u?WI(this.u):WI(XI),this.g.onreadystatechange=lb(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void uT(this,e)}e=n||"";var i,s=new f0(this.headers);r&&d0(r,function(e,t){s.set(t,e)}),r=function(e){e:{for(var t=lT,n=e.length,r="string"==typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return t<0?null:"string"==typeof e?e.charAt(t):e[t]}(s.T()),n=tb.FormData&&e instanceof tb.FormData,0<=pb(cT,t)&&!r&&!n&&s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{pT(this),0<this.B&&((this.K=(i=this.g,Pb&&qb()&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=lb(this.pa,this)):this.A=SI(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){uT(this,e)}},qi.pa=function(){void 0!==eb&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,uI(this,"timeout"),this.abort(8))},qi.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,uI(this,"complete"),uI(this,"abort"),fT(this))},qi.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),fT(this,!0)),sT.Z.M.call(this)},qi.Fa=function(){this.s||(this.F||this.v||this.l?dT(this):this.cb())},qi.cb=function(){dT(this)},qi.ba=function(){try{return 2<gT(this)?this.g.status:-1}catch(e){return-1}},qi.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},qi.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),iT(t)}},qi.Da=function(){return this.m},qi.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(qi=_T.prototype).ma=8,qi.G=1,qi.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},qi.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new YI(this,this.h,e,void 0),n=this.s;if(this.P&&(n?Cb(n=Sb(n),this.P):n=this.P),null===this.o&&(t.H=n),this.ja)e:{for(var r=0,i=0;i<this.l.length;i++){var s=this.l[i];if("__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s=s.length:s=void 0,void 0===s)break;if(4096<(r+=s)){r=i;break e}if(4096===r||i===this.l.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=CT(this,t,r),T0(i=v0(this.F),"RID",e),T0(i,"CVER",22),this.D&&T0(i,"X-HTTP-Session-Id",this.D),kT(this,i),this.o&&n&&yT(i,this.o,n),K0(this.i,t),this.Ra&&T0(i,"TYPE","init"),this.ja?(T0(i,"$req",r),T0(i,"SID","null"),t.$=!0,n0(t,i,null)):n0(t,i,r),this.G=2}}else 3==this.G&&(e?ST(this,e):0==this.l.length||$0(this.i)||ST(this))},qi.Ga=function(){var e;this.u=null,PT(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(e=2*this.O,this.h.info("BP detection timer enabled: "+e),this.B=$I(lb(this.bb,this),e))},qi.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,VI(10),bT(this),PT(this))},qi.ab=function(){null!=this.v&&(this.v=null,bT(this),RT(this),VI(19))},qi.jb=function(e){e?(this.h.info("Successfully pinged google.com"),VI(2)):(this.h.info("Failed to ping google.com"),VI(1))},(qi=jT.prototype).xa=function(){},qi.wa=function(){},qi.va=function(){},qi.ua=function(){},qi.Oa=function(){},qT.prototype.g=function(e,t){return new VT(e,t)},hb(VT,lI),VT.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),_I(lb(e.hb,e,t))),VI(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=FT(e,null,e.W),ET(e)},VT.prototype.close=function(){wT(this.g)},VT.prototype.u=function(e){var t;"string"==typeof e?((t={}).__data__=e,TT(this.g,t)):this.v?((t={}).__data__=dI(e),TT(this.g,t)):TT(this.g,e)},VT.prototype.M=function(){this.g.j=null,delete this.j,wT(this.g),delete this.g,VT.Z.M.call(this)},hb(BT,HI),hb($T,GI),hb(zT,jT),zT.prototype.xa=function(){uI(this.g,"a")},zT.prototype.wa=function(e){uI(this.g,new BT(e))},zT.prototype.va=function(e){uI(this.g,new $T)},zT.prototype.ua=function(){uI(this.g,"b")},qT.prototype.createWebChannel=qT.prototype.g,VT.prototype.send=VT.prototype.u,VT.prototype.open=VT.prototype.m,dr.NO_ERROR=0,dr.TIMEOUT=8,dr.HTTP_ERROR=6,G.COMPLETE="complete",(KI.EventType=H).OPEN="a",H.CLOSE="b",H.ERROR="c",H.MESSAGE="d",lI.prototype.listen=lI.prototype.N,sT.prototype.listenOnce=sT.prototype.O,sT.prototype.getLastError=sT.prototype.La,sT.prototype.getLastErrorCode=sT.prototype.Da,sT.prototype.getStatus=sT.prototype.ba,sT.prototype.getResponseJson=sT.prototype.Qa,sT.prototype.getResponseText=sT.prototype.ga,sT.prototype.send=sT.prototype.ea;var WT,KT=FI,HT=dr,GT=G,QT=MI,YT=10,JT=11,XT=X0,ZT=KI,eE=sT;let tE="9.0.0-2021720181311";class nE{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.t(e),this.i=e=>t.writeSequenceNumber(e))}t(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.i&&this.i(e),e}}nE.o=-1;const rE={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class iE extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}const sE=new mo("@firebase/firestore");function oE(){return sE.logLevel}function aE(e,...t){sE.logLevel<=lo.DEBUG&&(t=t.map(uE),sE.debug(`Firestore (${tE}): ${e}`,...t))}function cE(e,...t){sE.logLevel<=lo.ERROR&&(t=t.map(uE),sE.error(`Firestore (${tE}): ${e}`,...t))}function lE(e,...t){sE.logLevel<=lo.WARN&&(t=t.map(uE),sE.warn(`Firestore (${tE}): ${e}`,...t))}function uE(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function hE(e="Unexpected state"){e=`FIRESTORE (${tE}) INTERNAL ASSERTION FAILED: `+e;throw cE(e),new Error(e)}function dE(e){e||hE()}class fE{static u(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}(40);for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function pE(e,t){return e<t?-1:t<e?1:0}function gE(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function mE(e){return e+"\0"}class yE{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new iE(rE.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new iE(rE.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new iE(rE.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new iE(rE.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return yE.fromMillis(Date.now())}static fromDate(e){return yE.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),e=Math.floor(1e6*(e-1e3*t));return new yE(t,e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?pE(this.nanoseconds,e.nanoseconds):pE(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class vE{constructor(e){this.timestamp=e}static fromTimestamp(e){return new vE(e)}static min(){return new vE(new yE(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function _E(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function wE(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function bE(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class IE{constructor(e,t,n){void 0===t?t=0:t>e.length&&hE(),void 0===n?n=e.length-t:n>e.length-t&&hE(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===IE.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof IE?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(n){for(let e=this.offset,t=this.limit();e<t;e++)n(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){const r=Math.min(t.length,n.length);for(let e=0;e<r;e++){const r=t.get(e),i=n.get(e);if(r<i)return-1;if(r>i)return 1}return t.length<n.length?-1:t.length>n.length?1:0}}class TE extends IE{construct(e,t,n){return new TE(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new iE(rE.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new TE(t)}static emptyPath(){return new TE([])}}const EE=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class SE extends IE{construct(e,t,n){return new SE(e,t,n)}static isValidIdentifier(e){return EE.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!SE.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new SE(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new iE(rE.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new iE(rE.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new iE(rE.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new iE(rE.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new SE(t)}static emptyPath(){return new SE([])}}class kE{constructor(e){(this.fields=e).sort(SE.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return gE(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class CE{constructor(e){this.binaryString=e}static fromBase64String(e){e=atob(e);return new CE(e)}static fromUint8Array(e){e=function(t){let n="";for(let e=0;e<t.length;++e)n+=String.fromCharCode(t[e]);return n}(e);return new CE(e)}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return pE(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}CE.EMPTY_BYTE_STRING=new CE("");const AE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function RE(t){if(dE(!!t),"string"!=typeof t)return{seconds:NE(t.seconds),nanos:NE(t.nanos)};{let e=0;var n=AE.exec(t);dE(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function NE(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function PE(e){return"string"==typeof e?CE.fromBase64String(e):CE.fromUint8Array(e)}function OE(e){return"server_timestamp"===(null===(e=((null===(e=null==e?void 0:e.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===e?void 0:e.stringValue)}function xE(e){e=RE(e.mapValue.fields.__local_write_time__.timestampValue);return new yE(e.seconds,e.nanos)}function DE(e){return null==e}function ME(e){return 0===e&&1/e==-1/0}function LE(e){return"number"==typeof e&&Number.isInteger(e)&&!ME(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class FE{constructor(e){this.path=e}static fromPath(e){return new FE(TE.fromString(e))}static fromName(e){return new FE(TE.fromString(e).popFirst(5))}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===TE.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return TE.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new FE(new TE(e.slice()))}}function UE(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?OE(e)?4:10:hE()}function jE(n,r){var e,t,i=UE(n);if(i!==UE(r))return!1;switch(i){case 0:return!0;case 1:return n.booleanValue===r.booleanValue;case 4:return xE(n).isEqual(xE(r));case 3:return function(e){if("string"==typeof n.timestampValue&&"string"==typeof e.timestampValue&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;var t=RE(n.timestampValue),e=RE(e.timestampValue);return t.seconds===e.seconds&&t.nanos===e.nanos}(r);case 5:return n.stringValue===r.stringValue;case 6:return t=r,PE(n.bytesValue).isEqual(PE(t.bytesValue));case 7:return n.referenceValue===r.referenceValue;case 8:return e=r,NE((t=n).geoPointValue.latitude)===NE(e.geoPointValue.latitude)&&NE(t.geoPointValue.longitude)===NE(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return NE(e.integerValue)===NE(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){e=NE(e.doubleValue),t=NE(t.doubleValue);return e===t?ME(e)===ME(t):isNaN(e)&&isNaN(t)}return!1}(n,r);case 9:return gE(n.arrayValue.values||[],r.arrayValue.values||[],jE);case 10:return function(e){const t=e.mapValue.fields||{},n=r.mapValue.fields||{};if(_E(t)!==_E(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!jE(t[e],n[e])))return!1;return!0}(n);default:return hE()}}function qE(e,t){return void 0!==(e.values||[]).find(e=>jE(e,t))}function VE(e,t){var n,r,i,s=UE(e),o=UE(t);if(s!==o)return pE(s,o);switch(s){case 0:return 0;case 1:return pE(e.booleanValue,t.booleanValue);case 2:return r=t,i=NE(e.integerValue||e.doubleValue),r=NE(r.integerValue||r.doubleValue),i<r?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return BE(e.timestampValue,t.timestampValue);case 4:return BE(xE(e),xE(t));case 5:return pE(e.stringValue,t.stringValue);case 6:return function(e,t){const n=PE(e),r=PE(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=pE(n[e],r[e]);if(0!==t)return t}return pE(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,i=t.geoPointValue,0!==(r=pE(NE(n.latitude),NE(i.latitude)))?r:pE(NE(n.longitude),NE(i.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=VE(n[e],r[e]);if(t)return t}return pE(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=pE(r[e],s[e]);if(0!==t)return t;var o=VE(n[r[e]],i[s[e]]);if(0!==o)return o}return pE(r.length,s.length)}(e.mapValue,t.mapValue);default:throw hE()}}function BE(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return pE(e,t);var n=RE(e),e=RE(t),t=pE(n.seconds,e.seconds);return 0!==t?t:pE(n.nanos,e.nanos)}function $E(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=RE(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?PE(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,FE.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=s(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${s(e.fields[i])}`;return n+"}"}(e.mapValue):hE();var t}(e)}function zE(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function WE(e){return e&&"integerValue"in e}function KE(e){return!!e&&"arrayValue"in e}function HE(e){return e&&"nullValue"in e}function GE(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function QE(e){return e&&"mapValue"in e}function YE(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return wE(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=YE(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=YE(t.arrayValue.values[e]);return r}return Object.assign({},t)}class JE{constructor(e){this.value=e}static empty(){return new JE({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let t=this.value;for(let e=0;e<n.length-1;++e)if(t=(t.mapValue.fields||{})[n.get(e)],!QE(t))return null;return t=(t.mapValue.fields||{})[n.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=YE(t)}setAll(e){let n=SE.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=YE(e):i.push(t.lastSegment())});e=this.getFieldsMap(n);this.applyChanges(e,r,i)}delete(e){const t=this.field(e.popLast());QE(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return jE(this.value,e.value)}getFieldsMap(n){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let t=0;t<n.length;++t){let e=r.mapValue.fields[n.get(t)];QE(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},r.mapValue.fields[n.get(t)]=e),r=e}return r.mapValue.fields}applyChanges(n,e,t){wE(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new JE(YE(this.value))}}class XE{constructor(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(e){return new XE(e,0,vE.min(),JE.empty(),0)}static newFoundDocument(e,t,n){return new XE(e,1,t,n,0)}static newNoDocument(e,t){return new XE(e,2,t,JE.empty(),0)}static newUnknownDocument(e,t){return new XE(e,3,t,JE.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=JE.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=JE.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof XE&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new XE(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ZE{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.h=null}}function eS(e,t=null,n=[],r=[],i=null,s=null,o=null){return new ZE(e,t,n,r,i,s,o)}function tS(e){const t=e;if(null===t.h){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+$E(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),DE(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=pS(t.startAt)),t.endAt&&(e+="|ub:",e+=pS(t.endAt)),t.h=e}return t.h}function nS(t,n){if(t.limit!==n.limit)return!1;if(t.orderBy.length!==n.orderBy.length)return!1;for(let e=0;e<t.orderBy.length;e++)if(r=t.orderBy[e],i=n.orderBy[e],r.dir!==i.dir||!r.field.isEqual(i.field))return!1;var r,i,s,o;if(t.filters.length!==n.filters.length)return!1;for(let e=0;e<t.filters.length;e++)if(s=t.filters[e],o=n.filters[e],s.op!==o.op||!s.field.isEqual(o.field)||!jE(s.value,o.value))return!1;return t.collectionGroup===n.collectionGroup&&!!t.path.isEqual(n.path)&&!!yS(t.startAt,n.startAt)&&yS(t.endAt,n.endAt)}function rS(e){return FE.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class iS extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.l(e,t,n):new sS(e,t,n):"array-contains"===t?new lS(e,n):"in"===t?new uS(e,n):"not-in"===t?new hS(e,n):"array-contains-any"===t?new dS(e,n):new iS(e,t,n)}static l(e,t,n){return new("in"===t?oS:aS)(e,n)}matches(e){e=e.data.field(this.field);return"!="===this.op?null!==e&&this.m(VE(e,this.value)):null!==e&&UE(this.value)===UE(e)&&this.m(VE(e,this.value))}m(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return hE()}}g(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class sS extends iS{constructor(e,t,n){super(e,t,n),this.key=FE.fromName(n.referenceValue)}matches(e){e=FE.comparator(e.key,this.key);return this.m(e)}}class oS extends iS{constructor(e,t){super(e,"in",t),this.keys=cS(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class aS extends iS{constructor(e,t){super(e,"not-in",t),this.keys=cS(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function cS(e,t){return((null===(t=t.arrayValue)||void 0===t?void 0:t.values)||[]).map(e=>FE.fromName(e.referenceValue))}class lS extends iS{constructor(e,t){super(e,"array-contains",t)}matches(e){e=e.data.field(this.field);return KE(e)&&qE(e.arrayValue,this.value)}}class uS extends iS{constructor(e,t){super(e,"in",t)}matches(e){e=e.data.field(this.field);return null!==e&&qE(this.value.arrayValue,e)}}class hS extends iS{constructor(e,t){super(e,"not-in",t)}matches(e){if(qE(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;e=e.data.field(this.field);return null!==e&&!qE(this.value.arrayValue,e)}}class dS extends iS{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!KE(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>qE(this.value.arrayValue,e))}}class fS{constructor(e,t){this.position=e,this.before=t}}function pS(e){return`${e.before?"b":"a"}:${e.position.map(e=>$E(e)).join(",")}`}class gS{constructor(e,t="asc"){this.field=e,this.dir=t}}function mS(t,n,r){let i=0;for(let e=0;e<t.position.length;e++){const s=n[e],o=t.position[e];if(i=s.field.isKeyField()?FE.comparator(FE.fromName(o.referenceValue),r.key):VE(o,r.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return t.before?i<=0:i<0}function yS(t,n){if(null===t)return null===n;if(null===n)return!1;if(t.before!==n.before||t.position.length!==n.position.length)return!1;for(let e=0;e<t.position.length;e++)if(!jE(t.position[e],n.position[e]))return!1;return!0}class vS{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt}}function _S(e,t,n,r,i,s,o,a){return new vS(e,t,n,r,i,s,o,a)}function wS(e){return new vS(e)}function bS(e){return!DE(e.limit)&&"F"===e.limitType}function IS(e){return!DE(e.limit)&&"L"===e.limitType}function TS(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function ES(e){for(const t of e.filters)if(t.g())return t.field;return null}function SS(e){return null!==e.collectionGroup}function kS(t){const n=t;if(null===n.p){n.p=[];const t=ES(n),e=TS(n);if(null!==t&&null===e)t.isKeyField()||n.p.push(new gS(t)),n.p.push(new gS(SE.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.p.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.p.push(new gS(SE.keyField(),t))}}}return n.p}function CS(e){const t=e;if(!t.T)if("F"===t.limitType)t.T=eS(t.path,t.collectionGroup,kS(t),t.filters,t.limit,t.startAt,t.endAt);else{const r=[];for(const i of kS(t)){const t="desc"===i.dir?"asc":"desc";r.push(new gS(i.field,t))}var n=t.endAt?new fS(t.endAt.position,!t.endAt.before):null,e=t.startAt?new fS(t.startAt.position,!t.startAt.before):null;t.T=eS(t.path,t.collectionGroup,r,t.filters,t.limit,n,e)}return t.T}function AS(e,t,n){return new vS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function RS(e,t){return nS(CS(e),CS(t))&&e.limitType===t.limitType}function NS(e){return`${tS(CS(e))}|lt:${e.limitType}`}function PS(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>{return`${(e=e).field.canonicalString()} ${e.op} ${$E(e.value)}`}).join(", ")}]`),DE(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+pS(e.startAt)),e.endAt&&(t+=", endAt: "+pS(e.endAt)),`Target(${t})`}(CS(e))}; limitType=${e.limitType})`}function OS(n,e){return e.isFoundDocument()&&(t=n,r=e.key.path,null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(r):FE.isDocumentKey(t.path)?t.path.isEqual(r):t.path.isImmediateParentOf(r))&&function(e){for(const t of n.explicitOrderBy)if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(r=e,(!(e=n).startAt||mS(e.startAt,kS(e),r))&&(!e.endAt||!mS(e.endAt,kS(e),r)));var t,r}function xS(i){return(e,t)=>{let n=!1;for(const r of kS(i)){const i=function(e,r,t){var n=e.field.isKeyField()?FE.comparator(r.key,t.key):function(e,t){var n=r.data.field(e),e=t.data.field(e);return null!==n&&null!==e?VE(n,e):hE()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return hE()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}function DS(e,t){if(e.I){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ME(t)?"-0":t}}function MS(e){return{integerValue:""+e}}function LS(e,t){return LE(t)?MS(t):DS(e,t)}class FS{constructor(){this._=void 0}}function US(e,t){return e instanceof zS?WE(e=t)||e&&"doubleValue"in e?t:{integerValue:0}:null}class jS extends FS{}class qS extends FS{constructor(e){super(),this.elements=e}}function VS(e,t){const n=KS(t);for(const t of e.elements)n.some(e=>jE(e,t))||n.push(t);return{arrayValue:{values:n}}}class BS extends FS{constructor(e){super(),this.elements=e}}function $S(e,t){let n=KS(t);for(const t of e.elements)n=n.filter(e=>!jE(e,t));return{arrayValue:{values:n}}}class zS extends FS{constructor(e,t){super(),this.R=e,this.A=t}}function WS(e){return NE(e.integerValue||e.doubleValue)}function KS(e){return KE(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class HS{constructor(e,t){this.field=e,this.transform=t}}class GS{constructor(e,t){this.version=e,this.transformResults=t}}class QS{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new QS}static exists(e){return new QS(void 0,e)}static updateTime(e){return new QS(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function YS(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class JS{}function XS(e,t,n){e instanceof nk?function(e,t,n){const r=e.value.clone(),i=sk(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof rk?function(e,t,n){if(!YS(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=sk(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(ik(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function ZS(e,t,n){e instanceof nk?function(e,t,n){if(YS(e.precondition,t)){const r=e.value.clone(),i=ok(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(tk(t),r).setHasLocalMutations()}}(e,t,n):e instanceof rk?function(e,t,n){if(YS(e.precondition,t)){const r=ok(e.fieldTransforms,n,t),i=t.data;i.setAll(ik(e)),i.setAll(r),t.convertToFoundDocument(tk(t),i).setHasLocalMutations()}}(e,t,n):(t=t,YS(e.precondition,t)&&t.convertToNoDocument(vE.min()))}function ek(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&gE(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof qS&&t instanceof qS||e instanceof BS&&t instanceof BS?gE(e.elements,t.elements,jE):e instanceof zS&&t instanceof zS?jE(e.A,t.A):e instanceof jS&&t instanceof jS)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}function tk(e){return e.isFoundDocument()?e.version:vE.min()}class nk extends JS{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class rk extends JS{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function ik(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function sk(t,n,r){const i=new Map;dE(t.length===r.length);for(let e=0;e<r.length;e++){var s=t[e],o=s.transform,a=n.data.field(s.field);i.set(s.field,(s=o,o=a,a=r[e],s instanceof qS?VS(s,o):s instanceof BS?$S(s,o):a))}return i}function ok(e,t,n){const r=new Map;for(const l of e){const e=l.transform,u=n.data.field(l.field);r.set(l.field,(i=e,s=u,o=t,c=a=void 0,i instanceof jS?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return s&&(e.fields.__previous_value__=s),{mapValue:e}}():i instanceof qS?VS(i,s):i instanceof BS?$S(i,s):(c=US(a=i,s),i=WS(c)+WS(a.A),WE(c)&&WE(a.A)?MS(i):DS(a.R,i))))}var i,s,o,a,c;return r}class ak extends JS{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class ck extends JS{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class lk{constructor(e){this.count=e}}function uk(e){switch(e){case rE.OK:return hE(),0;case rE.CANCELLED:case rE.UNKNOWN:case rE.DEADLINE_EXCEEDED:case rE.RESOURCE_EXHAUSTED:case rE.INTERNAL:case rE.UNAVAILABLE:case rE.UNAUTHENTICATED:return;case rE.INVALID_ARGUMENT:case rE.NOT_FOUND:case rE.ALREADY_EXISTS:case rE.PERMISSION_DENIED:case rE.FAILED_PRECONDITION:case rE.ABORTED:case rE.OUT_OF_RANGE:case rE.UNIMPLEMENTED:case rE.DATA_LOSS:return 1;default:return hE(),0}}function hk(e){if(void 0===e)return cE("GRPC error has no .code"),rE.UNKNOWN;switch(e){case WT.OK:return rE.OK;case WT.CANCELLED:return rE.CANCELLED;case WT.UNKNOWN:return rE.UNKNOWN;case WT.DEADLINE_EXCEEDED:return rE.DEADLINE_EXCEEDED;case WT.RESOURCE_EXHAUSTED:return rE.RESOURCE_EXHAUSTED;case WT.INTERNAL:return rE.INTERNAL;case WT.UNAVAILABLE:return rE.UNAVAILABLE;case WT.UNAUTHENTICATED:return rE.UNAUTHENTICATED;case WT.INVALID_ARGUMENT:return rE.INVALID_ARGUMENT;case WT.NOT_FOUND:return rE.NOT_FOUND;case WT.ALREADY_EXISTS:return rE.ALREADY_EXISTS;case WT.PERMISSION_DENIED:return rE.PERMISSION_DENIED;case WT.FAILED_PRECONDITION:return rE.FAILED_PRECONDITION;case WT.ABORTED:return rE.ABORTED;case WT.OUT_OF_RANGE:return rE.OUT_OF_RANGE;case WT.UNIMPLEMENTED:return rE.UNIMPLEMENTED;case WT.DATA_LOSS:return rE.DATA_LOSS;default:return hE()}}(dr=WT=WT||{})[dr.OK=0]="OK",dr[dr.CANCELLED=1]="CANCELLED",dr[dr.UNKNOWN=2]="UNKNOWN",dr[dr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",dr[dr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",dr[dr.NOT_FOUND=5]="NOT_FOUND",dr[dr.ALREADY_EXISTS=6]="ALREADY_EXISTS",dr[dr.PERMISSION_DENIED=7]="PERMISSION_DENIED",dr[dr.UNAUTHENTICATED=16]="UNAUTHENTICATED",dr[dr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",dr[dr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",dr[dr.ABORTED=10]="ABORTED",dr[dr.OUT_OF_RANGE=11]="OUT_OF_RANGE",dr[dr.UNIMPLEMENTED=12]="UNIMPLEMENTED",dr[dr.INTERNAL=13]="INTERNAL",dr[dr.UNAVAILABLE=14]="UNAVAILABLE",dr[dr.DATA_LOSS=15]="DATA_LOSS";class dk{constructor(e,t){this.comparator=e,this.root=t||pk.EMPTY}insert(e,t){return new dk(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,pk.BLACK,null,null))}remove(e){return new dk(this.comparator,this.root.remove(e,this.comparator).copy(null,null,pk.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new fk(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new fk(this.root,e,this.comparator,!1)}getReverseIterator(){return new fk(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new fk(this.root,e,this.comparator,!0)}}class fk{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class pk{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:pk.RED,this.left=null!=r?r:pk.EMPTY,this.right=null!=i?i:pk.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new pk(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return pk.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return pk.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,pk.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,pk.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw hE();if(this.right.isRed())throw hE();var e=this.left.check();if(e!==this.right.check())throw hE();return e+(this.isRed()?0:1)}}pk.EMPTY=null,pk.RED=!0,pk.BLACK=!1,pk.EMPTY=new class{constructor(){this.size=0}get key(){throw hE()}get value(){throw hE()}get color(){throw hE()}get left(){throw hE()}get right(){throw hE()}copy(e,t,n,r,i){return this}insert(e,t,n){return new pk(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class gk{constructor(e){this.comparator=e,this.data=new dk(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new mk(this.data.getIterator())}getIteratorFrom(e){return new mk(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof gk))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new gk(this.comparator);return t.data=e,t}}class mk{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const yk=new dk(FE.comparator);const vk=new dk(FE.comparator);const _k=new dk(FE.comparator);const wk=new gk(FE.comparator);function bk(...e){let t=wk;for(const n of e)t=t.add(n);return t}const Ik=new gk(pE);class Tk{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,Ek.createSynthesizedTargetChangeForCurrentChange(e,t)),new Tk(vE.min(),n,Ik,yk,bk())}}class Ek{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new Ek(CE.EMPTY_BYTE_STRING,t,bk(),bk(),bk())}}class Sk{constructor(e,t,n,r){this.P=e,this.removedTargetIds=t,this.key=n,this.v=r}}class kk{constructor(e,t){this.targetId=e,this.V=t}}class Ck{constructor(e,t,n=CE.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Ak{constructor(){this.S=0,this.D=Pk(),this.C=CE.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}get current(){return this.N}get resumeToken(){return this.C}get $(){return 0!==this.S}get O(){return this.k}F(e){0<e.approximateByteSize()&&(this.k=!0,this.C=e)}M(){let n=bk(),r=bk(),i=bk();return this.D.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:hE()}}),new Ek(this.C,this.N,n,r,i)}L(){this.k=!1,this.D=Pk()}B(e,t){this.k=!0,this.D=this.D.insert(e,t)}U(e){this.k=!0,this.D=this.D.remove(e)}q(){this.S+=1}K(){--this.S}j(){this.k=!0,this.N=!0}}class Rk{constructor(e){this.W=e,this.G=new Map,this.H=yk,this.J=Nk(),this.Y=new gk(pE)}X(e){for(const t of e.P)e.v&&e.v.isFoundDocument()?this.Z(t,e.v):this.tt(t,e.key,e.v);for(const n of e.removedTargetIds)this.tt(n,e.key,e.v)}et(n){this.forEachTarget(n,e=>{const t=this.nt(e);switch(n.state){case 0:this.st(e)&&t.F(n.resumeToken);break;case 1:t.K(),t.$||t.L(),t.F(n.resumeToken);break;case 2:t.K(),t.$||this.removeTarget(e);break;case 3:this.st(e)&&(t.j(),t.F(n.resumeToken));break;case 4:this.st(e)&&(this.it(e),t.F(n.resumeToken));break;default:hE()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.G.forEach((e,t)=>{this.st(t)&&n(t)})}rt(e){const t=e.targetId,n=e.V.count,r=this.ot(t);if(r){const e=r.target;if(rS(e))if(0===n){const n=new FE(e.path);this.tt(t,n,XE.newNoDocument(n,vE.min()))}else dE(1===n);else this.at(t)!==n&&(this.it(t),this.Y=this.Y.add(t))}}ct(r){const i=new Map;this.G.forEach((e,t)=>{var n=this.ot(t);if(n){if(e.current&&rS(n.target)){const i=new FE(n.target.path);null!==this.H.get(i)||this.ut(t,i)||this.tt(t,i,XE.newNoDocument(i,r))}e.O&&(i.set(t,e.M()),e.L())}});let s=bk();this.J.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{e=this.ot(e);return!e||2===e.purpose||(n=!1)}),n&&(s=s.add(e))});var e=new Tk(r,i,this.Y,this.H,s);return this.H=yk,this.J=Nk(),this.Y=new gk(pE),e}Z(e,t){var n;this.st(e)&&(n=this.ut(e,t.key)?2:0,this.nt(e).B(t.key,n),this.H=this.H.insert(t.key,t),this.J=this.J.insert(t.key,this.ht(t.key).add(e)))}tt(e,t,n){if(this.st(e)){const r=this.nt(e);this.ut(e,t)?r.B(t,1):r.U(t),this.J=this.J.insert(t,this.ht(t).delete(e)),n&&(this.H=this.H.insert(t,n))}}removeTarget(e){this.G.delete(e)}at(e){var t=this.nt(e).M();return this.W.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}q(e){this.nt(e).q()}nt(e){let t=this.G.get(e);return t||(t=new Ak,this.G.set(e,t)),t}ht(e){let t=this.J.get(e);return t||(t=new gk(pE),this.J=this.J.insert(e,t)),t}st(e){var t=null!==this.ot(e);return t||aE("WatchChangeAggregator","Detected inactive target",e),t}ot(e){var t=this.G.get(e);return t&&t.$?null:this.W.lt(e)}it(t){this.G.set(t,new Ak),this.W.getRemoteKeysForTarget(t).forEach(e=>{this.tt(t,e,null)})}ut(e,t){return this.W.getRemoteKeysForTarget(e).has(t)}}function Nk(){return new dk(FE.comparator)}function Pk(){return new dk(FE.comparator)}const Ok={asc:"ASCENDING",desc:"DESCENDING"},xk={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Dk{constructor(e,t){this.databaseId=e,this.I=t}}function Mk(e,t){return e.I?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Lk(e,t){return e.I?t.toBase64():t.toUint8Array()}function Fk(e){return dE(!!e),vE.fromTimestamp((e=RE(e),new yE(e.seconds,e.nanos)))}function Uk(e,t){return e=e,new TE(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function jk(e){e=TE.fromString(e);return dE(sC(e)),e}function qk(e,t){return Uk(e.databaseId,t.path)}function Vk(e,t){const n=jk(t);if(n.get(1)!==e.databaseId.projectId)throw new iE(rE.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new iE(rE.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new FE(Wk(n))}function Bk(e,t){return Uk(e.databaseId,t)}function $k(e){e=jk(e);return 4===e.length?TE.emptyPath():Wk(e)}function zk(e){return new TE(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Wk(e){return dE(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function Kk(e,t,n){return{name:qk(e,t),fields:n.value.mapValue.fields}}function Hk(e,t,n){const r=Vk(e,t.name),i=Fk(t.updateTime),s=new JE({mapValue:{fields:t.fields}}),o=XE.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Gk(e,t){let n;if(t instanceof nk)n={update:Kk(e,t.key,t.value)};else if(t instanceof ak)n={delete:qk(e,t.key)};else if(t instanceof rk)n={update:Kk(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof ck))return hE();n={verify:qk(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof jS)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof qS)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof BS)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof zS)return{fieldPath:e.field.canonicalString(),increment:t.A};throw hE()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(t=t.precondition).updateTime?{updateTime:Mk(e,t.updateTime.toTimestamp())}:void 0!==t.exists?{exists:t.exists}:hE()),n}function Qk(t,n){const e=n.currentDocument?void 0!==(s=n.currentDocument).updateTime?QS.updateTime(Fk(s.updateTime)):void 0!==s.exists?QS.exists(s.exists):QS.none():QS.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)dE("REQUEST_TIME"===t.setToServerValue),n=new jS;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new qS(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new BS(e)}else"increment"in t?n=new zS(e,t.increment):hE();t=SE.fromServerFormat(t.fieldPath);return new HS(t,n)}(t,e)):[];if(n.update){n.update.name;var i=Vk(t,n.update.name),s=new JE({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new kE(e.map(e=>SE.fromServerFormat(e)))}();return new rk(i,s,t,e,r)}return new nk(i,s,e,r)}if(n.delete){const r=Vk(t,n.delete);return new ak(r,e)}if(n.verify){const r=Vk(t,n.verify);return new ck(r,e)}return hE()}function Yk(e,t){return{documents:[Bk(e,t.path)]}}function Jk(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Bk(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Bk(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){e=e.map(e=>function(e){if("=="===e.op){if(GE(e.value))return{unaryFilter:{field:tC(e.field),op:"IS_NAN"}};if(HE(e.value))return{unaryFilter:{field:tC(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(GE(e.value))return{unaryFilter:{field:tC(e.field),op:"IS_NOT_NAN"}};if(HE(e.value))return{unaryFilter:{field:tC(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:tC(e.field),op:(t=e.op,xk[t]),value:e.value}};var t}(e));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(t.filters);i&&(n.structuredQuery.where=i);i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:tC(e.field),direction:(e=e.dir,Ok[e])}}(e))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);i=t.limit,i=e.I||DE(i)?i:{value:i};return null!==i&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt=Zk(t.startAt)),t.endAt&&(n.structuredQuery.endAt=Zk(t.endAt)),n}function Xk(e){let t=$k(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(0<r){dE(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[iC(e)]:void 0!==e.fieldFilter?[rC(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((e,t)=>e.concat(t)):hE():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new gS(nC(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let a=null;n.limit&&(a=function(e){e="object"==typeof e?e.value:e;return DE(e)?null:e}(n.limit));let c=null;n.startAt&&(c=eC(n.startAt));let l=null;return n.endAt&&(l=eC(n.endAt)),_S(t,i,o,s,a,"F",c,l)}function Zk(e){return{before:e.before,values:e.position}}function eC(e){var t=!!e.before,e=e.values||[];return new fS(e,t)}function tC(e){return{fieldPath:e.canonicalString()}}function nC(e){return SE.fromServerFormat(e.fieldPath)}function rC(e){return iS.create(nC(e.fieldFilter.field),function(){switch(e.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return hE()}}(),e.fieldFilter.value)}function iC(e){switch(e.unaryFilter.op){case"IS_NAN":var t=nC(e.unaryFilter.field);return iS.create(t,"==",{doubleValue:NaN});case"IS_NULL":t=nC(e.unaryFilter.field);return iS.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=nC(e.unaryFilter.field);return iS.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=nC(e.unaryFilter.field);return iS.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return hE()}}function sC(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function oC(t){let n="";for(let e=0;e<t.length;e++)0<n.length&&(n=aC(n)),n=function(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(t.get(e),n);return aC(n)}function aC(e){return e+""}function cC(n){const r=n.length;if(dE(2<=r),2===r)return dE(""===n.charAt(0)&&""===n.charAt(1)),TE.emptyPath();const i=r-2,s=[];let o="";for(let t=0;t<r;){const r=n.indexOf("",t);switch((r<0||r>i)&&hE(),n.charAt(r+1)){case"":const i=n.substring(t,r);let e;0===o.length?e=i:(o+=i,e=o,o=""),s.push(e);break;case"":o+=n.substring(t,r),o+="\0";break;case"":o+=n.substring(t,r+1);break;default:hE()}t=r+2}return new TE(s)}class lC{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class uC{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}uC.store="owner",uC.key="owner";class hC{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}hC.store="mutationQueues",hC.keyPath="userId";class dC{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}dC.store="mutations",dC.keyPath="batchId",dC.userMutationsIndex="userMutationsIndex",dC.userMutationsKeyPath=["userId","batchId"];class fC{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,oC(t)]}static key(e,t,n){return[e,oC(t),n]}}fC.store="documentMutations",fC.PLACEHOLDER=new fC;class pC{constructor(e,t){this.path=e,this.readTime=t}}class gC{constructor(e,t){this.path=e,this.version=t}}class mC{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}mC.store="remoteDocuments",mC.readTimeIndex="readTimeIndex",mC.readTimeIndexPath="readTime",mC.collectionReadTimeIndex="collectionReadTimeIndex",mC.collectionReadTimeIndexPath=["parentPath","readTime"];class yC{constructor(e){this.byteSize=e}}yC.store="remoteDocumentGlobal",yC.key="remoteDocumentGlobalKey";class vC{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}vC.store="targets",vC.keyPath="targetId",vC.queryTargetsIndexName="queryTargetsIndex",vC.queryTargetsKeyPath=["canonicalId","targetId"];class _C{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}_C.store="targetDocuments",_C.keyPath=["targetId","path"],_C.documentTargetsIndex="documentTargetsIndex",_C.documentTargetsKeyPath=["path","targetId"];class wC{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}wC.key="targetGlobalKey",wC.store="targetGlobal";class bC{constructor(e,t){this.collectionId=e,this.parent=t}}bC.store="collectionParents",bC.keyPath=["collectionId","parent"];class IC{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}IC.store="clientMetadata",IC.keyPath="clientId";class TC{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}TC.store="bundles",TC.keyPath="bundleId";class EC{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}EC.store="namedQueries",EC.keyPath="name";const SC=[hC.store,dC.store,fC.store,mC.store,vC.store,uC.store,wC.store,_C.store,IC.store,yC.store,bC.store,TC.store,EC.store],kC="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class CC{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class AC{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class RC{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&hE(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new RC((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof RC?t:RC.resolve(t)}catch(e){return RC.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):RC.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):RC.reject(t)}static resolve(n){return new RC((e,t)=>{e(n)})}static reject(n){return new RC((e,t)=>{t(n)})}static waitFor(e){return new RC((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=RC.resolve(!1);for(const n of e)t=t.next(e=>e?RC.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}}class NC{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.ft=new AC,this.transaction.oncomplete=()=>{this.ft.resolve()},this.transaction.onabort=()=>{e.error?this.ft.reject(new xC(t,e.error)):this.ft.resolve()},this.transaction.onerror=e=>{e=UC(e.target.error);this.ft.reject(new xC(t,e))}}static open(e,t,n,r){try{return new NC(t,e.transaction(r,n))}catch(e){throw new xC(t,e)}}get dt(){return this.ft.promise}abort(e){e&&this.ft.reject(e),this.aborted||(aE("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){e=this.transaction.objectStore(e);return new MC(e)}}class PC{constructor(e,t,n){this.name=e,this.version=t,this.wt=n,12.2===PC._t(fs())&&cE("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return aE("SimpleDb","Removing database:",e),LC(window.indexedDB.deleteDatabase(e)).toPromise()}static gt(){if("undefined"==typeof indexedDB)return!1;if(PC.yt())return!0;const e=fs(),t=PC._t(e),n=0<t&&t<10,r=PC.Et(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static yt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Tt)}static It(e,t){return e.store(t)}static _t(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Et(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async At(i){return this.db||(aE("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{e=e.target.result;t(e)},r.onblocked=()=>{n(new xC(i,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{e=e.target.error;"VersionError"===e.name?n(new iE(rE.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new xC(i,e))},r.onupgradeneeded=e=>{aE("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.wt.Rt(t,r.transaction,e.oldVersion,this.version).next(()=>{aE("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.Pt&&(this.db.onversionchange=e=>this.Pt(e)),this.db}bt(t){this.Pt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.At(e);const t=NC.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).catch(e=>(t.abort(e),RC.reject(e))).toPromise();return s.catch(()=>{}),await t.dt,s}catch(e){const t="FirebaseError"!==e.name&&s<3;if(aE("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class OC{constructor(e){this.vt=e,this.Vt=!1,this.St=null}get isDone(){return this.Vt}get Dt(){return this.St}set cursor(e){this.vt=e}done(){this.Vt=!0}Ct(e){this.St=e}delete(){return LC(this.vt.delete())}}class xC extends iE{constructor(e,t){super(rE.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function DC(e){return"IndexedDbTransactionError"===e.name}class MC{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(aE("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(aE("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),LC(n)}add(e){return aE("SimpleDb","ADD",this.store.name,e,e),LC(this.store.add(e))}get(t){return LC(this.store.get(t)).next(e=>(aE("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return aE("SimpleDb","DELETE",this.store.name,e),LC(this.store.delete(e))}count(){return aE("SimpleDb","COUNT",this.store.name),LC(this.store.count())}Nt(e,t){const n=this.cursor(this.options(e,t)),r=[];return this.xt(n,(e,t)=>{r.push(t)}).next(()=>r)}kt(e,t){aE("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.$t=!1;t=this.cursor(n);return this.xt(t,(e,t,n)=>n.delete())}Ot(e,t){let n;t?n=e:(n={},t=e);e=this.cursor(n);return this.xt(e,t)}Ft(r){const e=this.cursor({});return new RC((n,t)=>{e.onerror=e=>{e=UC(e.target.error);t(e)},e.onsuccess=e=>{const t=e.target.result;t?r(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}xt(e,s){const o=[];return new RC((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new OC(t),r=s(t.primaryKey,t.value,n);if(r instanceof RC){const e=r.catch(e=>(n.done(),RC.reject(e)));o.push(e)}n.isDone?i():null===n.Dt?t.continue():t.continue(n.Dt)}else i()}}).next(()=>RC.waitFor(o))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.$t?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function LC(e){return new RC((t,n)=>{e.onsuccess=e=>{e=e.target.result;t(e)},e.onerror=e=>{e=UC(e.target.error);n(e)}})}let FC=!1;function UC(e){const t=PC._t(fs());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new iE("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return FC||(FC=!0,setTimeout(()=>{throw e},0)),e}}return e}class jC extends CC{constructor(e,t){super(),this.Mt=e,this.currentSequenceNumber=t}}function qC(e,t){return PC.It(e.Mt,t)}class VC{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){var n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&XS(r,t,n[e])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&ZS(t,e,this.localWriteTime);for(const n of this.mutations)n.key.isEqual(e.key)&&ZS(n,e,this.localWriteTime)}applyToLocalDocumentSet(r){this.mutations.forEach(e=>{const t=r.get(e.key),n=t;this.applyToLocalView(n),t.isValidDocument()||n.convertToNoDocument(vE.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),bk())}isEqual(e){return this.batchId===e.batchId&&gE(this.mutations,e.mutations,(e,t)=>ek(e,t))&&gE(this.baseMutations,e.baseMutations,(e,t)=>ek(e,t))}}class BC{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){dE(e.mutations.length===n.length);let r=_k;var i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new BC(e,t,n,r)}}class $C{constructor(e,t,n,r,i=vE.min(),s=vE.min(),o=CE.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new $C(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new $C(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new $C(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class zC{constructor(e){this.Lt=e}}function WC(e,t){if(t.document)return Hk(e.Lt,t.document,!!t.hasCommittedMutations);if(t.noDocument){const e=FE.fromSegments(t.noDocument.path),n=YC(t.noDocument.readTime),r=XE.newNoDocument(e,n);return t.hasCommittedMutations?r.setHasCommittedMutations():r}if(t.unknownDocument){const e=FE.fromSegments(t.unknownDocument.path),i=YC(t.unknownDocument.version);return XE.newUnknownDocument(e,i)}return hE()}function KC(e,t,n){var r=HC(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){const s={name:qk(n=e.Lt,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:Mk(n,e.version.toTimestamp())},o=t.hasCommittedMutations;return new mC(null,null,s,o,r,i)}if(t.isNoDocument()){const a=t.key.path.toArray(),s=QC(t.version),c=t.hasCommittedMutations;return new mC(null,new pC(a,s),null,c,r,i)}if(t.isUnknownDocument()){const a=t.key.path.toArray(),s=QC(t.version);return new mC(new gC(a,s),null,null,!0,r,i)}return hE()}function HC(e){e=e.toTimestamp();return[e.seconds,e.nanoseconds]}function GC(e){e=new yE(e[0],e[1]);return vE.fromTimestamp(e)}function QC(e){e=e.toTimestamp();return new lC(e.seconds,e.nanoseconds)}function YC(e){e=new yE(e.seconds,e.nanoseconds);return vE.fromTimestamp(e)}function JC(t,n){const r=(n.baseMutations||[]).map(e=>Qk(t.Lt,e));for(let e=0;e<n.mutations.length-1;++e){const r=n.mutations[e];if(e+1<n.mutations.length&&void 0!==n.mutations[e+1].transform){const i=n.mutations[e+1];r.updateTransforms=i.transform.fieldTransforms,n.mutations.splice(e+1,1),++e}}const i=n.mutations.map(e=>Qk(t.Lt,e)),e=yE.fromMillis(n.localWriteTimeMs);return new VC(n.batchId,e,r,i)}function XC(e){var t,n=YC(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?YC(e.lastLimboFreeSnapshotVersion):vE.min();let i;return i=void 0!==e.query.documents?(dE(1===(t=e.query).documents.length),CS(wS($k(t.documents[0])))):CS(Xk(e.query)),new $C(i,e.targetId,0,e.lastListenSequenceNumber,n,r,CE.fromBase64String(e.resumeToken))}function ZC(e,t){var n=QC(t.snapshotVersion),r=QC(t.lastLimboFreeSnapshotVersion),i=(rS(t.target)?Yk:Jk)(e.Lt,t.target),e=t.resumeToken.toBase64();return new vC(t.targetId,tS(t.target),n,e,t.sequenceNumber,r,i)}function eA(e){var t=Xk({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?AS(t,t.limit,"L"):t}class tA{getBundleMetadata(e,t){return nA(e).get(t).next(e=>{if(e)return{id:(e=e).bundleId,createTime:YC(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return nA(e).put({bundleId:(t=t).id,createTime:QC(Fk(t.createTime)),version:t.version})}getNamedQuery(e,t){return rA(e).get(t).next(e=>{if(e)return{name:(e=e).name,query:eA(e.bundledQuery),readTime:YC(e.readTime)}})}saveNamedQuery(e,t){return rA(e).put({name:(t=t).name,readTime:QC(Fk(t.readTime)),bundledQuery:t.bundledQuery})}}function nA(e){return qC(e,TC.store)}function rA(e){return qC(e,EC.store)}class iA{constructor(){this.Bt=new sA}addToCollectionParentIndex(e,t){return this.Bt.add(t),RC.resolve()}getCollectionParents(e,t){return RC.resolve(this.Bt.getEntries(t))}}class sA{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new gk(TE.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new gk(TE.comparator)).toArray()}}class oA{constructor(){this.Ut=new sA}addToCollectionParentIndex(e,t){if(this.Ut.has(t))return RC.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Ut.add(t)});r={collectionId:n,parent:oC(r)};return aA(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[mE(n),""],!1,!0);return aA(e).Nt(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(cC(t.parent))}return r})}}function aA(e){return qC(e,bC.store)}const cA={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class lA{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new lA(e,lA.DEFAULT_COLLECTION_PERCENTILE,lA.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function uA(e,t,n){const r=e.store(dC.store),i=e.store(fC.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Ot({range:o},(e,t,n)=>(a++,n.delete()));s.push(c.next(()=>{dE(1===a)}));const l=[];for(const e of n.mutations){const r=fC.key(t,e.key.path,n.batchId);s.push(i.delete(r)),l.push(e.key)}return RC.waitFor(s).next(()=>l)}function hA(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw hE();t=e.noDocument}return JSON.stringify(t).length}lA.DEFAULT_COLLECTION_PERCENTILE=10,lA.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lA.DEFAULT=new lA(41943040,lA.DEFAULT_COLLECTION_PERCENTILE,lA.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lA.DISABLED=new lA(-1,0,0);class dA{constructor(e,t,n,r){this.userId=e,this.R=t,this.qt=n,this.referenceDelegate=r,this.Kt={}}static jt(e,t,n,r){dE(""!==e.uid);e=e.isAuthenticated()?e.uid:"";return new dA(e,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return pA(e).Ot({index:dC.userMutationsIndex,range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,h,d,f){const p=gA(u),g=pA(u);return g.add({}).next(e=>{dE("number"==typeof e);const t=new VC(e,h,d,f),n=(i=this.R,s=this.userId,o=t,a=o.baseMutations.map(e=>Gk(i.Lt,e)),c=o.mutations.map(e=>Gk(i.Lt,e)),new dC(s,o.batchId,o.localWriteTime.toMillis(),a,c)),r=[];var i,s,o,a,c;let l=new gk((e,t)=>pE(e.canonicalString(),t.canonicalString()));for(const u of f){const h=fC.key(this.userId,u.key.path,e);l=l.add(u.key.path.popLast()),r.push(g.put(n)),r.push(p.put(h,fC.PLACEHOLDER))}return l.forEach(e=>{r.push(this.qt.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.Kt[e]=t.keys()}),RC.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return pA(e).get(t).next(e=>e?(dE(e.userId===this.userId),JC(this.R,e)):null)}Qt(e,t){return this.Kt[t]?RC.resolve(this.Kt[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){e=e.keys();return this.Kt[t]=e}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return pA(e).Ot({index:dC.userMutationsIndex,range:n},(e,t,n)=>{t.userId===this.userId&&(dE(t.batchId>=r),i=JC(this.R,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return pA(e).Ot({index:dC.userMutationsIndex,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return pA(e).Nt(dC.userMutationsIndex,t).next(e=>e.map(e=>JC(this.R,e)))}getAllMutationBatchesAffectingDocumentKey(s,o){const e=fC.prefixForPath(this.userId,o.path),t=IDBKeyRange.lowerBound(e),a=[];return gA(s).Ot({range:t},(e,t,n)=>{var[r,i,e]=e,i=cC(i);if(r===this.userId&&o.path.isEqual(i))return pA(s).get(e).next(e=>{if(!e)throw hE();dE(e.userId===this.userId),a.push(JC(this.R,e))});n.done()}).next(()=>a)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new gk(pE);const n=[];return e.forEach(s=>{var e=fC.prefixForPath(this.userId,s.path),e=IDBKeyRange.lowerBound(e),e=gA(t).Ot({range:e},(e,t,n)=>{var[r,i,e]=e,i=cC(i);r===this.userId&&s.path.isEqual(i)?o=o.add(e):n.done()});n.push(e)}),RC.waitFor(n).next(()=>this.Wt(t,o))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,o=s.length+1,n=fC.prefixForPath(this.userId,s),r=IDBKeyRange.lowerBound(n);let a=new gk(pE);return gA(e).Ot({range:r},(e,t,n)=>{var[r,i,e]=e,i=cC(i);r===this.userId&&s.isPrefixOf(i)?i.length===o&&(a=a.add(e)):n.done()}).next(()=>this.Wt(e,a))}Wt(t,e){const n=[],r=[];return e.forEach(e=>{r.push(pA(t).get(e).next(e=>{if(null===e)throw hE();dE(e.userId===this.userId),n.push(JC(this.R,e))}))}),RC.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return uA(t.Mt,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.Gt(n.batchId)}),RC.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}Gt(e){delete this.Kt[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return RC.resolve();const t=IDBKeyRange.lowerBound(fC.prefixForUser(this.userId)),r=[];return gA(n).Ot({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=cC(e[1]);r.push(t)}else n.done()}).next(()=>{dE(0===r.length)})})}containsKey(e,t){return fA(e,this.userId,t)}zt(e){return mA(e).get(this.userId).next(e=>e||new hC(this.userId,-1,""))}}function fA(e,i,t){const n=fC.prefixForPath(i,t.path),s=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return gA(e).Ot({range:r,$t:!0},(e,t,n)=>{var[r,e]=e;r===i&&e===s&&(o=!0),n.done()}).next(()=>o)}function pA(e){return qC(e,dC.store)}function gA(e){return qC(e,fC.store)}function mA(e){return qC(e,hC.store)}class yA{constructor(e){this.Ht=e}next(){return this.Ht+=2,this.Ht}static Jt(){return new yA(0)}static Yt(){return new yA(-1)}}class vA{constructor(e,t){this.referenceDelegate=e,this.R=t}allocateTargetId(n){return this.Xt(n).next(e=>{const t=new yA(e.highestTargetId);return e.highestTargetId=t.next(),this.Zt(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Xt(e).next(e=>vE.fromTimestamp(new yE(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Xt(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Xt(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Zt(t,e)))}addTargetData(t,n){return this.te(t,n).next(()=>this.Xt(t).next(e=>(e.targetCount+=1,this.ee(n,e),this.Zt(t,e))))}updateTargetData(e,t){return this.te(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>_A(t).delete(e.targetId)).next(()=>this.Xt(t)).next(e=>(dE(0<e.targetCount),--e.targetCount,this.Zt(t,e)))}removeTargets(n,r,i){let s=0;const o=[];return _A(n).Ot((e,t)=>{t=XC(t);t.sequenceNumber<=r&&null===i.get(t.targetId)&&(s++,o.push(this.removeTargetData(n,t)))}).next(()=>RC.waitFor(o)).next(()=>s)}forEachTarget(e,n){return _A(e).Ot((e,t)=>{t=XC(t);n(t)})}Xt(e){return wA(e).get(wC.key).next(e=>(dE(null!==e),e))}Zt(e,t){return wA(e).put(wC.key,t)}te(e,t){return _A(e).put(ZC(this.R,t))}ee(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Xt(e).next(e=>e.targetCount)}getTargetData(e,r){var t=tS(r),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let i=null;return _A(e).Ot({range:t,index:vC.queryTargetsIndexName},(e,t,n)=>{t=XC(t);nS(r,t.target)&&(i=t,n.done())}).next(()=>i)}addMatchingKeys(n,e,r){const i=[],s=bA(n);return e.forEach(e=>{var t=oC(e.path);i.push(s.put(new _C(r,t))),i.push(this.referenceDelegate.addReference(n,r,e))}),RC.waitFor(i)}removeMatchingKeys(n,e,r){const i=bA(n);return RC.forEach(e,e=>{var t=oC(e.path);return RC.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=bA(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=bA(e);let i=bk();return r.Ot({range:n,$t:!0},(e,t,n)=>{e=cC(e[1]),e=new FE(e);i=i.add(e)}).next(()=>i)}containsKey(e,t){t=oC(t.path),t=IDBKeyRange.bound([t],[mE(t)],!1,!0);let r=0;return bA(e).Ot({index:_C.documentTargetsIndex,$t:!0,range:t},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}lt(e,t){return _A(e).get(t).next(e=>e?XC(e):null)}}function _A(e){return qC(e,vC.store)}function wA(e){return qC(e,wC.store)}function bA(e){return qC(e,_C.store)}async function IA(e){if(e.code!==rE.FAILED_PRECONDITION||e.message!==kC)throw e;aE("LocalStore","Unexpectedly lost primary lease")}function TA([e,t],[n,r]){n=pE(e,n);return 0===n?pE(t,r):n}class EA{constructor(e){this.ne=e,this.buffer=new gk(TA),this.se=0}ie(){return++this.se}re(e){e=[e,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();TA(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class SA{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.oe=!1,this.ae=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ce(e)}stop(){this.ae&&(this.ae.cancel(),this.ae=null)}get started(){return null!==this.ae}ce(e){var t=this.oe?3e5:6e4;aE("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.ae=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.ae=null,this.oe=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){DC(e)?aE("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await IA(e)}await this.ce(e)})}}class kA{constructor(e,t){this.ue=e,this.params=t}calculateTargetCount(e,t){return this.ue.he(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return RC.resolve(nE.o);const n=new EA(t);return this.ue.forEachTarget(e,e=>n.re(e.sequenceNumber)).next(()=>this.ue.le(e,e=>n.re(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.ue.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.ue.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(aE("LruGarbageCollector","Garbage collection skipped; disabled"),RC.resolve(cA)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(aE("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cA):this.fe(t,n))}getCacheSize(e){return this.ue.getCacheSize(e)}fe(t,n){let r,i,s,o,a,c,l;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(aE("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,o=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,a=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(l=Date.now(),oE()<=lo.DEBUG&&aE("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-u}ms\n\tDetermined least recently used ${i} in `+(a-o)+"ms\n"+`\tRemoved ${s} targets in `+(c-a)+"ms\n"+`\tRemoved ${e} documents in `+(l-c)+"ms\n"+`Total Duration: ${l-u}ms`),RC.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class CA{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new kA(e,t))}he(e){const n=this.de(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}de(e){let t=0;return this.le(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}le(e,n){return this.we(e,(e,t)=>n(t))}addReference(e,t,n){return AA(e,n)}removeReference(e,t,n){return AA(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return AA(e,t)}_e(t,n){let r=!1;return mA(t).Ft(e=>fA(t,e,n).next(e=>(e&&(r=!0),RC.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let o=0;return this.we(n,(t,e)=>{if(e<=r){const r=this._e(n,t).next(e=>{if(!e)return o++,i.getEntry(n,t).next(()=>(i.removeEntry(t),bA(n).delete([0,oC(t.path)])))});s.push(r)}}).next(()=>RC.waitFor(s)).next(()=>i.apply(n)).next(()=>o)}removeTarget(e,t){t=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,t)}updateLimboDocument(e,t){return AA(e,t)}we(e,r){const t=bA(e);let i,s=nE.o;return t.Ot({index:_C.documentTargetsIndex},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==nE.o&&r(new FE(cC(i)),s),s=n,i=t):s=nE.o}).next(()=>{s!==nE.o&&r(new FE(cC(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function AA(e,t){return bA(e).put((t=t,e=e.currentSequenceNumber,new _C(0,oC(t.path),e)))}class RA{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(t,n){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0!==r){for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return void(r[e]=[t,n]);r.push([t,n])}else this.inner[e]=[[t,n]]}delete(t){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return!1;for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return 1===r.length?delete this.inner[n]:r.splice(e,1),!0;return!1}forEach(r){wE(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return bE(this.inner)}}class NA{constructor(){this.changes=new RA(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){e=this.changes.get(e);return e?e.readTime:vE.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:XE.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?RC.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class PA{constructor(e,t){this.R=e,this.qt=t}addEntry(e,t,n){return DA(e).put(MA(t),n)}removeEntry(e,t){const n=DA(e),r=MA(t);return n.delete(r)}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.me(t,e)))}getEntry(e,t){return DA(e).get(MA(t)).next(e=>this.ge(t,e))}ye(e,t){return DA(e).get(MA(t)).next(e=>({document:this.ge(t,e),size:hA(e)}))}getEntries(e,t){let n=yk;return this.pe(e,t,(e,t)=>{t=this.ge(e,t);n=n.insert(e,t)}).next(()=>n)}Ee(e,t){let r=yk,i=new dk(FE.comparator);return this.pe(e,t,(e,t)=>{var n=this.ge(e,t);r=r.insert(e,n),i=i.insert(e,hA(t))}).next(()=>({documents:r,Te:i}))}pe(e,t,i){if(t.isEmpty())return RC.resolve();const n=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),s=t.getIterator();let o=s.getNext();return DA(e).Ot({range:n},(e,t,n)=>{for(var r=FE.fromSegments(e);o&&FE.comparator(o,r)<0;)i(o,null),o=s.getNext();o&&o.isEqual(r)&&(i(o,t),o=s.hasNext()?s.getNext():null),o?n.Ct(o.path.toArray()):n.done()}).next(()=>{for(;o;)i(o,null),o=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,r,t){let i=yk;const s=r.path.length+1,n={};if(t.isEqual(vE.min())){const e=r.path.toArray();n.range=IDBKeyRange.lowerBound(e)}else{const e=r.path.toArray(),i=HC(t);n.range=IDBKeyRange.lowerBound([e,i],!0),n.index=mC.collectionReadTimeIndex}return DA(e).Ot(n,(e,t,n)=>{e.length===s&&(t=WC(this.R,t),r.path.isPrefixOf(t.key.path)?OS(r,t)&&(i=i.insert(t.key,t)):n.done())}).next(()=>i)}newChangeBuffer(e){return new OA(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return xA(e).get(yC.key).next(e=>(dE(!!e),e))}me(e,t){return xA(e).put(yC.key,t)}ge(e,t){if(t){const e=WC(this.R,t);if(!e.isNoDocument()||!e.version.isEqual(vE.min()))return e}return XE.newInvalidDocument(e)}}class OA extends NA{constructor(e,t){super(),this.Ie=e,this.trackRemovals=t,this.Ae=new RA(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(i){const s=[];let o=0,a=new gk((e,t)=>pE(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.Ae.get(e);if(t.document.isValidDocument()){var r=KC(this.Ie.R,t.document,this.getReadTime(e));a=a.add(e.path.popLast());t=hA(r);o+=t-n,s.push(this.Ie.addEntry(i,e,r))}else if(o-=n,this.trackRemovals){const o=KC(this.Ie.R,XE.newNoDocument(e,vE.min()),this.getReadTime(e));s.push(this.Ie.addEntry(i,e,o))}else s.push(this.Ie.removeEntry(i,e))}),a.forEach(e=>{s.push(this.Ie.qt.addToCollectionParentIndex(i,e))}),s.push(this.Ie.updateMetadata(i,o)),RC.waitFor(s)}getFromCache(e,t){return this.Ie.ye(e,t).next(e=>(this.Ae.set(t,e.size),e.document))}getAllFromCache(e,t){return this.Ie.Ee(e,t).next(({documents:e,Te:t})=>(t.forEach((e,t)=>{this.Ae.set(e,t)}),e))}}function xA(e){return qC(e,yC.store)}function DA(e){return qC(e,mC.store)}function MA(e){return e.path.toArray()}class LA{constructor(e){this.R=e}Rt(t,n,e,r){dE(e<r&&0<=e&&r<=11);const i=new NC("createOrUpgrade",n);var s;e<1&&1<=r&&(t.createObjectStore(uC.store),(s=t).createObjectStore(hC.store,{keyPath:hC.keyPath}),s.createObjectStore(dC.store,{keyPath:dC.keyPath,autoIncrement:!0}).createIndex(dC.userMutationsIndex,dC.userMutationsKeyPath,{unique:!0}),s.createObjectStore(fC.store),FA(t),t.createObjectStore(mC.store));let o=RC.resolve();return e<3&&3<=r&&(0!==e&&((s=t).deleteObjectStore(_C.store),s.deleteObjectStore(vC.store),s.deleteObjectStore(wC.store),FA(t)),o=o.next(()=>function(){const e=i.store(wC.store),t=new wC(0,0,vE.min().toTimestamp(),0);return e.put(wC.key,t)}())),e<4&&4<=r&&(0!==e&&(o=o.next(()=>function(r,i){return i.store(dC.store).Nt().next(e=>{r.deleteObjectStore(dC.store),r.createObjectStore(dC.store,{keyPath:dC.keyPath,autoIncrement:!0}).createIndex(dC.userMutationsIndex,dC.userMutationsKeyPath,{unique:!0});const t=i.store(dC.store),n=e.map(e=>t.put(e));return RC.waitFor(n)})}(t,i))),o=o.next(()=>{t.createObjectStore(IC.store,{keyPath:IC.keyPath})})),e<5&&5<=r&&(o=o.next(()=>this.Re(i))),e<6&&6<=r&&(o=o.next(()=>(t.createObjectStore(yC.store),this.Pe(i)))),e<7&&7<=r&&(o=o.next(()=>this.be(i))),e<8&&8<=r&&(o=o.next(()=>this.ve(t,i))),e<9&&9<=r&&(o=o.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),function(){const e=n.objectStore(mC.store);e.createIndex(mC.readTimeIndex,mC.readTimeIndexPath,{unique:!1}),e.createIndex(mC.collectionReadTimeIndex,mC.collectionReadTimeIndexPath,{unique:!1})}()})),e<10&&10<=r&&(o=o.next(()=>this.Ve(i))),e<11&&11<=r&&(o=o.next(()=>{t.createObjectStore(TC.store,{keyPath:TC.keyPath}),t.createObjectStore(EC.store,{keyPath:EC.keyPath})})),o}Pe(t){let n=0;return t.store(mC.store).Ot((e,t)=>{n+=hA(t)}).next(()=>{var e=new yC(n);return t.store(yC.store).put(yC.key,e)})}Re(n){const e=n.store(hC.store),r=n.store(dC.store);return e.Nt().next(e=>RC.forEach(e,t=>{var e=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.Nt(dC.userMutationsIndex,e).next(e=>RC.forEach(e,e=>{dE(e.userId===t.userId);e=JC(this.R,e);return uA(n,t.userId,e).next(()=>{})}))}))}be(e){const o=e.store(_C.store),t=e.store(mC.store);return e.store(wC.store).get(wC.key).next(i=>{const s=[];return t.Ot((e,t)=>{const n=new TE(e),r=[0,oC(n)];s.push(o.get(r).next(e=>e?RC.resolve():(e=>o.put(new _C(0,oC(e),i.highestListenSequenceNumber)))(n)))}).next(()=>RC.waitFor(s))})}ve(e,t){e.createObjectStore(bC.store,{keyPath:bC.keyPath});const n=t.store(bC.store),r=new sA,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:oC(r)})}};return t.store(mC.store).Ot({$t:!0},(e,t)=>{const n=new TE(e);return i(n.popLast())}).next(()=>t.store(fC.store).Ot({$t:!0},([,e],t)=>{const n=cC(e);return i(n.popLast())}))}Ve(e){const n=e.store(vC.store);return n.Ot((e,t)=>{t=XC(t),t=ZC(this.R,t);return n.put(t)})}}function FA(e){e.createObjectStore(_C.store,{keyPath:_C.keyPath}).createIndex(_C.documentTargetsIndex,_C.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(vC.store,{keyPath:vC.keyPath}).createIndex(vC.queryTargetsIndexName,vC.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(wC.store)}const UA="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class jA{constructor(e,t,n,r,i,s,o,a,c,l){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Se=i,this.window=s,this.document=o,this.De=c,this.Ce=l,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.$e=null,this.Oe=null,this.Fe=Number.NEGATIVE_INFINITY,this.Me=e=>Promise.resolve(),!jA.gt())throw new iE(rE.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new CA(this,r),this.Le=t+"main",this.R=new zC(a),this.Be=new PC(this.Le,11,new LA(this.R)),this.Ue=new vA(this.referenceDelegate,this.R),this.qt=new oA,this.qe=(t=this.R,a=this.qt,new PA(t,a)),this.Ke=new tA,this.window&&this.window.localStorage?this.je=this.window.localStorage:(this.je=null,!1===l&&cE("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Qe().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new iE(rE.FAILED_PRECONDITION,UA);return this.We(),this.Ge(),this.ze(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ue.getHighestSequenceNumber(e))}).then(e=>{this.Ne=new nE(e,this.De)}).then(()=>{this.xe=!0}).catch(e=>(this.Be&&this.Be.close(),Promise.reject(e)))}He(t){return this.Me=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Be.bt(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Se.enqueueAndForget(async()=>{this.started&&await this.Qe()}))}Qe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>VA(t).put(new IC(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.Je(t).next(e=>{e||(this.isPrimary=!1,this.Se.enqueueRetryable(()=>this.Me(!1)))})}).next(()=>this.Ye(t)).next(e=>this.isPrimary&&!e?this.Xe(t).next(()=>!1):!!e&&this.Ze(t).next(()=>!0))).catch(e=>{if(DC(e))return aE("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return aE("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Se.enqueueRetryable(()=>this.Me(e)),this.isPrimary=e})}Je(e){return qA(e).get(uC.key).next(e=>RC.resolve(this.tn(e)))}en(e){return VA(e).delete(this.clientId)}async nn(){if(this.isPrimary&&!this.sn(this.Fe,18e5)){this.Fe=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=qC(e,IC.store);return r.Nt().next(e=>{const t=this.rn(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return RC.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.je)for(const t of e)this.je.removeItem(this.on(t.clientId))}}ze(){this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Qe().then(()=>this.nn()).then(()=>this.ze()))}tn(e){return!!e&&e.ownerId===this.clientId}Ye(t){return this.Ce?RC.resolve(!0):qA(t).get(uC.key).next(e=>{if(null!==e&&this.sn(e.leaseTimestampMs,5e3)&&!this.an(e.ownerId)){if(this.tn(e)&&this.networkEnabled)return!0;if(!this.tn(e)){if(!e.allowTabSynchronization)throw new iE(rE.FAILED_PRECONDITION,UA);return!1}}return!(!this.networkEnabled||!this.inForeground)||VA(t).Nt().next(e=>void 0===this.rn(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,e=this.networkEnabled===e.networkEnabled;if(t||n&&e)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&aE("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.xe=!1,this.cn(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.un(),this.hn(),await this.Be.runTransaction("shutdown","readwrite",[uC.store,IC.store],e=>{const t=new jC(e,nE.o);return this.Xe(t).next(()=>this.en(t))}),this.Be.close(),this.ln()}rn(e,t){return e.filter(e=>this.sn(e.updateTimeMs,t)&&!this.an(e.clientId))}fn(){return this.runTransaction("getActiveClients","readonly",e=>VA(e).Nt().next(e=>this.rn(e,18e5).map(e=>e.clientId)))}get started(){return this.xe}getMutationQueue(e){return dA.jt(e,this.R,this.qt,this.referenceDelegate)}getTargetCache(){return this.Ue}getRemoteDocumentCache(){return this.qe}getIndexManager(){return this.qt}getBundleCache(){return this.Ke}runTransaction(t,n,r){aE("IndexedDbPersistence","Starting transaction:",t);let i;return this.Be.runTransaction(t,"readonly"===n?"readonly":"readwrite",SC,e=>(i=new jC(e,this.Ne?this.Ne.next():nE.o),"readwrite-primary"===n?this.Je(i).next(e=>!!e||this.Ye(i)).next(e=>{if(!e)throw cE(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Se.enqueueRetryable(()=>this.Me(!1)),new iE(rE.FAILED_PRECONDITION,kC);return r(i)}).next(e=>this.Ze(i).next(()=>e)):this.dn(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}dn(e){return qA(e).get(uC.key).next(e=>{if(null!==e&&this.sn(e.leaseTimestampMs,5e3)&&!this.an(e.ownerId)&&!this.tn(e)&&!(this.Ce||this.allowTabSynchronization&&e.allowTabSynchronization))throw new iE(rE.FAILED_PRECONDITION,UA)})}Ze(e){var t=new uC(this.clientId,this.allowTabSynchronization,Date.now());return qA(e).put(uC.key,t)}static gt(){return PC.gt()}Xe(e){const t=qA(e);return t.get(uC.key).next(e=>this.tn(e)?(aE("IndexedDbPersistence","Releasing primary lease."),t.delete(uC.key)):RC.resolve())}sn(e,t){var n=Date.now();return!(e<n-t||n<e&&(cE(`Detected an update time that is in the future: ${e} > ${n}`),1))}We(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.$e=()=>{this.Se.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Qe()))},this.document.addEventListener("visibilitychange",this.$e),this.inForeground="visible"===this.document.visibilityState)}un(){this.$e&&(this.document.removeEventListener("visibilitychange",this.$e),this.$e=null)}Ge(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ke=()=>{this.cn(),!gs()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match("Version/14")&&this.Se.enterRestrictedMode(!0),this.Se.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ke))}hn(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)}an(e){var t;try{var n=null!==(null===(t=this.je)||void 0===t?void 0:t.getItem(this.on(e)));return aE("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return cE("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}cn(){if(this.je)try{this.je.setItem(this.on(this.clientId),String(Date.now()))}catch(e){cE("Failed to set zombie client id.",e)}}ln(){if(this.je)try{this.je.removeItem(this.on(this.clientId))}catch(e){}}on(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function qA(e){return qC(e,uC.store)}function VA(e){return qC(e,IC.store)}function BA(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class $A{constructor(e,t){this.progress=e,this.wn=t}}class zA{constructor(e,t,n){this.qe=e,this._n=t,this.qt=n}mn(t,n){return this._n.getAllMutationBatchesAffectingDocumentKey(t,n).next(e=>this.gn(t,n,e))}gn(e,t,n){return this.qe.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}yn(e,n){e.forEach((e,t)=>{for(const e of n)e.applyToLocalView(t)})}pn(t,e){return this.qe.getEntries(t,e).next(e=>this.En(t,e).next(()=>e))}En(e,t){return this._n.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.yn(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,FE.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Tn(e,t.path):SS(t)?this.In(e,t,n):this.An(e,t,n);var r}Tn(e,t){return this.mn(e,new FE(t)).next(e=>{let t=vk;return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}In(n,r,i){const s=r.collectionGroup;let o=vk;return this.qt.getCollectionParents(n,s).next(e=>RC.forEach(e,e=>{var t,t=(t=r,e=e.child(s),new vS(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.An(n,t,i).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}An(t,n,e){let i,s;return this.qe.getDocumentsMatchingQuery(t,n,e).next(e=>(i=e,this._n.getAllMutationBatchesAffectingQuery(t,n))).next(e=>(s=e,this.Rn(t,s,i).next(t=>{i=t;for(const t of s)for(const r of t.mutations){var n=r.key;let e=i.get(n);null==e&&(e=XE.newInvalidDocument(n),i=i.insert(n,e)),ZS(r,e,t.localWriteTime),e.isFoundDocument()||(i=i.remove(n))}}))).next(()=>(i.forEach((e,t)=>{OS(n,t)||(i=i.remove(e))}),i))}Rn(e,t,n){let r=bk();for(const e of t)for(const t of e.mutations)t instanceof rk&&null===n.get(t.key)&&(r=r.add(t.key));let i=n;return this.qe.getEntries(e,r).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(i=i.insert(e,t))}),i))}}class WA{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Pn=n,this.bn=r}static vn(e,t){let n=bk(),r=bk();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new WA(e,t.fromCache,n,r)}}class KA{Vn(e){this.Sn=e}getDocumentsMatchingQuery(t,r,i,s){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(vE.min())?this.Dn(t,r):this.Sn.pn(t,s).next(e=>{const n=this.Cn(r,e);return(bS(r)||IS(r))&&this.Nn(r.limitType,n,s,i)?this.Dn(t,r):(oE()<=lo.DEBUG&&aE("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),PS(r)),this.Sn.getDocumentsMatchingQuery(t,r,i).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t)))})}Cn(n,e){let r=new gk(xS(n));return e.forEach((e,t)=>{OS(n,t)&&(r=r.add(t))}),r}Nn(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Dn(e,t){return oE()<=lo.DEBUG&&aE("QueryEngine","Using full collection scan to execute query:",PS(t)),this.Sn.getDocumentsMatchingQuery(e,t,vE.min())}}class HA{constructor(e,t,n,r){this.persistence=e,this.xn=t,this.R=r,this.kn=new dk(pE),this.$n=new RA(e=>tS(e),nS),this.On=vE.min(),this._n=e.getMutationQueue(n),this.Fn=e.getRemoteDocumentCache(),this.Ue=e.getTargetCache(),this.Mn=new zA(this.Fn,this._n,this.persistence.getIndexManager()),this.Ke=e.getBundleCache(),this.xn.Vn(this.Mn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.kn))}}function GA(e,t,n,r){return new HA(e,t,n,r)}async function QA(e,t){const n=e;let r=n._n,o=n.Mn;e=await n.persistence.runTransaction("Handle user change","readonly",i=>{let s;return n._n.getAllMutationBatches(i).next(e=>(s=e,r=n.persistence.getMutationQueue(t),o=new zA(n.Fn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=bk();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return o.pn(i,r).next(e=>({Ln:e,removedBatchIds:t,addedBatchIds:n}))})});return n._n=r,n.Mn=o,n.xn.Vn(n.Mn),e}function YA(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ue.getLastRemoteSnapshotVersion(e))}function JA(e,n){const u=e,h=n.snapshotVersion;let d=u.kn;return u.persistence.runTransaction("Apply remote event","readwrite-primary",c=>{const e=u.Fn.newChangeBuffer({trackRemovals:!0});d=u.kn;const l=[];n.targetChanges.forEach((e,t)=>{const n=d.get(t);if(n){l.push(u.Ue.removeMatchingKeys(c,e.removedDocuments,t).next(()=>u.Ue.addMatchingKeys(c,e.addedDocuments,t)));const a=e.resumeToken;var r,i,s,o;0<a.approximateByteSize()&&(r=n.withResumeToken(a,h).withSequenceNumber(c.currentSequenceNumber),d=d.insert(t,r),i=n,o=e,dE(0<(s=r).resumeToken.approximateByteSize()),0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size)||l.push(u.Ue.updateTargetData(c,r)))}});let t=yk;if(n.documentUpdates.forEach((e,t)=>{n.resolvedLimboDocuments.has(e)&&l.push(u.persistence.referenceDelegate.updateLimboDocument(c,e))}),l.push(XA(c,e,n.documentUpdates,h,void 0).next(e=>{t=e})),!h.isEqual(vE.min())){const n=u.Ue.getLastRemoteSnapshotVersion(c).next(e=>u.Ue.setTargetsMetadata(c,c.currentSequenceNumber,h));l.push(n)}return RC.waitFor(l).next(()=>e.apply(c)).next(()=>u.Mn.En(c,t)).next(()=>t)}).then(e=>(u.kn=d,e))}function XA(e,o,t,a,c){let n=bk();return t.forEach(e=>n=n.add(e)),o.getEntries(e,n).next(i=>{let s=yk;return t.forEach((e,t)=>{const n=i.get(e),r=(null==c?void 0:c.get(e))||a;t.isNoDocument()&&t.version.isEqual(vE.min())?(o.removeEntry(e,r),s=s.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(o.addEntry(t,r),s=s.insert(e,t)):aE("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),s})}function ZA(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.Ue.getTargetData(t,r).next(e=>e?(n=e,RC.resolve(n)):i.Ue.allocateTargetId(t).next(e=>(n=new $C(r,e,0,t.currentSequenceNumber),i.Ue.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.kn.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.kn=i.kn.insert(e.targetId,e),i.$n.set(r,e.targetId)),e})}async function eR(e,t,n){const r=e,i=r.kn.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!DC(e))throw e;aE("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.kn=r.kn.remove(t),r.$n.delete(i.target)}function tR(e,n,r){const i=e;let s=vE.min(),o=bk();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.$n.get(n);return void 0!==i?RC.resolve(r.kn.get(i)):r.Ue.getTargetData(t,n)}(i,t,CS(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Ue.getMatchingKeysForTargetId(t,e.targetId).next(e=>{o=e})}).next(()=>i.xn.getDocumentsMatchingQuery(t,n,r?s:vE.min(),r?o:bk())).next(e=>({documents:e,Bn:o})))}function nR(e,t){const n=e,r=n.Ue,i=n.kn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.lt(e,t).next(e=>e?e.target:null))}function rR(e){const n=e;return n.persistence.runTransaction("Get new document changes","readonly",e=>function(e,t,n){const r=e;let i=yk,s=HC(n);const o=DA(t),a=IDBKeyRange.lowerBound(s,!0);return o.Ot({index:mC.readTimeIndex,range:a},(e,t)=>{var n=WC(r.R,t);i=i.insert(n.key,n),s=t.readTime}).next(()=>({wn:i,readTime:GC(s)}))}(n.Fn,e,n.On)).then(({wn:e,readTime:t})=>(n.On=t,e))}class iR{constructor(e){this.R=e,this.jn=new Map,this.Qn=new Map}getBundleMetadata(e,t){return RC.resolve(this.jn.get(t))}saveBundleMetadata(e,t){return this.jn.set(t.id,{id:t.id,version:t.version,createTime:Fk(t.createTime)}),RC.resolve()}getNamedQuery(e,t){return RC.resolve(this.Qn.get(t))}saveNamedQuery(e,t){return this.Qn.set(t.name,{name:(t=t).name,query:eA(t.bundledQuery),readTime:Fk(t.readTime)}),RC.resolve()}}class sR{constructor(){this.Wn=new gk(oR.Gn),this.zn=new gk(oR.Hn)}isEmpty(){return this.Wn.isEmpty()}addReference(e,t){t=new oR(e,t);this.Wn=this.Wn.add(t),this.zn=this.zn.add(t)}Jn(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Yn(new oR(e,t))}Xn(e,t){e.forEach(e=>this.removeReference(e,t))}Zn(e){const t=new FE(new TE([])),n=new oR(t,e),r=new oR(t,e+1),i=[];return this.zn.forEachInRange([n,r],e=>{this.Yn(e),i.push(e.key)}),i}ts(){this.Wn.forEach(e=>this.Yn(e))}Yn(e){this.Wn=this.Wn.delete(e),this.zn=this.zn.delete(e)}es(e){var t=new FE(new TE([])),n=new oR(t,e),e=new oR(t,e+1);let r=bk();return this.zn.forEachInRange([n,e],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new oR(e,0),t=this.Wn.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class oR{constructor(e,t){this.key=e,this.ns=t}static Gn(e,t){return FE.comparator(e.key,t.key)||pE(e.ns,t.ns)}static Hn(e,t){return pE(e.ns,t.ns)||FE.comparator(e.key,t.key)}}class aR{constructor(e,t){this.qt=e,this.referenceDelegate=t,this._n=[],this.ss=1,this.rs=new gk(oR.Gn)}checkEmpty(e){return RC.resolve(0===this._n.length)}addMutationBatch(e,t,n,r){var i=this.ss;this.ss++,0<this._n.length&&this._n[this._n.length-1];n=new VC(i,t,n,r);this._n.push(n);for(const t of r)this.rs=this.rs.add(new oR(t.key,i)),this.qt.addToCollectionParentIndex(e,t.key.path.popLast());return RC.resolve(n)}lookupMutationBatch(e,t){return RC.resolve(this.os(t))}getNextMutationBatchAfterBatchId(e,t){t=this.cs(t+1),t=t<0?0:t;return RC.resolve(this._n.length>t?this._n[t]:null)}getHighestUnacknowledgedBatchId(){return RC.resolve(0===this._n.length?-1:this.ss-1)}getAllMutationBatches(e){return RC.resolve(this._n.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new oR(t,0),r=new oR(t,Number.POSITIVE_INFINITY),i=[];return this.rs.forEachInRange([n,r],e=>{e=this.os(e.ns);i.push(e)}),RC.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new gk(pE);return t.forEach(e=>{var t=new oR(e,0),e=new oR(e,Number.POSITIVE_INFINITY);this.rs.forEachInRange([t,e],e=>{n=n.add(e.ns)})}),RC.resolve(this.us(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;FE.isDocumentKey(i)||(i=i.child(""));t=new oR(new FE(i),0);let s=new gk(pE);return this.rs.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(s=s.add(e.ns)),!0)},t),RC.resolve(this.us(s))}us(e){const t=[];return e.forEach(e=>{e=this.os(e);null!==e&&t.push(e)}),t}removeMutationBatch(n,r){dE(0===this.hs(r.batchId,"removed")),this._n.shift();let i=this.rs;return RC.forEach(r.mutations,e=>{var t=new oR(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.rs=i})}Gt(e){}containsKey(e,t){var n=new oR(t,0),n=this.rs.firstAfterOrEqual(n);return RC.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this._n.length,RC.resolve()}hs(e,t){return this.cs(e)}cs(e){return 0===this._n.length?0:e-this._n[0].batchId}os(e){e=this.cs(e);return e<0||e>=this._n.length?null:this._n[e]}}class cR{constructor(e,t){this.qt=e,this.ls=t,this.docs=new dk(FE.comparator),this.size=0}addEntry(e,t,n){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ls(t);return this.docs=this.docs.insert(r,{document:t.clone(),size:o,readTime:n}),this.size+=o-s,this.qt.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return RC.resolve(n?n.document.clone():XE.newInvalidDocument(t))}getEntries(e,t){let n=yk;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.clone():XE.newInvalidDocument(e))}),RC.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=yk;const i=new FE(t.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||OS(t,i)&&(r=r.insert(i.key,i.clone()))}return RC.resolve(r)}fs(e,t){return RC.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new lR(this)}getSize(e){return RC.resolve(this.size)}}class lR extends NA{constructor(e){super(),this.Ie=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.document.isValidDocument()?r.push(this.Ie.addEntry(n,t.document,this.getReadTime(e))):this.Ie.removeEntry(e)}),RC.waitFor(r)}getFromCache(e,t){return this.Ie.getEntry(e,t)}getAllFromCache(e,t){return this.Ie.getEntries(e,t)}}class uR{constructor(e){this.persistence=e,this.ds=new RA(e=>tS(e),nS),this.lastRemoteSnapshotVersion=vE.min(),this.highestTargetId=0,this.ws=0,this._s=new sR,this.targetCount=0,this.gs=yA.Jt()}forEachTarget(e,n){return this.ds.forEach((e,t)=>n(t)),RC.resolve()}getLastRemoteSnapshotVersion(e){return RC.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return RC.resolve(this.ws)}allocateTargetId(e){return this.highestTargetId=this.gs.next(),RC.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ws&&(this.ws=t),RC.resolve()}te(e){this.ds.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.gs=new yA(t),this.highestTargetId=t),e.sequenceNumber>this.ws&&(this.ws=e.sequenceNumber)}addTargetData(e,t){return this.te(t),this.targetCount+=1,RC.resolve()}updateTargetData(e,t){return this.te(t),RC.resolve()}removeTargetData(e,t){return this.ds.delete(t.target),this._s.Zn(t.targetId),--this.targetCount,RC.resolve()}removeTargets(n,r,i){let s=0;const o=[];return this.ds.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.ds.delete(e),o.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),RC.waitFor(o).next(()=>s)}getTargetCount(e){return RC.resolve(this.targetCount)}getTargetData(e,t){t=this.ds.get(t)||null;return RC.resolve(t)}addMatchingKeys(e,t,n){return this._s.Jn(t,n),RC.resolve()}removeMatchingKeys(t,e,n){this._s.Xn(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),RC.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._s.Zn(t),RC.resolve()}getMatchingKeysForTargetId(e,t){t=this._s.es(t);return RC.resolve(t)}containsKey(e,t){return RC.resolve(this._s.containsKey(t))}}class hR{constructor(e,t){var n;this.ys={},this.Ne=new nE(0),this.xe=!1,this.xe=!0,this.referenceDelegate=e(this),this.Ue=new uR(this),this.qt=new iA,this.qe=(n=this.qt,e=e=>this.referenceDelegate.ps(e),new cR(n,e)),this.R=new zC(t),this.Ke=new iR(this.R)}start(){return Promise.resolve()}shutdown(){return this.xe=!1,Promise.resolve()}get started(){return this.xe}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.qt}getMutationQueue(e){let t=this.ys[e.toKey()];return t||(t=new aR(this.qt,this.referenceDelegate),this.ys[e.toKey()]=t),t}getTargetCache(){return this.Ue}getRemoteDocumentCache(){return this.qe}getBundleCache(){return this.Ke}runTransaction(e,t,n){aE("MemoryPersistence","Starting transaction:",e);const r=new dR(this.Ne.next());return this.referenceDelegate.Es(),n(r).next(e=>this.referenceDelegate.Ts(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Is(t,n){return RC.or(Object.values(this.ys).map(e=>()=>e.containsKey(t,n)))}}class dR extends CC{constructor(e){super(),this.currentSequenceNumber=e}}class fR{constructor(e){this.persistence=e,this.As=new sR,this.Rs=null}static Ps(e){return new fR(e)}get bs(){if(this.Rs)return this.Rs;throw hE()}addReference(e,t,n){return this.As.addReference(n,t),this.bs.delete(n.toString()),RC.resolve()}removeReference(e,t,n){return this.As.removeReference(n,t),this.bs.add(n.toString()),RC.resolve()}markPotentiallyOrphaned(e,t){return this.bs.add(t.toString()),RC.resolve()}removeTarget(e,t){this.As.Zn(t.targetId).forEach(e=>this.bs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.bs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Es(){this.Rs=new Set}Ts(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return RC.forEach(this.bs,e=>{const t=FE.fromPath(e);return this.vs(n,t).next(e=>{e||r.removeEntry(t)})}).next(()=>(this.Rs=null,r.apply(n)))}updateLimboDocument(e,t){return this.vs(e,t).next(e=>{e?this.bs.delete(t.toString()):this.bs.add(t.toString())})}ps(e){return 0}vs(e,t){return RC.or([()=>RC.resolve(this.As.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Is(e,t)])}}class pR{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}function gR(e,t){return`firestore_clients_${e}_${t}`}function mR(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function yR(e,t){return`firestore_targets_${e}_${t}`}pR.UNAUTHENTICATED=new pR(null),pR.GOOGLE_CREDENTIALS=new pR("google-credentials-uid"),pR.FIRST_PARTY=new pR("first-party-uid"),pR.MOCK_USER=new pR("mock-user");class vR{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Vs(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new iE(r.error.code,r.error.message))),s?new vR(e,t,r.state,i):(cE("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ss(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class _R{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Vs(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new iE(n.error.code,n.error.message))),i?new _R(e,n.state,r):(cE("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Ss(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class wR{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Vs(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Ik;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=LE(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new wR(e,i):(cE("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class bR{constructor(e,t){this.clientId=e,this.onlineState=t}static Vs(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new bR(t.clientId,t.onlineState):(cE("SharedClientState",`Failed to parse online state: ${e}`),null)}}class IR{constructor(){this.activeTargetIds=Ik}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}Cs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ss(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class TR{constructor(e,t,n,r,i){this.window=e,this.Se=t,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.$s=new dk(pE),this.started=!1,this.Os=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Fs=gR(this.persistenceKey,this.Ns),this.Ms=`firestore_sequence_number_${this.persistenceKey}`,this.$s=this.$s.insert(this.Ns,new IR),this.Ls=new RegExp(`^firestore_clients_${n}_([^_]*)$`),this.Bs=new RegExp(`^firestore_mutations_${n}_(\\d+)(?:_(.*))?$`),this.Us=new RegExp(`^firestore_targets_${n}_(\\d+)$`),this.qs=`firestore_online_state_${this.persistenceKey}`,this.Ks=`firestore_bundle_loaded_${this.persistenceKey}`,this.window.addEventListener("storage",this.xs)}static gt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.fn();for(const n of e)if(n!==this.Ns){const e=this.getItem(gR(this.persistenceKey,n));var t;!e||(t=wR.Vs(n,e))&&(this.$s=this.$s.insert(t.clientId,t))}this.js();const n=this.storage.getItem(this.qs);if(n){const e=this.Qs(n);e&&this.Ws(e)}for(const e of this.Os)this.ks(e);this.Os=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ms,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Gs(this.$s)}isActiveQueryTarget(n){let r=!1;return this.$s.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.zs(e,"pending")}updateMutationState(e,t,n){this.zs(e,t,n),this.Hs(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(yR(this.persistenceKey,e)))||(n=_R.Vs(e,n))&&(t=n.state)),this.Js.Ds(e),this.js(),t}removeLocalQueryTarget(e){this.Js.Cs(e),this.js()}isLocalQueryTarget(e){return this.Js.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(yR(this.persistenceKey,e))}updateQueryState(e,t,n){this.Ys(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Hs(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Xs(e)}notifyBundleLoaded(){this.Zs()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Fs),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return aE("SharedClientState","READ",e,t),t}setItem(e,t){aE("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){aE("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ks(e){const r=e;r.storageArea===this.storage&&(aE("SharedClientState","EVENT",r.key,r.newValue),r.key!==this.Fs?this.Se.enqueueRetryable(async()=>{if(this.started){if(null!==r.key)if(this.Ls.test(r.key)){if(null==r.newValue){var e=this.ti(r.key);return this.ei(e,null)}e=this.ni(r.key,r.newValue);if(e)return this.ei(e.clientId,e)}else if(this.Bs.test(r.key)){if(null!==r.newValue){var t=this.si(r.key,r.newValue);if(t)return this.ii(t)}}else if(this.Us.test(r.key)){if(null!==r.newValue){t=this.ri(r.key,r.newValue);if(t)return this.oi(t)}}else if(r.key===this.qs){if(null!==r.newValue){var n=this.Qs(r.newValue);if(n)return this.Ws(n)}}else if(r.key===this.Ms){n=function(e){let t=nE.o;if(null!=e)try{var n=JSON.parse(e);dE("number"==typeof n),t=n}catch(e){cE("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(r.newValue);n!==nE.o&&this.sequenceNumberHandler(n)}else if(r.key===this.Ks)return this.syncEngine.ai()}else this.Os.push(r)}):cE("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Js(){return this.$s.get(this.Ns)}js(){this.setItem(this.Fs,this.Js.Ss())}zs(e,t,n){const r=new vR(this.currentUser,e,t,n),i=mR(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ss())}Hs(e){e=mR(this.persistenceKey,this.currentUser,e);this.removeItem(e)}Xs(e){e={clientId:this.Ns,onlineState:e};this.storage.setItem(this.qs,JSON.stringify(e))}Ys(e,t,n){const r=yR(this.persistenceKey,e),i=new _R(e,t,n);this.setItem(r,i.Ss())}Zs(){this.setItem(this.Ks,"value-not-used")}ti(e){e=this.Ls.exec(e);return e?e[1]:null}ni(e,t){e=this.ti(e);return wR.Vs(e,t)}si(e,t){var n=this.Bs.exec(e),e=Number(n[1]),n=void 0!==n[2]?n[2]:null;return vR.Vs(new pR(n),e,t)}ri(e,t){e=this.Us.exec(e),e=Number(e[1]);return _R.Vs(e,t)}Qs(e){return bR.Vs(e)}async ii(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.ci(e.batchId,e.state,e.error);aE("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}oi(e){return this.syncEngine.ui(e.targetId,e.state,e.error)}ei(e,t){const n=t?this.$s.insert(e,t):this.$s.remove(e),r=this.Gs(this.$s),i=this.Gs(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.hi(s,o).then(()=>{this.$s=n})}Ws(e){this.$s.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Gs(e){let n=Ik;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class ER{constructor(){this.li=new IR,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.li.Ds(e),this.fi[e]||"not-current"}updateQueryState(e,t,n){this.fi[e]=t}removeLocalQueryTarget(e){this.li.Cs(e)}isLocalQueryTarget(e){return this.li.activeTargetIds.has(e)}clearQueryState(e){delete this.fi[e]}getAllActiveQueryTargets(){return this.li.activeTargetIds}isActiveQueryTarget(e){return this.li.activeTargetIds.has(e)}start(){return this.li=new IR,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class SR{di(e){}shutdown(){}}class kR{constructor(){this.wi=()=>this._i(),this.mi=()=>this.gi(),this.yi=[],this.pi()}di(e){this.yi.push(e)}shutdown(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)}pi(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)}_i(){aE("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.yi)e(0)}gi(){aE("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.yi)e(1)}static gt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const CR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class AR{constructor(e){this.Ei=e.Ei,this.Ti=e.Ti}Ii(e){this.Ai=e}Ri(e){this.Pi=e}onMessage(e){this.bi=e}close(){this.Ti()}send(e){this.Ei(e)}vi(){this.Ai()}Vi(e){this.Pi(e)}Si(e){this.bi(e)}}class RR extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.Di=t+"://"+e.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Ni(t,e,n,r){const i=this.xi(t,e);aE("RestConnection","Sending: ",i,n);e={};return this.ki(e,r),this.$i(t,i,e,n).then(e=>(aE("RestConnection","Received: ",e),e),e=>{throw lE("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e})}Oi(e,t,n,r){return this.Ni(e,t,n,r)}ki(e,t){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+tE,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t)for(const n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])}xi(e,t){e=CR[e];return`${this.Di}/v1/${t}:${e}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}$i(a,t,n,r){return new Promise((i,s)=>{const o=new eE;o.listenOnce(GT.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case HT.NO_ERROR:var e=o.getResponseJson();aE("Connection","XHR received:",JSON.stringify(e)),i(e);break;case HT.TIMEOUT:aE("Connection",'RPC "'+a+'" timed out'),s(new iE(rE.DEADLINE_EXCEEDED,"Request time out"));break;case HT.HTTP_ERROR:var t,n=o.getStatus();if(aE("Connection",'RPC "'+a+'" failed with status:',n,"response text:",o.getResponseText()),0<n){const a=o.getResponseJson().error;a&&a.status&&a.message?(r=a.status.toLowerCase().replace(/_/g,"-"),t=0<=Object.values(rE).indexOf(r)?r:rE.UNKNOWN,s(new iE(t,a.message))):s(new iE(rE.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new iE(rE.UNAVAILABLE,"Connection failed."));break;default:hE()}}finally{aE("Connection",'RPC "'+a+'" completed.')}var r});var e=JSON.stringify(r);o.send(t,"POST",e,n,15)})}Fi(e,t){const n=[this.Di,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=new qT,i=KT(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new XT({})),this.ki(s.initMessageHeaders,t),ps()||ys()||0<=fs().indexOf("Electron/")||vs()||0<=fs().indexOf("MSAppHost/")||ms()||(s.httpHeadersOverwriteParam="$httpHeaders");t=n.join("");aE("Connection","Creating WebChannel: "+t,s);const o=r.createWebChannel(t,s);let a=!1,c=!1;const l=new AR({Ei:e=>{c?aE("Connection","Not sending because WebChannel is closed:",e):(a||(aE("Connection","Opening WebChannel transport."),o.open(),a=!0),aE("Connection","WebChannel sending:",e),o.send(e))},Ti:()=>o.close()}),u=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return u(o,ZT.EventType.OPEN,()=>{c||aE("Connection","WebChannel transport opened.")}),u(o,ZT.EventType.CLOSE,()=>{c||(c=!0,aE("Connection","WebChannel transport closed"),l.Vi())}),u(o,ZT.EventType.ERROR,e=>{c||(c=!0,lE("Connection","WebChannel transport errored:",e),l.Vi(new iE(rE.UNAVAILABLE,"The operation could not be completed")))}),u(o,ZT.EventType.MESSAGE,e=>{if(!c){e=e.data[0];dE(!!e);var n=e.error||(null===(n=e[0])||void 0===n?void 0:n.error);if(n){aE("Connection","WebChannel received error:",n);const r=n.status;let e=function(e){e=WT[e];if(void 0!==e)return hk(e)}(r),t=n.message;void 0===e&&(e=rE.INTERNAL,t="Unknown error status: "+r+" with message "+n.message),c=!0,l.Vi(new iE(e,t)),o.close()}else aE("Connection","WebChannel received:",e),l.Si(e)}}),u(i,QT.STAT_EVENT,e=>{e.stat===YT?aE("Connection","Detected buffering proxy"):e.stat===JT&&aE("Connection","Detected no buffering proxy")}),setTimeout(()=>{l.vi()},0),l}}function NR(){return"undefined"!=typeof window?window:null}function PR(){return"undefined"!=typeof document?document:null}function OR(e){return new Dk(e,!0)}class xR{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Se=e,this.timerId=t,this.Mi=n,this.Li=r,this.Bi=i,this.Ui=0,this.qi=null,this.Ki=Date.now(),this.reset()}reset(){this.Ui=0}ji(){this.Ui=this.Bi}Qi(e){this.cancel();var t=Math.floor(this.Ui+this.Wi()),n=Math.max(0,Date.now()-this.Ki),r=Math.max(0,t-n);0<r&&aE("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ui} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.qi=this.Se.enqueueAfterDelay(this.timerId,r,()=>(this.Ki=Date.now(),e())),this.Ui*=this.Li,this.Ui<this.Mi&&(this.Ui=this.Mi),this.Ui>this.Bi&&(this.Ui=this.Bi)}Gi(){null!==this.qi&&(this.qi.skipDelay(),this.qi=null)}cancel(){null!==this.qi&&(this.qi.cancel(),this.qi=null)}Wi(){return(Math.random()-.5)*this.Ui}}class DR{constructor(e,t,n,r,i,s){this.Se=e,this.zi=n,this.Hi=r,this.Ji=i,this.listener=s,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new xR(e,t)}tr(){return 1===this.state||2===this.state||4===this.state}er(){return 2===this.state}start(){3!==this.state?this.auth():this.nr()}async stop(){this.tr()&&await this.close(0)}sr(){this.state=0,this.Zi.reset()}ir(){this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,()=>this.rr()))}ar(e){this.cr(),this.stream.send(e)}async rr(){if(this.er())return this.close(0)}cr(){this.Xi&&(this.Xi.cancel(),this.Xi=null)}async close(e,t){this.cr(),this.Zi.cancel(),this.Yi++,3!==e?this.Zi.reset():t&&t.code===rE.RESOURCE_EXHAUSTED?(cE(t.toString()),cE("Using maximum backoff delay to prevent overloading the backend."),this.Zi.ji()):t&&t.code===rE.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ur(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ri(t)}ur(){}auth(){this.state=1;const e=this.hr(this.Yi),t=this.Yi;this.Ji.getToken().then(e=>{this.Yi===t&&this.lr(e)},t=>{e(()=>{var e=new iE(rE.UNKNOWN,"Fetching auth token failed: "+t.message);return this.dr(e)})})}lr(e){const t=this.hr(this.Yi);this.stream=this.wr(e),this.stream.Ii(()=>{t(()=>(this.state=2,this.listener.Ii()))}),this.stream.Ri(e=>{t(()=>this.dr(e))}),this.stream.onMessage(e=>{t(()=>this.onMessage(e))})}nr(){this.state=4,this.Zi.Qi(async()=>{this.state=0,this.start()})}dr(e){return aE("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(3,e)}hr(t){return e=>{this.Se.enqueueAndForget(()=>this.Yi===t?e():(aE("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class MR extends DR{constructor(e,t,n,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle",t,n,i),this.R=r}wr(e){return this.Hi.Fi("Listen",e)}onMessage(e){this.Zi.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(s=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===s?1:"REMOVE"===s?2:"CURRENT"===s?3:"RESET"===s?4:hE(),i=t.targetChange.targetIds||[],s=(o=t.targetChange.resumeToken,e.I?(dE(void 0===o||"string"==typeof o),CE.fromBase64String(o||"")):(dE(void 0===o||o instanceof Uint8Array),CE.fromUint8Array(o||new Uint8Array))),o=t.targetChange.cause,a=o&&(o=void 0===(a=o).code?rE.UNKNOWN:hk(a.code),new iE(o,a.message||""));n=new Ck(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;var c=t.documentChange;c.document,c.document.name,c.document.updateTime;var s=Vk(e,c.document.name),l=Fk(c.document.updateTime),a=new JE({mapValue:{fields:c.document.fields}}),l=XE.newFoundDocument(s,l,a),a=c.targetIds||[],c=c.removedTargetIds||[];n=new Sk(a,c,l.key,l)}else if("documentDelete"in t){t.documentDelete;c=t.documentDelete;c.document;var l=Vk(e,c.document),u=c.readTime?Fk(c.readTime):vE.min(),u=XE.newNoDocument(l,u),c=c.removedTargetIds||[];n=new Sk([],c,u.key,u)}else if("documentRemove"in t){t.documentRemove;u=t.documentRemove;u.document;var h=Vk(e,u.document),u=u.removedTargetIds||[];n=new Sk([],u,h,null)}else{if(!("filter"in t))return hE();{t.filter;const e=t.filter;e.targetId;h=e.count||0,t=new lk(h),h=e.targetId;n=new kk(h,t)}}var a,s;return n}(this.R,e),e=function(e){if(!("targetChange"in e))return vE.min();e=e.targetChange;return(!e.targetIds||!e.targetIds.length)&&e.readTime?Fk(e.readTime):vE.min()}(e);return this.listener._r(t,e)}mr(e){const t={};t.database=zk(this.R),t.addTarget=function(e,t){let n;var r=t.target;return n=rS(r)?{documents:Yk(e,r)}:{query:Jk(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=Lk(e,t.resumeToken):0<t.snapshotVersion.compareTo(vE.min())&&(n.readTime=Mk(e,t.snapshotVersion.toTimestamp())),n}(this.R,e);var n,e=(this.R,n=e,null==(e=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return hE()}}())?null:{"goog-listen-tags":e});e&&(t.labels=e),this.ar(t)}gr(e){const t={};t.database=zk(this.R),t.removeTarget=e,this.ar(t)}}class LR extends DR{constructor(e,t,n,r,i){super(e,"write_stream_connection_backoff","write_stream_idle",t,n,i),this.R=r,this.yr=!1}get pr(){return this.yr}start(){this.yr=!1,this.lastStreamToken=void 0,super.start()}ur(){this.yr&&this.Er([])}wr(e){return this.Hi.Fi("Write",e)}onMessage(e){if(dE(!!e.streamToken),this.lastStreamToken=e.streamToken,this.yr){this.Zi.reset();var t=(n=e.writeResults,r=e.commitTime,n&&0<n.length?(dE(void 0!==r),n.map(e=>function(e,t){let n=e.updateTime?Fk(e.updateTime):Fk(t);return n.isEqual(vE.min())&&(n=Fk(t)),new GS(n,e.transformResults||[])}(e,r))):[]),n=Fk(e.commitTime);return this.listener.Tr(n,t)}var n,r;return dE(!e.writeResults||0===e.writeResults.length),this.yr=!0,this.listener.Ir()}Ar(){const e={};e.database=zk(this.R),this.ar(e)}Er(e){e={streamToken:this.lastStreamToken,writes:e.map(e=>Gk(this.R,e))};this.ar(e)}}class FR extends class{}{constructor(e,t,n){super(),this.credentials=e,this.Hi=t,this.R=n,this.Rr=!1}Pr(){if(this.Rr)throw new iE(rE.FAILED_PRECONDITION,"The client has already been terminated.")}Ni(t,n,r){return this.Pr(),this.credentials.getToken().then(e=>this.Hi.Ni(t,n,r,e)).catch(e=>{throw"FirebaseError"===e.name?(e.code===rE.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new iE(rE.UNKNOWN,e.toString())})}Oi(t,n,r){return this.Pr(),this.credentials.getToken().then(e=>this.Hi.Oi(t,n,r,e)).catch(e=>{throw"FirebaseError"===e.name?(e.code===rE.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new iE(rE.UNKNOWN,e.toString())})}terminate(){this.Rr=!0}}class UR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.br=0,this.vr=null,this.Vr=!0}Sr(){0===this.br&&(this.Dr("Unknown"),this.vr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.vr=null,this.Cr("Backend didn't respond within 10 seconds."),this.Dr("Offline"),Promise.resolve())))}Nr(e){"Online"===this.state?this.Dr("Unknown"):(this.br++,1<=this.br&&(this.kr(),this.Cr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Dr("Offline")))}set(e){this.kr(),this.br=0,"Online"===e&&(this.Vr=!1),this.Dr(e)}Dr(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Cr(e){e=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Vr?(cE(e),this.Vr=!1):aE("OnlineStateTracker",e)}kr(){null!==this.vr&&(this.vr.cancel(),this.vr=null)}}class jR{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.$r=[],this.Or=new Map,this.Fr=new Set,this.Mr=[],this.Lr=i,this.Lr.di(e=>{n.enqueueAndForget(async()=>{GR(this)&&(aE("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.Fr.add(4),await VR(t),t.Br.set("Unknown"),t.Fr.delete(4),await qR(t)}(this))})}),this.Br=new UR(n,r)}}async function qR(e){if(GR(e))for(const t of e.Mr)await t(!0)}async function VR(e){for(const t of e.Mr)await t(!1)}function BR(e,t){const n=e;n.Or.has(t.targetId)||(n.Or.set(t.targetId,t),HR(n)?KR(n):nN(n).er()&&zR(n,t))}function $R(e,t){const n=e,r=nN(n);n.Or.delete(t),r.er()&&WR(n,t),0===n.Or.size&&(r.er()?r.ir():GR(n)&&n.Br.set("Unknown"))}function zR(e,t){e.Ur.q(t.targetId),nN(e).mr(t)}function WR(e,t){e.Ur.q(t),nN(e).gr(t)}function KR(t){t.Ur=new Rk({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>t.Or.get(e)||null}),nN(t).start(),t.Br.Sr()}function HR(e){return GR(e)&&!nN(e).tr()&&0<e.Or.size}function GR(e){return 0===e.Fr.size}function QR(e){e.Ur=void 0}async function YR(e,t,n){if(!DC(t))throw t;e.Fr.add(1),await VR(e),e.Br.set("Offline"),n=n||(()=>YA(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{aE("RemoteStore","Retrying IndexedDB access"),await n(),e.Fr.delete(1),await qR(e)})}function JR(t,n){return n().catch(e=>YR(t,e,n))}async function XR(e){const t=e,n=rN(t);let r=0<t.$r.length?t.$r[t.$r.length-1].batchId:-1;for(;GR(i=t)&&i.$r.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n._n.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.$r.length&&n.ir();break}r=e.batchId,function(e,t){e.$r.push(t);const n=rN(e);n.er()&&n.pr&&n.Er(t.mutations)}(t,e)}catch(e){await YR(t,e)}var i;ZR(t)&&eN(t)}function ZR(e){return GR(e)&&!rN(e).tr()&&0<e.$r.length}function eN(e){rN(e).start()}async function tN(e,t){const n=e;t?(n.Fr.delete(2),await qR(n)):t||(n.Fr.add(2),await VR(n),n.Br.set("Unknown"))}function nN(t){return t.qr||(t.qr=function(e,t,n){const r=e;return r.Pr(),new MR(t,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:async function(n){n.Or.forEach((e,t)=>{zR(n,e)})}.bind(null,t),Ri:async function(e,t){QR(e),HR(e)?(e.Br.Nr(t),KR(e)):e.Br.set("Unknown")}.bind(null,t),_r:async function(e,r,t){if(e.Br.set("Online"),r instanceof Ck&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.Or.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.Or.delete(n),e.Ur.removeTarget(n))}(e)}catch(t){aE("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await YR(e,t)}else if(r instanceof Sk?e.Ur.X(r):r instanceof kk?e.Ur.rt(r):e.Ur.et(r),!t.isEqual(vE.min()))try{const r=await YA(e.localStore);0<=t.compareTo(r)&&await function(r,i){const e=r.Ur.ct(i);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.Or.get(t);n&&r.Or.set(t,n.withResumeToken(e.resumeToken,i))}}),e.targetMismatches.forEach(e=>{const t=r.Or.get(e);t&&(r.Or.set(e,t.withResumeToken(CE.EMPTY_BYTE_STRING,t.snapshotVersion)),WR(r,e),e=new $C(t.target,e,1,t.sequenceNumber),zR(r,e))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){aE("RemoteStore","Failed to raise snapshot:",r),await YR(e,r)}}.bind(null,t)}),t.Mr.push(async e=>{e?(t.qr.sr(),HR(t)?KR(t):t.Br.set("Unknown")):(await t.qr.stop(),QR(t))})),t.qr}function rN(t){return t.Kr||(t.Kr=function(e,t,n){const r=e;return r.Pr(),new LR(t,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:async function(e){rN(e).Ar()}.bind(null,t),Ri:async function(e,t){t&&rN(e).pr&&await async function(e,t){if(uk(n=t.code)&&n!==rE.ABORTED){const n=e.$r.shift();rN(e).sr(),await JR(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await XR(e)}var n}(e,t),ZR(e)&&eN(e)}.bind(null,t),Ir:async function(e){const t=rN(e);for(const n of e.$r)t.Er(n.mutations)}.bind(null,t),Tr:async function(e,t,n){const r=e.$r.shift(),i=BC.from(r,t,n);await JR(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await XR(e)}.bind(null,t)}),t.Mr.push(async e=>{e?(t.Kr.sr(),await XR(t)):(await t.Kr.stop(),0<t.$r.length&&(aE("RemoteStore",`Stopping write stream with ${t.$r.length} pending writes`),t.$r=[]))})),t.Kr}class iN{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new AC,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new iN(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new iE(rE.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function sN(e,t){if(cE("AsyncQueue",`${t}: ${e}`),DC(e))return new iE(rE.UNAVAILABLE,`${t}: ${e}`);throw e}class oN{constructor(n){this.comparator=n?(e,t)=>n(e,t)||FE.comparator(e.key,t.key):(e,t)=>FE.comparator(e.key,t.key),this.keyedMap=vk,this.sortedSet=new dk(this.comparator)}static emptySet(e){return new oN(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){e=this.keyedMap.get(e);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof oN))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new oN;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class aN{constructor(){this.jr=new dk(FE.comparator)}track(e){var t=e.doc.key,n=this.jr.get(t);!n||0!==e.type&&3===n.type?this.jr=this.jr.insert(t,e):3===e.type&&1!==n.type?this.jr=this.jr.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.jr=this.jr.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.jr=this.jr.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.jr=this.jr.remove(t):1===e.type&&2===n.type?this.jr=this.jr.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.jr=this.jr.insert(t,{type:2,doc:e.doc}):hE()}Qr(){const n=[];return this.jr.inorderTraversal((e,t)=>{n.push(t)}),n}}class cN{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new cN(e,t,oN.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&RS(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class lN{constructor(){this.Wr=void 0,this.listeners=[]}}class uN{constructor(){this.queries=new RA(e=>NS(e),RS),this.onlineState="Unknown",this.Gr=new Set}}async function hN(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new lN),i)try{s.Wr=await n.onListen(r)}catch(e){const n=sN(e,`Initialization of query '${PS(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.zr(n.onlineState),!s.Wr||t.Hr(s.Wr)&&fN(n)}async function dN(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function fN(e){e.Gr.forEach(e=>{e.next()})}class pN{constructor(e,t,n){this.query=e,this.Jr=t,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}Hr(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new cN(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.Yr?this.Zr(e)&&(this.Jr.next(e),t=!0):this.eo(e,this.onlineState)&&(this.no(e),t=!0),this.Xr=e,t}onError(e){this.Jr.error(e)}zr(e){this.onlineState=e;let t=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,e)&&(this.no(this.Xr),t=!0),t}eo(e,t){return!e.fromCache||!(this.options.so&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}Zr(e){if(0<e.docChanges.length)return!0;var t=this.Xr&&this.Xr.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}no(e){e=cN.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.Yr=!0,this.Jr.next(e)}}class gN{constructor(e,t){this.payload=e,this.byteLength=t}io(){return"metadata"in this.payload}}class mN{constructor(e){this.R=e}Un(e){return Vk(this.R,e)}qn(e){return e.metadata.exists?Hk(this.R,e.document,!1):XE.newNoDocument(this.Un(e.metadata.name),this.Kn(e.metadata.readTime))}Kn(e){return Fk(e)}}class yN{constructor(e,t,n){this.ro=e,this.localStore=t,this.R=n,this.queries=[],this.documents=[],this.progress=vN(e)}oo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ao(e){const t=new Map,n=new mN(this.R);for(const i of e)if(i.metadata.queries){const e=n.Un(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||bk()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=bk(),o=yk,a=_k;for(const e of n){const n=t.Un(e.metadata.name);e.document&&(s=s.add(n)),o=o.insert(n,t.qn(e)),a=a.insert(n,t.Kn(e.metadata.readTime))}const c=i.Fn.newChangeBuffer({trackRemovals:!0}),l=await ZA(i,(r=r,CS(wS(TE.fromString(`__bundle__/docs/${r}`)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>XA(t,c,o,vE.min(),a).next(e=>(c.apply(t),e)).next(e=>i.Ue.removeMatchingKeysForTargetId(t,l.targetId).next(()=>i.Ue.addMatchingKeys(t,s,l.targetId)).next(()=>i.Mn.En(t,e)).next(()=>e)))}(this.localStore,new mN(this.R),this.documents,this.ro.id),t=this.ao(this.documents);for(const e of this.queries)await async function(e,n,r=bk()){const i=await ZA(e,CS(eA(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=Fk(n.readTime);if(0<=i.snapshotVersion.compareTo(t))return s.Ke.saveNamedQuery(e,n);t=i.withResumeToken(CE.EMPTY_BYTE_STRING,t);return s.kn=s.kn.insert(t.targetId,t),s.Ue.updateTargetData(e,t).next(()=>s.Ue.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.Ue.addMatchingKeys(e,r,i.targetId)).next(()=>s.Ke.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",new $A(Object.assign({},this.progress),e)}}function vN(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class _N{constructor(e){this.key=e}}class wN{constructor(e){this.key=e}}class bN{constructor(e,t){this.query=e,this.co=t,this.uo=null,this.current=!1,this.ho=bk(),this.mutatedKeys=bk(),this.lo=xS(e),this.fo=new oN(this.lo)}get wo(){return this.co}_o(e,t){const a=t?t.mo:new aN,c=(t||this).fo;let l=(t||this).mutatedKeys,u=c,h=!1;const d=bS(this.query)&&c.size===this.query.limit?c.last():null,f=IS(this.query)&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((e,t)=>{const n=c.get(e),r=OS(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let o=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(a.track({type:3,doc:r}),o=!0):this.yo(n,r)||(a.track({type:2,doc:r}),o=!0,(d&&0<this.lo(r,d)||f&&this.lo(r,f)<0)&&(h=!0)):!n&&r?(a.track({type:0,doc:r}),o=!0):n&&!r&&(a.track({type:1,doc:n}),o=!0,(d||f)&&(h=!0)),o&&(l=r?(u=u.add(r),s?l.add(e):l.delete(e)):(u=u.delete(e),l.delete(e)))}),bS(this.query)||IS(this.query))for(;u.size>this.query.limit;){const e=bS(this.query)?u.last():u.first();u=u.delete(e.key),l=l.delete(e.key),a.track({type:1,doc:e})}return{fo:u,mo:a,Nn:h,mutatedKeys:l}}yo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.fo;this.fo=e.fo,this.mutatedKeys=e.mutatedKeys;const i=e.mo.Qr();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return hE()}};return n(e)-n(t)}(e.type,t.type)||this.lo(e.doc,t.doc)),this.po(n);var s=t?this.Eo():[],n=0===this.ho.size&&this.current?1:0,t=n!==this.uo;return this.uo=n,0!==i.length||t?{snapshot:new cN(this.query,e.fo,r,i,e.mutatedKeys,0==n,t,!1),To:s}:{To:s}}zr(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({fo:this.fo,mo:new aN,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}}Io(e){return!this.co.has(e)&&!!this.fo.has(e)&&!this.fo.get(e).hasLocalMutations}po(e){e&&(e.addedDocuments.forEach(e=>this.co=this.co.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.co=this.co.delete(e)),this.current=e.current)}Eo(){if(!this.current)return[];const t=this.ho;this.ho=bk(),this.fo.forEach(e=>{this.Io(e.key)&&(this.ho=this.ho.add(e.key))});const n=[];return t.forEach(e=>{this.ho.has(e)||n.push(new wN(e))}),this.ho.forEach(e=>{t.has(e)||n.push(new _N(e))}),n}Ao(e){this.co=e.Bn,this.ho=bk();e=this._o(e.documents);return this.applyChanges(e,!0)}Ro(){return cN.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.uo)}}class IN{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class TN{constructor(e){this.key=e,this.Po=!1}}class EN{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.bo={},this.vo=new RA(e=>NS(e),RS),this.Vo=new Map,this.So=new Set,this.Do=new dk(FE.comparator),this.Co=new Map,this.No=new sR,this.xo={},this.ko=new Map,this.$o=yA.Yt(),this.onlineState="Unknown",this.Oo=void 0}get isPrimaryClient(){return!0===this.Oo}}async function SN(n,e,t,r){n.Fo=(e,i,t)=>async function(e,t,n){let r=t.view._o(i);r.Nn&&(r=await tR(e.localStore,t.query,!1).then(({documents:e})=>t.view._o(e,r)));n=n&&n.targetChanges.get(t.targetId),n=t.view.applyChanges(r,e.isPrimaryClient,n);return DN(e,t.targetId,n.To),n.snapshot}(n,e,t);const i=await tR(n.localStore,e,!0),s=new bN(e,i.Bn),o=s._o(i.documents),a=Ek.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),c=s.applyChanges(o,n.isPrimaryClient,a);DN(n,t,c.To);r=new IN(e,t,s);return n.vo.set(e,r),n.Vo.has(t)?n.Vo.get(t).push(e):n.Vo.set(t,[e]),c.snapshot}async function kN(e,t,n){const r=VN(e);try{const e=await function(e,r){const i=e,s=yE.now(),t=r.reduce((e,t)=>e.add(t.key),bk());let o;return i.persistence.runTransaction("Locally write mutations","readwrite",n=>i.Mn.pn(n,t).next(e=>{o=e;const t=[];for(const n of r){const r=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=US(r.transform,e||null);null!=i&&(null==n&&(n=JE.empty()),n.set(r.field,i))}return n||null}(n,o.get(n.key));null!=r&&t.push(new rk(n.key,r,function r(e){const i=[];return wE(e.fields,(e,t)=>{const n=new SE([e]);if(QE(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new kE(i)}(r.value.mapValue),QS.exists(!0)))}return i._n.addMutationBatch(n,s,t,r)})).then(e=>(e.applyToLocalDocumentSet(o),{batchId:e.batchId,changes:o}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.xo[e.currentUser.toKey()];r=r||new dk(pE),r=r.insert(t,n),e.xo[e.currentUser.toKey()]=r}(r,e.batchId,n),await LN(r,e.changes),await XR(r.remoteStore)}catch(e){const t=sN(e,"Failed to persist write");n.reject(t)}}async function CN(e,t){const r=e;try{const e=await JA(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.Co.get(t);n&&(dE(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.Po=!0:0<e.modifiedDocuments.size?dE(n.Po):0<e.removedDocuments.size&&(dE(n.Po),n.Po=!1))}),await LN(r,e,t)}catch(e){await IA(e)}}function AN(n,r,e){const t=n;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const n=[];t.vo.forEach((e,t)=>{t=t.view.zr(r);t.snapshot&&n.push(t.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.zr(n)&&(r=!0)}),r&&fN(t)}(t.eventManager,r),n.length&&t.bo._r(n),t.onlineState=r,t.isPrimaryClient&&t.sharedClientState.setOnlineState(r)}}async function RN(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.Fn.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let o=RC.resolve();return n.forEach(n=>{o=o.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);dE(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&i.addEntry(e,r.commitVersion))})}),o.next(()=>e._n.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i._n.performConsistencyCheck(e)).next(()=>i.Mn.pn(e,t))})}(n.localStore,t);PN(n,r,null),NN(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await LN(n,e)}catch(e){await IA(e)}}function NN(e,t){(e.ko.get(t)||[]).forEach(e=>{e.resolve()}),e.ko.delete(t)}function PN(e,t,n){const r=e;let i=r.xo[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.xo[r.currentUser.toKey()]=i}}function ON(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Vo.get(e))t.vo.delete(r),n&&t.bo.Mo(r,n);t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(e=>{t.No.containsKey(e)||xN(t,e)})}function xN(e,t){e.So.delete(t.path.canonicalString());var n=e.Do.get(t);null!==n&&($R(e.remoteStore,n),e.Do=e.Do.remove(t),e.Co.delete(n),MN(e))}function DN(e,t,n){for(const r of n)r instanceof _N?(e.No.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.Do.get(n)||e.So.has(r)||(aE("SyncEngine","New document in limbo: "+n),e.So.add(r),MN(e))}(e,r)):r instanceof wN?(aE("SyncEngine","Document no longer in limbo: "+r.key),e.No.removeReference(r.key,t),e.No.containsKey(r.key)||xN(e,r.key)):hE()}function MN(e){for(;0<e.So.size&&e.Do.size<e.maxConcurrentLimboResolutions;){var t=e.So.values().next().value;e.So.delete(t);var n=new FE(TE.fromString(t)),t=e.$o.next();e.Co.set(t,new TN(n)),e.Do=e.Do.insert(n,t),BR(e.remoteStore,new $C(CS(wS(n.path)),t,2,nE.o))}}async function LN(e,n,r){const i=e,s=[],o=[],a=[];i.vo.isEmpty()||(i.vo.forEach((e,t)=>{a.push(i.Fo(t,n,r).then(e=>{e&&(i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),s.push(e),e=WA.vn(t.targetId,e),o.push(e))}))}),await Promise.all(a),i.bo._r(s),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>RC.forEach(t,t=>RC.forEach(t.Pn,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>RC.forEach(t.bn,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!DC(e))throw e;aE("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.kn.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.kn=r.kn.insert(t,i)}}}(i.localStore,o))}async function FN(r,e){const i=r;if(qN(i),VN(i),!0===e&&!0!==i.Oo){const r=i.sharedClientState.getAllActiveQueryTargets(),e=await UN(i,r.toArray());i.Oo=!0,await tN(i.remoteStore,!0);for(const r of e)BR(i.remoteStore,r)}else if(!1===e&&!1!==i.Oo){const r=[];let n=Promise.resolve();i.Vo.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(ON(i,t),eR(i.localStore,t,!0))),$R(i.remoteStore,t)}),await n,await UN(i,r),function(){const n=i;n.Co.forEach((e,t)=>{$R(n.remoteStore,t)}),n.No.ts(),n.Co=new Map,n.Do=new dk(FE.comparator)}(),i.Oo=!1,await tN(i.remoteStore,!1)}}async function UN(t,n){const r=t,i=[],s=[];for(const t of n){let e;const l=r.Vo.get(t);if(l&&0!==l.length){e=await ZA(r.localStore,CS(l[0]));for(const t of l){const n=r.vo.get(t),l=(o=r,a=n,c=void 0,o=await tR((c=o).localStore,a.query,!0),o=a.view.Ao(o),c.isPrimaryClient&&DN(c,a.targetId,o.To),await o);l.snapshot&&s.push(l.snapshot)}}else{const l=await nR(r.localStore,t);e=await ZA(r.localStore,l),await SN(r,jN(l),t,!1)}i.push(e)}var o,a,c;return r.bo._r(s),i}function jN(e){return _S(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function qN(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=CN.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){const n=e,r=n.Co.get(t);if(r&&r.Po)return bk().add(r.key);{let e=bk();const r=n.Vo.get(t);if(!r)return e;for(const t of r){const r=n.vo.get(t);e=e.unionWith(r.view.wo)}return e}}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Co.get(t),s=i&&i.key;if(s){let e=new dk(FE.comparator);e=e.insert(s,XE.newNoDocument(s,vE.min()));const n=bk().add(s),i=new Tk(vE.min(),new Map,new gk(pE),e,n);await CN(r,i),r.Do=r.Do.remove(s),r.Co.delete(t),MN(r)}else await eR(r.localStore,t,!1).then(()=>ON(r,t,n)).catch(IA)}.bind(null,t),t.bo._r=function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Hr(e)&&(r=!0);i.Wr=e}}r&&fN(n)}.bind(null,t.eventManager),t.bo.Mo=function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}.bind(null,t.eventManager),t}function VN(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=RN.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i._n.lookupMutationBatch(t,r).next(e=>(dE(null!==e),n=e.keys(),i._n.removeMutationBatch(t,e))).next(()=>i._n.performConsistencyCheck(t)).next(()=>i.Mn.pn(t,n))})}(r.localStore,t);PN(r,t,n),NN(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await LN(r,e)}catch(n){await IA(n)}}.bind(null,t),t}class BN{constructor(){this.synchronizeTabs=!1}async initialize(e){this.R=OR(e.databaseInfo.databaseId),this.sharedClientState=this.Bo(e),this.persistence=this.Uo(e),await this.persistence.start(),this.gcScheduler=this.qo(e),this.localStore=this.Ko(e)}qo(e){return null}Ko(e){return GA(this.persistence,new KA,e.initialUser,this.R)}Uo(e){return new hR(fR.Ps,this.R)}Bo(e){return new ER}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class $N extends BN{constructor(e,t,n){super(),this.jo=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=e;return t.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(){const e=DA(t);let r=vE.min();return e.Ot({index:mC.readTimeIndex,reverse:!0},(e,t,n)=>{t.readTime&&(r=GC(t.readTime)),n.done()}).next(()=>r)}()).then(e=>{t.On=e})}(this.localStore),await this.jo.initialize(this,e),await VN(this.jo.syncEngine),await XR(this.jo.remoteStore),await this.persistence.He(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Ko(e){return GA(this.persistence,new KA,e.initialUser,this.R)}qo(e){var t=this.persistence.referenceDelegate.garbageCollector;return new SA(t,e.asyncQueue)}Uo(e){var t=BA(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?lA.withCacheSize(this.cacheSizeBytes):lA.DEFAULT;return new jA(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,NR(),PR(),this.R,this.sharedClientState,!!this.forceOwnership)}Bo(e){return new ER}}class zN extends $N{constructor(e,t){super(e,t,!1),this.jo=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);e=this.jo.syncEngine;this.sharedClientState instanceof TR&&(this.sharedClientState.syncEngine={ci:async function(e,t,n,r){var i=e;null!==(e=await function(e,n){const r=e,i=r._n;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Qt(t,n).next(e=>e?r.Mn.pn(t,e):RC.resolve(null)))}(i.localStore,t))?("pending"===n?await XR(i.remoteStore):"acknowledged"===n||"rejected"===n?(PN(i,t,r||null),NN(i,t),i.localStore._n.Gt(t)):hE(),await LN(i,e)):aE("SyncEngine","Cannot apply mutation batch with id: "+t)}.bind(null,e),ui:async function(e,t,n,r){const i=e;if(i.Oo)aE("SyncEngine","Ignoring unexpected query state notification.");else if(i.Vo.has(t))switch(n){case"current":case"not-current":{const e=await rR(i.localStore),r=Tk.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await LN(i,e,r);break}case"rejected":await eR(i.localStore,t,!0),ON(i,t,r);break;default:hE()}}.bind(null,e),hi:async function(e,t,n){const r=qN(e);if(r.Oo){for(const e of t)if(r.Vo.has(e))aE("SyncEngine","Adding an already active target "+e);else{const t=await nR(r.localStore,e),n=await ZA(r.localStore,t);await SN(r,jN(t),n.targetId,!1),BR(r.remoteStore,n)}for(const e of n)r.Vo.has(e)&&await eR(r.localStore,e,!1).then(()=>{$R(r.remoteStore,e),ON(r,e)}).catch(IA)}}.bind(null,e),fn:function(e){return e.localStore.persistence.fn()}.bind(null,e),ai:async function(e){const t=e;return rR(t.localStore).then(e=>LN(t,e))}.bind(null,e)},await this.sharedClientState.start()),await this.persistence.He(async e=>{await FN(this.jo.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())})}Bo(e){var t=NR();if(!TR.gt(t))throw new iE(rE.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=BA(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new TR(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class WN{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>AN(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){aE("SyncEngine","User change. New user:",t.toKey());const r=await QA(n.localStore,t);n.currentUser=t,(e=n).ko.forEach(e=>{e.forEach(e=>{e.reject(new iE(rE.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.ko.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await LN(n,r.Ln)}}.bind(null,this.syncEngine),await tN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new uN}createDatastore(e){var t,n=OR(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new RR(t));return e=e.credentials,t=t,n=n,new FR(e,t,n)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>AN(this.syncEngine,e,0),e=new(kR.gt()?kR:SR),new jR(t,n,r,i,e);var t,n,r,i}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new EN(e,t,n,r,i,s);return o&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;aE("RemoteStore","RemoteStore shutting down."),t.Fr.add(5),await VR(t),t.Lr.shutdown(),t.Br.set("Unknown")}(this.remoteStore)}}function KN(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class HN{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Qo(this.observer.next,e)}error(e){this.observer.error?this.Qo(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Wo(){this.muted=!0}Qo(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class GN{constructor(e,t){this.Go=e,this.R=t,this.metadata=new AC,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(e=>{e&&e.io()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.Go.cancel()}async getMetadata(){return this.metadata.promise}async Lo(){return await this.getMetadata(),this.Ho()}async Ho(){var e=await this.Jo();if(null===e)return null;var t=this.zo.decode(e),n=Number(t);isNaN(n)&&this.Yo(`length string (${t}) is not valid number`);t=await this.Xo(n);return new gN(JSON.parse(t),e.length+n)}Zo(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Jo(){for(;this.Zo()<0&&!await this.ta(););if(0===this.buffer.length)return null;var e=this.Zo();e<0&&this.Yo("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Xo(e){for(;this.buffer.length<e;)await this.ta()&&this.Yo("Reached the end of bundle when more is expected.");var t=this.zo.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Yo(e){throw this.Go.cancel(),new Error(`Invalid bundle format: ${e}`)}async ta(){var e=await this.Go.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class QN{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new iE(rE.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=zk(r.R)+"/documents",i={documents:t.map(e=>qk(r.R,e))},s=await r.Oi("BatchGetDocuments",n,i),o=new Map;s.forEach(e=>{const t=(n=r.R,"found"in(e=e)?function(e,t){dE(!!t.found),t.found.name,t.found.updateTime;var n=Vk(e,t.found.name),e=Fk(t.found.updateTime),t=new JE({mapValue:{fields:t.found.fields}});return XE.newFoundDocument(n,e,t)}(n,e):"missing"in e?function(e,t){dE(!!t.missing),dE(!!t.readTime);e=Vk(e,t.missing),t=Fk(t.readTime);return XE.newNoDocument(e,t)}(n,e):hE());var n;o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{e=o.get(e.toString());dE(!!e),a.push(e)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new ak(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{t=FE.fromPath(t);this.mutations.push(new ck(t,this.precondition(t)))}),await async function(e,t){const n=e,r=zk(n.R)+"/documents",i={writes:t.map(e=>Gk(n.R,e))};await n.Ni("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw hE();t=vE.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new iE(rE.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?QS.updateTime(t):QS.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return QS.exists(!0);if(t.isEqual(vE.min()))throw new iE(rE.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return QS.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class YN{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.ea=5,this.Zi=new xR(this.asyncQueue,"transaction_retry")}run(){--this.ea,this.na()}na(){this.Zi.Qi(async()=>{const t=new QN(this.datastore),e=this.sa(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.ia(e)}))}).catch(e=>{this.ia(e)})})}sa(e){try{var t=this.updateFunction(e);return!DE(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ia(e){0<this.ea&&this.ra(e)?(--this.ea,this.asyncQueue.enqueueAndForget(()=>(this.na(),Promise.resolve()))):this.deferred.reject(e)}ra(e){if("FirebaseError"!==e.name)return!1;e=e.code;return"aborted"===e||"failed-precondition"===e||!uk(e)}}class JN{constructor(e,t,n){this.credentials=e,this.asyncQueue=t,this.databaseInfo=n,this.user=pR.UNAUTHENTICATED,this.clientId=fE.u(),this.credentialListener=()=>Promise.resolve(),this.credentials.setChangeListener(t,async e=>{aE("FirestoreClient","Received user=",e.uid),await this.credentialListener(e),this.user=e})}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.credentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new iE(rE.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new AC;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.removeChangeListener(),n.resolve()}catch(e){var t=sN(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function XN(e,t){e.asyncQueue.verifyOperationInProgress(),aE("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await QA(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function ZN(e,t){e.asyncQueue.verifyOperationInProgress();var n=await eP(e);aE("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>async function(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),aE("RemoteStore","RemoteStore received new credentials");e=GR(n);n.Fr.add(3),await VR(n),e&&n.Br.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Fr.delete(3),await qR(n)}(t.remoteStore,e)),e.onlineComponents=t}async function eP(e){return e.offlineComponents||(aE("FirestoreClient","Using default OfflineComponentProvider"),await XN(e,new BN)),e.offlineComponents}async function tP(e){return e.onlineComponents||(aE("FirestoreClient","Using default OnlineComponentProvider"),await ZN(e,new WN)),e.onlineComponents}function nP(e){return eP(e).then(e=>e.persistence)}function rP(e){return eP(e).then(e=>e.localStore)}function iP(e){return tP(e).then(e=>e.remoteStore)}function sP(e){return tP(e).then(e=>e.syncEngine)}async function oP(e){const t=await tP(e),n=t.eventManager;return n.onListen=async function(e,t){const n=qN(e);let r,i;const s=n.vo.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Ro();else{const e=await ZA(n.localStore,CS(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await SN(n,t,r,"current"===s),n.isPrimaryClient&&BR(n.remoteStore,e)}return i}.bind(null,t.syncEngine),n.onUnlisten=async function(e,t){const n=e,r=n.vo.get(t),i=n.Vo.get(r.targetId);if(1<i.length)return n.Vo.set(r.targetId,i.filter(e=>!RS(e,t))),void n.vo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await eR(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),$R(n.remoteStore,r.targetId),ON(n,r.targetId)}).catch(IA)):(ON(n,r.targetId),await eR(n.localStore,r.targetId,!0))}.bind(null,t.syncEngine),n}function aP(e,t,n={}){const r=new AC;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,i,s,o){const e=new HN({next:e=>{r.enqueueAndForget(()=>dN(n,a));var t=e.docs.has(i);!t&&e.fromCache?o.reject(new iE(rE.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?o.reject(new iE(rE.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(e)},error:e=>o.reject(e)}),a=new pN(wS(i.path),e,{includeMetadataChanges:!0,so:!0});return hN(n,a)}(await oP(e),e.asyncQueue,t,n,r)),r.promise}function cP(e,t,n={}){const r=new AC;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,i){const s=new HN({next:e=>{n.enqueueAndForget(()=>dN(t,o)),e.fromCache&&"server"===r.source?i.reject(new iE(rE.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),o=new pN(e,s,{includeMetadataChanges:!0,so:!0});return hN(t,o)}(await oP(e),e.asyncQueue,t,n,r)),r.promise}function lP(e,t,n,r){const i=function(e,t){e="string"==typeof e?(new TextEncoder).encode(e):e;return e=function(e){if(e instanceof Uint8Array)return KN(e,void 0);if(e instanceof ArrayBuffer)return KN(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(e),t=t,new GN(e,t)}(n,OR(t));e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=Fk(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ke.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),void r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes});r._updateProgress(vN(i));const o=new yN(i,t.localStore,n.R);let e=await n.Lo();for(;e;){const t=await o.oo(e);t&&r._updateProgress(t),e=await n.Lo()}var s=await o.complete();await LN(t,s.wn,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ke.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress)}catch(t){lE("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t)}}(r,t,n).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(await sP(e),i,r)})}class uP{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class hP{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof hP&&e.projectId===this.projectId&&e.database===this.database}}const dP=new Map;class fP{constructor(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${e}`}}class pP{constructor(){this.changeListener=null}getToken(){return Promise.resolve(null)}invalidateToken(){}setChangeListener(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(pR.UNAUTHENTICATED))}removeChangeListener(){this.changeListener=null}}class gP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}setChangeListener(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}removeChangeListener(){this.changeListener=null}}class mP{constructor(t){this.currentUser=pR.UNAUTHENTICATED,this.oa=new AC,this.aa=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.ca=()=>{this.aa++,this.currentUser=this.ua(),this.oa.resolve(),this.changeListener&&this.asyncQueue.enqueueRetryable(()=>this.changeListener(this.currentUser))};const n=e=>{aE("FirebaseCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.ca)};t.onInit(e=>n(e)),setTimeout(()=>{var e;this.auth||((e=t.getImmediate({optional:!0}))?n(e):(aE("FirebaseCredentialsProvider","Auth not yet detected"),this.oa.resolve()))},0)}getToken(){const t=this.aa,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.aa!==t?(aE("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(dE("string"==typeof e.accessToken),new fP(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}setChangeListener(e,t){this.asyncQueue=e,this.asyncQueue.enqueueRetryable(async()=>{await this.oa.promise,await t(this.currentUser),this.changeListener=t})}removeChangeListener(){this.auth&&this.auth.removeAuthTokenListener(this.ca),this.changeListener=()=>Promise.resolve()}ua(){var e=this.auth&&this.auth.getUid();return dE(null===e||"string"==typeof e),new pR(e)}}class yP{constructor(e,t,n){this.ha=e,this.la=t,this.fa=n,this.type="FirstParty",this.user=pR.FIRST_PARTY}get authHeaders(){const e={"X-Goog-AuthUser":this.la},t=this.ha.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),this.fa&&(e["X-Goog-Iam-Authorization-Token"]=this.fa),e}}class vP{constructor(e,t,n){this.ha=e,this.la=t,this.fa=n}getToken(){return Promise.resolve(new yP(this.ha,this.la,this.fa))}setChangeListener(e,t){e.enqueueRetryable(()=>t(pR.FIRST_PARTY))}removeChangeListener(){}invalidateToken(){}}function _P(e,t,n){if(!n)throw new iE(rE.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function wP(e,t,n,r){if(!0===t&&!0===r)throw new iE(rE.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function bP(e){if(!FE.isDocumentKey(e))throw new iE(rE.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function IP(e){if(FE.isDocumentKey(e))throw new iE(rE.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function TP(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":hE();if(t instanceof Array)return"an array";var e=function(){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}();return e?`a custom ${e} object`:"an object"}function EP(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new iE(rE.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");e=TP(e);throw new iE(rE.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}function SP(e,t){if(t<=0)throw new iE(rE.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class kP{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new iE(rE.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new iE(rE.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,wP("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class CP{constructor(e,t){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new kP({}),this._settingsFrozen=!1,e instanceof hP?(this._databaseId=e,this._credentials=new pP):(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new iE(rE.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hP(e.options.projectId)}(e),this._credentials=new mP(t))}get app(){if(!this._app)throw new iE(rE.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new iE(rE.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new kP(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new pP;switch(e.type){case"gapi":var t=e.client;return dE(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new vP(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new iE(rE.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=dP.get(e);t&&(aE("ComponentProvider","Removing Datastore"),dP.delete(e),t.terminate())}(this),Promise.resolve()}}class AP{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new NP(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new AP(this.firestore,e,this._key)}}class RP{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new RP(this.firestore,e,this._query)}}class NP extends RP{constructor(e,t,n){super(e,t,wS(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new AP(this.firestore,null,new FE(e))}withConverter(e){return new NP(this.firestore,e,this._path)}}function PP(e,t,...n){if(e=to(e),_P("collection","path",t),e instanceof CP){var r=TE.fromString(t,...n);return IP(r),new NP(e,null,r)}if(!(e instanceof AP||e instanceof NP))throw new iE(rE.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");t=TE.fromString(e.path,...n).child(TE.fromString(t));return IP(t),new NP(e.firestore,null,t)}function OP(e,t,...n){if(e=to(e),_P("doc","path",t=1===arguments.length?fE.u():t),e instanceof CP){var r=TE.fromString(t,...n);return bP(r),new AP(e,null,new FE(r))}if(!(e instanceof AP||e instanceof NP))throw new iE(rE.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");n=e._path.child(TE.fromString(t,...n));return bP(n),new AP(e.firestore,e instanceof NP?e.converter:null,new FE(n))}function xP(e,t){return e=to(e),t=to(t),(e instanceof AP||e instanceof NP)&&(t instanceof AP||t instanceof NP)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function DP(e,t){return e=to(e),t=to(t),e instanceof RP&&t instanceof RP&&e.firestore===t.firestore&&RS(e._query,t._query)&&e.converter===t.converter}class MP{constructor(){this.da=Promise.resolve(),this.wa=[],this._a=!1,this.ma=[],this.ga=null,this.ya=!1,this.pa=!1,this.Ea=[],this.Zi=new xR(this,"async_queue_retry"),this.Ta=()=>{var e=PR();e&&aE("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Zi.Gi()};const e=PR();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ta)}get isShuttingDown(){return this._a}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ia(),this.Aa(e)}enterRestrictedMode(e){if(!this._a){this._a=!0,this.pa=e||!1;const t=PR();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ta)}}enqueue(e){if(this.Ia(),this._a)return new Promise(()=>{});const t=new AC;return this.Aa(()=>this._a&&this.pa?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.wa.push(e),this.Ra()))}async Ra(){if(0!==this.wa.length){try{await this.wa[0](),this.wa.shift(),this.Zi.reset()}catch(e){if(!DC(e))throw e;aE("AsyncQueue","Operation failed with retryable error: "+e)}0<this.wa.length&&this.Zi.Qi(()=>this.Ra())}}Aa(e){var t=this.da.then(()=>(this.ya=!0,e().catch(e=>{throw this.ga=e,this.ya=!1,cE("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.ya=!1,e))));return this.da=t}enqueueAfterDelay(e,t,n){this.Ia(),-1<this.Ea.indexOf(e)&&(t=0);n=iN.createAndSchedule(this,e,t,n,e=>this.Pa(e));return this.ma.push(n),n}Ia(){this.ga&&hE()}verifyOperationInProgress(){}async ba(){for(var e;await(e=this.da),e!==this.da;);}va(e){for(const t of this.ma)if(t.timerId===e)return!0;return!1}Va(t){return this.ba().then(()=>{this.ma.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.ma)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ba()})}Sa(e){this.Ea.push(e)}Pa(e){e=this.ma.indexOf(e);this.ma.splice(e,1)}}function LP(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class FP{constructor(){this._progressObserver={},this._taskCompletionResolver=new AC,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class UP extends CP{constructor(e,t){super(e,t),this.type="firestore",this._queue=new MP,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||qP(this),this._firestoreClient.terminate()}}function jP(e){return e._firestoreClient||qP(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function qP(e){var t,n,r,i=e._freezeSettings(),i=(t=e._databaseId,n=(null===(r=e._app)||void 0===r?void 0:r.options.appId)||"",r=e._persistenceKey,i=i,new uP(t,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));e._firestoreClient=new JN(e._credentials,e._queue,i)}function VP(e,n,r){const i=new AC;return e.asyncQueue.enqueue(async()=>{try{await XN(e,r),await ZN(e,n),i.resolve()}catch(e){if(!("FirebaseError"===(t=e).name?t.code===rE.FAILED_PRECONDITION||t.code===rE.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),i.reject(e)}var t}).then(()=>i.promise)}function BP(e){return function(e){const t=new AC;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;GR(n.remoteStore)||aE("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t._n.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.ko.get(e)||[];r.push(t),n.ko.set(e,r)}catch(e){const n=sN(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await sP(e),t)),t.promise}(jP(e=EP(e,UP)))}function $P(e){return(n=jP(e=EP(e,UP))).asyncQueue.enqueue(async()=>{const e=await nP(n),t=await iP(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.Fr.delete(0),qR(e)}()});var n}function zP(e){return(n=jP(e=EP(e,UP))).asyncQueue.enqueue(async()=>{const e=await nP(n),t=await iP(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.Fr.add(0),await VR(e),e.Br.set("Offline")}()});var n}function WP(t,e){return n=jP(t=EP(t,UP)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Ke.getNamedQuery(e,t))}(await rP(n),r)).then(e=>e?new RP(t,null,e.query):null);var n,r}function KP(e){if(e._initialized||e._terminated)throw new iE(rE.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class HP{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new iE(rE.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new SE(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class GP{constructor(e){this._byteString=e}static fromBase64String(e){try{return new GP(CE.fromBase64String(e))}catch(e){throw new iE(rE.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new GP(CE.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class QP{constructor(e){this._methodName=e}}class YP{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new iE(rE.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new iE(rE.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return pE(this._lat,e._lat)||pE(this._long,e._long)}}const JP=/^__.*__$/;class XP{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new rk(e,this.data,this.fieldMask,t,this.fieldTransforms):new nk(e,this.data,t,this.fieldTransforms)}}class ZP{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new rk(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function eO(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw hE()}}class tO{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Da(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ca(){return this.settings.Ca}Na(e){return new tO(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}xa(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Na({path:n,ka:!1});return r.$a(e),r}Oa(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Na({path:n,ka:!1});return r.Da(),r}Fa(e){return this.Na({path:void 0,ka:!0})}Ma(e){return bO(e,this.settings.methodName,this.settings.La||!1,this.path,this.settings.Ba)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Da(){if(this.path)for(let e=0;e<this.path.length;e++)this.$a(this.path.get(e))}$a(e){if(0===e.length)throw this.Ma("Document fields must not be empty");if(eO(this.Ca)&&JP.test(e))throw this.Ma('Document fields cannot begin and end with "__"')}}class nO{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.R=n||OR(e)}Ua(e,t,n,r=!1){return new tO({Ca:e,methodName:t,Ba:n,path:SE.emptyPath(),ka:!1,La:r},this.databaseId,this.R,this.ignoreUndefinedProperties)}}function rO(e){var t=e._freezeSettings(),n=OR(e._databaseId);return new nO(e._databaseId,!!t.ignoreUndefinedProperties,n)}function iO(e,t,n,r,i,s={}){const o=e.Ua(s.merge||s.mergeFields?2:0,t,n,i);yO("Data must be an object, but it was:",o,r);r=gO(r,o);let a,c;if(s.merge)a=new kE(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const l of s.mergeFields){const i=vO(t,l,n);if(!o.contains(i))throw new iE(rE.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);IO(e,i)||e.push(i)}a=new kE(e),c=o.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,c=o.fieldTransforms;return new XP(new JE(r),a,c)}class sO extends QP{_toFieldTransform(e){if(2!==e.Ca)throw 1===e.Ca?e.Ma(`${this._methodName}() can only appear at the top level of your update data`):e.Ma(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof sO}}function oO(e,t,n){return new tO({Ca:3,Ba:t.settings.Ba,methodName:e._methodName,ka:n},t.databaseId,t.R,t.ignoreUndefinedProperties)}class aO extends QP{_toFieldTransform(e){return new HS(e.path,new jS)}isEqual(e){return e instanceof aO}}class cO extends QP{constructor(e,t){super(e),this.qa=t}_toFieldTransform(e){const t=oO(this,e,!0),n=this.qa.map(e=>pO(e,t)),r=new qS(n);return new HS(e.path,r)}isEqual(e){return this===e}}class lO extends QP{constructor(e,t){super(e),this.qa=t}_toFieldTransform(e){const t=oO(this,e,!0),n=this.qa.map(e=>pO(e,t)),r=new BS(n);return new HS(e.path,r)}isEqual(e){return this===e}}class uO extends QP{constructor(e,t){super(e),this.Ka=t}_toFieldTransform(e){var t=new zS(e.R,LS(e.R,this.Ka));return new HS(e.path,t)}isEqual(e){return this===e}}function hO(e,i,s,t){const o=e.Ua(1,i,s);yO("Data must be an object, but it was:",o,t);const a=[],c=JE.empty();wE(t,(e,t)=>{var n=wO(i,e,s);t=to(t);e=o.Oa(n);if(t instanceof sO)a.push(n);else{const r=pO(t,e);null!=r&&(a.push(n),c.set(n,r))}});t=new kE(a);return new ZP(c,t,o.fieldTransforms)}function dO(t,n,e,r,i,s){const o=t.Ua(1,n,e),a=[vO(n,r,e)],c=[i];if(s.length%2!=0)throw new iE(rE.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(vO(n,s[e])),c.push(s[e+1]);const l=[],u=JE.empty();for(let e=a.length-1;0<=e;--e)if(!IO(l,a[e])){const n=a[e];var h=to(h=c[e]);const r=o.Oa(n);if(h instanceof sO)l.push(n);else{const t=pO(h,r);null!=t&&(l.push(n),u.set(n,t))}}i=new kE(l);return new ZP(u,i,o.fieldTransforms)}function fO(e,t,n,r=!1){return pO(n,e.Ua(r?4:3,t))}function pO(s,e){if(mO(s=to(s)))return yO("Unsupported field value:",e,s),gO(s,e);if(s instanceof QP)return function(e,t){if(!eO(t.Ca))throw t.Ma(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Ma(`${e._methodName}() is not currently supported inside arrays`);e=e._toFieldTransform(t);e&&t.fieldTransforms.push(e)}(s,e),null;if(void 0===s&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.ka&&4!==e.Ca)throw e.Ma("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const i of s){let e=pO(i,t.Fa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=to(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return LS(t.R,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=yE.fromDate(e);return{timestampValue:Mk(t.R,n)}}if(e instanceof yE){n=new yE(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Mk(t.R,n)}}if(e instanceof YP)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof GP)return{bytesValue:Lk(t.R,e._byteString)};if(e instanceof AP){const r=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(r))throw t.Ma(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Uk(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Ma(`Unsupported field value: ${TP(e)}`)}(0,e)}function gO(e,n){const r={};return bE(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):wE(e,(e,t)=>{t=pO(t,n.xa(e));null!=t&&(r[e]=t)}),{mapValue:{fields:r}}}function mO(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof yE||e instanceof YP||e instanceof GP||e instanceof AP||e instanceof QP)}function yO(e,t,n){if(!mO(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=TP(n);throw"an object"===n?t.Ma(e+" a custom object"):t.Ma(e+" "+n)}var r}function vO(e,t,n){if((t=to(t))instanceof HP)return t._internalPath;if("string"==typeof t)return wO(e,t);throw bO("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}const _O=new RegExp("[~\\*/\\[\\]]");function wO(t,n,r){if(0<=n.search(_O))throw bO(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new HP(...n.split("."))._internalPath}catch(e){throw bO(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function bO(e,t,n,r,i){var s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new iE(rE.INVALID_ARGUMENT,a+e+c)}function IO(e,t){return e.some(e=>e.isEqual(t))}class TO{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new AP(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new EO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){e=this._document.data.field(SO("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e)}}}class EO extends TO{data(){return super.data()}}function SO(e,t){return"string"==typeof t?wO(e,t):(t instanceof HP?t:t._delegate)._internalPath}class kO{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class CO extends TO{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new AO(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){e=this._document.data.field(SO("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e,t.serverTimestamps)}}}class AO extends CO{data(e={}){return super.data(e)}}class RO{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new kO(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new AO(this._firestore,this._userDataWriter,e.key,e,new kO(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){e=!!e.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new iE(rE.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let t=0;return s._snapshot.docChanges.map(e=>({type:"added",doc:new AO(s._firestore,s._userDataWriter,e.doc.key,e.doc,new kO(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:t++}))}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new AO(s._firestore,s._userDataWriter,e.doc.key,e.doc,new kO(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return hE()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function NO(e,t){return e instanceof CO&&t instanceof CO?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof RO&&t instanceof RO&&e._firestore===t._firestore&&DP(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function PO(e){if(IS(e)&&0===e.explicitOrderBy.length)throw new iE(rE.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class OO{}function xO(e,...t){for(const n of t)e=n._apply(e);return e}class DO extends OO{constructor(e,t,n){super(),this.ja=e,this.Qa=t,this.Wa=n,this.type="where"}_apply(e){var t=rO(e.firestore),t=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new iE(rE.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on FieldPath.documentId().`);if("in"===s||"not-in"===s){VO(o,s);const t=[];for(const n of o)t.push(qO(r,e,n));a={arrayValue:{values:t}}}else a=qO(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||VO(o,s),a=fO(n,t,o,"in"===s||"not-in"===s);s=iS.create(i,s,a);return function(e,t){if(t.g()){const r=ES(e);if(null!==r&&!r.isEqual(t.field))throw new iE(rE.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${t.field.toString()}'`);var n=TS(e);null!==n&&BO(0,t.field,n)}const r=function(e,t){for(const n of e.filters)if(0<=t.indexOf(n.op))return n.op;return null}(e,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new iE(rE.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new iE(rE.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}(e,s),s}(e._query,"where",t,e.firestore._databaseId,this.ja,this.Qa,this.Wa);return new RP(e.firestore,e.converter,(e=e._query,t=e.filters.concat([t]),new vS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))}}class MO extends OO{constructor(e,t){super(),this.ja=e,this.Ga=t,this.type="orderBy"}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new iE(rE.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new iE(rE.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new gS(t,n);return t=r,null!==TS(n=e)||null!==(e=ES(n))&&BO(0,e,t.field),r}(e._query,this.ja,this.Ga);return new RP(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new vS(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class LO extends OO{constructor(e,t,n){super(),this.type=e,this.za=t,this.Ha=n}_apply(e){return new RP(e.firestore,e.converter,AS(e._query,this.za,this.Ha))}}class FO extends OO{constructor(e,t,n){super(),this.type=e,this.Ja=t,this.Ya=n}_apply(e){var t=jO(e,this.type,this.Ja,this.Ya);return new RP(e.firestore,e.converter,(e=e._query,t=t,new vS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)))}}class UO extends OO{constructor(e,t,n){super(),this.type=e,this.Ja=t,this.Ya=n}_apply(e){var t=jO(e,this.type,this.Ja,this.Ya);return new RP(e.firestore,e.converter,(e=e._query,t=t,new vS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)))}}function jO(e,t,n,r){if(n[0]=to(n[0]),n[0]instanceof TO)return function(e,t,n,r,i){if(!r)throw new iE(rE.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of kS(e))if(n.field.isKeyField())s.push(zE(t,r.key));else{const e=r.data.field(n.field);if(OE(e))throw new iE(rE.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new iE(rE.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new fS(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=rO(e.firestore);return function(t,n,r,i,s,e){const o=t.explicitOrderBy;if(s.length>o.length)throw new iE(rE.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let e=0;e<s.length;e++){const c=s[e];if(o[e].field.isKeyField()){if("string"!=typeof c)throw new iE(rE.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof c}`);if(!SS(t)&&-1!==c.indexOf("/"))throw new iE(rE.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${i}() must be a plain document ID, but '${c}' contains a slash.`);const r=t.path.child(TE.fromString(c));if(!FE.isDocumentKey(r))throw new iE(rE.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${i}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);const s=new FE(r);a.push(zE(n,s))}else{const t=fO(r,i,c);a.push(t)}}return new fS(a,e)}(e._query,e.firestore._databaseId,i,t,n,r)}function qO(e,t,n){if("string"==typeof(n=to(n))){if(""===n)throw new iE(rE.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!SS(t)&&-1!==n.indexOf("/"))throw new iE(rE.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);t=t.path.child(TE.fromString(n));if(!FE.isDocumentKey(t))throw new iE(rE.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${t}' is not because it has an odd number of segments (${t.length}).`);return zE(e,new FE(t))}if(n instanceof AP)return zE(e,n._key);throw new iE(rE.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${TP(n)}.`)}function VO(e,t){if(!Array.isArray(e)||0===e.length)throw new iE(rE.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new iE(rE.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function BO(e,t,n){if(!n.isEqual(t))throw new iE(rE.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class $O{convertValue(e,t="none"){switch(UE(e)){case 0:return null;case 1:return e.booleanValue;case 2:return NE(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(PE(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw hE()}}convertObject(e,n){const r={};return wE(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new YP(NE(e.latitude),NE(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){t=t.mapValue.fields.__previous_value__;return OE(t)?e(t):t}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(xE(e));default:return null}}convertTimestamp(e){e=RE(e);return new yE(e.seconds,e.nanos)}convertDocumentKey(e,t){const n=TE.fromString(e);dE(sC(n));const r=new hP(n.get(1),n.get(3)),i=new FE(n.popFirst(5));return r.isEqual(t)||cE(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function zO(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class WO extends $O{constructor(e){super(),this.firestore=e}convertBytes(e){return new GP(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new AP(this.firestore,null,e)}}class KO{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=rO(e)}set(e,t,n){this._verifyNotCommitted();const r=HO(e,this._firestore),i=zO(r.converter,t,n),s=iO(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,QS.none())),this}update(e,t,n,...r){this._verifyNotCommitted();e=HO(e,this._firestore);let i;return i="string"==typeof(t=to(t))||t instanceof HP?dO(this._dataReader,"WriteBatch.update",e._key,t,n,r):hO(this._dataReader,"WriteBatch.update",e._key,t),this._mutations.push(i.toMutation(e._key,QS.exists(!0))),this}delete(e){this._verifyNotCommitted();e=HO(e,this._firestore);return this._mutations=this._mutations.concat(new ak(e._key,QS.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new iE(rE.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function HO(e,t){if((e=to(e)).firestore!==t)throw new iE(rE.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class GO extends $O{constructor(e){super(),this.firestore=e}convertBytes(e){return new GP(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new AP(this.firestore,null,e)}}function QO(t){t=EP(t,AP);const n=EP(t.firestore,UP),e=jP(n),r=new GO(n);return function(e,t){const n=new AC;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.Mn.mn(e,t))}(t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new iE(rE.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){t=sN(e,`Failed to get document '${t} from cache`);n.reject(t)}}(await rP(e),t,n)),n.promise}(e,t._key).then(e=>new CO(n,r,t._key,e,new kO(null!==e&&e.hasLocalMutations,!0),t.converter))}function YO(t){t=EP(t,RP);const n=EP(t.firestore,UP),e=jP(n),r=new GO(n);return function(e,t){const n=new AC;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await tR(e,t,!0),i=new bN(t,r.Bn),s=i._o(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){t=sN(e,`Failed to execute query '${t} against cache`);n.reject(t)}}(await rP(e),t,n)),n.promise}(e,t._query).then(e=>new RO(n,r,t,e))}function JO(e,t,n){e=EP(e,AP);var r=EP(e.firestore,UP),t=zO(e.converter,t,n);return t1(r,[iO(rO(r),"setDoc",e._key,t,null!==e.converter,n).toMutation(e._key,QS.none())])}function XO(e,t,n,...r){e=EP(e,AP);var i=EP(e.firestore,UP),s=rO(i);let o;return o="string"==typeof(t=to(t))||t instanceof HP?dO(s,"updateDoc",e._key,t,n,r):hO(s,"updateDoc",e._key,t),t1(i,[o.toMutation(e._key,QS.exists(!0))])}function ZO(t,...n){var e;t=to(t);let r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||LP(n[i])||(r=n[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges};if(LP(n[i])){const t=n[i];n[i]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[i+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[i+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let o,a,c;if(t instanceof AP)a=EP(t.firestore,UP),c=wS(t._key.path),o={next:e=>{n[i]&&n[i](n1(a,t,e))},error:n[i+1],complete:n[i+2]};else{const l=EP(t,RP);a=EP(l.firestore,UP),c=l._query;const u=new GO(a);o={next:e=>{n[i]&&n[i](new RO(a,u,l,e))},error:n[i+1],complete:n[i+2]},PO(t._query)}return function(e,t,n,r){const i=new HN(r),s=new pN(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>hN(await oP(e),s)),()=>{i.Wo(),e.asyncQueue.enqueueAndForget(async()=>dN(await oP(e),s))}}(jP(a),c,s,o)}function e1(e,t){return function(e,t){const n=new HN(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Gr.add(t),t.next()}(await oP(e),n)),()=>{n.Wo(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Gr.delete(t)}(await oP(e),n))}}(jP(e=EP(e,UP)),LP(t)?t:{next:t})}function t1(e,t){return function(e,t){const n=new AC;return e.asyncQueue.enqueueAndForget(async()=>kN(await sP(e),t,n)),n.promise}(jP(e),t)}function n1(e,t,n){var r=n.docs.get(t._key),i=new GO(e);return new CO(e,i,t._key,r,new kO(n.hasPendingWrites,n.fromCache),t.converter)}class r1 extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=rO(e)}get(e){const n=HO(e,this._firestore),r=new WO(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return hE();const t=e[0];if(t.isFoundDocument())return new TO(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new TO(this._firestore,r,n._key,null,n.converter);throw hE()})}set(e,t,n){e=HO(e,this._firestore),t=zO(e.converter,t,n),n=iO(this._dataReader,"Transaction.set",e._key,t,null!==e.converter,n);return this._transaction.set(e._key,n),this}update(e,t,n,...r){e=HO(e,this._firestore),t="string"==typeof(t=to(t))||t instanceof HP?dO(this._dataReader,"Transaction.update",e._key,t,n,r):hO(this._dataReader,"Transaction.update",e._key,t);return this._transaction.update(e._key,t),this}delete(e){e=HO(e,this._firestore);return this._transaction.delete(e._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=HO(e,this._firestore),n=new GO(this._firestore);return super.get(e).then(e=>new CO(this._firestore,n,t._key,e._document,new kO(!1,!1),t.converter))}}function i1(t,n){return function(t,n){const r=new AC;return t.asyncQueue.enqueueAndForget(async()=>{var e=await tP(t).then(e=>e.datastore);new YN(t.asyncQueue,e,n,r).run()}),r.promise}(jP(t),e=>n(new r1(t,e)))}G=xo,tE=G,Ro(new no("firestore",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=new UP(n,e.getProvider("auth-internal"));return t=Object.assign({useFetchStreams:!0},t),r._setSettings(t),r},"PUBLIC")),Fo("@firebase/firestore","3.0.0-2021720181311",void 0);var s1=function(e,t){return(s1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var o1,a1="FirebaseError",c1=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}s1(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(l1,o1=Error),l1);function l1(e,t,n){t=o1.call(this,t)||this;return t.code=e,t.customData=n,t.name=a1,Object.setPrototypeOf(t,l1.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,u1.prototype.create),t}var u1=(h1.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i=t[0]||{},s=this.service+"/"+e,e=this.errors[e],e=e?(r=i,e.replace(d1,function(e,t){var n=r[t];return null!=n?String(n):"<"+t+"?>"})):"Error",e=this.serviceName+": "+e+" ("+s+").";return new c1(s,e,i)},h1);function h1(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var d1=/\{\$([^}]+)}/g;function f1(e){return e&&e._delegate?e._delegate:e}var p1,g1,m1=(y1.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},y1.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},y1.prototype.setServiceProps=function(e){return this.serviceProps=e,this},y1.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},y1);function y1(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}function v1(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new iE("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function _1(){if("undefined"==typeof Uint8Array)throw new iE("unimplemented","Uint8Arrays are not available in this environment.")}function w1(){if("undefined"==typeof atob)throw new iE("unimplemented","Blobs are unavailable in Firestore in this environment.")}class b1{constructor(e){this._delegate=e}static fromBase64String(e){return w1(),new b1(GP.fromBase64String(e))}static fromUint8Array(e){return _1(),new b1(GP.fromUint8Array(e))}toBase64(){return w1(),this._delegate.toBase64()}toUint8Array(){return _1(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function I1(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class T1{enableIndexedDbPersistence(e,t){return function(e,t){KP(e=EP(e,UP));var n=jP(e),r=e._freezeSettings(),e=new WN;return VP(n,e,new $N(e,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){KP(e=EP(e,UP));var t=jP(e),n=e._freezeSettings(),e=new WN;return VP(t,e,new zN(e,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new iE(rE.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new AC;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!PC.gt())return Promise.resolve();e+="main";await PC.delete(e)}(BA(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class E1{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof hP||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||lE("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(n,e,r,i={}){const s=(n=EP(n,CP))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&lE("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${r}`,ssl:!1})),i.mockUserToken){let e,t;if("string"==typeof i.mockUserToken)e=i.mockUserToken,t=pR.MOCK_USER;else{e=ds(i.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new iE(rE.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new pR(s)}n._credentials=new gP(new fP(e,t))}}(this._delegate,e,t,n)}enableNetwork(){return $P(this._delegate)}disableNetwork(){return zP(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,wP("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return BP(this._delegate)}onSnapshotsInSync(e){return e1(this._delegate,e)}get app(){if(!this._appCompat)throw new iE("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new U1(this,PP(this._delegate,e))}catch(e){throw N1(e,"collection()","Firestore.collection()")}}doc(e){try{return new R1(this,OP(this._delegate,e))}catch(e){throw N1(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new M1(this,function(e,t){if(e=EP(e,CP),_P("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new iE(rE.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new RP(e,null,(t=t,new vS(TE.emptyPath(),t)))}(this._delegate,e))}catch(e){throw N1(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return i1(this._delegate,e=>t(new k1(this,e)))}batch(){return jP(this._delegate),new C1(new KO(this._delegate,e=>t1(this._delegate,e)))}loadBundle(e){return t=this._delegate,n=e,r=jP(t=EP(t,UP)),e=new FP,lP(r,t._databaseId,n,e),e;var t,n,r}namedQuery(e){return WP(this._delegate,e).then(e=>e?new M1(this,e):null)}}class S1 extends $O{constructor(e){super(),this.firestore=e}convertBytes(e){return new b1(new GP(e))}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return R1.forKey(e,this.firestore,null)}}class k1{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new S1(e)}get(e){const t=j1(e);return this._delegate.get(t).then(e=>new x1(this._firestore,new CO(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){e=j1(e);return n?(v1("Transaction.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=j1(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=j1(e);return this._delegate.delete(e),this}}class C1{constructor(e){this._delegate=e}set(e,t,n){e=j1(e);return n?(v1("WriteBatch.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=j1(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=j1(e);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class A1{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){e=new AO(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new D1(this._firestore,e),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=A1.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new A1(e,new S1(e),t),r.set(t,i)),i}}A1.INSTANCES=new WeakMap;class R1{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new S1(e)}static forPath(e,t,n){if(e.length%2!=0)throw new iE("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new R1(t,new AP(t._delegate,n,new FE(e)))}static forKey(e,t,n){return new R1(t,new AP(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new U1(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new U1(this.firestore,PP(this._delegate,e))}catch(e){throw N1(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=f1(e))instanceof AP&&xP(this._delegate,e)}set(e,t){t=v1("DocumentReference.set",t);try{return t?JO(this._delegate,e,t):JO(this._delegate,e)}catch(e){throw N1(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?XO(this._delegate,e):XO(this._delegate,e,t,...n)}catch(e){throw N1(e,"updateDoc()","DocumentReference.update()")}}delete(){return t1(EP((e=this._delegate).firestore,UP),[new ak(e._key,QS.none())]);var e}onSnapshot(...e){var t=P1(e),e=O1(e,e=>new x1(this.firestore,new CO(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return ZO(this._delegate,t,e)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?QO:"server"===(null==e?void 0:e.source)?function(t){t=EP(t,AP);const n=EP(t.firestore,UP);return aP(jP(n),t._key,{source:"server"}).then(e=>n1(n,t,e))}:function(t){t=EP(t,AP);const n=EP(t.firestore,UP);return aP(jP(n),t._key).then(e=>n1(n,t,e))})(this._delegate),t.then(e=>new x1(this.firestore,new CO(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new R1(this.firestore,e?this._delegate.withConverter(A1.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function N1(e,t,n){return e.message=e.message.replace(t,n),e}function P1(e){for(const t of e)if("object"==typeof t&&!I1(t))return t;return{}}function O1(e,t){let n;return n=I1(e[0])?e[0]:I1(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{n.next&&n.next(t(e))},error:null===(e=n.error)||void 0===e?void 0:e.bind(n),complete:null===(e=n.complete)||void 0===e?void 0:e.bind(n)}}class x1{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new R1(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return NO(this._delegate,e._delegate)}}class D1 extends x1{data(e){e=this._delegate.data(e);return void 0!==e||hE(),e}}class M1{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new S1(e)}where(e,t,n){try{return new M1(this.firestore,xO(this._delegate,(r=e,i=t,s=n,r=SO("where",e),new DO(r,i,s))))}catch(e){throw N1(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new M1(this.firestore,xO(this._delegate,([n,r="asc"]=[e,t],n=SO("orderBy",n),new MO(n,r))))}catch(e){throw N1(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r}limit(e){try{return new M1(this.firestore,xO(this._delegate,(SP("limit",t=e),new LO("limit",t,"F"))))}catch(e){throw N1(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new M1(this.firestore,xO(this._delegate,(SP("limitToLast",t=e),new LO("limitToLast",t,"L"))))}catch(e){throw N1(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new M1(this.firestore,xO(this._delegate,function(...e){return new FO("startAt",e,!0)}(...e)))}catch(e){throw N1(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new M1(this.firestore,xO(this._delegate,function(...e){return new FO("startAfter",e,!1)}(...e)))}catch(e){throw N1(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new M1(this.firestore,xO(this._delegate,function(...e){return new UO("endBefore",e,!0)}(...e)))}catch(e){throw N1(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new M1(this.firestore,xO(this._delegate,function(...e){return new UO("endAt",e,!1)}(...e)))}catch(e){throw N1(e,"endAt()","Query.endAt()")}}isEqual(e){return DP(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?YO:"server"===(null==e?void 0:e.source)?function(t){t=EP(t,RP);const n=EP(t.firestore,UP),e=jP(n),r=new GO(n);return cP(e,t._query,{source:"server"}).then(e=>new RO(n,r,t,e))}:function(t){t=EP(t,RP);const n=EP(t.firestore,UP),e=jP(n),r=new GO(n);return PO(t._query),cP(e,t._query).then(e=>new RO(n,r,t,e))})(this._delegate),t.then(e=>new F1(this.firestore,new RO(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=P1(e),e=O1(e,e=>new F1(this.firestore,new RO(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return ZO(this._delegate,t,e)}withConverter(e){return new M1(this.firestore,e?this._delegate.withConverter(A1.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class L1{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new D1(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class F1{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new M1(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new D1(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new L1(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new D1(this._firestore,e))})}isEqual(e){return NO(this._delegate,e._delegate)}}class U1 extends M1{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new R1(this.firestore,e):null}doc(e){try{return void 0===e?new R1(this.firestore,OP(this._delegate)):new R1(this.firestore,OP(this._delegate,e))}catch(e){throw N1(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=EP(e.firestore,UP),r=OP(e),i=zO(e.converter,t);return t1(n,[iO(rO(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,QS.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new R1(this.firestore,e))}isEqual(e){return xP(this._delegate,e._delegate)}withConverter(e){return new U1(this.firestore,e?this._delegate.withConverter(A1.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function j1(e){return EP(e,AP)}const q1={Firestore:E1,GeoPoint:YP,Timestamp:yE,Blob:b1,Transaction:k1,WriteBatch:C1,DocumentReference:R1,DocumentSnapshot:x1,Query:M1,QueryDocumentSnapshot:D1,QuerySnapshot:F1,CollectionReference:U1,FieldPath:class e{constructor(...e){this._delegate=new HP(...e)}static documentId(){return new e(SE.keyField().canonicalString())}isEqual(e){return(e=f1(e))instanceof HP&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class n{constructor(e){this._delegate=e}static serverTimestamp(){const e=new aO("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){const e=new sO("deleteField");return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){const t=function(...e){return new cO("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){const t=function(...e){return new lO("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){const t=new uO("increment",e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,sE.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};p1=Wo,g1=(e,t)=>new E1(e,t,new T1),p1.INTERNAL.registerComponent(new m1("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("firestore").getImmediate();return g1(t,e)},"PUBLIC").setServiceProps(Object.assign({},q1))),p1.registerVersion("@firebase/firestore-compat","0.1.0-2021720181311");const V1="type.googleapis.com/google.protobuf.Int64Value",B1="type.googleapis.com/google.protobuf.UInt64Value";function $1(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function z1(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case V1:case B1:var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>z1(e)):"function"==typeof e||"object"==typeof e?$1(e,e=>z1(e)):e}const W1="functions",K1={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class H1 extends Ss{constructor(e,t,n){super(`${W1}/${e}`,t||""),this.details=n}}function G1(e,t){let n=function(e){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=n,i=void 0;try{var s=t&&t.error;if(s){const e=s.status;if("string"==typeof e){if(!K1[e])return new H1("internal","internal");n=K1[e],r=e}var o=s.message;"string"==typeof o&&(r=o),i=s.details,void 0!==i&&(i=z1(i))}}catch(e){}return"ok"===n?null:new H1(n,r,i)}class Q1{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){return this.appCheck?(await this.appCheck.getToken()).token:null}async getContext(){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken()}}}const Y1="us-central1";class J1{constructor(e,t,n,r,i=Y1,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new Q1(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var o=new URL(i);this.customDomain=o.origin,this.region=Y1}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null===this.emulatorOrigin?null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`:`${this.emulatorOrigin}/${t}/${this.region}/${e}`}}function X1(t,n,r){return e=>async function(e,t,n,r){const i=e._url(t),s={data:n=function t(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>t(e));if("function"==typeof e||"object"==typeof e)return $1(e,e=>t(e));throw new Error("Data cannot be encoded in JSON: "+e)}(n)},o={},a=await e.contextProvider.getContext();a.authToken&&(o.Authorization="Bearer "+a.authToken);a.messagingToken&&(o["Firebase-Instance-ID-Token"]=a.messagingToken);null!==a.appCheckToken&&(o["X-Firebase-AppCheck"]=a.appCheckToken);r=r.timeout||7e4,r=await Promise.race([async function(e,t,n,r){n["Content-Type"]="application/json";let i;try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}(i,s,o,e.fetchImpl),function(n){return new Promise((e,t)=>{setTimeout(()=>{t(new H1("deadline-exceeded","deadline-exceeded"))},n)})}(r),e.cancelAllRequests]);if(!r)throw new H1("cancelled","Firebase Functions instance was deleted.");e=G1(r.status,r.json);if(e)throw e;if(!r.json)throw new H1("internal","Response is not valid JSON object.");let c=r.json.data;void 0===c&&(c=r.json.result);if(void 0===c)throw new H1("internal","Response is missing data field.");r=z1(c);return{data:r}}(t,n,e,r||{})}var Z1;function ex(e,t,n){to(e).emulatorOrigin=`http://${t}:${n}`}Z1=fetch.bind(self),Ro(new no(W1,(e,{instanceIdentifier:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-compat"),e=e.getProvider("app-check-internal");return new J1(n,r,i,e,t,Z1)},"PUBLIC").setMultipleInstances(!0)),Fo("@firebase/functions","0.7.0-2021720181311");var tx,nx,rx,ix;class sx{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return X1(to(this._delegate),e,t)}useFunctionsEmulator(e){e=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==e)throw new Ss("functions","No origin provided to useFunctionsEmulator()");if(null==e[2])throw new Ss("functions","Port missing in origin provided to useFunctionsEmulator()");return ex(this._delegate,e[1],Number(e[2]))}useEmulator(e,t){return ex(this._delegate,e,t)}}const ox=(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("functions").getImmediate({identifier:null!=t?t:"us-central1"});return new sx(n,t)};tx={Functions:sx},Wo.INTERNAL.registerComponent(new no("functions-compat",ox,"PUBLIC").setServiceProps(tx).setMultipleInstances(!0)),Wo.registerVersion("@firebase/functions-compat","0.1.0-2021720181311");const ax=new Cs("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});const cx="/firebase-messaging-sw.js",lx="/firebase-cloud-messaging-push-scope",ux="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",hx="https://fcmregistrations.googleapis.com/v1",dx="google.c.a.c_id",fx="google.c.a.c_l",px="google.c.a.ts";function gx(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(dr={})[dr.DATA_MESSAGE=1]="DATA_MESSAGE",dr[dr.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(G=nx=nx||{}).PUSH_RECEIVED="push-received",G.NOTIFICATION_CLICKED="notification-clicked";const mx="fcm_token_details_db",yx=5,vx="fcm_token_object_Store";async function _x(s){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(mx))return null}let o=null;const e=await ia(mx,yx,async e=>{var t;if(!(e.oldVersion<2)&&e.objectStoreNames.contains(vx)){const i=e.transaction.objectStore(vx);var n,r=await i.index("fcmSenderId").get(s);await i.clear(),r&&(2===e.oldVersion?(n=r).auth&&n.p256dh&&n.endpoint&&(o={token:n.fcmToken,createTime:null!==(t=n.createTime)&&void 0!==t?t:Date.now(),subscriptionOptions:{auth:n.auth,p256dh:n.p256dh,endpoint:n.endpoint,swScope:n.swScope,vapidKey:"string"==typeof n.vapidKey?n.vapidKey:gx(n.vapidKey)}}):3===e.oldVersion?(n=r,o={token:n.fcmToken,createTime:n.createTime,subscriptionOptions:{auth:gx(n.auth),p256dh:gx(n.p256dh),endpoint:n.endpoint,swScope:n.swScope,vapidKey:gx(n.vapidKey)}}):4===e.oldVersion&&(r=r,o={token:r.fcmToken,createTime:r.createTime,subscriptionOptions:{auth:gx(r.auth),p256dh:gx(r.p256dh),endpoint:r.endpoint,swScope:r.swScope,vapidKey:gx(r.vapidKey)}}))}});return e.close(),await sa(mx),await sa("fcm_vapid_details_db"),await sa("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(o)?o:null}const wx="firebase-messaging-database",bx=1,Ix="firebase-messaging-store";let Tx=null;function Ex(){return Tx=Tx||ia(wx,bx,e=>{0===e.oldVersion&&e.createObjectStore(Ix)}),Tx}async function Sx(e){var t=Cx(e);const n=await Ex();t=await n.transaction(Ix).objectStore(Ix).get(t);if(t)return t;t=await _x(e.appConfig.senderId);return t?(await kx(e,t),t):void 0}async function kx(e,t){e=Cx(e);const n=await Ex(),r=n.transaction(Ix,"readwrite");return await r.objectStore(Ix).put(t,e),await r.complete,t}function Cx({appConfig:e}){return e.appId}async function Ax(e,t){var n={method:"DELETE",headers:await Nx(e)};try{const s=await fetch(`${Rx(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw ax.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw ax.create("token-unsubscribe-failed",{errorInfo:e})}}function Rx({projectId:e}){return`${hx}/projects/${e}/registrations`}async function Nx({appConfig:e,installations:t}){t=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function Px({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==ux&&(i.web.applicationPubKey=r),i}const Ox=6048e5;async function xx(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:gx(t.getKey("auth")),p256dh:gx(t.getKey("p256dh"))},a=await Sx(e.firebaseDependencies);if(a){if(n=a.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,n=o.p256dh===n.p256dh,r&&i&&s&&n)return Date.now()>=a.createTime+Ox?async function(t,e){try{var n=await async function(e,t){var n=await Nx(e),r=Px(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${Rx(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw ax.create("token-update-failed",{errorInfo:e})}if(i.error){r=i.error.message;throw ax.create("token-update-failed",{errorInfo:r})}if(!i.token)throw ax.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await kx(t.firebaseDependencies,r),n}catch(e){throw await Dx(t),e}}(e,{token:a.token,createTime:Date.now(),subscriptionOptions:o}):a.token;try{await Ax(e.firebaseDependencies,a.token)}catch(e){console.warn(e)}return Mx(e.firebaseDependencies,o)}return Mx(e.firebaseDependencies,o)}async function Dx(e){var t=await Sx(e.firebaseDependencies);t&&(await Ax(e.firebaseDependencies,t.token),await async function(e){e=Cx(e);const t=await Ex(),n=t.transaction(Ix,"readwrite");await n.objectStore(Ix).delete(e),await n.complete}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function Mx(e,t){t={token:await async function(e,t){var n=await Nx(e),t=Px(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const i=await fetch(Rx(e.appConfig),t);r=await i.json()}catch(e){throw ax.create("token-subscribe-failed",{errorInfo:e})}if(r.error){t=r.error.message;throw ax.create("token-subscribe-failed",{errorInfo:t})}if(!r.token)throw ax.create("token-subscribe-no-token");return r.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await kx(e,t),t.token}function Lx(e){var t,n,r,i={from:e.from,collapseKey:e.collapse_key,messageId:e.fcm_message_id};return n=i,(r=e).notification&&(n.notification={},(t=r.notification.title)&&(n.notification.title=t),(t=r.notification.body)&&(n.notification.body=t),(r=r.notification.image)&&(n.notification.image=r)),n=i,(r=e).data&&(n.data=r.data),n=i,(r=e).fcmOptions&&(n.fcmOptions={},(e=r.fcmOptions.link)&&(n.fcmOptions.link=e),(r=r.fcmOptions.analytics_label)&&(n.fcmOptions.analyticsLabel=r)),i}function Fx(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));return r.join("")}function Ux(e){return ax.create("missing-app-config-values",{valueName:e})}Fx("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),Fx("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class jx{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw Ux("App Configuration Object");if(!e.name)throw Ux("App Name");var{options:t}=e;for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw Ux(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function qx(e,t,n){t=function(e){switch(e){case nx.NOTIFICATION_CLICKED:return"notification_open";case nx.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);const r=await e.firebaseDependencies.analyticsProvider.get();r.logEvent(t,{message_id:n[dx],message_name:n[fx],message_time:n[px],message_device_time:Math.floor(Date.now()/1e3)})}async function Vx(e,t){var n,r=t.data;r.isFirebaseMessaging&&(e.onMessageHandler&&r.messageType===nx.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(Lx(r)):e.onMessageHandler.next(Lx(r))),n=r.data,"object"==typeof(t=n)&&t&&dx in t&&"1"===n["google.c.a.e"]&&await qx(e,r.messageType,n))}async function Bx(e){try{e.swRegistration=await navigator.serviceWorker.register(cx,{scope:lx}),e.swRegistration.update().catch(()=>{})}catch(e){throw ax.create("failed-service-worker-registration",{browserErrorMessage:e.message})}}async function $x(e,t){if(!navigator)throw ax.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw ax.create("permission-blocked");var n,r;return n=e,await((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=ux)),await async function(e,t){if(t||e.swRegistration||await Bx(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw ax.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),xx(e)}function zx(e){return async function(e){if(!navigator)throw ax.create("only-available-in-window");return e.swRegistration||await Bx(e),Dx(e)}(e=to(e))}function Wx(e,t){return function(e,t){if(!navigator)throw ax.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=to(e),t)}Ro(new no("messaging",e=>{!async function(){return await bs()&&"indexedDB"in window&&null!==indexedDB&&navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}().then(e=>{if(!e)throw ax.create("unsupported-browser")}).catch(e=>{throw ax.create("indexed-db-unsupported")});const t=new jx(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>Vx(t,e)),t},"PUBLIC"));const Kx=new Cs("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});const Hx="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Gx="https://fcmregistrations.googleapis.com/v1",Qx="FCM_MSG",Yx="google.c.a.c_id",Jx=3,Xx=1;function Zx(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(dr=rx=rx||{})[dr.DATA_MESSAGE=1]="DATA_MESSAGE",dr[dr.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(G=ix=ix||{}).PUSH_RECEIVED="push-received",G.NOTIFICATION_CLICKED="notification-clicked";const eD="fcm_token_details_db",tD=5,nD="fcm_token_object_Store";async function rD(s){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(eD))return null}let o=null;const e=await ia(eD,tD,async e=>{var t;if(!(e.oldVersion<2)&&e.objectStoreNames.contains(nD)){const i=e.transaction.objectStore(nD);var n,r=await i.index("fcmSenderId").get(s);await i.clear(),r&&(2===e.oldVersion?(n=r).auth&&n.p256dh&&n.endpoint&&(o={token:n.fcmToken,createTime:null!==(t=n.createTime)&&void 0!==t?t:Date.now(),subscriptionOptions:{auth:n.auth,p256dh:n.p256dh,endpoint:n.endpoint,swScope:n.swScope,vapidKey:"string"==typeof n.vapidKey?n.vapidKey:Zx(n.vapidKey)}}):3===e.oldVersion?(n=r,o={token:n.fcmToken,createTime:n.createTime,subscriptionOptions:{auth:Zx(n.auth),p256dh:Zx(n.p256dh),endpoint:n.endpoint,swScope:n.swScope,vapidKey:Zx(n.vapidKey)}}):4===e.oldVersion&&(r=r,o={token:r.fcmToken,createTime:r.createTime,subscriptionOptions:{auth:Zx(r.auth),p256dh:Zx(r.p256dh),endpoint:r.endpoint,swScope:r.swScope,vapidKey:Zx(r.vapidKey)}}))}});return e.close(),await sa(eD),await sa("fcm_vapid_details_db"),await sa("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(o)?o:null}const iD="firebase-messaging-database",sD=1,oD="firebase-messaging-store";let aD=null;function cD(){return aD=aD||ia(iD,sD,e=>{0===e.oldVersion&&e.createObjectStore(oD)}),aD}async function lD(e){var t=hD(e);const n=await cD();t=await n.transaction(oD).objectStore(oD).get(t);if(t)return t;t=await rD(e.appConfig.senderId);return t?(await uD(e,t),t):void 0}async function uD(e,t){e=hD(e);const n=await cD(),r=n.transaction(oD,"readwrite");return await r.objectStore(oD).put(t,e),await r.complete,t}function hD({appConfig:e}){return e.appId}async function dD(e,t){var n={method:"DELETE",headers:await pD(e)};try{const s=await fetch(`${fD(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw Kx.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw Kx.create("token-unsubscribe-failed",{errorInfo:e})}}function fD({projectId:e}){return`${Gx}/projects/${e}/registrations`}async function pD({appConfig:e,installations:t}){t=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function gD({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==Hx&&(i.web.applicationPubKey=r),i}const mD=6048e5;async function yD(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:Zx(t.getKey("auth")),p256dh:Zx(t.getKey("p256dh"))},a=await lD(e.firebaseDependencies);if(a){if(n=a.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,n=o.p256dh===n.p256dh,r&&i&&s&&n)return Date.now()>=a.createTime+mD?async function(t,e){try{var n=await async function(e,t){var n=await pD(e),r=gD(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${fD(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw Kx.create("token-update-failed",{errorInfo:e})}if(i.error){r=i.error.message;throw Kx.create("token-update-failed",{errorInfo:r})}if(!i.token)throw Kx.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await uD(t.firebaseDependencies,r),n}catch(e){throw await vD(t),e}}(e,{token:a.token,createTime:Date.now(),subscriptionOptions:o}):a.token;try{await dD(e.firebaseDependencies,a.token)}catch(e){console.warn(e)}return _D(e.firebaseDependencies,o)}return _D(e.firebaseDependencies,o)}async function vD(e){var t=await lD(e.firebaseDependencies);t&&(await dD(e.firebaseDependencies,t.token),await async function(e){e=hD(e);const t=await cD(),n=t.transaction(oD,"readwrite");await n.objectStore(oD).delete(e),await n.complete}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function _D(e,t){t={token:await async function(e,t){var n=await pD(e),t=gD(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const i=await fetch(fD(e.appConfig),t);r=await i.json()}catch(e){throw Kx.create("token-subscribe-failed",{errorInfo:e})}if(r.error){t=r.error.message;throw Kx.create("token-subscribe-failed",{errorInfo:t})}if(!r.token)throw Kx.create("token-subscribe-no-token");return r.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await uD(e,t),t.token}bD("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),bD("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");async function wD(e,t){t=function(e,t){const n={};e.from&&(n.project_number=e.from);e.fcm_message_id&&(n.message_id=e.fcm_message_id);n.instance_id=t,e.notification?n.message_type=rx.DISPLAY_NOTIFICATION.toString():n.message_type=rx.DATA_MESSAGE.toString();n.sdk_platform=Jx.toString(),n.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(n.collapse_key=e.collapse_key);n.event=Xx.toString(),null!==(t=e.fcmOptions)&&void 0!==t&&t.analytics_label&&(n.analytics_label=null===(e=e.fcmOptions)||void 0===e?void 0:e.analytics_label);return n}(t,await e.firebaseDependencies.installations.getId());!function(e,t){const n={};n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),e.logEvents.push(n)}(e,t)}function bD(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));return r.join("")}async function ID(e,t){var n=function({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}(e);if(n){t.deliveryMetricsExportedToBigQueryEnabled&&await wD(t,n);var r,i,s=await ED();if(s.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")))return function(e,t){t.isFirebaseMessaging=!0,t.messageType=ix.PUSH_RECEIVED;for(const n of e)n.postMessage(t)}(s,n);n.notification&&await function(e){var{actions:t}=e,{maxActions:n}=Notification;t&&n&&t.length>n&&console.warn(`This browser only supports ${n} actions. The remaining actions will not be displayed.`);return self.registration.showNotification(null!==(n=e.title)&&void 0!==n?n:"",e)}(function(e){const t=Object.assign({},e.notification);return t.data={[Qx]:e},t}(n)),t&&t.onBackgroundMessageHandler&&(i={from:(r=n).from,collapseKey:r.collapse_key,messageId:r.fcm_message_id},e=i,(s=r).notification&&(e.notification={},(n=s.notification.title)&&(e.notification.title=n),(n=s.notification.body)&&(e.notification.body=n),(s=s.notification.image)&&(e.notification.image=s)),e=i,(s=r).data&&(e.data=s.data),e=i,(s=r).fcmOptions&&(e.fcmOptions={},(r=s.fcmOptions.link)&&(e.fcmOptions.link=r),(s=s.fcmOptions.analytics_label)&&(e.fcmOptions.analyticsLabel=s)),i=i,"function"==typeof t.onBackgroundMessageHandler?t.onBackgroundMessageHandler(i):t.onBackgroundMessageHandler.next(i))}}async function TD(e){const t=null===(i=null===(n=e.notification)||void 0===n?void 0:n.data)||void 0===i?void 0:i[Qx];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var n=function(e){var t;var n=null!==(t=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==t?t:null===(n=e.notification)||void 0===n?void 0:n.click_action;if(n)return n;return function(e){return"object"==typeof e&&e&&Yx in e}(e.data)?self.location.origin:null}(t);if(n){var r,i=new URL(n,self.location.href),e=new URL(self.location.origin);if(i.host===e.host){let e=await async function(e){var t=await ED();for(const r of t){var n=new URL(r.url,self.location.href);if(e.host===n.host)return r}return null}(i);if(e?e=await e.focus():(e=await self.clients.openWindow(n),r=3e3,await new Promise(e=>{setTimeout(e,r)})),e)return t.messageType=ix.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}}function ED(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function SD(e){return Kx.create("missing-app-config-values",{valueName:e})}class kD{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw SD("App Configuration Object");if(!e.name)throw SD("App Name");var{options:t}=e;for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw SD(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}function CD(e,t){return function(e,t){if(void 0!==self.document)throw Kx.create("only-available-in-sw");return e.onBackgroundMessageHandler=t,()=>{e.onBackgroundMessageHandler=null}}(e=to(e),t)}Ro(new no("messaging-sw",e=>{!async function(){return await bs()&&"indexedDB"in self&&null!==indexedDB&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}().then(e=>{if(!e)throw Kx.create("unsupported-browser")}).catch(e=>{throw Kx.create("indexed-db-unsupported")});const t=new kD(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(ID(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(async function(e,t){var{newSubscription:e}=e;e?(e=await lD(t.firebaseDependencies),await vD(t),t.vapidKey=null!==(e=null===(e=null==e?void 0:e.subscriptionOptions)||void 0===e?void 0:e.vapidKey)&&void 0!==e?e:Hx,await yD(t)):await vD(t)}(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(TD(e))}),t},"PUBLIC"));var AD;class RD{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return async function(e,t){return $x(e=to(e),t)}(this._delegate,e)}async deleteToken(){return zx(this._delegate)}onMessage(e){return Wx(this._delegate,e)}onBackgroundMessage(e){return CD(this._delegate,e)}}Wo.INTERNAL.registerComponent(new no("messaging-compat",e=>navigator?new RD(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()):new RD(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()),"PUBLIC")),Wo.registerVersion("@firebase/messaging-compat","0.1.0-2021720181311"),(dr=AD=AD||{})[dr.NO_ERROR=0]="NO_ERROR",dr[dr.NETWORK_ERROR=1]="NETWORK_ERROR",dr[dr.ABORT=2]="ABORT";const ND="firebasestorage.googleapis.com",PD="storageBucket";class OD extends Ss{constructor(e,t){super(xD(e),`Firebase Storage: ${t} (${xD(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,OD.prototype)}_codeEquals(e){return xD(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function xD(e){return"storage/"+e}function DD(){return new OD("unknown","An unknown error occurred, please check the error payload for server response.")}function MD(){return new OD("canceled","User canceled the upload/download.")}function LD(){return new OD("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function FD(e){return new OD("invalid-argument",e)}function UD(){return new OD("app-deleted","The Firebase app was deleted.")}function jD(e){return new OD("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function qD(e,t){return new OD("invalid-format","String does not match format '"+e+"': "+t)}function VD(e){throw new OD("internal-error","Internal error: "+e)}class BD{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=AD.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=AD.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=AD.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw VD("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw VD("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw VD("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponseText(){if(!this.sent_)throw VD("cannot .getResponseText() before sending");return this.xhr_.responseText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class $D{createConnection(){return new BD}}class zD{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=zD.makeFromUrl(t,e)}catch(e){return new zD(t,"")}if(""===n.path)return n;throw t=t,new OD("invalid-default-bucket","Invalid default bucket '"+t+"'.")}static makeFromUrl(t,e){let n=null;var r="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var o=e.replace(/[.]/g,"\\."),o=new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),e=e===ND?"(?:storage.googleapis.com|storage.cloud.google.com)":e,a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${e}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let e=0;e<a.length;e++){const u=a[e];var c=u.regex.exec(t);if(c){var l=c[u.indices.bucket];let e=c[u.indices.path];e=e||"",n=new zD(l,e),u.postModify(n);break}}if(null==n)throw r=t,new OD("invalid-url","Invalid URL '"+r+"'.");return n}}class WD{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function KD(e){return"string"==typeof e||e instanceof String}function HD(e){return GD()&&e instanceof Blob}function GD(){return"undefined"!=typeof Blob}function QD(e,t,n,r){if(r<t)throw FD(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n<r)throw FD(`Invalid value for '${e}'. Expected ${n} or less.`)}function YD(e,t){var n=t.match(/^(\w+):\/\/.+/);let r=null==(null==n?void 0:n[1])?`https://${t}`:t;return`${r}/v0${e}`}function JD(e){const t=encodeURIComponent;let n="?";for(const i in e){var r;e.hasOwnProperty(i)&&(r=t(i)+"="+t(e[i]),n=n+r+"&")}return n=n.slice(0,-1),n}class XD{constructor(e,t,n,r,i,s,o,a,c,l,u){this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=s.slice(),this.callback_=o,this.errorCallback_=a,this.progressCallback_=l,this.timeout_=c,this.pool_=u,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const c=this;function e(e,t){const n=c.resolve_,r=c.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=c.callback_(i,i.getResponseText());void 0!==s?n(s):n()}catch(e){r(e)}else if(null!==i){const a=DD();a.serverResponse=i.getResponseText(),c.errorCallback_?r(c.errorCallback_(i,a)):r(a)}else{var o;t.canceled?(o=(c.appDelete_?UD:MD)(),r(o)):(o=new OD("retry-limit-exceeded","Max retry time for operation exceeded, please try again."),r(o))}}this.canceled_?e(0,new ZD(!1,null,!0)):this.backoffId_=function(t,n,e){let r=1,i=null,s=!1,o=0;function a(){return 2===o}let c=!1;function l(...e){c||(c=!0,n.apply(null,e))}function u(e){i=setTimeout(()=>{i=null,t(h,a())},e)}function h(e,...t){if(!c)if(e)l.call(null,e,...t);else if(a()||s)l.call(null,e,...t);else{r<64&&(r*=2);let e;e=1===o?(o=2,0):1e3*(r+Math.random()),u(e)}}let d=!1;function f(e){d||(d=!0,c||(null!==i?(e||(o=2),clearTimeout(i),u(0)):e||(o=1)))}return u(0),setTimeout(()=>{f(s=!0)},e),f}(function(r,e){if(e)r(!1,new ZD(!1,null,!0));else{const s=c.pool_.createConnection();function i(e){var t=e.loaded,e=e.lengthComputable?e.total:-1;null!==c.progressCallback_&&c.progressCallback_(t,e)}c.pendingConnection_=s,null!==c.progressCallback_&&s.addUploadProgressListener(i),s.send(c.url_,c.method_,c.body_,c.headers_).then(()=>{null!==c.progressCallback_&&s.removeUploadProgressListener(i),c.pendingConnection_=null;var e,t=s.getErrorCode()===AD.NO_ERROR,n=s.getStatus();t&&!c.isRetryStatusCode_(n)?(e=-1!==c.successCodes_.indexOf(n),r(!0,new ZD(e,s))):(e=s.getErrorCode()===AD.ABORT,r(!1,new ZD(!1,null,e)))})}},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){var t=500<=e&&e<600,n=-1!==[408,429].indexOf(e),e=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||e}}class ZD{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function eM(...t){const e="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==e){const n=new e;for(let e=0;e<t.length;e++)n.append(t[e]);return n.getBlob()}if(GD())return new Blob(t);throw new OD("unsupported-environment","This browser doesn't seem to support creating Blobs")}const tM={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class nM{constructor(e,t){this.data=e,this.contentType=t||null}}function rM(e,t){switch(e){case tM.RAW:return new nM(iM(t));case tM.BASE64:case tM.BASE64URL:return new nM(sM(e,t));case tM.DATA_URL:return new nM(function(e){e=new oM(e);return e.base64?sM(tM.BASE64,e.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw qD(tM.DATA_URL,"Malformed data URL.")}return iM(t)}(e.rest)}(t),function(e){e=new oM(e);return e.contentType}(t))}throw DD()}function iM(n){const r=[];for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);var i,s;e<=127?r.push(e):e<=2047?r.push(192|e>>6,128|63&e):55296==(64512&e)?t<n.length-1&&56320==(64512&n.charCodeAt(t+1))?(i=e,s=n.charCodeAt(++t),e=65536|(1023&i)<<10|1023&s,r.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):r.push(239,191,189):56320==(64512&e)?r.push(239,191,189):r.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(r)}function sM(t,e){switch(t){case tM.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw qD(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case tM.BASE64URL:r=-1!==e.indexOf("+"),n=-1!==e.indexOf("/");if(r||n)throw qD(t,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=atob(e)}catch(e){throw qD(t,"Invalid character found")}const s=new Uint8Array(i.length);for(let e=0;e<i.length;e++)s[e]=i.charCodeAt(e);return s}class oM{constructor(e){this.base64=!1,this.contentType=null;var t,n=e.match(/^data:([^,]+)?,/);if(null===n)throw qD(tM.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;null!=r&&(this.base64=(t=r,n=";base64",t.length>=n.length&&t.substring(t.length-n.length)===n),this.contentType=this.base64?r.substring(0,r.length-";base64".length):r),this.rest=e.substring(e.indexOf(",")+1)}}class aM{constructor(e,t){let n=0,r="";HD(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(HD(this.data_)){var n=this.data_,r=(i=e,r=t,(n=n).webkitSlice?n.webkitSlice(i,r):n.mozSlice?n.mozSlice(i,r):n.slice?n.slice(i,r):null);return null===r?null:new aM(r)}var i,r,e=new Uint8Array(this.data_.buffer,e,t-e);return new aM(e,!0)}static getBlob(...e){if(GD()){var t=e.map(e=>e instanceof aM?e.data_:e);return new aM(eM.apply(null,t))}{const r=e.map(e=>KD(e)?rM(tM.RAW,e).data:e.data_);let t=0;r.forEach(e=>{t+=e.byteLength});const i=new Uint8Array(t);let n=0;return r.forEach(t=>{for(let e=0;e<t.length;e++)i[n++]=t[e]}),new aM(i,!0)}}uploadData(){return this.data_}}function cM(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function lM(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function uM(e,t){return t}class hM{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||uM}}let dM=null;function fM(){if(dM)return dM;const e=[];e.push(new hM("bucket")),e.push(new hM("generation")),e.push(new hM("metageneration")),e.push(new hM("name","fullPath",!0));const t=new hM("name");t.xform=function(e,t){return!KD(t=t)||t.length<2?t:lM(t)},e.push(t);const n=new hM("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new hM("timeCreated")),e.push(new hM("updated")),e.push(new hM("md5Hash",null,!0)),e.push(new hM("cacheControl",null,!0)),e.push(new hM("contentDisposition",null,!0)),e.push(new hM("contentEncoding",null,!0)),e.push(new hM("contentLanguage",null,!0)),e.push(new hM("contentType",null,!0)),e.push(new hM("metadata","customMetadata",!0)),dM=e,dM}function pM(n,r){Object.defineProperty(n,"ref",{get:function(){var e=n.bucket,t=n.fullPath,t=new zD(e,t);return r._makeStorageReference(t)}})}function gM(e,t,n){t=cM(t);return null===t?null:function(e,t,n){const r={type:"file"};var i=n.length;for(let e=0;e<i;e++){const s=n[e];r[s.local]=s.xform(r,t[s.server])}return pM(r,e),r}(e,t,n)}function mM(t,n){const r={};var i=n.length;for(let e=0;e<i;e++){var s=n[e];s.writable&&(r[s.server]=t[s.local])}return JSON.stringify(r)}const yM="prefixes",vM="items";function _M(e,t,n){n=cM(n);return null===n?null:function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[yM])for(const o of n[yM]){var i=o.replace(/\/$/,""),i=e._makeStorageReference(new zD(t,i));r.prefixes.push(i)}if(n[vM])for(const a of n[vM]){var s=e._makeStorageReference(new zD(t,a.name));r.items.push(s)}return r}(e,t,n)}class wM{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function bM(e){if(!e)throw DD()}function IM(n,r){return function(e,t){return bM(null!==(t=gM(n,t,r))),t}}function TM(n,r){return function(e,t){return bM(null!==(t=_M(n,r,t))),t}}function EM(r,i){return function(e,t){var n=gM(r,t,i);return bM(null!==n),function(r,e,i){if(null===(e=cM(e)))return null;if(!KD(e.downloadTokens))return null;const t=e.downloadTokens;if(0===t.length)return null;const s=encodeURIComponent,n=t.split(",");return n.map(e=>{var t=r.bucket,n=r.fullPath;return YD("/b/"+s(t)+"/o/"+s(n),i)+JD({alt:"media",token:e})})[0]}(n,t,r.host)}}function SM(i){return function(e,t){let n;var r;return n=401===e.getStatus()?e.getResponseText().includes("Firebase App Check token is invalid")?new OD("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new OD("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=i.bucket,new OD("quota-exceeded","Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(e=i.path,new OD("unauthorized","User does not have permission to access '"+e+"'.")):t,n.serverResponse=t.serverResponse,n}}function kM(r){const i=SM(r);return function(e,t){let n=i(e,t);return 404===e.getStatus()&&(n=(e=r.path,new OD("object-not-found","Object '"+e+"' does not exist."))),n.serverResponse=t.serverResponse,n}}function CM(e,t,n){var r=YD(t.fullServerUrl(),e.host),i=e.maxOperationRetryTime;const s=new wM(r,"GET",IM(e,n),i);return s.errorHandler=kM(t),s}function AM(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=(e=t,(t=null)&&t.contentType||e&&e.type()||"application/octet-stream")),r}function RM(e,t,n,r,i){var s=t.bucketOnlyServerUrl();const o={"X-Goog-Upload-Protocol":"multipart"};var a=function(){let t="";for(let e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();o["Content-Type"]="multipart/related; boundary="+a;var c=AM(t,r,i),i="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+mM(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",a="\r\n--"+a+"--";const l=aM.getBlob(i,r,a);if(null===l)throw LD();a={name:c.fullPath},c=YD(s,e.host),s=e.maxUploadRetryTime;const u=new wM(c,"POST",IM(e,n),s);return u.urlParams=a,u.headers=o,u.body=l.uploadData(),u.errorHandler=SM(t),u}class NM{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function PM(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){bM(!1)}const r=t||["active"];return bM(!!n&&-1!==r.indexOf(n)),n}function OM(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),o=AM(t,r,i),i={name:o.fullPath},s=YD(s,e.host),r={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},n=mM(o,n),e=e.maxUploadRetryTime;const a=new wM(s,"POST",function(e){PM(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){bM(!1)}return bM(KD(t)),t},e);return a.urlParams=i,a.headers=r,a.body=n,a.errorHandler=SM(t),a}function xM(e,t,n,r){e=e.maxUploadRetryTime;const i=new wM(n,"POST",function(e){var t=PM(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){bM(!1)}return n||bM(!1),e=Number(n),bM(!isNaN(e)),new NM(e,r.size(),"final"===t)},e);return i.headers={"X-Goog-Upload-Command":"query"},i.errorHandler=SM(t),i}function DM(e,o,t,a,n,c,r,i){const l=new NM(0,0);if(r?(l.current=r.current,l.total=r.total):(l.current=0,l.total=a.size()),a.size()!==l.total)throw new OD("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var s=l.total-l.current;let u=s;0<n&&(u=Math.min(u,n));r=l.current,n=r+u,s={"X-Goog-Upload-Command":u===s?"upload, finalize":"upload","X-Goog-Upload-Offset":`${l.current}`};const h=a.slice(r,n);if(null===h)throw LD();n=o.maxUploadRetryTime;const d=new wM(t,"POST",function(e,t){var n=PM(e,["active","final"]),r=l.current+u,i=a.size();let s;return s="final"===n?IM(o,c)(e,t):null,new NM(r,i,"final"===n,s)},n);return d.headers=s,d.body=h.uploadData(),d.progressCallback=i||null,d.errorHandler=SM(e),d}const MM={STATE_CHANGED:"state_changed"},LM={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function FM(e){switch(e){case"running":case"pausing":case"canceling":return LM.RUNNING;case"paused":return LM.PAUSED;case"success":return LM.SUCCESS;case"canceled":return LM.CANCELED;case"error":default:return LM.ERROR}}class UM{constructor(e,t,n){"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=(e=e).next,this.error=e.error,this.complete=e.complete)}}function jM(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class qM{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=fM(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=e,this._transition("error"))},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":n(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var n=OM(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const i=this._uploadUrl;this._resolveToken((e,t)=>{var n=xM(this._ref.storage,this._ref._location,i,this._blob);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const i=262144*this._chunkMultiplier,s=new NM(this._transferred,this._blob.size()),o=this._uploadUrl;this._resolveToken((e,t)=>{let n;try{n=DM(this._ref._location,this._ref.storage,o,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var n=CM(this._ref.storage,this._ref._location,this._mappings);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var n=RM(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=MD(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=FM(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new UM(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){e=this._observers.indexOf(e);-1!==e&&this._observers.splice(e,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(FM(this._state)){case LM.SUCCESS:jM(this._resolve.bind(null,this.snapshot))();break;case LM.CANCELED:case LM.ERROR:const t=this._reject;jM(t.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(FM(this._state)){case LM.RUNNING:case LM.PAUSED:e.next&&jM(e.next.bind(e,this.snapshot))();break;case LM.SUCCESS:e.complete&&jM(e.complete.bind(e))();break;case LM.CANCELED:case LM.ERROR:e.error&&jM(e.error.bind(e,this._error))();break;default:e.error&&jM(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class VM{constructor(e,t){this._service=e,t instanceof zD?this._location=t:this._location=zD.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new VM(e,t)}get root(){var e=new zD(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return lM(this._location.path)}get storage(){return this._service}get parent(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;e=new zD(this._location.bucket,e);return new VM(this._service,e)}_throwIfRoot(e){if(""===this._location.path)throw jD(e)}}function BM(e){const t={prefixes:[],items:[]};return async function e(t,n,r){const i={pageToken:r};const s=await $M(t,i);n.prefixes.push(...s.prefixes);n.items.push(...s.items);null!=s.nextPageToken&&await e(t,n,s.nextPageToken)}(e,t).then(()=>t)}async function $M(e,t){null!=t&&"number"==typeof t.maxResults&&QD("options.maxResults",1,1e3,t.maxResults);t=t||{},t=function(e,t,n,r,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&0<n.length&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i),r=YD(t.bucketOnlyServerUrl(),e.host),i=e.maxOperationRetryTime;const o=new wM(r,"GET",TM(e,t.bucket),i);return o.urlParams=s,o.errorHandler=SM(t),o}(e.storage,e._location,"/",t.pageToken,t.maxResults);return(await e.storage.makeRequestWithTokens(t)).getPromise()}async function zM(e,t){e._throwIfRoot("updateMetadata");t=function(e,t,n,r){var i=YD(t.fullServerUrl(),e.host),s=mM(n,r),n=e.maxOperationRetryTime;const o=new wM(i,"PATCH",IM(e,r),n);return o.headers={"Content-Type":"application/json; charset=utf-8"},o.body=s,o.errorHandler=kM(t),o}(e.storage,e._location,t,fM());return(await e.storage.makeRequestWithTokens(t)).getPromise()}async function WM(e){e._throwIfRoot("getDownloadURL");var t=function(e,t,n){var r=YD(t.fullServerUrl(),e.host),i=e.maxOperationRetryTime;const s=new wM(r,"GET",EM(e,n),i);return s.errorHandler=kM(t),s}(e.storage,e._location,fM());return(await e.storage.makeRequestWithTokens(t)).getPromise().then(e=>{if(null===e)throw new OD("no-download-url","The given file does not have any download URLs.");return e})}async function KM(e){e._throwIfRoot("deleteObject");var t=function(e,t){var n=YD(t.fullServerUrl(),e.host),e=e.maxOperationRetryTime;const r=new wM(n,"DELETE",function(e,t){},e);return r.successCodes=[200,204],r.errorHandler=kM(t),r}(e.storage,e._location);return(await e.storage.makeRequestWithTokens(t)).getPromise()}function HM(e,t){var n,t=(n=e._location.path,t=(t=t).split("/").filter(e=>0<e.length).join("/"),0===n.length?t:n+"/"+t),t=new zD(e._location.bucket,t);return new VM(e.storage,t)}function GM(e,t){if(e instanceof JM){var n=e;if(null==n._bucket)throw new OD("no-default-bucket","No default bucket found. Did you set the '"+PD+"' property when initializing the app?");n=new VM(n,n._bucket);return null!=t?GM(n,t):n}return void 0!==t?HM(e,t):e}function QM(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof JM)return n=e,r=t,new VM(n,r);throw FD("To use ref(service, url), the first argument must be a Storage instance.")}return GM(e,t);var n,r}function YM(e,t){t=null==t?void 0:t[PD];return null==t?null:zD.makeFromBucketSpec(t,e)}class JM{constructor(e,t,n,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._pool=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=ND,this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?zD.makeFromBucketSpec(i,this._host):YM(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=zD.makeFromBucketSpec(this._url,e):this._bucket=YM(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){QD("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){QD("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){var t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new VM(this,e)}_makeRequest(e,t,n){if(this._deleted)return new WD(UD());{const l=(r=e,i=this._appId,s=t,o=n,a=this._pool,c=this._firebaseVersion,e=JD(r.urlParams),t=r.url+e,n=Object.assign({},r.headers),e=n,(i=i)&&(e["X-Firebase-GMPID"]=i),i=n,null!==(s=s)&&0<s.length&&(i.Authorization="Firebase "+s),c=c,n["X-Firebase-Storage-Version"]="webjs/"+(null!=c?c:"AppManager"),c=n,null!==(o=o)&&(c["X-Firebase-AppCheck"]=o),new XD(t,r.method,n,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,a));return this._requests.add(l),l.getPromise().then(()=>this._requests.delete(l),()=>this._requests.delete(l)),l}var r,i,s,o,a,c}async makeRequestWithTokens(e){var[t,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n)}}function XM(e,t,n){return e=to(e),t=t,n=n,(e=e)._throwIfRoot("uploadBytesResumable"),new qM(e,new aM(t),n)}function ZM(e){return async function(e){e._throwIfRoot("getMetadata");var t=CM(e.storage,e._location,fM());return(await e.storage.makeRequestWithTokens(t)).getPromise()}(e=to(e))}function eL(e,t){return QM(e=to(e),t)}function tL(e,t,n,r={}){!function(e,t,n,r={}){e.host=`http://${t}:${n}`;var{mockUserToken:r}=r;r&&(e._overrideAuthToken="string"==typeof r?r:ds(r,e.app.options.projectId))}(e,t,n,r)}Ro(new no("storage",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),e=e.getProvider("app-check-internal");return new JM(n,r,e,new $D,t,xo)},"PUBLIC").setMultipleInstances(!0)),Fo("@firebase/storage","0.7.0-2021720181311");var nL=function(e,t){return(nL=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var rL,iL="FirebaseError",sL=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}nL(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(oL,rL=Error),oL);function oL(e,t,n){t=rL.call(this,t)||this;return t.code=e,t.customData=n,t.name=iL,Object.setPrototypeOf(t,oL.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,aL.prototype.create),t}var aL=(cL.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i=t[0]||{},s=this.service+"/"+e,e=this.errors[e],e=e?(r=i,e.replace(hL,function(e,t){var n=r[t];return null!=n?String(n):"<"+t+"?>"})):"Error",e=this.serviceName+": "+e+" ("+s+").";return new sL(s,e,i)},cL);function cL(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var lL,uL,hL=/\{\$([^}]+)}/g,dL=(fL.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},fL.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},fL.prototype.setServiceProps=function(e){return this.serviceProps=e,this},fL.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},fL);function fL(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}class pL{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class gL{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new pL(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new pL(e,this,this._ref))},e)}on(e,t,n,r){let i=void 0;return t&&(i="function"==typeof t?e=>t(new pL(e,this,this._ref)):{next:t.next?e=>t.next(new pL(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class mL{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new yL(e,this._service))}get items(){return this._delegate.items.map(e=>new yL(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class yL{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){e=HM(this._delegate,e);return new yL(e,this.storage)}get root(){return new yL(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new yL(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new gL(XM(this._delegate,e,t),this)}putString(e,t=tM.RAW,n){this._throwIfRoot("putString");e=rM(t,e);const r=Object.assign({},n);return null==r.contentType&&null!=e.contentType&&(r.contentType=e.contentType),new gL(new qM(this._delegate,new aM(e.data,!0),r),this)}listAll(){return BM(to(this._delegate)).then(e=>new mL(e,this.storage))}list(e){return t=this._delegate,e=e||void 0,$M(t=to(t),e).then(e=>new mL(e,this.storage));var t}getMetadata(){return ZM(this._delegate)}updateMetadata(e){return zM(to(this._delegate),e)}getDownloadURL(){return WM(to(this._delegate))}delete(){return this._throwIfRoot("delete"),KM(to(this._delegate))}_throwIfRoot(e){if(""===this._delegate._location.path)throw jD(e)}}class vL{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(_L(e))throw FD("ref() expected a child path but got a URL, use refFromURL instead.");return new yL(eL(this._delegate,e),this)}refFromURL(e){if(!_L(e))throw FD("refFromURL() expected a full URL but got a child path, use ref() instead.");try{zD.makeFromUrl(e,this._delegate.host)}catch(e){throw FD("refFromUrl() expected a valid full URL but got an invalid one.")}return new yL(eL(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){tL(this._delegate,e,t,n)}}function _L(e){return/^[A-Za-z]+:\/\//.test(e)}function wL(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("storage").getImmediate({identifier:t});return new vL(n,t)}lL=Wo,uL={TaskState:LM,TaskEvent:MM,StringFormat:tM,Storage:vL,Reference:yL},lL.INTERNAL.registerComponent(new dL("storage-compat",wL,"PUBLIC").setServiceProps(uL).setMultipleInstances(!0)),lL.registerVersion("@firebase/storage-compat","0.1.0-2021720181311");G="0.5.0-2021720181311";const bL=G,IL="FB-PERF-TRACE-MEASURE",TL="@firebase/performance/config",EL="@firebase/performance/configexpire";var SL,kL,CL,dr="Performance";const AL=new Cs("performance",dr,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),RL=new mo(dr);RL.logLevel=lo.INFO;let NL,PL;class OL{constructor(e){if(!(this.window=e))throw AL.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled?!!ws()||(RL.info("IndexedDB is not supported by current browswer"),!1):(RL.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,n){if(this.PerformanceObserver){const t=new this.PerformanceObserver(e=>{for(const t of e.getEntries())n(t)});t.observe({entryTypes:[e]})}}static getInstance(){return void 0===NL&&(NL=new OL(PL)),NL}}let xL;function DL(t,n){var e=t.length-n.length;if(e<0||1<e)throw AL.create("invalid String merger input");const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),n.length>e&&r.push(n.charAt(e));return r.join("")}let ML;class LL{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=DL("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=DL("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===ML&&(ML=new LL),ML}}(dr=SL=SL||{})[dr.UNKNOWN=0]="UNKNOWN",dr[dr.VISIBLE=1]="VISIBLE",dr[dr.HIDDEN=2]="HIDDEN";const FL=["firebase_","google_","ga_"],UL=new RegExp("^[a-zA-Z]\\w*$");function jL(){switch(OL.getInstance().document.visibilityState){case"visible":return SL.VISIBLE;case"hidden":return SL.HIDDEN;default:return SL.UNKNOWN}}function qL(e){e=null===(e=e.options)||void 0===e?void 0:e.appId;if(!e)throw AL.create("no app id");return e}const VL="0.0.1",BL={loggingEnabled:!0},$L="FIREBASE_INSTALLATIONS_AUTH";function zL(e,t){var r,i,n=function(){const e=OL.getInstance().localStorage;if(e){var t=e.getItem(EL);if(t&&function(e){return Number(e)>Date.now()}(t)){t=e.getItem(TL);if(t)try{return JSON.parse(t)}catch(e){return}}}}();return n?(KL(n),Promise.resolve()):(i=t,function(e){const t=e.getToken();return t.then(e=>{}),t}((r=e).installations).then(e=>{var t=function(e){if(!(e=null===(e=e.options)||void 0===e?void 0:e.projectId))throw AL.create("no project id");return e}(r.app),n=function(e){if(!(e=null===(e=e.options)||void 0===e?void 0:e.apiKey))throw AL.create("no api key");return e}(r.app),e=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=${n}`,{method:"POST",headers:{Authorization:`${$L} ${e}`},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:qL(r.app),app_version:bL,sdk_version:VL})});return fetch(e).then(e=>{if(e.ok)return e.json();throw AL.create("RC response not ok")})}).catch(()=>{RL.info(WL)}).then(KL).then(e=>function(e){const t=OL.getInstance().localStorage;e&&t&&(t.setItem(TL,JSON.stringify(e)),t.setItem(EL,String(Date.now()+60*LL.getInstance().configTimeToLive*60*1e3)))}(e),()=>{}))}const WL="Could not fetch config, will use default configs";function KL(e){if(!e)return e;const t=LL.getInstance();var n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=BL.loggingEnabled,n.fpr_log_source&&(t.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(t.logEndPointUrl=n.fpr_log_endpoint_url),n.fpr_log_transport_key&&(t.transportKey=n.fpr_log_transport_key),void 0!==n.fpr_vc_network_request_sampling_rate&&(t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),t.logTraceAfterSampling=HL(t.tracesSamplingRate),t.logNetworkAfterSampling=HL(t.networkRequestsSamplingRate),e}function HL(e){return Math.random()<=e}let GL=1,QL;function YL(e){var t;return GL=2,QL=QL||(t=e,function(){const n=OL.getInstance().document;return new Promise(e=>{if(n&&"complete"!==n.readyState){const t=()=>{"complete"===n.readyState&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}().then(()=>function(e){const t=e.getId();return t.then(e=>{xL=e}),t}(t.installations)).then(e=>zL(t,e)).then(()=>JL(),()=>JL())),QL}function JL(){GL=3}const XL=1e4,ZL=3,eF=1e3;let tF=ZL,nF=[],rF=!1;function iF(e){setTimeout(()=>{if(0!==tF)return nF.length?void function(){const e=nF.splice(0,eF),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:LL.getInstance().logSource,log_event:t};!function(e,r){return function(e){var t=LL.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then(e=>(e.ok||RL.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let n=XL;isNaN(t)||(n=Math.max(t,n));e=e.logResponseDetails;Array.isArray(e)&&0<e.length&&"RETRY_REQUEST_LATER"===e[0].responseAction&&(nF=[...r,...nF],RL.info("Retry transport request later.")),tF=ZL,iF(n)})}(n,e).catch(()=>{nF=[...e,...nF],tF--,RL.info(`Tries left: ${tF}.`),iF(XL)})}():iF(XL)},e)}function sF(t){return(...e)=>{!function(e){if(!e.eventTime||!e.message)throw AL.create("invalid cc log");nF=[...nF,e]}({message:t(...e),eventTime:Date.now()})}}let oF;function aF(e,t){oF=oF||sF(uF),oF(e,t)}function cF(e){var t=LL.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&OL.getInstance().requiredApisAvailable()&&(e.isAuto&&jL()!==SL.VISIBLE||(3===GL?lF(e):YL(e.performanceController).then(()=>lF(e),()=>lF(e))))}function lF(e){var t;!xL||(t=LL.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>aF(e,1),0)}function uF(e,t){return 0===t?(t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},t={application_info:hF(e.performanceController.app),network_request_metric:t},JSON.stringify(t)):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);var n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);e={application_info:hF(e.performanceController.app),trace_metric:t};return JSON.stringify(e)}(e)}function hF(e){return{google_app_id:qL(e),app_instance_id:xL,web_app_info:{sdk_version:bL,page_url:OL.getInstance().getUrl(),service_worker_status:"serviceWorker"in(e=OL.getInstance().navigator)?e.serviceWorker.controller?2:3:1,visibility_state:jL(),effective_connection_type:function(){var e=OL.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}const dF=["_fp","_fcp","_fid"];class fF{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=OL.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${IL}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw AL.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw AL.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),cF(this)}record(e,t,n){if(e<=0)throw AL.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw AL.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Number(Math.floor(n.metrics[r])));cF(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(n=e,r=this.name,0===n.length||100<n.length||!(r&&r.startsWith("_wt_")&&-1<dF.indexOf(n))&&n.startsWith("_"))throw AL.create("invalid custom metric name",{customMetricName:e});var n,r;this.counters[e]=(e=t,(t=Math.floor(e))<e&&RL.info(`Metric value should be an Integer, setting the value as : ${t}.`),t)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var n,r,i=!(0===(n=e).length||40<n.length)&&(!FL.some(e=>n.startsWith(e))&&!!n.match(UL)),r=0!==(r=t).length&&r.length<=100;if(i&&r)this.customAttributes[e]=t;else{if(!i)throw AL.create("invalid attribute name",{attributeName:e});if(!r)throw AL.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure),e=e&&e[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){var i=OL.getInstance().getUrl();if(i){const s=new fF(e,"_wt_"+i,!0);i=Math.floor(1e3*OL.getInstance().getTimeOrigin());s.setStartTime(i),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));n&&((t=n.find(e=>"first-paint"===e.name))&&t.startTime&&s.putMetric("_fp",Math.floor(1e3*t.startTime)),(n=n.find(e=>"first-contentful-paint"===e.name))&&n.startTime&&s.putMetric("_fcp",Math.floor(1e3*n.startTime)),r&&s.putMetric("_fid",Math.floor(1e3*r))),cF(s)}}static createUserTimingTrace(e,t){cF(new fF(e,t,!1,t))}}function pF(e,t){const n=t;var r,i;n&&void 0!==n.responseStart&&(i=OL.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+i)),t=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,i=Math.floor(1e3*(n.responseEnd-n.startTime)),function(e){const t=LL.getInstance();var n,r,i;t.instrumentationEnabled&&(n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0],n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout(()=>aF(e,0),0))}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:t,timeToResponseCompletedUs:i}))}const gF=5e3;function mF(e){xL&&(setTimeout(()=>function(n){const e=OL.getInstance(),r=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{fF.createOobTrace(n,r,i),t=void 0},gF);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),fF.createOobTrace(n,r,i,e))})}else fF.createOobTrace(n,r,i)}(e),0),setTimeout(()=>function(t){const e=OL.getInstance(),n=e.getEntriesByType("resource");for(const r of n)pF(t,r);e.setupObserver("resource",e=>pF(t,e))}(e),0),setTimeout(()=>function(t){const e=OL.getInstance(),n=e.getEntriesByType("measure");for(const r of n)yF(t,r);e.setupObserver("measure",e=>yF(t,e))}(e),0))}function yF(e,t){const n=t.name;n.substring(0,IL.length)!==IL&&fF.createUserTimingTrace(e,n)}class vF{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),OL.getInstance().requiredApisAvailable()?bs().then(e=>{e&&(rF||(iF(5500),rF=!0),YL(this).then(()=>mF(this),()=>mF(this)),this.initialized=!0)}).catch(e=>{RL.info(`Environment doesn't support IndexedDB: ${e}`)}):RL.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){LL.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return LL.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){LL.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return LL.getInstance().dataCollectionEnabled}}Ro(new no("performance",(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==n.name)throw AL.create("FB not default");if("undefined"==typeof window)throw AL.create("no window");e=window,PL=e;const i=new vF(n,r);return i._init(t),i},"PUBLIC")),Fo("@firebase/performance",G);class _F{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=this._delegate,e=e,t=to(t),new fF(t,e);var t}}function wF(e){var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("performance").getImmediate();return new _F(t,e)}(kL=Wo).INTERNAL.registerComponent(new no("performance-compat",wF,"PUBLIC")),kL.registerVersion("@firebase/performance-compat","0.1.0-2021720181311");const bF="@firebase/remote-config";class IF{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const TF=new Cs("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}."});const EF=["1","true","t","yes","y","on"];class SF{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=EF.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return isNaN(e)&&(e=0),e}getSource(){return this._source}}async function kF(e){const t=to(e);var[n,e]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(n&&n.config&&n.eTag&&n.eTag!==e)&&(await Promise.all([t._storageCache.setActiveConfig(n.config),t._storage.setActiveConfigEtag(n.eTag)]),!0)}function CF(e){const t=to(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function AF(t){const n=to(t),e=new IF;setTimeout(async()=>{e.abort()},n.settings.fetchTimeoutMillis);try{await n._client.fetch({cacheMaxAgeMillis:n.settings.minimumFetchIntervalMillis,signal:e}),await n._storageCache.setLastFetchStatus("success")}catch(e){r=(r="fetch-throttle",(t=e)instanceof Ss&&-1!==t.code.indexOf(r)?"throttle":"failure");throw await n._storageCache.setLastFetchStatus(r),e}var r}function RF(n){const e=to(n);return[t={},r={}]=[e._storageCache.getActiveConfig(),e.defaultConfig],Object.keys(Object.assign(Object.assign({},t),r)).reduce((e,t)=>(e[t]=NF(n,t),e),{});var t,r}function NF(e,t){const n=to(e);n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value.");e=n._storageCache.getActiveConfig();return e&&void 0!==e[t]?new SF("remote",e[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new SF("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new SF("static"))}class PF{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,t=n<=e;return this.logger.debug("Config fetch cache check."+` Cache age millis: ${n}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${t}.`),t}async fetch(e){var[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag;e=await this.client.fetch(e);const r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===e.status&&r.push(this.storage.setLastSuccessfulFetchResponse(e)),await Promise.all(r),e}}class OF{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(n){var[e,t]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),r=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,i={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":n.eTag||"*"},t={sdk_version:this.sdkVersion,app_instance_id:e,app_instance_id_token:t,app_id:this.appId,language_code:(t=navigator).languages&&t.languages[0]||t.language},t={method:"POST",headers:i,body:JSON.stringify(t)},r=fetch(r,t),t=new Promise((e,t)=>{n.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let s;try{await Promise.race([r,t]),s=await r}catch(e){let t="fetch-client-network";throw"AbortError"===e.name&&(t="fetch-timeout"),TF.create(t,{originalErrorMessage:e.message})}let o=s.status;r=s.headers.get("ETag")||void 0;let a,c;if(200===s.status){let e;try{e=await s.json()}catch(e){throw TF.create("fetch-client-parse",{originalErrorMessage:e.message})}a=e.entries,c=e.state}if("INSTANCE_STATE_UNSPECIFIED"===c?o=500:"NO_CHANGE"===c?o=304:"NO_TEMPLATE"!==c&&"EMPTY_CONFIG"!==c||(a={}),304!==o&&200!==o)throw TF.create("fetch-status",{httpStatus:o});return{status:o,eTag:r,config:a}}}class xF{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:n}){var i,s;i=t.signal,s=e,await new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(TF.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var r=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),r}catch(e){if(!function(e){if(e instanceof Ss&&e.customData){e=Number(e.customData.httpStatus);return 429===e||500===e||503===e||504===e}}(e))throw e;n={throttleEndTimeMillis:Date.now()+eo(n),backoffCount:n+1};return await this.storage.setThrottleMetadata(n),this.attemptFetch(t,n)}}}class DF{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function MF(e,t){e=e.target.error||void 0;return TF.create(t,{originalErrorMessage:e&&e.message})}const LF="app_namespace_store";class FF{constructor(e,t,n,r=function(){return new Promise((t,n)=>{const e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{n(MF(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(LF,{keyPath:"compositeKey"})}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(o){const a=await this.openDbPromise;return new Promise((t,n)=>{const e=a.transaction([LF],"readonly"),r=e.objectStore(LF);var i=this.createCompositeKey(o);try{const s=r.get(i);s.onerror=e=>{n(MF(e,"storage-get"))},s.onsuccess=e=>{e=e.target.result;t(e?e.value:void 0)}}catch(e){n(TF.create("storage-get",{originalErrorMessage:e&&e.message}))}})}async set(o,a){const c=await this.openDbPromise;return new Promise((e,t)=>{const n=c.transaction([LF],"readwrite"),r=n.objectStore(LF);var i=this.createCompositeKey(o);try{const s=r.put({compositeKey:i,value:a});s.onerror=e=>{t(MF(e,"storage-set"))},s.onsuccess=()=>{e()}}catch(e){t(TF.create("storage-set",{originalErrorMessage:e&&e.message}))}})}async delete(o){const a=await this.openDbPromise;return new Promise((e,t)=>{const n=a.transaction([LF],"readwrite"),r=n.objectStore(LF);var i=this.createCompositeKey(o);try{const s=r.delete(i);s.onerror=e=>{t(MF(e,"storage-delete"))},s.onsuccess=()=>{e()}}catch(e){t(TF.create("storage-delete",{originalErrorMessage:e&&e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class UF{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),e=await e;e&&(this.lastFetchStatus=e);t=await t;t&&(this.lastSuccessfulFetchTimestampMillis=t);n=await n;n&&(this.activeConfig=n)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}Ro(new no("remote-config",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw TF.create("registration-window");var{projectId:i,apiKey:s,appId:e}=n.options;if(!i)throw TF.create("registration-project-id");if(!s)throw TF.create("registration-api-key");if(!e)throw TF.create("registration-app-id");t=t||"firebase";const o=new FF(e,n.name,t),a=new UF(o),c=new mo(bF);c.logLevel=lo.ERROR;e=new OF(r,xo,t,i,s,e),e=new xF(e,o),e=new PF(e,o,a,c),e=new DF(n,e,a,o,c);return CF(e),e},"PUBLIC").setMultipleInstances(!0)),Fo(bF,"0.2.0-2021720181311");class jF{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return kF(this._delegate)}ensureInitialized(){return CF(this._delegate)}fetch(){return AF(this._delegate)}fetchAndActivate(){return async function(e){return await AF(e=to(e)),kF(e)}(this._delegate)}getAll(){return RF(this._delegate)}getBoolean(e){return NF(to(this._delegate),e).asBoolean()}getNumber(e){return NF(to(this._delegate),e).asNumber()}getString(e){return NF(to(this._delegate),e).asString()}getValue(e){return NF(this._delegate,e)}setLogLevel(e){!function(e,t){const n=to(e);switch(t){case"debug":n._logger.logLevel=lo.DEBUG;break;case"silent":n._logger.logLevel=lo.SILENT;break;default:n._logger.logLevel=lo.ERROR}}(this._delegate,e)}}function qF(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("remote-config").getImmediate({identifier:t});return new jF(n,t)}return(CL=Wo).INTERNAL.registerComponent(new no("remoteConfig-compat",qF,"PUBLIC").setMultipleInstances(!0)),CL.registerVersion("@firebase/remote-config-compat","0.1.0-2021720181311"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Wo.registerVersion("firebase","9.0.0-2021720181311","compat-cdn"),Wo});
//# sourceMappingURL=firebase-compat.js.map
